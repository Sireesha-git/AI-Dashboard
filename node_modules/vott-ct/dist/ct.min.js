!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(window,(function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=36)}([function(t,e,i){"use strict";(function(t){i.d(e,"c",(function(){return r})),i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return o}));var n=Math.PI/180;const r=void 0!==t?t:"undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope?self:{},s={_global:r,version:"8.4.2",isBrowser:"undefined"!=typeof window&&("[object Window]"==={}.toString.call(window)||"[object global]"==={}.toString.call(window)),isUnminified:/param/.test(function(t){}.toString()),dblClickWindow:400,getAngle:t=>s.angleDeg?t*n:t,enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,pixelRatio:"undefined"!=typeof window&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging:()=>s.DD.isDragging,isDragReady:()=>!!s.DD.node,releaseCanvasOnDestroy:!0,document:r.document,_injectGlobal(t){r.Konva=t}},o=t=>{s[t.prototype.getClassName()]=t};s._injectGlobal(s)}).call(this,i(39))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Point2D=void 0;class n{constructor(t,e){"number"==typeof t&&"number"==typeof e?(this.x=t,this.y=e):void 0!==t.x&&void 0!==t.y&&(this.x=t.x,this.y=t.y)}static BuildFromJSON(t){return new n(t.x,t.y)}move(t,e){"number"==typeof t&&"number"==typeof e?(this.x=t,this.y=e):void 0!==t.x&&void 0!==t.y&&(this.x=t.x,this.y=t.y)}shift(t,e){this.x+=t,this.y+=e}boundToRect(t){return new n(this.x<0?0:this.x>t.width?t.width:this.x,this.y<0?0:this.y>t.height?t.height:this.y)}squareDistanceToPoint(t){return(this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y)}squareDistanceToLine(t,e){const i=t.squareDistanceToPoint(e);let r;if(0===i)r=this.squareDistanceToPoint(t);else{const s=((this.x-t.x)*(e.x-t.x)+(this.y-t.y)*(e.y-t.y))/i,o=Math.max(0,Math.min(1,s)),a=new n(t.x+o*(e.x-t.x),t.y+o*(e.y-t.y));r=this.squareDistanceToPoint(a)}return r}copy(){return new n(this.x,this.y)}toString(){return`{${this.x.toString()}, ${this.y.toString()}}`}toJSON(){return{x:this.x,y:this.y}}}e.Point2D=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Rect=void 0;class n{constructor(t,e){this.width=0,this.height=0,this.resize(t,e)}static BuildFromJSON(t){return new n(t.width,t.height)}resize(t,e){t>=0&&e>=0&&(this.width=t,this.height=e)}copy(){return new n(this.width,this.height)}toString(){return`[${this.width.toString()}, ${this.height.toString()}]`}toJSON(){return{width:this.width,height:this.height}}}e.Rect=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ChangeEventType=void 0,function(t){t[t.MOVEEND=0]="MOVEEND",t[t.MOVING=1]="MOVING",t[t.MOVEBEGIN=2]="MOVEBEGIN",t[t.SELECTIONTOGGLE=3]="SELECTIONTOGGLE"}(e.ChangeEventType||(e.ChangeEventType={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RegionData=e.RegionDataType=void 0;const n=i(40),r=i(27);Object.defineProperty(e,"RegionDataType",{enumerable:!0,get:function(){return r.RegionDataType}});const s=i(20),o=i(41),a=i(1),h=i(2);class l{constructor(t,e,i,n,s,l,c){this.corner=new a.Point2D(t,e),this.regionRect=new h.Rect(i,n),this.regionPoints=null!=s?s:[],this.regionBezierControls=new o.CubicBezierIndex(c),this.regionType=null!=l?l:r.RegionDataType.Point}static BuildPointRegionData(t,e){return new l(t,e,0,0,[new a.Point2D(t,e)],r.RegionDataType.Point)}static BuildRectRegionData(t,e,i,n){return new l(t,e,i,n,[new a.Point2D(t,e),new a.Point2D(t+i,e),new a.Point2D(t+i,e+n),new a.Point2D(t,e+n)],r.RegionDataType.Rect)}static BuildPolygonRegionData(t,e,i,n,s){return new l(t,e,i,n,s.map(t=>new a.Point2D(t.x,t.y)),r.RegionDataType.Polygon)}static BuildPathRegionData(t,e,i,n,s,h){return new l(t,e,i,n,s.map(t=>new a.Point2D(t.x,t.y)),r.RegionDataType.Path,o.CubicBezierIndex.buildFromJSON(h))}static BuildFromJson(t){return new l(t.x,t.y,t.width,t.height,t.points.map(t=>new a.Point2D(t.x,t.y)),t.type,o.CubicBezierIndex.buildFromJSON(t.bezierControls))}get x(){return this.corner.x}set x(t){this.move(t,this.y)}get y(){return this.corner.y}set y(t){this.move(this.x,t)}get width(){return this.regionRect.width}set width(t){this.resize(t,this.height)}get height(){return this.regionRect.height}set height(t){this.resize(this.width,t)}get area(){let t;return t=this.regionType===r.RegionDataType.Point?1:this.regionRect.width*this.regionRect.height,t}get boundRect(){return this.regionRect.copy()}set boundRect(t){this.resize(t.width,t.height)}get points(){return this.regionPoints.map(t=>t.copy())}set points(t){this.setPoints(t)}get bezierControls(){return this.regionBezierControls.copy()}get type(){return this.regionType}move(t,e){const i=this.x,n=this.y;this.corner.move(t,e);const r=this.x-i,s=this.y-n;this.regionPoints.forEach(t=>{t.shift(r,s)}),this.regionBezierControls=this.regionBezierControls.shift(r,s)}resize(t,e){const i=t/this.width,n=e/this.height;this.regionRect.resize(t,e);const r=t=>{const e=(t.x-this.x)*i+this.x,r=(t.y-this.y)*n+this.y;return new a.Point2D(e,r)};this.regionPoints=this.regionPoints.map(r),this.regionBezierControls=this.regionBezierControls.move(r)}setPoint(t,e){e>=0&&e<this.regionPoints.length&&(this.regionPoints[e]=new a.Point2D(t)),this.resetBBox()}splicePoints(t,e=0,...i){const n=this.regionPoints.length,r=t<0?t:t>n?n:t,s=[];0===r?s.push(n-1):s.push(r-1);for(let t=r;t<r+e;t++)s.push(t);const h=i.length-e,l={};this.regionBezierControls.forEach((t,e)=>{if(!s.includes(e)){if(!(e>=r))return l[e]=t.copy();l[e+h]=t.copy()}}),this.regionBezierControls=new o.CubicBezierIndex(l),this.regionPoints.splice(r,e,...i.map(t=>new a.Point2D(t))),this.resetBBox()}setBezierControl(t,e){this.setBezierControls({[t]:e})}setBezierControls(t){this._setBezierControls(t),this.resetBBox()}deleteBezierControls(t){this._deleteBezierControls(t),this.resetBBox()}setPoints(t){this.regionPoints=t.map(t=>new a.Point2D(t)),this.resetBBox()}initFrom(t){this.corner=new a.Point2D(t.x,t.y),this.regionRect=new h.Rect(t.width,t.height),this.regionPoints=t.points.map(t=>new a.Point2D(t.x,t.y)),this.regionBezierControls=o.CubicBezierIndex.buildFromJSON(t.bezierControls)}boundToRect(t){const e=new a.Point2D(this.x+this.width,this.y+this.height).boundToRect(t),i=this.corner.boundToRect(t),n=e.x-i.x,r=e.y-i.y;return new l(i.x,i.y,n,r,this.regionPoints.map(e=>e.boundToRect(t)),this.regionType,this.regionBezierControls.boundToRect(t))}scale(t,e){const i=t,n=void 0!==e?e:t,r=t=>new a.Point2D(t.x*i,t.y*n);var s;this.corner=r(this),this.regionRect=(s=this,new h.Rect(s.width*i,s.height*n)),this.regionPoints=this.regionPoints.map(r),this.regionBezierControls=this.regionBezierControls.scale(r)}copy(){return new l(this.x,this.y,this.width,this.height,this.regionPoints.map(t=>t.copy()),this.regionType,this.regionBezierControls.copy())}getLineSegments(){return n.calculateLineSegments(this.regionPoints,{regionType:this.regionType})}toString(){return`${this.corner.toString()} x ${this.boundRect.toString()}: {${this.regionPoints.toString()}}, {${this.regionBezierControls.toString()}}`}toPath(){const t=this.getLineSegments(),e=t.length,i=this.regionPoints,n=this.regionBezierControls;if(1===i.length)return`M${i[0].x},${i[0].y} m-1,0 a1,1 0 1 0 2,0 a1,1 0 1 0 -2,0`;const r=[];for(let i=0;i<e;i++){const e=t[i];0===i&&r.push(`M${e.start.x},${e.start.y}`),n[i]?r.push(`C${n[i].c1.x},${n[i].c1.y} ${n[i].c2.x},${n[i].c2.y} ${e.end.x},${e.end.y}`):r.push(`L${e.end.x},${e.end.y}`)}return r.join(" ")}toLinePathSegments(){const t=this.getLineSegments(),e=t.length,i=this.regionBezierControls,n=[];for(let r=0;r<e;r++){const e=t[r];i[r]?n.push(`M${e.start.x},${e.start.y} C${i[r].c1.x},${i[r].c1.y} ${i[r].c2.x},${i[r].c2.y} ${e.end.x},${e.end.y}`):n.push(`M${e.start.x},${e.start.y} L${e.end.x},${e.end.y}`)}return n}toJSON(){return{x:this.x,y:this.y,width:this.width,height:this.height,points:this.regionPoints.map(t=>({x:t.x,y:t.y})),bezierControls:this.regionBezierControls.toJSON(),type:this.regionType}}_deleteBezierControls(t){(Array.isArray(t)?t:[t]).forEach(t=>delete this.regionBezierControls[t])}_setBezierControls(t){const e=this.getLineSegmentCount();Object.entries(t).forEach(([t,i])=>{const n=Number(t);n<0||n>=e||(this.regionBezierControls[n]=new s.CubicBezierControl(i))})}resetBBox(){const{x:t,y:e,height:i,width:n}=Snap.path.getBBox(this.toPath());this.corner.move(t,e),this.regionRect.resize(n,i)}getLineSegmentCount(){const t=this.regionPoints.length;return[r.RegionDataType.Polygon,r.RegionDataType.Path].includes(this.regionType)?t:t-1}}e.RegionData=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RegionComponent=void 0;e.RegionComponent=class{constructor(t,e,i,n=null){this.isVisible=!0,this.isFrozen=!1,this.isSelected=!1,this.paper=t,this.paperRect=e,this.regionData=i,this.callbacks=n}get x(){return this.regionData.x}get y(){return this.regionData.y}get width(){return this.regionData.boundRect.width}get height(){return this.regionData.boundRect.height}get area(){return this.regionData.area}get boundRect(){return this.regionData.boundRect}hide(){this.node.node.setAttribute("display","none"),this.isVisible=!1}show(){this.node.node.setAttribute("display","inherit"),this.isVisible=!0}select(){this.isSelected=!0,this.node.addClass("selected")}unselect(){this.isSelected=!1,this.node.removeClass("selected")}freeze(){this.isFrozen=!0}unfreeze(){this.isFrozen=!1}move(t,e){this.regionData.move(t,e),this.redraw()}resize(t,e){this.regionData.resize(t,e),this.redraw()}resizePaper(t,e){this.paperRect.resize(t,e)}subscribeToEvents(t){t.forEach(t=>{t.base.addEventListener(t.event,this.makeFreezable(t.listener.bind(this),t.bypass))})}makeFreezable(t,e=!1){return i=>{this.isFrozen&&!e||t(i)}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ToolbarIcon=e.ToolbarItemType=void 0,function(t){t[t.SELECTOR=0]="SELECTOR",t[t.SWITCH=1]="SWITCH",t[t.SEPARATOR=2]="SEPARATOR",t[t.TRIGGER=3]="TRIGGER"}(e.ToolbarItemType||(e.ToolbarItemType={}));class n{constructor(t,e){this.isSelected=!1,this.focused=!1,this.onfocusCallback=()=>{this.focused=!0},this.onfocusoutCallback=()=>{this.focused=!1},this.paper=t,null!=e?(this.description=e,void 0!==e.width?this.width=e.width:this.width=n.IconWidth,void 0!==e.height?this.height=e.height:this.height=n.IconHeight):(this.description=null,this.width=n.IconWidth,this.height=n.IconHeight)}move(t,e){this.x=t,this.y=e}resize(t,e){this.width=t,this.height=e}select(){this.node.addClass("selected"),this.isSelected=!0}unselect(){this.node.removeClass("selected"),this.isSelected=!1}isFocused(){return this.focused}toggleSelection(){this.isSelected?this.unselect():this.select()}}e.ToolbarIcon=n,n.IconWidth=48,n.IconHeight=48},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Region=void 0;const n=i(5);class r extends n.RegionComponent{constructor(t,e=null,i,n,r,s,o){super(t,e,i,Object.assign({},n)),this.styleSheet=null,this.ID=r,this.tags=s,this.regionID=this.s8(),this.styleID=`region_${this.regionID}_style`,this.styleSheet=this.insertStyleSheet(),this.tagsUpdateOptions=o,this.UI=[];const a=this.callbacks.onChange;this.callbacks.onChange=(t,e,...i)=>{this.regionData.initFrom(e),this.redraw(),a(this,this.regionData,...i)}}removeStyles(){document.getElementById(this.styleID).remove()}updateTags(t,e){this.tags=t,this.tagsUpdateOptions=e}move(t,e){super.move(t,e),this.redraw()}resize(t,e){super.resize(t,e),this.redraw()}redraw(){this.UI.forEach(t=>{t.redraw()})}freeze(){super.freeze(),this.node.addClass("old"),this.UI.forEach(t=>{t.freeze()})}unfreeze(){super.unfreeze(),this.node.removeClass("old"),this.UI.forEach(t=>{t.unfreeze()})}s8(){return Math.floor(4294967296*(1+Math.random())).toString(16).substring(1)}insertStyleSheet(){const t=document.createElement("style");return t.setAttribute("id",this.styleID),document.head.appendChild(t),t.sheet}}e.Region=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AnchorsComponent=void 0;const n=i(1),r=i(3),s=i(5);class o extends s.RegionComponent{constructor(t,e=null,i,n){super(t,e,i,n),this.mixins=[],this.activeAnchorIndex=0,this.isDragged=!1,this.node=this.paper.g(),this.node.addClass("anchorsLayer"),this.anchors=[],this.anchorsNode=this.paper.g(),this.node.add(this.anchorsNode),this.buildAnchors()}redraw(){null!==this.regionData.points&&this.regionData.points.length>0&&this.anchors.length>0&&window.requestAnimationFrame(()=>{this.regionData.points.forEach((t,e)=>{this.anchors[e].attr({cx:t.x,cy:t.y})})}),this.mixins.forEach(t=>t.redraw())}freeze(){super.freeze()}buildAnchors(){this.buildPointAnchors(),this.buildGhostAnchor(),this.subscribeToEvents([{event:"pointerleave",base:this.node.node,listener:t=>{this.isDragged||window.requestAnimationFrame(()=>{this.ghostAnchor.attr({display:"none"})})},bypass:!0}]),this.mixins.forEach(t=>t.buildAnchors())}buildPointAnchors(){this.regionData.points.forEach((t,e)=>{const i=this.createAnchor(this.paper,t.x,t.y);this.anchors.push(i),this.anchorsNode.add(i),this.subscribeAnchorToEvents(i,e+1)})}buildGhostAnchor(){this.ghostAnchor=this.createAnchor(this.paper,0,0,"ghost",o.DEFAULT_GHOST_ANCHOR_RADIUS),this.ghostAnchor.attr({display:"none"}),this.node.add(this.ghostAnchor),this.subscribeGhostToEvents()}subscribeAnchorToEvents(t,e){this.subscribeToEvents([{event:"pointerenter",base:t.node,listener:t=>{this.activeAnchorIndex=e;const i=this.getActiveAnchorPoint(t);window.requestAnimationFrame(()=>{this.ghostAnchor.attr({cx:i.x,cy:i.y,display:"block"})})},bypass:!1}])}createAnchor(t,e,i,n,r=o.DEFAULT_ANCHOR_RADIUS){const s=t.circle(e,i,r);return s.addClass("anchorStyle"),void 0!==n&&""!==n&&s.addClass(n),s}onGhostPointerEnter(t){}onGhostPointerLeave(t){this.isDragged||(window.requestAnimationFrame(()=>{this.ghostAnchor.attr({display:"none"})}),this.activeAnchorIndex=0)}onGhostPointerDown(t){this.ghostAnchor.node.setPointerCapture(t.pointerId);const e=t.clientX-t.target.closest("svg").getBoundingClientRect().left,i=t.clientY-t.target.closest("svg").getBoundingClientRect().top;this.dragOrigin=new n.Point2D(e,i),this.isDragged=!0,this.callbacks.onManipulationLockRequest(this),this.callbacks.onChange(this,this.regionData.copy(),r.ChangeEventType.MOVEBEGIN)}onGhostPointerMove(t){if(this.isDragged){const e=t.target.getBoundingClientRect(),i=t.clientX-e.left,r=t.clientY-e.top,s=t.clientX-t.target.closest("svg").getBoundingClientRect().left,o=t.clientY-t.target.closest("svg").getBoundingClientRect().top;let a=s-this.dragOrigin.x,h=o-this.dragOrigin.y;if((i<0&&a>0||i>0&&a<0)&&(a=0),(r<0&&h>0||r>0&&h<0)&&(h=0),0!==this.activeAnchorIndex){const e=this.getActiveAnchorPoint(t);let i=new n.Point2D(e.x+a,e.y+h);null!==this.paperRect&&(i=i.boundToRect(this.paperRect)),window.requestAnimationFrame(()=>{this.ghostAnchor.attr({cx:i.x,cy:i.y})}),this.updateRegion(i)}this.dragOrigin=new n.Point2D(s,o)}}onGhostPointerUp(t){this.ghostAnchor.node.releasePointerCapture(t.pointerId),this.callbacks.onManipulationLockRelease(this),this.callbacks.onChange(this,this.regionData.copy(),r.ChangeEventType.MOVEEND),this.activeAnchorIndex=0,this.dragOrigin=null,this.isDragged=!1,window.requestAnimationFrame(()=>{this.ghostAnchor.attr({display:"none"})})}subscribeGhostToEvents(){const t=[{event:"pointerenter",base:this.ghostAnchor.node,listener:this.onGhostPointerEnter,bypass:!1},{event:"pointerleave",base:this.ghostAnchor.node,listener:this.onGhostPointerLeave,bypass:!1},{event:"pointerdown",base:this.ghostAnchor.node,listener:this.onGhostPointerDown,bypass:!1},{event:"pointerup",base:this.ghostAnchor.node,listener:this.onGhostPointerUp,bypass:!1},{event:"pointermove",base:this.ghostAnchor.node,listener:this.onGhostPointerMove,bypass:!1}];this.subscribeToEvents(t)}getActiveAnchorPoint(t){return this.activeAnchorIndex>0?this.regionData.points[this.activeAnchorIndex-1]:null}}e.AnchorsComponent=o,o.DEFAULT_ANCHOR_RADIUS=3,o.DEFAULT_GHOST_ANCHOR_RADIUS=7},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TagsComponent=void 0;const n=i(5);class r extends n.RegionComponent{constructor(t,e,i,n,r,s,o){super(t,e,i,null),this.styleSheet=null,this.styleMap=[],this.styleLightMap=[],this.styleId=r,this.styleSheet=s,this.tags=n,this.tagsUpdateOptions=o,this.node=t.g(),this.node.addClass("tagsLayer")}static getCachedBBox(t){const e=t.node.innerHTML;return r.bboxCache[e]||(r.bboxCache[e]=t.getBBox()),r.bboxCache[e]}updateTags(t,e){this.tags=t,this.tagsUpdateOptions=e,this.rebuildTagLabels(),this.clearStyleMaps(),this.initStyleMaps(t);const i=void 0===e||e.showRegionBackground;this.applyStyleMaps(i);const n=void 0===e||e.showTagsText;this.applyStyleForTagsVisibility(n)}clearStyleMaps(){for(;this.styleSheet.cssRules.length>0;)this.styleSheet.deleteRule(0)}applyStyleMaps(t=!0){this.tags&&void 0!==this.tags.primary&&window.requestAnimationFrame(()=>{const e=t?this.styleMap:this.styleLightMap;for(const t of e)this.styleSheet.insertRule(`${t.rule}{${t.style}}`,0)})}applyStyleForTagsVisibility(t=!0){if(this.tags&&void 0!==this.tags.primary){const e=t?"block":"none",i=[{rule:`.${this.styleId} .primaryTagTextBGStyle`,style:`display: ${e};`},{rule:`.${this.styleId} .primaryTagTextStyle`,style:`display: ${e};`}];window.requestAnimationFrame(()=>{for(const t of i)this.styleSheet.insertRule(`${t.rule}{${t.style}}`,0)})}}}e.TagsComponent=r,r.bboxCache={}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Selector=void 0;const n=i(21);class r extends n.Element{constructor(t,e,i,n){super(e,i),this.isEnabled=!0,this.parentNode=t,this.callbacks=void 0!==n?n:{onLocked:null,onSelectionBegin:null,onSelectionEnd:null,onUnlocked:null,onMaskSelection:null}}enable(){this.isEnabled||(this.isEnabled=!0,this.show())}disable(){this.isEnabled&&(this.isEnabled=!1,this.hide())}subscribeToEvents(t){t.forEach(t=>{t.base.addEventListener(t.event,this.enablify(t.listener.bind(this),t.bypass))})}enablify(t,e=!1){return i=>{(this.isEnabled||e)&&t(i)}}showAll(t){window.requestAnimationFrame(()=>{t.forEach(t=>{void 0!==t.show?t.show():t.node.setAttribute("visibility","visible")})})}hideAll(t){window.requestAnimationFrame(()=>{t.forEach(t=>{void 0!==t.hide?t.hide():t.node.setAttribute("visibility","hidden")})})}resizeAll(t){window.requestAnimationFrame(()=>{t.forEach(t=>{t.resize(this.boundRect.width,this.boundRect.height)})})}moveCross(t,e,i=!1,n=null){t.move(e,this.boundRect,i,n)}movePoint(t,e){t.attr({cx:e.x,cy:e.y})}moveLine(t,e,i){t.attr({x1:e.x,x2:i.x,y1:e.y,y2:i.y})}}e.Selector=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LABColor=void 0;const n=i(18);e.LABColor=class{constructor(t,e,i){this.values=[t,e,i]}get l(){return this.values[0]}get a(){return this.values[1]}get b(){return this.values[2]}distanceTo(t){const e=this.values[0]-t.values[0],i=this.values[1]-t.values[1],n=this.values[2]-t.values[2],r=Math.sqrt(this.values[1]*this.values[1]+this.values[2]*this.values[2]),s=r-Math.sqrt(t.values[1]*t.values[1]+t.values[2]*t.values[2]);let o=i*i+n*n-s*s;o=o<0?0:Math.sqrt(o);const a=e/1,h=s/(1+.045*r),l=o/(1+.015*r),c=a*a+h*h+l*l;return c<0?0:Math.sqrt(c)}distanceTo_00(t){const[e,i,n]=this.values,[r,s,o]=t.values,a=Math.PI/180,h=180/Math.PI,l=r-e,c=(e+r)/2,d=((Math.sqrt(i*i+n*n)+Math.sqrt(s*s+o*o))/2)**7,g=Math.sqrt(d/(d+25**7)),u=i+.5*i*(1-g),p=s+.5*s*(1-g),f=Math.sqrt(u*u+n*n),y=Math.sqrt(p*p+o*o),m=(f+y)/2,v=y-f,b=0===n&&0===u?0:Math.atan2(n,u)*h%360,S=0===o&&0===p?0:Math.atan2(o,p)*h%360;let x=S-b;const w=Math.abs(x);S<=b&&w>180&&(x+=360),S>b&&w>180&&(x-=360);const C=2*Math.sqrt(f*y)*Math.sin(.5*x*a);let A=(b+S)/2;w>180&&b+S<360&&(A+=180),w>180&&b+S>=360&&(A-=180);const T=1-.17*Math.cos((A-30)*a)+.24*Math.cos(2*A*a)+.32*Math.cos((3*A+6)*a)-.2*Math.cos((4*A-63)*a),_=1+.015*(c-50)/Math.sqrt(20+(c-50)*(c-50)),R=1+.045*m,P=1+.015*m*T,E=-2*g*Math.sin(60*Math.exp(-(A-275)/25*((A-275)/25))*a);return Math.sqrt((l/(1*_))**2+(v/(1*R))**2+(C/(1*P))**2+E*(v/(1*R))*(C/(1*P)))}distanceToGray(){return Math.sqrt(this.a*this.a+this.b*this.b)}toArray(){return this.values.map(t=>t)}toXYZ(){let t=(100*this.l+16)/116,e=this.a/5+t,i=t-this.b/2;return[e,t,i]=[e,t,i].map(t=>{const e=t*t*t;return e>.008856451?e:(t-16/116)/7.787037}),new n.XYZColor(e*n.XYZColor.D65.x,t*n.XYZColor.D65.y,i*n.XYZColor.D65.z)}toRGB(){return this.toXYZ().toRGB()}toSRGB(){return this.toXYZ().toRGB().toSRGB()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ConfigurationManager=void 0;class n{}e.ConfigurationManager=n,n.isModifyRegionOnlyMode=!1,n.isPathRegionEnabled=!1,n.isMaskEnabled=!1},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SelectionMode=void 0,function(t){t[t.NONE=0]="NONE",t[t.POINT=1]="POINT",t[t.RECT=2]="RECT",t[t.COPYRECT=3]="COPYRECT",t[t.POLYLINE=4]="POLYLINE",t[t.POLYGON=5]="POLYGON",t[t.BRUSH=6]="BRUSH",t[t.ERASER=7]="ERASER"}(e.SelectionMode||(e.SelectionMode={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DragComponent=void 0;const n=i(1),r=i(3),s=i(5);class o extends s.RegionComponent{constructor(t,e=null,i,n){super(t,e,i,n),this.isDragged=!1,this.node=t.g(),this.node.addClass("dragLayer")}freeze(){super.freeze(),this.isDragged=!1,this.dragOrigin=null}subscribeToDragEvents(){const t=[{event:"pointerenter",base:this.dragNode.node,listener:t=>{this.isDragged&&t.stopPropagation()},bypass:!1},{event:"pointermove",base:this.dragNode.node,listener:t=>{if(this.isDragged){const e=t.target.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top;let o=t.clientX-this.dragOrigin.x,a=t.clientY-this.dragOrigin.y;(i<0&&o>0||i>this.width&&o<0)&&(o=0),(s<0&&a>0||s>this.height&&a<0)&&(a=0);let h=new n.Point2D(this.x+o,this.y+a);null!==this.paperRect&&(h=h.boundToRect(this.paperRect)),this.dragOrigin=new n.Point2D(t.clientX,t.clientY);const l=this.regionData.copy();l.move(h),this.callbacks.onChange(this,l,r.ChangeEventType.MOVING)}},bypass:!1},{event:"pointerleave",base:this.dragNode.node,listener:t=>{},bypass:!1},{event:"pointerdown",base:this.dragNode.node,listener:t=>{this.dragNode.node.setPointerCapture(t.pointerId);const e=t.ctrlKey;this.isDragged=!0,this.dragOrigin=new n.Point2D(t.clientX,t.clientY),this.callbacks.onManipulationLockRequest(this),this.callbacks.onChange(this,this.regionData.copy(),r.ChangeEventType.MOVEBEGIN,e)},bypass:!1},{event:"pointerup",base:this.dragNode.node,listener:t=>{this.dragNode.node.releasePointerCapture(t.pointerId);const e=t.ctrlKey;this.isDragged&&(this.callbacks.onChange(this,this.regionData.copy(),r.ChangeEventType.MOVEEND,e),this.isDragged=!1,this.dragOrigin=null),this.callbacks.onManipulationLockRelease(this),this.callbacks.onChange(this,this.regionData.copy(),r.ChangeEventType.SELECTIONTOGGLE,e)},bypass:!1}];this.subscribeToEvents(t)}}e.DragComponent=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CrossElement=void 0;const n=i(1),r=i(21);class s extends r.Element{constructor(t,e){super(t,e),this.buildUIElements(),this.hide()}get x(){return this.center.x}get y(){return this.center.y}boundToRect(t){return new n.Point2D(this.x,this.y).boundToRect(t)}move(t,e,i=!1,r=null){const s=new n.Point2D(t).boundToRect(e);if(i){const t=Math.abs(s.x-r.x),e=Math.sign(s.x-r.x),i=Math.abs(s.y-r.y),n=Math.sign(s.y-r.y),o=Math.min(t,i);s.x=r.x+o*e,s.y=r.y+o*n}this.center.move(s),this.vl.node.setAttribute("x1",s.x.toString()),this.vl.node.setAttribute("x2",s.x.toString()),this.vl.node.setAttribute("y2",e.height.toString()),this.hl.node.setAttribute("y1",s.y.toString()),this.hl.node.setAttribute("x2",e.width.toString()),this.hl.node.setAttribute("y2",s.y.toString())}resize(t,e){super.resize(t,e),this.vl.node.setAttribute("y2",e.toString()),this.hl.node.setAttribute("x2",t.toString())}buildUIElements(){const t=this.paper.line(0,0,0,this.boundRect.height),e=this.paper.line(0,0,this.boundRect.width,0);this.node=this.paper.g(),this.node.addClass("crossStyle"),this.node.add(t),this.node.add(e),this.hl=e,this.vl=t,this.center=new n.Point2D(0,0)}}e.CrossElement=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HSLColor=void 0;const n=i(23);e.HSLColor=class{constructor(t,e,i){this.values=[t,e,i]}get h(){return this.values[0]}get s(){return this.values[1]}get l(){return this.values[2]}toArray(){return this.values.map(t=>t)}toCSSValues(){return[360*this.h,100*this.s,100*this.l]}toCSSString(t){const[e,i,n]=this.toCSSValues();return void 0!==t?`hsla(${e}, ${i}%, ${n}%, ${t=Math.min(1,Math.max(0,t))})`:`hsl(${e}, ${i}%, ${n}%)`}toSRGB(){let t,e;const[i,r,s]=this.values;e=s<=.5?s*(r+1):s+r-s*r,t=2*s-e;const o=this.hue2rgb(t,e,i+1/3),a=this.hue2rgb(t,e,i),h=this.hue2rgb(t,e,i-1/3);return new n.SRGBColor(o,a,h)}hue2rgb(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RGBColor=void 0;const n=i(23),r=i(18);e.RGBColor=class{constructor(t,e,i){this.values=[t,e,i]}get r(){return this.values[0]}get g(){return this.values[1]}get b(){return this.values[2]}toArray(){return this.values.map(t=>t)}toXYZ(){const[t,e,i]=this.values,n=.4124*t+.3576*e+.1805*i,s=.2126*t+.7152*e+.0722*i,o=.0193*t+.1192*e+.9505*i;return new r.XYZColor(n,s,o)}toSRGB(){const t=this.values.map(t=>t<.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055);return new n.SRGBColor(t[0],t[1],t[2])}toLAB(){return this.toXYZ().toLAB()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.XYZColor=void 0;const n=i(11),r=i(17);class s{constructor(t,e,i){this.values=[t,e,i]}get x(){return this.values[0]}get y(){return this.values[1]}get z(){return this.values[2]}toArray(){return this.values.map(t=>t)}toRGB(){const[t,e,i]=this.values,n=3.2406255*t-1.537208*e-.4986286*i,s=-.9689307*t+1.8757561*e+.0415175*i,o=.0557101*t-.2040211*e+1.0569959*i;return new r.RGBColor(n,s,o)}toSRGB(){return this.toRGB().toSRGB()}toLAB(){const t=[this.x/s.D65.x,this.y/s.D65.y,this.z/s.D65.z].map(t=>t>.008856451?t**(1/3):7.787037*t+16/116);return new n.LABColor((116*t[1]-16)/100,5*(t[0]-t[1]),2*(t[1]-t[2]))}}e.XYZColor=s,s.D65=new s(.95047,1,1.08883),s.D50=new s(.966797,1,.825188)},function(t,e,i){"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),e.ZoomManager=e.ZoomType=e.ZoomDirection=void 0,function(t){t[t.In=0]="In",t[t.Out=1]="Out"}(n=e.ZoomDirection||(e.ZoomDirection={})),function(t){t[t.Default=0]="Default",t[t.ImageCenter=1]="ImageCenter",t[t.ViewportCenter=2]="ViewportCenter",t[t.CursorCenter=3]="CursorCenter"}(e.ZoomType||(e.ZoomType={}));class r{constructor(t=!1,e,i,n){this.minZoomScale=1,this.maxZoomScale=4,this.zoomScale=.1,this.isZoomEnabled=t,this.maxZoomScale=i||this.maxZoomScale,this.zoomScale=n||this.zoomScale,this.currentZoomScale=this.minZoomScale,this.previousZoomScale=this.minZoomScale,this.callbacks=e,this.shouldResetZoomOnContentLoad=!1}get resetZoomOnContentLoad(){return this.shouldResetZoomOnContentLoad}set resetZoomOnContentLoad(t){this.shouldResetZoomOnContentLoad=t,t&&(this.previousZoomScale=this.currentZoomScale=1)}static getInstance(t=!1,e,i,n){return r.instance||(r.instance=new r(t,e,i,n)),r.instance}updateZoomScale(t,e){this.previousZoomScale=this.currentZoomScale;const i=this.getZoomData();let r;if(e?r=e:(t===n.In&&(r=this.currentZoomScale+this.zoomScale),t===n.Out&&(r=this.currentZoomScale-this.zoomScale)),r>=this.minZoomScale&&r<=this.maxZoomScale)return this.currentZoomScale=r,i.currentZoomScale=r,i}setMaxZoomScale(t){this.maxZoomScale=t}setZoomScale(t){this.zoomScale=t}getZoomData(){return{minZoomScale:this.minZoomScale,maxZoomScale:this.maxZoomScale,currentZoomScale:this.currentZoomScale,previousZoomScale:this.previousZoomScale}}deleteInstance(){r.instance&&delete r.instance}}e.ZoomManager=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CubicBezierControl=void 0;const n=i(1);class r{constructor({c1:t,c2:e}){this.c1=new n.Point2D(t),this.c2=new n.Point2D(e)}static BuildFromJSON({c1:t,c2:e}){return new r({c1:t,c2:e})}boundToRect(t){return new r({c1:this.c1.boundToRect(t),c2:this.c2.boundToRect(t)})}shift(t,e){this.c1.shift(t,e),this.c2.shift(t,e)}copy(){return new r(this)}toString(){return`{${this.c1.toString()}, ${this.c2.toString()}}`}toJSON(){return{c1:this.c1.toJSON(),c2:this.c2.toJSON()}}}e.CubicBezierControl=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Element=void 0;e.Element=class{constructor(t,e){this.isVisible=!0,this.paper=t,this.boundRect=e}get width(){return this.boundRect.width}get height(){return this.boundRect.height}hide(){this.node.node.setAttribute("visibility","hidden"),this.isVisible=!1}show(){this.node.node.setAttribute("visibility","visible"),this.isVisible=!0}resize(t,e,i,n){this.boundRect.resize(t,e)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Color=void 0;const n=i(16),r=i(11),s=i(17),o=i(23),a=i(18);e.Color=class{constructor(...t){if(1===t.length){const e=t[0];if(e instanceof o.SRGBColor)this.srgbColor=e;else if(e instanceof s.RGBColor)this.rgbColor=e,this.srgbColor=e.toSRGB();else if(e instanceof n.HSLColor)this.hslColor=e,this.srgbColor=e.toSRGB();else if(e instanceof a.XYZColor)this.xyzColor=e,this.rgbColor=e.toRGB(),this.srgbColor=this.rgbColor.toSRGB();else if(e instanceof r.LABColor)this.labColor=e,this.xyzColor=e.toXYZ(),this.rgbColor=this.xyzColor.toRGB(),this.srgbColor=this.rgbColor.toSRGB();else{if("string"!=typeof e)throw new Error("Wrong arg type. Expected one of the '***Color' types.");this.srgbColor=o.SRGBColor.ParseHex(e)}}else{if(3!==t.length)throw new Error("Wrong args for Color constructor.");if("number"!=typeof t[0]||"number"!=typeof t[1]||"number"!=typeof t[2])throw new Error("Wrong arg type. Expected 3 args of the 'number' type.");this.srgbColor=new o.SRGBColor(t[0],t[1],t[2])}}get sRGB(){return this.srgbColor}get RGB(){return void 0===this.rgbColor&&(this.rgbColor=this.srgbColor.toRGB()),this.rgbColor}get XYZ(){return void 0===this.xyzColor&&(this.xyzColor=this.RGB.toXYZ()),this.xyzColor}get LAB(){return void 0===this.labColor&&(this.labColor=this.XYZ.toLAB()),this.labColor}get HSL(){return void 0===this.hslColor&&(this.hslColor=this.srgbColor.toHSL()),this.hslColor}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SRGBColor=void 0;const n=i(16),r=i(17);class s{constructor(t,e,i){this.values=[t,e,i]}static ParseHex(t){if(!/#([a-f0-9]{3,4}){1,2}\b/i.test(t))throw new Error("Invalid CSS RGB color: "+t);let e,i,n;return 7===t.length||9===t.length?(e=parseInt(t.substring(1,3),16)/255,i=parseInt(t.substring(3,5),16)/255,n=parseInt(t.substring(5,7),16)/255):4!==t.length&&5!==t.length||(e=parseInt(t.charAt(1),16)/16,i=parseInt(t.charAt(2),16)/16,n=parseInt(t.charAt(3),16)/16),new s(e,i,n)}get r(){return this.values[0]}get g(){return this.values[1]}get b(){return this.values[2]}isValidColor(){return this.r>=0&&this.r<=1&&this.g>=0&&this.g<=1&&this.b>=0&&this.b<=1}truncate(){return new s(Math.min(1,Math.max(0,this.r)),Math.min(1,Math.max(0,this.g)),Math.min(1,Math.max(0,this.b)))}toArray(){return this.values.map(t=>t)}toCSSString(t){const[e,i,n]=this.to255();return void 0!==t?`rgba(${e}, ${i}, ${n}, ${t=Math.min(1,Math.max(0,t))})`:`rgb(${e}, ${i}, ${n})`}toHex(t){const[e,i,n]=this.toFF();if(void 0!==t){t=Math.min(1,Math.max(0,t));return`#${e}${i}${n}${Math.round(255*t).toString(16)}`}return`#${e}${i}${n}`}toHSL(){const[t,e,i]=this.values,r=Math.max(t,e,i),s=Math.min(t,e,i);let o,a;const h=(r+s)/2;if(r===s)o=0,a=0;else{const n=r-s;switch(a=h>.5?n/(2-r-s):n/(r+s),r){case t:o=(e-i)/n+(e<i?6:0);break;case e:o=(i-t)/n+2;break;case i:o=(t-e)/n+4}o/=6}return new n.HSLColor(o,a,h)}toXYZ(){return this.toRGB().toXYZ()}toRGB(){const[t,e,i]=this.values.map(t=>t<.04045?t/12.92:((t+.055)/1.055)**2.4);return new r.RGBColor(t,e,i)}toLAB(){return this.toRGB().toXYZ().toLAB()}to255(){return this.truncate().values.map(t=>Math.round(255*t))}toFF(){return this.truncate().values.map(t=>Math.round(255*t).toString(16).padStart(2,"0"))}}e.SRGBColor=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FilterPipeline=e.SaturationFilter=e.ContrastFilter=e.BrightnessFilter=e.BlurDiffFilter=e.GrayscaleFilter=e.InvertFilter=void 0,e.InvertFilter=function(t){const e=t.getContext("2d").getImageData(0,0,t.width,t.height),i=document.createElement("canvas");i.width=t.width,i.height=t.height;const n=e.data;for(let t=0;t<n.length;t+=4)n[t]=255-n[t],n[t+1]=255-n[t+1],n[t+2]=255-n[t+2];return i.getContext("2d").putImageData(e,0,0),new Promise((t,e)=>t(i))},e.GrayscaleFilter=function(t){const e=t.getContext("2d").getImageData(0,0,t.width,t.height),i=document.createElement("canvas");i.width=t.width,i.height=t.height;const n=e.data;for(let t=0;t<n.length;t+=4){const e=.2126*n[t]+.7152*n[t+1]+.0722*n[t+2];n[t]=e,n[t+1]=e,n[t+2]=e}return i.getContext("2d").putImageData(e,0,0),new Promise((t,e)=>t(i))},e.BlurDiffFilter=function(t){function e(t,e,n,r,s){const o=function(t,e){const i=Math.sqrt(12*t*t/e+1);let n=Math.floor(i);n%2==0&&n--;const r=n+2,s=(12*t*t-e*n*n-4*e*n-3*e)/(-4*n-4),o=Math.round(s),a=[];for(let t=0;t<e;t++)a.push(t<o?n:r);return a}(s,3);i(t,e,n,r,(o[0]-1)/2),i(e,t,n,r,(o[1]-1)/2),i(t,e,n,r,(o[2]-1)/2)}function i(t,e,i,n,r){for(let i=0;i<t.length;i++)e[i]=t[i];!function(t,e,i,n,r){const s=1/(r+r+1);for(let o=0;o<n;o++){let n=o*i,a=n,h=n+r;const l=t[n],c=t[n+i-1];let d=(r+1)*l;for(let e=0;e<r;e++)d+=t[n+e];for(let i=0;i<=r;i++)d+=t[h++]-l,e[n++]=Math.round(d*s);for(let o=r+1;o<i-r;o++)d+=t[h++]-t[a++],e[n++]=Math.round(d*s);for(let o=i-r;o<i;o++)d+=c-t[a++],e[n++]=Math.round(d*s)}}(e,t,i,n,r),function(t,e,i,n,r){const s=1/(r+r+1);for(let o=0;o<i;o++){let a=o,h=a,l=a+r*i;const c=t[a],d=t[a+i*(n-1)];let g=(r+1)*c;for(let e=0;e<r;e++)g+=t[a+e*i];for(let n=0;n<=r;n++)g+=t[l]-c,e[a]=Math.round(g*s),l+=i,a+=i;for(let o=r+1;o<n-r;o++)g+=t[l]-t[h],e[a]=Math.round(g*s),h+=i,l+=i,a+=i;for(let o=n-r;o<n;o++)g+=d-t[h],e[a]=Math.round(g*s),h+=i,a+=i}}(t,e,i,n,r)}return i=>{const n=i.getContext("2d").getImageData(0,0,i.width,i.height),r=document.createElement("canvas");r.width=i.width,r.height=i.height;const s=r.getContext("2d").createImageData(r.width,r.height),o=n.data,a=s.data,h=i.width*i.height,l=new Uint8ClampedArray(h),c=new Uint8ClampedArray(h),d=new Uint8ClampedArray(h),g=new Uint8ClampedArray(h);for(let t=0;t<h;t++)l[t]=o[4*t],c[t]=o[4*t+1],d[t]=o[4*t+2],g[t]=o[4*t+3];const u=new Uint8ClampedArray(h),p=new Uint8ClampedArray(h),f=new Uint8ClampedArray(h),y=new Uint8ClampedArray(h),m=new Uint8ClampedArray(h),v=new Uint8ClampedArray(h),b=t/2;e(l,u,r.width,r.height,b),e(c,p,r.width,r.height,b),e(d,f,r.width,r.height,b),e(l,y,r.width,r.height,t),e(c,m,r.width,r.height,t),e(d,v,r.width,r.height,t);const S=127/t;for(let e=0;e<h;e++){const i=Math.abs(y[e]-u[e]),n=Math.abs(m[e]-p[e]),r=Math.abs(v[e]-f[e]),s=.2358*i+.07*n+.6742*r,h=Math.round(.2358*o[4*e+0]+.07*o[4*e+1]+.6742*o[4*e+2]);a[4*e+0]=i>=.2358*b?o[4*e+0]:Math.round(h/t)*t,a[4*e+1]=n>=.07*b?o[4*e+1]:Math.round(h/t)*t,a[4*e+2]=r>=.6742*b?o[4*e+2]:Math.round(h/t)*t,a[4*e+3]=s>=t?255:0+Math.round(s*S)}return r.getContext("2d").putImageData(s,0,0),new Promise((t,e)=>t(r))}},e.BrightnessFilter=function(t){return e=>{const i=e.getContext("2d").getImageData(0,0,e.width,e.height),n=document.createElement("canvas");n.width=e.width,n.height=e.height;const r=i.data;for(let e=0;e<r.length;e+=4)r[e+0]=Math.max(0,Math.min(r[e+0]+t,255)),r[e+1]=Math.max(0,Math.min(r[e+1]+t,255)),r[e+2]=Math.max(0,Math.min(r[e+2]+t,255));return n.getContext("2d").putImageData(i,0,0),new Promise((t,e)=>t(n))}},e.ContrastFilter=function(t){return e=>{const i=e.getContext("2d").getImageData(0,0,e.width,e.height),n=document.createElement("canvas");n.width=e.width,n.height=e.height;const r=i.data,s=259*(t+255)/(255*(259-t));for(let t=0;t<r.length;t+=4)r[t+0]=s*(r[t]-128)+128,r[t+1]=s*(r[t+1]-128)+128,r[t+2]=s*(r[t+2]-128)+128;return n.getContext("2d").putImageData(i,0,0),new Promise((t,e)=>t(n))}},e.SaturationFilter=function(t){return e=>{const i=e.getContext("2d").getImageData(0,0,e.width,e.height),n=document.createElement("canvas");n.width=e.width,n.height=e.height;const r=t/255,s=i.data;for(let t=0;t<s.length;t+=4){const e=s[t+0],i=s[t+1],n=s[t+2],o=.213*e+.715*i+.072*n,a=o+r*(.787*e-.715*i-.072*n),h=o+r*(-.213*e+.285*i-.072*n),l=o+r*(-.213*e-.715*i+.928*n);s[t]=Math.round(a),s[t+1]=Math.round(h),s[t+2]=Math.round(l)}return n.getContext("2d").putImageData(i,0,0),new Promise((t,e)=>t(n))}};e.FilterPipeline=class{constructor(){this.pipeline=new Array}addFilter(t){this.pipeline.push(t)}clearFilters(){this.pipeline=new Array}applyToCanvas(t){let e=new Promise((e,i)=>e(t));return this.pipeline.length>0&&this.pipeline.forEach(t=>{e=e.then(t)}),e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.KonvaContainerId=e.EnabledMaskHostZIndex=e.SvgHostZIndex=e.DisabledMaskHostZIndex=e.ImageCanvasZIndex=void 0,e.ImageCanvasZIndex=98,e.DisabledMaskHostZIndex=99,e.SvgHostZIndex=100,e.EnabledMaskHostZIndex=101,e.KonvaContainerId="konvaContainer"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RegionsManager=void 0;const n=i(1),r=i(2),s=i(4),o=i(3),a=i(19),h=i(43),l=i(29),c=i(51),d=i(54),g=i(30),u=i(61);e.RegionsManager=class{constructor(t,e){this.isFrozenState=!1,this.isFocusedState=!0,this.justManipulated=!1,this.manipulationLock=!1,this.tagsUpdateOptions={showRegionBackground:!0,showTagsText:!0},this.baseParent=t,this.paper=Snap(t),this.paperRect=new r.Rect(t.width.baseVal.value,t.height.baseVal.value),this.regionAnnouncer=document.getElementById("regionAnnouncer"),this.regions=new Array,this.callbacks={onChange:(t,i,n,r=!1)=>{this.onRegionChange(t,i,n,r),"function"==typeof e.onChange&&e.onChange(t,i,n,r)},onManipulationLockRequest:t=>{this.manipulationLock=!0,"function"==typeof e.onManipulationLockRequest&&e.onManipulationLockRequest(t)},onManipulationLockRelease:t=>{this.manipulationLock=!1,"function"==typeof e.onManipulationLockRelease&&e.onManipulationLockRelease(t)},onManipulationBegin:this.functionGuard(e.onManipulationBegin),onManipulationEnd:t=>{this.manipulationLock||"function"!=typeof e.onManipulationEnd||e.onManipulationEnd(t)},onRegionDelete:this.functionGuard(e.onRegionDelete),onRegionMoveBegin:this.functionGuard(e.onRegionMoveBegin),onRegionMove:this.functionGuard(e.onRegionMove),onRegionMoveEnd:this.functionGuard(e.onRegionMoveEnd),onRegionSelected:this.functionGuard(e.onRegionSelected)},this.buildOn(this.paper),this.subscribeToEvents()}get isFrozen(){return this.isFrozenState}get isFocused(){return this.isFocusedState}addRegion(t,e,i){e.type===s.RegionDataType.Point?this.addPointRegion(t,e,i):e.type===s.RegionDataType.Polyline?this.addPolylineRegion(t,e,i):e.type===s.RegionDataType.Rect?this.addRectRegion(t,e,i):e.type===s.RegionDataType.Polygon?this.addPolygonRegion(t,e,i):e.type===s.RegionDataType.Path&&this.addPathRegion(t,e,i),this.regionAnnouncer&&(this.regionAnnouncer.innerHTML=i.toString())}addRectRegion(t,e,i){this.menu.hide();const n=new g.RectRegion(this.paper,this.paperRect,e,this.callbacks,t,i,this.tagsUpdateOptions);this.registerRegion(n)}addPointRegion(t,e,i){this.menu.hide();const n=new l.PointRegion(this.paper,this.paperRect,e,this.callbacks,t,i,this.tagsUpdateOptions);this.registerRegion(n)}addPolylineRegion(t,e,i){this.menu.hide();const n=new d.PolylineRegion(this.paper,this.paperRect,e,this.callbacks,t,i,this.tagsUpdateOptions);this.registerRegion(n)}addPolygonRegion(t,e,i){this.menu.hide();const n=new c.PolygonRegion(this.paper,this.paperRect,e,this.callbacks,t,i,this.tagsUpdateOptions);this.registerRegion(n)}addPathRegion(t,e,i){this.menu.hide();const n=new h.PathRegion(this.paper,this.paperRect,e,this.callbacks,t,i,this.tagsUpdateOptions);this.registerRegion(n)}redrawAllRegions(){window.requestAnimationFrame(t=>{this.regions.forEach(t=>{const e=t.node.remove();this.regionManagerLayer.add(e)})})}getSelectedRegionsBounds(){return this.lookupSelectedRegions().map(t=>({id:t.ID,x:t.x,y:t.y,width:t.boundRect.width,height:t.boundRect.height}))}getAllRegions(t){return this.regions.map(e=>({id:e.ID,tags:e.tags,regionData:t?e.regionData:this.scaleRegionToOriginalSize(e.regionData)}))}updateRegionVisibility(t,e){this.regions.forEach(i=>{t(i.tags,i)&&(e?i.show():i.hide())})}getSelectedRegions(){return this.lookupSelectedRegions().map(t=>({id:t.ID,tags:t.tags,regionData:this.scaleRegionToOriginalSize(t.regionData)}))}getSelectedRegionsWithZoomScale(){return this.lookupSelectedRegions().map(t=>({id:t.ID,tags:t.tags,regionData:t.regionData}))}deleteRegionById(t){const e=this.lookupRegionByID(t);null!=e&&this.deleteRegion(e),this.callbacks.onManipulationEnd()}deleteAllRegions(){for(const t of this.regions)t.removeStyles(),t.node.remove();this.regions=[],this.menu.hide(),this.callbacks.onManipulationEnd()}updateTagsById(t,e){const i=this.lookupRegionByID(t);null!=i&&i.updateTags(e,this.tagsUpdateOptions)}updateTagsForSelectedRegions(t){const e=this.lookupSelectedRegions();e.forEach(e=>{e.updateTags(t,this.tagsUpdateOptions)}),e.forEach(t=>{t.unselect()})}selectRegionById(t){const e=this.lookupRegionByID(t);this.selectRegion(e)}resize(t,e){const i=t/this.paperRect.width,r=e/this.paperRect.height;this.paperRect.resize(t,e),this.menu.hide();for(const t of this.regions)t.move(new n.Point2D(t.x*i,t.y*r)),t.resize(t.boundRect.width*i,t.boundRect.height*r)}freeze(t){this.regionManagerLayer.addClass("frozen"),void 0!==t?(this.regionManagerLayer.addClass(t),this.frozenNuance=t):this.frozenNuance="",this.menu.hide(),this.regions.forEach(t=>{t.freeze()}),this.isFrozenState=!0}unfreeze(){this.regionManagerLayer.removeClass("frozen"),""!==this.frozenNuance&&this.regionManagerLayer.removeClass(this.frozenNuance);const t=this.lookupSelectedRegions();t.length>0&&this.menu.showOnRegion(t[0]),this.regions.forEach(t=>{t.unfreeze()}),this.isFrozenState=!1}focus(){this.isFocusedState=!0}unfocus(){this.isFocusedState=!1}toggleFreezeMode(){this.isFrozen?this.unfreeze():this.freeze()}toggleBackground(){this.tagsUpdateOptions.showRegionBackground=!this.tagsUpdateOptions.showRegionBackground,this.regions.forEach(t=>{t.updateTags(t.tags,this.tagsUpdateOptions)})}toggleTagsTextVisibility(){this.tagsUpdateOptions.showTagsText=!this.tagsUpdateOptions.showTagsText,this.regions.forEach(t=>{t.updateTags(t.tags,this.tagsUpdateOptions)})}sortRegionsByArea(){function t(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}this.regions.length>1&&(!function e(i,n,r){let s,o;return n<r&&(s=r,o=function(e,i,n,r){const s=e[i].area;let o=n;for(let i=n;i<r;i++)e[i].area>s&&(t(e,i,o),o++);return t(e,r,o),o}(i,s,n,r),e(i,n,o-1),e(i,o+1,r)),i}(this.regions,0,this.regions.length-1),this.redrawAllRegions())}scaleRegion(t,e){const i=t.copy();return i.scale(e,e),i}scaleRegionToOriginalSize(t){const e=a.ZoomManager.getInstance();if(e&&e.isZoomEnabled){const i=1/e.getZoomData().currentZoomScale;return this.scaleRegion(t,i)}return t}lookupRegionByID(t){let e=null,i=0;for(;i<this.regions.length&&null==e;)this.regions[i].ID===t&&(e=this.regions[i]),i++;return e}lookupSelectedRegions(){const t=Array();for(const e of this.regions)e.isSelected&&t.push(e);return t}deleteRegion(t){t.removeStyles(),t.node.remove(),this.regions=this.regions.filter(e=>e!==t),this.menu.hide(),this.callbacks.onRegionDelete(t.ID,t.regionData)}deleteSelectedRegions(){const t=this.lookupSelectedRegions();for(const e of t)this.deleteRegion(e);this.selectNextRegion(),this.callbacks.onManipulationEnd()}selectRegion(t){null!==t&&(this.unselectRegions(t),t.select(),this.menu.showOnRegion(t),this.callbacks.onRegionSelected(t.ID))}selectAllRegions(){let t=null;for(const e of this.regions)t=e,t.select(),this.callbacks.onRegionSelected(t.ID);null!=t&&this.menu.showOnRegion(t)}selectNextRegion(){let t=null;const e=this.getIndexOfFirstSelectedRegion();this.regionSelectedAndValidNextRegion()?t=this.regions[e+1]:this.noRegionSelectedAndValidFirstRegion()&&(t=this.regions[0]),this.selectRegion(t)}selectPrevRegion(){let t=null;const e=this.getIndexOfFirstSelectedRegion();this.regionSelectedAndValidPrevRegion()?t=this.regions[e-1]:this.noRegionSelectedAndValidFirstRegion()&&(t=this.regions[0]),this.selectRegion(t)}reshapeRegion(t,e,i,r,s,o=!1){let a,h,l,c;o?(a=Math.max(0,t.boundRect.width-Math.abs(r)),h=Math.max(0,t.boundRect.height-Math.abs(s)),l=t.x+e+(r<0?0:r),c=t.y+i+(s<0?0:s)):(a=t.boundRect.width+Math.abs(r),h=t.boundRect.height+Math.abs(s),l=t.x+e+(r>0?0:r),c=t.y+i+(s>0?0:s));const d=new n.Point2D(l,c).boundToRect(this.paperRect),g=new n.Point2D(l+a,c+h).boundToRect(this.paperRect);t.move(d),t.resize(g.x-d.x,g.y-d.y)}moveSelectedRegions(t,e){const i=this.lookupSelectedRegions();i.forEach(i=>{this.reshapeRegion(i,t,e,0,0)}),this.menu.showOnRegion(i[0])}resizeSelectedRegions(t,e,i=!1){const n=this.lookupSelectedRegions();n.forEach(n=>{this.reshapeRegion(n,0,0,t,e,i)}),this.menu.showOnRegion(n[0])}onRegionChange(t,e,i,n=!1){i===o.ChangeEventType.MOVEBEGIN?(n||this.unselectRegions(t),this.menu.hide(),this.callbacks.onRegionSelected(t.ID,n),this.callbacks.onRegionMoveBegin(t.ID,e),this.justManipulated=!1):i===o.ChangeEventType.MOVING?(this.callbacks.onRegionMove(t.ID,e),this.justManipulated=!0):i===o.ChangeEventType.MOVEEND?(this.justManipulated&&(t.select(),this.menu.showOnRegion(t)),this.callbacks.onRegionMoveEnd(t.ID,e)):i!==o.ChangeEventType.SELECTIONTOGGLE||this.justManipulated||(t.isSelected?(t.unselect(),this.menu.hide(),this.callbacks.onRegionSelected("",n)):(n||this.unselectRegions(t),t.select(),this.menu.showOnRegion(t),this.callbacks.onRegionSelected(t.ID,n)))}unselectRegions(t){for(const e of this.regions)e!==t&&e.unselect()}buildOn(t){this.regionManagerLayer=t.g(),this.regionManagerLayer.addClass("regionManager"),this.menuLayer=t.g(),this.menuLayer.addClass("menuManager"),this.menu=new u.MenuElement(t,this.paperRect,new s.RegionData(0,0,0,0),this.callbacks),this.menu.addAction("delete","trash",t=>{this.deleteRegion(t),this.menu.hide()}),this.menuLayer.add(this.menu.menuGroup),this.menu.hide()}subscribeToEvents(){this.regionManagerLayer.node.addEventListener("pointerenter",t=>{this.callbacks.onManipulationBegin()}),this.regionManagerLayer.node.addEventListener("pointerleave",t=>{this.callbacks.onManipulationEnd()}),window.addEventListener("keyup",t=>{if(!(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement||t.target instanceof HTMLSelectElement||this.isFrozen)){switch(t.keyCode){case 9:this.isFocused&&(!t.shiftKey&&this.shouldPreventTabDefault()?this.selectNextRegion():t.shiftKey&&this.shouldPreventShiftTabDefault()&&this.selectPrevRegion());break;case 46:case 8:this.deleteSelectedRegions();break;case 38:t.ctrlKey&&(t.shiftKey||t.altKey?t.shiftKey&&!t.altKey?this.resizeSelectedRegions(0,-5):t.altKey&&!t.shiftKey&&this.resizeSelectedRegions(0,-5,!0):this.moveSelectedRegions(0,-5));break;case 40:t.ctrlKey&&(t.shiftKey||t.altKey?t.shiftKey&&!t.altKey?this.resizeSelectedRegions(0,5):t.altKey&&!t.shiftKey&&this.resizeSelectedRegions(0,5,!0):this.moveSelectedRegions(0,5));break;case 37:t.ctrlKey&&(t.shiftKey||t.altKey?t.shiftKey&&!t.altKey?this.resizeSelectedRegions(-5,0):t.altKey&&!t.shiftKey&&this.resizeSelectedRegions(-5,0,!0):this.moveSelectedRegions(-5,0));break;case 39:t.ctrlKey&&(t.shiftKey||t.altKey?t.shiftKey&&!t.altKey?this.resizeSelectedRegions(5,0):t.altKey&&!t.shiftKey&&this.resizeSelectedRegions(5,0,!0):this.moveSelectedRegions(5,0));break;default:return}t.preventDefault()}}),window.addEventListener("keydown",t=>{if(!(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement||t.target instanceof HTMLSelectElement||this.isFrozen))switch(t.key){case"a":case"A":t.ctrlKey&&this.selectAllRegions();break;case"Tab":this.isFocused&&(!t.shiftKey&&this.shouldPreventTabDefault()||t.shiftKey&&this.shouldPreventShiftTabDefault())&&t.preventDefault()}})}registerRegion(t){this.unselectRegions(),t.select(),this.regionManagerLayer.add(t.node),this.regions.push(t),this.menu.showOnRegion(t),t.unselect()}shouldPreventTabDefault(){this.getIndexOfFirstSelectedRegion();return this.regionSelectedAndValidNextRegion()||this.noRegionSelectedAndValidFirstRegion()}regionSelectedAndValidNextRegion(){const t=this.getIndexOfFirstSelectedRegion();return 0<=t&&t<this.regions.length-1}shouldPreventShiftTabDefault(){this.getIndexOfFirstSelectedRegion();return this.regionSelectedAndValidPrevRegion()||this.noRegionSelectedAndValidFirstRegion()}regionSelectedAndValidPrevRegion(){return 1<=this.getIndexOfFirstSelectedRegion()}noRegionSelectedAndValidFirstRegion(){return this.getIndexOfFirstSelectedRegion()<0&&this.regions.length>0}getIndexOfFirstSelectedRegion(){let t=-1;for(let e=0;e<this.regions.length;e++)if(this.regions[e].isSelected){t=e;break}return t}functionGuard(t){return(...e)=>{"function"==typeof t&&t(...e)}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RegionDataType=void 0,function(t){t.Point="point",t.Rect="rect",t.Polyline="polyline",t.Polygon="polygon",t.Path="Path"}(e.RegionDataType||(e.RegionDataType={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DragElement=void 0;const n=i(14);class r extends n.DragComponent{constructor(t,e=null,i,n){super(t,e,i,n),this.dragNode=t.rect(this.x,this.y,this.width,this.height),this.dragNode.addClass("dragRectStyle"),this.node.add(this.dragNode),this.subscribeToDragEvents()}redraw(){window.requestAnimationFrame(()=>{this.dragNode.attr({x:this.x,y:this.y,width:this.width,height:this.height})})}}e.DragElement=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PointRegion=void 0;const n=i(7),r=i(49),s=i(50);class o extends n.Region{constructor(t,e=null,i,n,r,s,o){super(t,e,i,n,r,s,o),this.buildOn(t)}updateTags(t,e){super.updateTags(t,e),this.tagsNode.updateTags(t,e),this.node.select("title").node.innerHTML=null!==t?t.toString():""}buildOn(t){this.node=t.g(),this.node.addClass("regionStyle"),this.node.addClass(this.styleID),this.dragNode=new r.DragElement(t,this.paperRect,this.regionData,this.callbacks),this.tagsNode=new s.TagsElement(t,this.paperRect,this.regionData,this.tags,this.styleID,this.styleSheet,this.tagsUpdateOptions),this.toolTip=Snap.parse(`<title>${null!==this.tags?this.tags.toString():""}</title>`),this.node.append(this.toolTip),this.node.add(this.dragNode.node),this.node.add(this.tagsNode.node),this.UI.push(this.tagsNode,this.dragNode)}}e.PointRegion=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RectRegion=void 0;const n=i(2),r=i(7),s=i(58),o=i(59),a=i(60);class h extends r.Region{constructor(t,e=null,i,r,s,o,a){super(t,e,i,Object.assign({},r),s,o,a),null!==e&&(this.paperRects={actual:new n.Rect(e.width-i.width,e.height-i.height),host:e}),this.buildOn(t);const h=this.callbacks.onChange;this.callbacks.onChange=(t,e,...i)=>{this.paperRects.actual.resize(this.paperRects.host.width-e.width,this.paperRects.host.height-e.height),h(this,e,...i)}}updateTags(t,e){super.updateTags(t,e),this.tagsNode.updateTags(t,e),this.node.select("title").node.innerHTML=null!==t?t.toString():""}resize(t,e){this.paperRects.actual.resize(this.paperRects.host.width-t,this.paperRects.host.height-e),super.resize(t,e)}buildOn(t){this.node=t.g(),this.node.addClass("regionStyle"),this.node.addClass(this.styleID),this.anchorNode=new s.AnchorsElement(t,this.paperRects.host,this.regionData,this.callbacks),this.dragNode=new o.DragElement(t,this.paperRects.actual,this.regionData,this.callbacks),this.tagsNode=new a.TagsElement(t,this.paperRects.host,this.regionData,this.tags,this.styleID,this.styleSheet,this.tagsUpdateOptions),this.toolTip=Snap.parse(`<title>${null!==this.tags?this.tags.toString():""}</title>`),this.node.append(this.toolTip),this.node.add(this.tagsNode.node),this.node.add(this.dragNode.node),this.node.add(this.anchorNode.node),this.UI.push(this.tagsNode,this.dragNode,this.anchorNode)}}e.RectRegion=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AreaSelector=void 0;const n=i(2),r=i(13),s=i(62),o=i(63),a=i(64),h=i(65),l=i(66),c=i(67);class d{constructor(t,e){this.isVisible=!0,this.parentNode=t,this.callbacks=void 0!==e?e:{onLocked:null,onSelectionBegin:null,onSelectionEnd:null,onNextSelectionPoint:null,onUnlocked:null,onMaskSelection:null},this.buildUIElements()}resize(t,e){const[i,n]=[this.boundRect.width,this.boundRect.height];void 0!==t&&void 0!==e?this.boundRect.resize(t,e):this.boundRect.resize(this.parentNode.width.baseVal.value,this.parentNode.height.baseVal.value),null!==this.selector&&this.selector.resize(t,e,i,n)}enable(){null!==this.selector&&(this.selector.enable(),this.selector.resize(this.boundRect.width,this.boundRect.height))}disable(){null!==this.selector&&this.selector.disable()}show(){this.enable(),this.isVisible=!0}hide(){this.disable(),this.isVisible=!1}undo(){this.selectorSettings.mode===r.SelectionMode.POLYGON&&this.polygonSelector.undo()}redo(){this.selectorSettings.mode===r.SelectionMode.POLYGON&&this.polygonSelector.redo()}canRedo(){return this.selectorSettings.mode===r.SelectionMode.POLYGON&&this.polygonSelector.canRedo()}canUndo(){return this.selectorSettings.mode===r.SelectionMode.POLYGON&&this.polygonSelector.canUndo()}setSelectionMode(t){var e,i,n;let s;if(s=null==t?{mode:r.SelectionMode.NONE}:void 0!==t.mode?t:{mode:t},void 0===this.selectorSettings||this.selectorSettings.mode!==s.mode){if(this.disable(),this.selectorSettings=s,this.selectorSettings.mode===r.SelectionMode.NONE)return void(this.selector=null);if(this.selectorSettings.mode===r.SelectionMode.COPYRECT){this.selector=this.rectCopySelector;const t=this.selectorSettings.template;void 0!==t?this.rectCopySelector.setTemplate(t):this.rectCopySelector.setTemplate(d.DefaultTemplateSize)}else this.selectorSettings.mode===r.SelectionMode.RECT?this.selector=this.rectSelector:this.selectorSettings.mode===r.SelectionMode.POINT?this.selector=this.pointSelector:this.selectorSettings.mode===r.SelectionMode.POLYLINE?this.selector=this.polylineSelector:this.selectorSettings.mode===r.SelectionMode.POLYGON?this.selector=this.polygonSelector:this.selectorSettings.mode===r.SelectionMode.BRUSH?null===(e=this.maskSelector)||void 0===e||e.enableMode(r.SelectionMode.BRUSH):this.selectorSettings.mode===r.SelectionMode.ERASER&&(null===(i=this.maskSelector)||void 0===i||i.enableMode(r.SelectionMode.ERASER));this.enable(),this.isVisible?this.show():this.hide(),this.selectorSettings.mode!==r.SelectionMode.BRUSH&&this.selectorSettings.mode!==r.SelectionMode.ERASER&&(null===(n=this.maskSelector)||void 0===n||n.disable())}}getSelectorSettings(){return this.selectorSettings}reset(){null!==this.selector&&this.selector.reset()}updateRectCopyTemplateSelector(t){void 0!==t?this.rectCopySelector.setTemplate(t):this.rectCopySelector.setTemplate(d.DefaultTemplateSize)}getRectCopyTemplate(t){if(void 0!==t&&t.length>0){const e=t[0];return new n.Rect(e.regionData.width,e.regionData.height)}return new n.Rect(40,40)}buildUIElements(){this.paper=Snap(this.parentNode),this.boundRect=new n.Rect(this.parentNode.width.baseVal.value,this.parentNode.height.baseVal.value),this.areaSelectorLayer=this.paper.g(),this.areaSelectorLayer.addClass("areaSelector"),this.rectSelector=new c.RectSelector(this.parentNode,this.paper,this.boundRect,this.callbacks),this.rectCopySelector=new l.RectCopySelector(this.parentNode,this.paper,this.boundRect,new n.Rect(0,0),this.callbacks),this.pointSelector=new o.PointSelector(this.parentNode,this.paper,this.boundRect,this.callbacks),this.polylineSelector=new h.PolylineSelector(this.parentNode,this.paper,this.boundRect,this.callbacks),this.polygonSelector=new a.PolygonSelector(this.parentNode,this.paper,this.boundRect,this.callbacks),this.maskSelector=new s.MaskSelector(this.callbacks),this.maskSelector.disable(),this.selector=this.rectSelector,this.rectSelector.enable(),this.rectCopySelector.disable(),this.pointSelector.disable(),this.polylineSelector.disable(),this.polygonSelector.disable(),this.selector.hide(),this.areaSelectorLayer.add(this.rectSelector.node),this.areaSelectorLayer.add(this.rectCopySelector.node),this.areaSelectorLayer.add(this.pointSelector.node),this.areaSelectorLayer.add(this.polylineSelector.node),this.areaSelectorLayer.add(this.polygonSelector.node)}}e.AreaSelector=d,d.DefaultTemplateSize=new n.Rect(20,20)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AlternatingCrossElement=void 0;const n=i(15);class r extends n.CrossElement{constructor(t,e){super(t,e),this.buildUIElements(),this.hide()}move(t,e,i=!1,n=null){super.move(t,e,i,n),this.vl2.node.setAttribute("x1",this.vl.attr("x1")),this.vl2.node.setAttribute("x2",this.vl.attr("x2")),this.vl2.node.setAttribute("y2",this.vl.attr("y2")),this.hl2.node.setAttribute("y1",this.hl.attr("y1")),this.hl2.node.setAttribute("x2",this.hl.attr("x2")),this.hl2.node.setAttribute("y2",this.hl.attr("y2"))}resize(t,e){super.resize(t,e),this.vl2.node.setAttribute("y2",e.toString()),this.hl2.node.setAttribute("x2",t.toString())}buildUIElements(){super.buildUIElements();const t=this.paper.line(0,0,0,this.boundRect.height),e=this.paper.line(0,0,this.boundRect.width,0);this.node.add(t),this.node.add(e),this.vl2=t,this.hl2=e,this.vl.addClass("blackDashes"),this.hl.addClass("blackDashes"),this.vl2.addClass("whiteDashes"),this.hl2.addClass("whiteDashes")}}e.AlternatingCrossElement=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RectElement=void 0;const n=i(1),r=i(2),s=i(21);class o extends s.Element{constructor(t,e,i){super(t,e),this.rect=new r.Rect(i.width,i.height),this.originPoint=new n.Point2D(0,0),this.buildUIElements(),this.hide()}get x(){return this.originPoint.x}get y(){return this.originPoint.y}move(t){this.node.node.setAttribute("x",t.x.toString()),this.node.node.setAttribute("y",t.y.toString()),this.originPoint.move(t)}resize(t,e){this.rect.resize(t,e),this.node.node.setAttribute("height",e.toString()),this.node.node.setAttribute("width",t.toString())}buildUIElements(){this.node=this.paper.rect(0,0,this.rect.width,this.rect.height)}}e.RectElement=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Toolbar=void 0;const n=i(2),r=i(6),s=i(68),o=i(69),a=i(70),h=i(71);e.Toolbar=class{constructor(t){this.iconSpace=8,this.areHotKeysEnabled=!0,this.icons=new Array,this.buildUIElements(t)}addSelector(t,e){const i=new s.ToolbarSelectIcon(this.paper,t,t=>{this.select(t),e(t)});this.addIcon(i)}addSwitch(t,e){const i=new a.ToolbarSwitchIcon(this.paper,t,t=>{e(t)});this.addIcon(i)}addSeparator(){const t=new o.ToolbarSeparator(this.paper,r.ToolbarIcon.IconWidth);this.addIcon(t)}addTrigger(t,e){const i=new h.ToolbarTriggerIcon(this.paper,t,t=>{e(t)});this.addIcon(i)}select(t){this.icons.forEach(e=>{e instanceof s.ToolbarSelectIcon&&(e.description.action!==t?e.unselect():e.select())})}setSwitch(t,e){const i=this.findIconByAction(t);void 0!==i&&i instanceof a.ToolbarSwitchIcon&&(e?i.select():i.unselect())}enableHotkeys(){this.areHotKeysEnabled=!0}disableHotkeys(){this.areHotKeysEnabled=!1}buildUIElements(t){this.baseParent=t,this.paper=Snap(t),this.paperRect=new n.Rect(t.width.baseVal.value,t.height.baseVal.value);const e=this.paper.g();e.addClass("toolbarLayer"),this.recalculateToolbarSize(),this.backgroundRect=this.paper.rect(0,0,this.toolbarWidth,this.toolbarHeight),this.backgroundRect.addClass("toolbarBGStyle"),e.add(this.backgroundRect),this.iconsLayer=this.paper.g(),this.iconsLayer.addClass("iconsLayerStyle"),e.add(this.iconsLayer),this.subscribeToKeyboardEvents()}recalculateToolbarSize(t){if(void 0===t)this.toolbarWidth=r.ToolbarIcon.IconWidth+2*this.iconSpace,this.toolbarHeight=this.icons.length*(r.ToolbarIcon.IconHeight+this.iconSpace)+this.iconSpace;else{const e=t.width+2*this.iconSpace;e>this.toolbarWidth&&(this.toolbarWidth=e),this.toolbarHeight=this.toolbarHeight+t.height+this.iconSpace}}updateToolbarSize(){this.backgroundRect.attr({height:this.toolbarHeight,width:this.toolbarWidth})}addIcon(t){this.icons.push(t),this.iconsLayer.add(t.node),t.move(this.iconSpace,this.toolbarHeight+this.iconSpace),this.recalculateToolbarSize(t),this.updateToolbarSize()}findIconByKey(t){return this.icons.find(e=>null!==e.description&&e.description.key.includes(t))}findIconByAction(t){return this.icons.find(e=>null!==e.description&&e.description.action===t)}findFocusedIcon(){return this.icons.find(t=>t.isFocused())}subscribeToKeyboardEvents(){window.addEventListener("keyup",t=>{if(!(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement||t.target instanceof HTMLSelectElement)){if(this.areHotKeysEnabled&&!t.ctrlKey&&!t.altKey){const e=this.findIconByKey(t.key);void 0!==e&&(e instanceof s.ToolbarSelectIcon||e instanceof a.ToolbarSwitchIcon||e instanceof h.ToolbarTriggerIcon)&&e.activate()}if(" "===t.key||"Enter"===t.key){t.preventDefault();const e=this.findFocusedIcon();void 0!==e&&(e instanceof s.ToolbarSelectIcon||e instanceof a.ToolbarSwitchIcon||e instanceof h.ToolbarTriggerIcon)&&e.activate()}}})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Tag=void 0;const n=i(22),r=i(16),s=i(11);class o{constructor(t,e,i="",s=0){this.tagColorPure="",this.tagColorAccent="",this.tagColorHighlight="",this.tagColorShadow="",this.tagColorNoColor="",this.tagColorDark="",this.tagName=t,"number"==typeof e?this.colorObj=new n.Color(new r.HSLColor(e%360/360,1,.5)):"string"==typeof e?this.colorObj=new n.Color(e):e instanceof n.Color&&(this.colorObj=e),this.tagID=i,this.tagSequenceNumber=s}static BuildFromJSON(t){return void 0!==t.color?new o(t.name,new n.Color(t.color),void 0===t.id?"":t.id):void 0!==t.colorHue?new o(t.name,new n.Color(new r.HSLColor(t.colorHue%360/360,1,.5)),void 0===t.id?"":t.id):void 0}static getHueFromColor(t){return 360*new n.Color(t).HSL.h}get colorHue(){return 360*this.colorObj.HSL.h}get color(){return this.colorObj.sRGB.toHex()}get srgbColor(){return this.colorObj.sRGB}get name(){return this.tagName}get id(){return this.tagID}get sequenceNumber(){return this.tagSequenceNumber}get colorPure(){return""===this.tagColorPure&&(this.tagColorPure=this.colorObj.sRGB.toCSSString()),this.tagColorPure}get colorAccent(){return""===this.tagColorAccent&&(this.tagColorAccent=this.colorObj.sRGB.toCSSString(.8)),this.tagColorAccent}get colorHighlight(){if(""===this.tagColorHighlight){const t=this.colorObj.LAB.toArray(),e=new s.LABColor(.7*t[0],.7*t[1],.7*t[2]);this.tagColorHighlight=e.toSRGB().truncate().toCSSString(.4)}return this.tagColorHighlight}get colorShadow(){if(""===this.tagColorShadow){const t=this.colorObj.LAB.toArray(),e=new s.LABColor(.6*t[0],.6*t[1],.6*t[2]);this.tagColorShadow=e.toSRGB().truncate().toCSSString(.2)}return this.tagColorShadow}get colorDark(){if(""===this.tagColorDark){const t=this.colorObj.LAB.toArray(),e=new s.LABColor(.5*t[0],.5*t[1],.5*t[2]);this.tagColorDark=e.toSRGB().truncate().toCSSString(.8)}return this.tagColorDark}get colorNoColor(){return""===this.tagColorNoColor&&(this.tagColorNoColor="rgba(0, 0, 0, 0.0)"),this.tagColorNoColor}copy(){return new o(this.tagName,this.colorObj,this.tagID,this.tagSequenceNumber)}toJSON(){return{name:this.tagName,colorHue:this.colorHue,color:this.colorObj.sRGB.toHex(),id:this.tagID}}}e.Tag=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CanvasTools=void 0;const n=i(37),r=i(24),s=i(22),o=i(16),a=i(11),h=i(72),l=i(17),c=i(18),d=i(1),g=i(2),u=i(4),p=i(35),f=i(73),y=i(13),m=i(29),v=i(30),b=i(26),S=i(31),x=i(34);i(74);class w{}e.CanvasTools=w,w.Core={Rect:g.Rect,Point2D:d.Point2D,RegionData:u.RegionData,TagsDescriptor:f.TagsDescriptor,Tag:p.Tag,Colors:{RGBColor:l.RGBColor,LABColor:a.LABColor,XYZColor:c.XYZColor,HSLColor:o.HSLColor,Palette:h.Palette,Color:s.Color}},w.Selection={AreaSelector:S.AreaSelector,SelectionMode:y.SelectionMode},w.Region={RegionsManager:b.RegionsManager,PointRegion:m.PointRegion,RectRegion:v.RectRegion},w.Filters={InvertFilter:r.InvertFilter,GrayscaleFilter:r.GrayscaleFilter,BlurDiffFilter:r.BlurDiffFilter,ContrastFilter:r.ContrastFilter,BrightnessFilter:r.BrightnessFilter,SaturationFilter:r.SaturationFilter},w.Editor=n.Editor,w.Toolbar=x.Toolbar,i(76)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Editor=void 0;const n=i(24),r=i(12),s=i(2),o=i(25),a=i(19),h=i(13),l=i(38),c=i(26),d=i(31),g=i(34),u=i(6);class p{constructor(t,e,i,r,s,h){this.autoResize=!0,this.isRMFrozen=!1,this.contentCanvas=this.createCanvasElement(),this.editorSVG=this.createSVGElement(),this.editorContainerDiv=t,this.editorContainerDiv.classList.add("CanvasToolsContainer"),this.editorContainerDiv.tabIndex=0,this.editorDiv=this.createDivElement(),this.editorDiv.classList.add("CanvasToolsEditor"),this.editorDiv.append(this.contentCanvas),this.editorDiv.append(this.editorSVG),this.editorContainerDiv.append(this.editorDiv);const g={onChange:null,onManipulationBegin:t=>{this.areaSelector.hide(),"function"==typeof this.onManipulationBegin&&this.onManipulationBegin(t)},onManipulationEnd:t=>{this.areaSelector.show(),"function"==typeof this.onManipulationEnd&&this.onManipulationEnd(t)},onRegionSelected:(t,e)=>{"function"==typeof this.onRegionSelected&&this.onRegionSelected(t,e)},onRegionMove:(t,e)=>{"function"==typeof this.onRegionMove&&this.onRegionMove(t,e)},onRegionMoveBegin:(t,e)=>{"function"==typeof this.onRegionMoveBegin&&this.onRegionMoveBegin(t,e)},onRegionMoveEnd:(t,e)=>{"function"==typeof this.onRegionMoveEnd&&this.onRegionMoveEnd(t,e)},onRegionDelete:(t,e)=>{"function"==typeof this.onRegionDelete&&this.onRegionDelete(t,e)}};null!=i?(this.regionsManager=i,i.callbacks=g):this.regionsManager=new c.RegionsManager(this.editorSVG,g);const u={onSelectionBegin:()=>{this.isRMFrozen=this.regionsManager.isFrozen,this.regionsManager.freeze(),"function"==typeof this.onSelectionBegin&&this.onSelectionBegin()},onSelectionEnd:t=>{this.isRMFrozen||this.regionsManager.unfreeze(),"function"==typeof this.onSelectionEnd&&this.onSelectionEnd(t)},onNextSelectionPoint:t=>{"function"==typeof this.onNextSelectionPoint&&this.onNextSelectionPoint(t)},onMaskSelection:(t,e)=>{var i,n,r,s,o;t?(null===(i=this.regionsManager)||void 0===i||i.freeze(),null===(n=this.areaSelector)||void 0===n||n.hide()):(null===(r=this.regionsManager)||void 0===r||r.unfreeze(),null===(s=this.areaSelector)||void 0===s||s.show()),null===(o=this.masksManager)||void 0===o||o.setSelection(t,e)}};null!=e?(this.areaSelector=e,this.areaSelector.callbacks=u):this.areaSelector=new d.AreaSelector(this.editorSVG,u),this.filterPipeline=null!=r?r:new n.FilterPipeline;const p={onZoomingOut:t=>{this.onZoom(a.ZoomDirection.Out,void 0,t)},onZoomingIn:t=>{this.onZoom(a.ZoomDirection.In,void 0,t)},getZoomLevel:()=>this.zoomManager.getZoomData().currentZoomScale,setZoomLevel:t=>(this.onZoom(a.ZoomDirection.In,t),this.zoomManager.getZoomData())};if(h){const t=this.createDivElement();t.setAttribute("id","konvaWrapper"),this.konvaContainerDivElement=this.createDivElement(),this.konvaContainerDivElement.setAttribute("id",o.KonvaContainerId),t.append(this.konvaContainerDivElement),this.editorDiv.append(t);const e={onMaskDrawingBegin:()=>{if("function"==typeof this.onMaskDrawingBegin)return this.onMaskDrawingBegin()},onMaskDrawingEnd:()=>{"function"==typeof this.onMaskDrawingEnd&&this.onMaskDrawingEnd()},getAllRegions:()=>{const t=this.regionsManager.getAllRegions();return this.regionsManager.deleteAllRegions(),t}};this.masksManager=new l.MasksManager(this.editorDiv,this.konvaContainerDivElement,e)}this.zoomManager=a.ZoomManager.getInstance(!1,p),this.zoomManager.deleteInstance(),this.zoomManager=a.ZoomManager.getInstance(!1,p),s&&s.isZoomEnabled&&(this.zoomManager.isZoomEnabled=!0,this.zoomManager.zoomType=s.zoomType||a.ZoomType.Default),this.resize(t.offsetWidth,t.offsetHeight),this.mergedAPI=new Proxy(this,{get:(t,e)=>{let i,n;return e in t?(n=t,i=n[e]):e in t.regionsManager?(n=t.RM,i=n[e]):e in t.areaSelector?(n=t.AS,i=n[e]):e in t.filterPipeline||e in t.zoomManager?(n=t.FP,i=n[e]):i=void 0,"function"==typeof i?(...t)=>{i.apply(n,t)}:i}}),this.subscribeToEvents();const f=document.createElement("div");f.setAttribute("aria-live","assertive"),f.setAttribute("tabindex","-1"),f.id="regionAnnouncer",t.appendChild(f),this.editorSVG.style["z-index"]=o.SvgHostZIndex,this.contentCanvas.style["z-index"]=o.ImageCanvasZIndex}get api(){return this.mergedAPI}get RM(){return this.regionsManager}get AS(){return this.areaSelector}get FP(){return this.filterPipeline}get ZM(){return this.zoomManager}get MM(){return this.masksManager}set isModifyRegionOnlyMode(t){r.ConfigurationManager.isModifyRegionOnlyMode=t}get isModifyRegionOnlyMode(){return r.ConfigurationManager.isModifyRegionOnlyMode}get getFrameSize(){return[this.frameWidth,this.frameHeight]}addToolbar(t,e,i){const n=this.createSVGElement();let r;t.append(n),this.toolbar=new g.Toolbar(n),null==e&&(e=p.FullToolbarSet),this.zoomManager.isZoomEnabled&&(e=e.concat(p.SeparatorIconGroupToolbar).concat(p.ZoomIconGroupToolbar)),e.forEach(t=>{if(t.type===u.ToolbarItemType.SEPARATOR)this.toolbar.addSeparator();else{const e={action:t.action,iconUrl:i+t.iconFile,tooltip:t.tooltip,key:t.key,width:t.width,height:t.height},n=e=>{t.actionCallback(e,this.regionsManager,this.areaSelector,this.zoomManager)};t.type===u.ToolbarItemType.SELECTOR?(this.toolbar.addSelector(e,n),t.activate&&(r=t.action)):t.type===u.ToolbarItemType.SWITCH?(this.toolbar.addSwitch(e,n),this.toolbar.setSwitch(t.action,t.activate)):t.type===u.ToolbarItemType.TRIGGER&&this.toolbar.addTrigger(e,n)}}),this.toolbar.select(r)}async addContentSource(t,e){const i=document.createElement("canvas"),n=i.getContext("2d");return t instanceof HTMLImageElement||t instanceof HTMLCanvasElement?(this.sourceWidth=t.width,this.sourceHeight=t.height):t instanceof HTMLVideoElement&&(this.sourceWidth=t.videoWidth,this.sourceHeight=t.videoHeight),i.width=this.sourceWidth,i.height=this.sourceHeight,n.drawImage(t,0,0,i.width,i.height),this.filterPipeline.applyToCanvas(i).then(t=>{this.contentCanvas.width=t.width,this.contentCanvas.height=t.height;this.contentCanvas.getContext("2d").drawImage(t,0,0,t.width,t.height)}).then(()=>{this.resize(this.editorContainerDiv.offsetWidth,this.editorContainerDiv.offsetHeight,!0),this.handleZoomAfterContentUpdate(!0),this.handleMaskManagerAfterContentUpdate(),"function"==typeof e&&e()})}enablePathRegions(t){r.ConfigurationManager.isPathRegionEnabled=t}resize(t,e,i){var n;this.frameWidth=t,this.frameHeight=e;const r=this.contentCanvas.width/this.contentCanvas.height;let s=0,o=0;r>t/e?(o=(e-t/r)/2,this.editorDiv.style.height=`calc(100% - ${2*o}px)`,this.editorDiv.style.width=""):(s=(t-e*r)/2,this.editorDiv.style.height="",this.editorDiv.style.width=`calc(100% - ${2*s}px)`),this.editorDiv.style.padding=`${o}px ${s}px`,this.frameWidth=t-2*s,this.frameHeight=e-2*o,this.areaSelector.resize(this.frameWidth,this.frameHeight),this.regionsManager.resize(this.frameWidth,this.frameHeight),null===(n=this.masksManager)||void 0===n||n.resize(this.frameWidth,this.frameHeight,i)}scaleRegionToSourceSize(t,e,i){const n=void 0!==e?e:this.sourceWidth,r=void 0!==i?i:this.sourceHeight,s=n/this.frameWidth,o=r/this.frameHeight,a=t.copy();return a.scale(s,o),a}scaleRegionToFrameSize(t,e,i){const n=void 0!==e?e:this.sourceWidth,r=void 0!==i?i:this.sourceHeight,s=this.frameWidth/n,o=this.frameHeight/r,a=t.copy();return a.scale(s,o),a}createSVGElement(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.innerHTML=p.SVGDefsTemplate,t.ondragstart=()=>!1,t.ondragend=()=>!1,t}createCanvasElement(){return document.createElement("canvas")}createDivElement(){return document.createElement("div")}onZoom(t,e,i){var n;if(!this.zoomManager.isZoomEnabled)throw new Error("Zoom feature is not enabled");const r=this.zoomManager.updateZoomScale(t,e);if(r){const t=this.frameWidth/r.previousZoomScale*r.currentZoomScale,e=this.frameHeight/r.previousZoomScale*r.currentZoomScale;this.frameWidth=t,this.frameHeight=e,this.zoomEditorToScale(t,e,r,i),this.areaSelector.resize(t,e),this.regionsManager.resize(t,e),null===(n=this.masksManager)||void 0===n||n.resize(t,e);const s=this.regionsManager.getSelectedRegionsWithZoomScale();this.areaSelector.updateRectCopyTemplateSelector(this.areaSelector.getRectCopyTemplate(s)),"function"==typeof this.onZoomEnd&&this.onZoomEnd(r)}}handleZoomAfterContentUpdate(t){var e;if(this.zoomManager.isZoomEnabled){const i=this.zoomManager.getZoomData(),n=this.frameWidth*i.currentZoomScale,r=this.frameHeight*i.currentZoomScale;this.frameWidth=n,this.frameHeight=r,this.zoomEditorToScale(n,r,i),this.areaSelector.resize(n,r),this.regionsManager.resize(n,r),null===(e=this.masksManager)||void 0===e||e.resize(n,r,t)}}handleMaskManagerAfterContentUpdate(){var t;null===(t=this.masksManager)||void 0===t||t.setSourceDimensions(this.sourceWidth,this.sourceHeight)}zoomEditorToScale(t,e,i,n){if(this.editorContainerDiv||this.editorContainerDiv.offsetWidth||(this.editorContainerDiv=document.getElementsByClassName("CanvasToolsContainer")[0],this.editorDiv=document.getElementsByClassName("CanvasToolsEditor")[0]),this.editorContainerDiv){this.editorContainerDiv.style.overflow=1===i.currentZoomScale?"hidden":"auto";const r=this.editorContainerDiv.offsetWidth,s=this.editorContainerDiv.offsetHeight;let o=0,h=0;if(t<r?(o=(r-t)/2,this.editorDiv.style.width=`calc(100% - ${2*o}px)`):this.editorDiv.style.width=t+"px",e<s?(h=(s-e)/2,this.editorDiv.style.height=`calc(100% - ${2*h}px)`):this.editorDiv.style.height=e+"px",o&&!h&&(o=(this.editorContainerDiv.clientWidth-t)/2,this.editorDiv.style.width=`calc(100% - ${2*o}px)`),!o&&h&&(h=(this.editorContainerDiv.clientHeight-e)/2,this.editorDiv.style.height=`calc(100% - ${2*h}px)`),this.editorDiv.style.padding=`${h}px ${o}px`,this.editorContainerDiv.focus(),this.zoomManager.zoomType===a.ZoomType.ImageCenter&&(this.editorContainerDiv.scrollHeight>this.editorContainerDiv.clientHeight&&(this.editorContainerDiv.scrollTop=(this.editorDiv.clientHeight-this.editorContainerDiv.clientHeight)/2),this.editorContainerDiv.scrollWidth>this.editorContainerDiv.clientWidth&&(this.editorContainerDiv.scrollLeft=(this.editorDiv.clientWidth-this.editorContainerDiv.clientWidth)/2)),this.zoomManager.zoomType===a.ZoomType.CursorCenter&&n){const t={left:this.editorContainerDiv.scrollLeft,top:this.editorContainerDiv.scrollTop},e={x:n.x,y:n.y},r={x:e.x/i.previousZoomScale*i.currentZoomScale,y:e.y/i.previousZoomScale*i.currentZoomScale},s={left:r.x-e.x,top:r.y-e.y},o={left:t.left+s.left,top:t.top+s.top};this.editorContainerDiv.scrollLeft=o.left,this.editorContainerDiv.scrollTop=o.top}if(this.zoomManager.zoomType===a.ZoomType.ViewportCenter||!n){const t={left:this.editorContainerDiv.scrollLeft,top:this.editorContainerDiv.scrollTop},e={x:this.editorContainerDiv.clientWidth/2+t.left,y:this.editorContainerDiv.clientHeight/2+t.top},n={x:e.x/i.previousZoomScale*i.currentZoomScale,y:e.y/i.previousZoomScale*i.currentZoomScale},r={left:n.x-e.x,top:n.y-e.y},s={left:t.left+r.left,top:t.top+r.top};this.editorContainerDiv.scrollLeft=s.left,this.editorContainerDiv.scrollTop=s.top}}}subscribeToEvents(){window.addEventListener("resize",t=>{this.autoResize&&(this.resize(this.editorContainerDiv.offsetWidth,this.editorContainerDiv.offsetHeight),this.handleZoomAfterContentUpdate())})}}e.Editor=p,p.FullToolbarSet=[{type:u.ToolbarItemType.SELECTOR,action:"none-select",iconFile:"none-selection.svg",tooltip:"Regions Manipulation (M)",key:["M","m"],actionCallback:(t,e,i)=>{i.setSelectionMode({mode:h.SelectionMode.NONE})},activate:!1},{type:u.ToolbarItemType.SEPARATOR},{type:u.ToolbarItemType.SELECTOR,action:"point-select",iconFile:"point-selection.svg",tooltip:"Point-selection (P)",key:["P","p"],actionCallback:(t,e,i)=>{i.setSelectionMode({mode:h.SelectionMode.POINT}),i.show()},activate:!1},{type:u.ToolbarItemType.SELECTOR,action:"rect-select",iconFile:"rect-selection.svg",tooltip:"Rectangular box (R)",key:["R","r"],actionCallback:(t,e,i)=>{i.setSelectionMode({mode:h.SelectionMode.RECT}),i.show()},activate:!0},{type:u.ToolbarItemType.SELECTOR,action:"copy-select",iconFile:"copy-t-selection.svg",tooltip:"Template-based box (T)",key:["T","t"],actionCallback:(t,e,i)=>{const n=e.getSelectedRegions();if(void 0!==n&&n.length>0){const t=n[0];i.setSelectionMode({mode:h.SelectionMode.COPYRECT,template:new s.Rect(t.regionData.width,t.regionData.height)})}else i.setSelectionMode({mode:h.SelectionMode.COPYRECT,template:new s.Rect(40,40)});i.show()},activate:!1},{type:u.ToolbarItemType.SELECTOR,action:"polyline-select",iconFile:"polyline-selection.svg",tooltip:"Polyline-selection (Y)",key:["Y","y"],actionCallback:(t,e,i)=>{i.setSelectionMode({mode:h.SelectionMode.POLYLINE}),i.show()},activate:!1},{type:u.ToolbarItemType.SELECTOR,action:"polygon-select",iconFile:"polygon-selection.svg",tooltip:"Polygon-selection (O)",key:["O","o"],actionCallback:(t,e,i)=>{r.ConfigurationManager.isModifyRegionOnlyMode=!1,i.setSelectionMode({mode:h.SelectionMode.POLYGON}),i.show()},activate:!1},{type:u.ToolbarItemType.SELECTOR,action:"pointer-add-remove-points-on-polygons",iconFile:"pointer-add-polygon-point.svg",tooltip:"Polygon add/remove points (U)",key:["U","u"],actionCallback:(t,e,i)=>{r.ConfigurationManager.isModifyRegionOnlyMode||(r.ConfigurationManager.isModifyRegionOnlyMode=!0,i.setSelectionMode({mode:h.SelectionMode.POLYGON}),i.show())},activate:!1},{type:u.ToolbarItemType.SEPARATOR},{type:u.ToolbarItemType.TRIGGER,action:"delete-all-select",iconFile:"delete-all-selection.svg",tooltip:"Delete all regions",key:["D","d"],actionCallback:(t,e,i)=>{e.deleteAllRegions()},activate:!1},{type:u.ToolbarItemType.SEPARATOR},{type:u.ToolbarItemType.SWITCH,action:"selection-lock",iconFile:"selection-lock.svg",tooltip:"Lock/unlock regions (L)",key:["L","l"],actionCallback:(t,e,i)=>{e.toggleFreezeMode()},activate:!1},{type:u.ToolbarItemType.SWITCH,action:"background-toggle",iconFile:"background-toggle.svg",tooltip:"Toggle Region Background (B)",key:["B","b"],actionCallback:(t,e,i)=>{e.toggleBackground()},activate:!1}],p.RectToolbarSet=[{type:u.ToolbarItemType.SELECTOR,action:"none-select",iconFile:"none-selection.svg",tooltip:"Regions Manipulation (M)",key:["M","m"],actionCallback:(t,e,i)=>{i.setSelectionMode({mode:h.SelectionMode.NONE})},activate:!1},{type:u.ToolbarItemType.SEPARATOR},{type:u.ToolbarItemType.SELECTOR,action:"rect-select",iconFile:"rect-selection.svg",tooltip:"Rectangular box (R)",key:["R","r"],actionCallback:(t,e,i)=>{i.setSelectionMode({mode:h.SelectionMode.RECT}),i.show()},activate:!0},{type:u.ToolbarItemType.SELECTOR,action:"copy-select",iconFile:"copy-t-selection.svg",tooltip:"Template-based box (T)",key:["T","t"],actionCallback:(t,e,i)=>{const n=e.getSelectedRegionsWithZoomScale();if(void 0!==n&&n.length>0){const t=n[0];i.setSelectionMode({mode:h.SelectionMode.COPYRECT,template:new s.Rect(t.regionData.width,t.regionData.height)})}else i.setSelectionMode({mode:h.SelectionMode.COPYRECT,template:new s.Rect(40,40)})},activate:!1},{type:u.ToolbarItemType.SEPARATOR},{type:u.ToolbarItemType.TRIGGER,action:"delete-all-select",iconFile:"delete-all-selection.svg",tooltip:"Delete all regions (D)",key:["D","d"],actionCallback:(t,e,i)=>{e.deleteAllRegions()},activate:!1},{type:u.ToolbarItemType.SEPARATOR},{type:u.ToolbarItemType.SWITCH,action:"selection-lock",iconFile:"selection-lock.svg",tooltip:"Lock/unlock regions (L)",key:["L","l"],actionCallback:(t,e,i)=>{e.toggleFreezeMode()},activate:!1},{type:u.ToolbarItemType.SWITCH,action:"background-toggle",iconFile:"background-toggle.svg",tooltip:"Toggle Region Background (B)",key:["B","b"],actionCallback:(t,e,i)=>{e.toggleBackground()},activate:!1}],p.ZoomIconGroupToolbar=[{type:u.ToolbarItemType.TRIGGER,action:"zoom-in",iconFile:"zoom-in.svg",tooltip:"Zoom in (+)",key:["+"],actionCallback:(t,e,i,n)=>{n.callbacks.onZoomingIn()},activate:!1},{type:u.ToolbarItemType.TRIGGER,action:"zoom-out",iconFile:"zoom-out.svg",tooltip:"Zoom out (-)",key:["-"],actionCallback:(t,e,i,n)=>{n.callbacks.onZoomingOut()},activate:!1}],p.SeparatorIconGroupToolbar=[{type:u.ToolbarItemType.SEPARATOR}],p.SVGDefsTemplate='\n        <defs>\n            <filter id="black-glow">\n                <feGaussianBlur in="SourceAlpha" stdDeviation="2" />\n                <feOffset dx="0" dy="0" result="offsetblur" />\n                <feComponentTransfer>\n                    <feFuncA type="linear" slope="0.8" />\n                </feComponentTransfer>\n                <feMerge>\n                    <feMergeNode />\n                    <feMergeNode in="SourceGraphic" />\n                </feMerge>\n            </filter>\n        </defs>'},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MasksManager=void 0;const n=i(81),r=i(25),s=i(19),o=i(13);e.MasksManager=class{constructor(t,e,i){this.callbacks=i,this.tagsList=[],this.maskSelectionMode=o.SelectionMode.BRUSH,this.brushSize={brush:30,erase:30},this.editorDiv=t,this.konvaContainerHostElement=e,this.konvaContainerHostElement.style["z-index"]=r.DisabledMaskHostZIndex,this.buildUIElements()}setSourceDimensions(t,e){this.sourceWidth=t,this.sourceHeight=e}setSelection(t,e){t&&(this.maskSelectionMode=e),this.updateZIndex(t)}setBrushSize(t){this.brushSize=t,this.setKonvaCursor()}eraseAllMasks(){this.resetKonvaLayer()}resize(t,e,i){var n;let r=1;if(this.konvaStage){if(i){const i=s.ZoomManager.getInstance().getZoomData().currentZoomScale;this.konvaStage.scale({x:1*i,y:1*i}),this.konvaStage.width(t),this.konvaStage.height(e),this.rePositionStage(),this.konvaStage.batchDraw(),r=i}else{const i=null!==(n=this.currentEditorDivWidth)&&void 0!==n?n:this.konvaStage.width(),s=this.konvaStage.scaleX()*(t/i);this.konvaStage.scale({x:s,y:s}),this.reSizeStage(t,e),this.rePositionStage(),this.konvaStage.batchDraw(),r=s}this.currentEditorDivWidth=t,this.setKonvaCursor(r)}}updateMaskVisibility(t,e){this.updateMaskVisibilityInternal(t,e)}polygonsToMask(){this.convertRegionsToMask(this.canvasLayer)}getAllMasks(){const t=this.tagsList.map(t=>({isVisible:!0,name:t.primary.name}));this.updateAllMaskVisibility(t);const e=this.getCurrentDimension(),i={width:this.sourceWidth,height:this.sourceHeight},n=this.konvaStage.width(),r=this.konvaStage.height(),s=this.konvaStage.scaleX(),o=this.konvaStage.scaleY(),a=this.konvaStage.x(),h=this.konvaStage.y();let l;this.konvaStage.width(e.width).height(e.height).scaleX(1).scaleY(1).x(0).y(0),l=this.canvasLayer.toCanvas({pixelRatio:this.sourceWidth/e.width});const c=null==l?void 0:l.getContext("2d"),d=c.getImageData(0,0,i.width,i.height);this.konvaStage.width(n).height(r).scaleX(s).scaleY(o).x(a).y(h);const g=d.data,u=new Array(i.width*i.height);u.fill(0);const p=[];return this.tagsList.forEach(t=>{const[e,n,r]=t.primary.srgbColor.to255(),s=t.primary.sequenceNumber;let o=!1;for(let t=0;t<=d.data.length-1;t+=4){const i=g[t],a=g[t+1],h=g[t+2],l=10;i>=e-l&&i<=e+l&&a>=n-l&&a<=n+l&&h>=r-l&&h<=r+l&&(u[t/4]=s,o=!0)}p.push(o),c.clearRect(0,0,i.width,i.height)}),this.tagsList=this.tagsList.filter((t,e)=>p[e]),{imageData:u,tags:this.tagsList}}loadAllMasks(t){this.initializeImageMask(),this.loadMasksInternal(t,this.canvasLayer)}unSmoothenImageData(t,e,i){for(let n=0;n<=t.length-1;n++)if(1===t[n]){const r=n-e.width-1<0?0:n-e.width-1,s=n-e.width<0?0:n-e.width,o=n-e.width+1<0?0:n-e.width+1,a=n,h=n-1<0?0:n-1,l=n+1>t.length-1?t.length-1:n+1,c=n+e.width-1>t.length-1?t.length-1:n+e.width-1,d=n+e.width>t.length-1?t.length-1:n+e.width,g=n+e.width+1>t.length-1?t.length-1:n+e.width+1,u=[];u.push(r,s,o,h,l,c,d,g);const p=u.findIndex(e=>0===t[e]);if(p>=0){const t=4*u[p];i[4*a]=i[t],i[4*a+1]=i[t+1],i[4*a+2]=i[t+2],i[4*a+3]=i[t+3]}}return i}getEdgePixelArray(t){const e=[];for(let i=0;i<=t.length-1;i+=4){let n=!0;e[i/4]=0;const r=t[i],s=t[i+1],o=t[i+2];0!==r&&0!==s&&0!==o&&(this.tagsList.forEach(t=>{const[e,i,a]=t.primary.srgbColor.to255();r===e&&s===i&&o===a&&(n=!1)}),n&&(e[i/4]=1))}return e}initializeImageMask(){this.maskImage||(this.maskImage=new Image)}updateMaskVisibilityInternal(t,e){this.canvasLayer.getChildren(t=>t.getAttr("name")===e).forEach(e=>{e.visible(t)})}updateAllMaskVisibility(t){t.forEach(t=>this.updateMaskVisibilityInternal(t.isVisible,t.name))}convertRegionsToMask(t){this.callbacks.getAllRegions().forEach(e=>{const i=e.tags;this.addTagsDescriptor(i);const r=e.regionData.points,s=e.regionData.bezierControls,o=[];r.forEach((t,e)=>{const i=e+1===r.length?0:e+1,n={start:{x:t.x,y:t.y},end:{x:r[i].x,y:r[i].y}};void 0!==s[e]&&(n.controlPoint=s.toJSON()[e]),o.push(n)});const a=new n.default.Shape({globalCompositeOperation:"destination-out",stroke:"black",fill:"black",strokeWidth:1,perfectDrawEnabled:!1,closed:!0,listening:!1,opacity:1,name:"eraserLine",sceneFunc:(t,e)=>{t.beginPath(),t.moveTo(o[0].start.x,o[0].start.y),o.forEach(e=>{e.controlPoint?t.bezierCurveTo(e.controlPoint.c1.x,e.controlPoint.c1.y,e.controlPoint.c2.x,e.controlPoint.c2.y,e.end.x,e.end.y):t.lineTo(e.end.x,e.end.y)}),t.closePath(),t.fillStrokeShape(e)}}),h=new n.default.Shape({globalCompositeOperation:"source-over",fill:i.primary.color,stroke:i.primary.color,fillEnabled:!0,perfectDrawEnabled:!1,strokeWidth:1,closed:!0,listening:!1,opacity:1,name:i.primary.name,sceneFunc:(t,e)=>{t.beginPath(),t.moveTo(o[0].start.x,o[0].start.y),o.forEach(e=>{e.controlPoint?t.bezierCurveTo(e.controlPoint.c1.x,e.controlPoint.c1.y,e.controlPoint.c2.x,e.controlPoint.c2.y,e.end.x,e.end.y):t.lineTo(e.end.x,e.end.y)}),t.closePath(),t.fillStrokeShape(e)}});t&&(t.add(a),t.add(h),t.draw())})}loadMasksInternal(t,e){const i=this.getCurrentDimension(),r={width:this.sourceWidth,height:this.sourceHeight};if(i&&!isNaN(i.width)&&!isNaN(i.height)){const s=document.createElement("canvas"),o=s.getContext("2d");o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",s.width=r.width,s.height=r.height;const a=o.createImageData(r.width,r.height),h=a.data,l=t.imageData;t.tags.forEach(t=>{const[e,i,n]=t.primary.srgbColor.to255();this.addTagsDescriptor(t);for(let r=0;r<=l.length-1;r++)l[r]===t.primary.sequenceNumber&&(h[4*r]=e,h[4*r+1]=i,h[4*r+2]=n,h[4*r+3]=255)}),a.data.set(h),o.putImageData(a,0,0),this.maskImage.src=s.toDataURL(),this.maskImage.onload=t=>{const r=new n.default.Image({image:this.maskImage,height:i.height,width:i.width,perfectDrawEnabled:!0});e.add(r)}}}setKonvaCursor(t){let e=this.maskSelectionMode===o.SelectionMode.BRUSH?this.brushSize.brush:this.brushSize.erase;e=Math.floor(e*(null!=t?t:1));const i=["url('",this.base64EncodedMaskCursor(e),"')"," ",Math.floor(e/2)+4," ",Math.floor(e/2)+4,",auto"];this.konvaStage.container().style.cursor=i.join("")}base64EncodedMaskCursor(t){const e=document.createElement("canvas"),i=e.getContext("2d");return e.width=t+8,e.height=t+8,i.beginPath(),i.arc(t/2+4,t/2+4,t/2,0,2*Math.PI,!1),i.lineWidth=2,i.strokeStyle="white",i.stroke(),e.toDataURL()}updateZIndex(t){this.konvaContainerHostElement.style["z-index"]=t?r.EnabledMaskHostZIndex:r.DisabledMaskHostZIndex}getScaledPointerPosition(){const t=this.konvaStage.getAbsoluteTransform().copy();t.invert();const e=this.konvaStage.getPointerPosition();return t.point(e)}addListeners(){let t,e,i,r=!1;this.konvaStage.on("mousedown",s=>{const a=this.getScaledPointerPosition();r=!0,t=this.getTagsDescriptor(),i=new n.default.Line(Object.assign({globalCompositeOperation:"destination-out",strokeWidth:this.maskSelectionMode===o.SelectionMode.BRUSH?this.brushSize.brush:this.brushSize.erase,points:[a.x,a.y],name:"eraserLine"},this.getLineShapeAttributes())),this.canvasLayer.add(i),e=new n.default.Line(Object.assign({stroke:t.primary.color,strokeWidth:this.maskSelectionMode===o.SelectionMode.BRUSH?this.brushSize.brush:this.brushSize.erase,globalCompositeOperation:this.maskSelectionMode===o.SelectionMode.BRUSH?"source-over":"destination-out",points:[a.x,a.y],name:t.primary.name},this.getLineShapeAttributes())),this.canvasLayer.add(e)}),this.konvaStage.on("mouseup",t=>{r=!1,e&&e.points().length<3&&e.destroy(),"function"==typeof this.callbacks.onMaskDrawingEnd&&this.callbacks.onMaskDrawingEnd()}),this.konvaStage.on("mousemove",t=>{if(!r)return;const n=this.getScaledPointerPosition(),s=i.points().concat([n.x,n.y]);i.points(s);const o=e.points().concat([n.x,n.y]);e.points(o)})}getCurrentDimension(){const t=s.ZoomManager.getInstance().getZoomData().currentZoomScale,e=getComputedStyle(this.editorDiv);return{width:parseInt(e.width,void 0)/t,height:parseInt(e.height,void 0)/t}}getLineShapeAttributes(){return{lineCap:"round",lineJoin:"round",listening:!1,tension:0,perfectDrawEnabled:!1,opacity:1}}reSizeStage(t,e){const i=document.getElementsByClassName("CanvasToolsContainer")[0];if(i){const n=getComputedStyle(i),r=parseFloat(n.width),s=parseFloat(n.height);(t<=r||e<=s)&&(this.konvaStage.width(t),this.konvaStage.height(e)),t>r&&e>s&&(this.konvaStage.width(r),this.konvaStage.height(s))}}rePositionStage(){const t=document.getElementsByClassName("CanvasToolsContainer")[0];if(t){const e=t.scrollLeft,i=t.scrollTop;this.konvaStage.container().style.transform="translate("+e+"px, "+i+"px)",this.konvaStage.x(-e),this.konvaStage.y(-i)}}getTagsDescriptor(){var t;const e=this.callbacks.onMaskDrawingBegin(),i=null===(t=null==e?void 0:e.primary)||void 0===t?void 0:t.name;return this.tagsList.find(t=>{var e;return(null===(e=null==t?void 0:t.primary)||void 0===e?void 0:e.name)===i})||this.tagsList.push(e),e}addTagsDescriptor(t){var e;const i=null===(e=null==t?void 0:t.primary)||void 0===e?void 0:e.name;this.tagsList.find(t=>{var e;return(null===(e=null==t?void 0:t.primary)||void 0===e?void 0:e.name)===i})||this.tagsList.push(t)}resetKonvaLayer(){this.canvasLayer.destroyChildren(),this.canvasLayer.destroy(),this.canvasLayer=new n.default.Layer({}),this.konvaStage.add(this.canvasLayer),this.tagsList=[]}buildUIElements(){const t=this.getCurrentDimension(),e=new n.default.Stage({container:r.KonvaContainerId,width:t.width,height:t.height});this.sourceHeight=t.height,this.sourceWidth=t.width,this.canvasLayer=new n.default.Layer({}),e.add(this.canvasLayer),this.konvaStage=e,this.setKonvaCursor(),this.addListeners();const i=document.getElementsByClassName("CanvasToolsContainer")[0];null==i||i.addEventListener("scroll",()=>this.rePositionStage())}}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.calculateLineSegments=void 0;const n=i(27);function r(t,e,i){return{oneThird:{x:t.x+e/3,y:t.y+i/3},half:{x:t.x+e/2,y:t.y+i/2},twoThird:{x:t.x+2*e/3,y:t.y+2*i/3}}}function s(t,e){const i=e.x-t.x,n=e.y-t.y;return{start:t,end:e,xLength:i,yLength:n,pointsAlongLine:r(t,i,n)}}e.calculateLineSegments=function(t,e){if(t.length<2)return[];if(2===t.length)return[s(t[0],t[1])];const i=[],r=t.length,o=r-1;for(let e=0;e<o;e++){const n=e+1;n<r&&i.push(s(t[e],t[n]))}return[n.RegionDataType.Polygon,n.RegionDataType.Path].includes(null==e?void 0:e.regionType)&&i.push(s(t[r-1],t[0])),i}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CubicBezierIndex=void 0;const n=i(20),r=i(42);function s(t){const e=r.mapIndexRecord(t,t=>new n.CubicBezierControl(t));return new a(e)}function o(t,e){return new a(r.mapIndexRecord(t,t=>new n.CubicBezierControl({c1:e(t.c1),c2:e(t.c2)})))}class a{static buildFromJSON(t){return s(t)}constructor(t){t&&Object.entries(t).forEach(([t,e])=>{const i=Number(t);Number.isSafeInteger(i)&&(this[i]=e)})}copy(){return s(this)}scale(t){return o(this,t)}move(t){return o(this,t)}shift(t,e){return new a(r.mapIndexRecord(this,i=>{const n=i.copy();return n.shift(t,e),n}))}boundToRect(t){return new a(r.mapIndexRecord(this,e=>e.boundToRect(t)))}toJSON(){return r.mapIndexRecord(this,t=>t.toJSON())}forEach(t){r.mapIndexRecord(this,t)}}e.CubicBezierIndex=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mapIndexRecord=void 0,e.mapIndexRecord=function(t,e){const i={};return Object.entries(t).forEach(([t,n])=>{const r=Number(t);Number.isSafeInteger(r)&&(i[r]=e(n,r))}),i}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PathRegion=void 0;const n=i(2),r=i(28),s=i(7),o=i(44),a=i(46),h=i(48);class l extends s.Region{constructor(t,e=null,i,r,s,o,a){super(t,e,i,Object.assign({},r),s,o,a),null!==e&&(this.paperRects={actual:new n.Rect(e.width-i.width,e.height-i.height),host:e}),this.buildOn(t);const h=this.callbacks.onChange;this.callbacks.onChange=(t,e,...i)=>{this.paperRects.actual.resize(this.paperRects.host.width-e.width,this.paperRects.host.height-e.height),h(this,e,...i)}}updateTags(t,e){super.updateTags(t,e),this.tagsNode.updateTags(t,e),this.node.select("title").node.innerHTML=null!==t?t.toString():""}resize(t,e){this.paperRects.actual.resize(this.paperRects.host.width-t,this.paperRects.host.height-e),super.resize(t,e)}buildOn(t){this.node=t.g(),this.node.addClass("regionStyle"),this.node.addClass(this.styleID),this.dragNode=new r.DragElement(t,this.paperRects.actual,this.regionData,this.callbacks),this.tagsNode=new h.TagsElement(t,this.paperRect,this.regionData,this.tags,this.styleID,this.styleSheet,this.tagsUpdateOptions),this.anchorNode=new o.AnchorsElement(t,this.paperRect,this.regionData,this.callbacks),this.midpointNode=new a.MidpointElement(t,this.paperRect,this.regionData,this.callbacks),this.toolTip=Snap.parse(`<title>${null!==this.tags?this.tags.toString():""}</title>`),this.node.append(this.toolTip),this.node.add(this.dragNode.node),this.node.add(this.tagsNode.node),this.node.add(this.anchorNode.node),this.node.add(this.midpointNode.node),this.UI.push(this.tagsNode,this.dragNode,this.anchorNode,this.midpointNode)}}e.PathRegion=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AnchorsElement=void 0;const n=i(12),r=i(1),s=i(3),o=i(8),a=i(45);var h;!function(t){t.Add="add",t.Delete="delete",t.None=""}(h||(h={}));class l extends o.AnchorsComponent{constructor(t,e=null,i,n){super(t,e,i,n),this.ghostAnchorActionState=h.None,this.anchorsLength=i.points.length;const r=new a.BezierController(this,t,e,i,this.anchorsNode,n,this.createAnchor.bind(this),this.subscribeToEvents.bind(this));r.buildAnchors(),this.mixins.push(r)}set ghostAnchorAction(t){this.ghostAnchor.removeClass("add"),this.ghostAnchor.removeClass("delete"),this.ghostAnchor.addClass(t),this.ghostAnchorActionState=t}get ghostAnchorAction(){return this.ghostAnchorActionState}redraw(){if(null!==this.regionData.points&&this.regionData.points.length>0){const t=this.regionData.points;this.anchorsLength!==t.length?(window.requestAnimationFrame(()=>{this.anchors.forEach(t=>{t.remove()}),this.anchors=[],this.buildPointAnchors()}),this.anchorsLength=t.length):this.anchors.length>0&&window.requestAnimationFrame(()=>{this.regionData.points.forEach((t,e)=>{this.anchors[e].attr({cx:t.x,cy:t.y})})}),this.updateAnchorLines()}this.mixins.forEach(t=>t.redraw())}buildAnchors(){this.buildAnchorLines(),super.buildAnchors()}buildAnchorLines(){const t=this.paper.g();t.addClass("anchorLineStyle"),this.anchorsPolyline=t,this.regionData.toLinePathSegments().forEach((e,i)=>{const n=this.paper.path(e);t.add(n),this.subscribeLineToEvents(n,i)}),this.anchorsNode.add(this.anchorsPolyline)}updateAnchorLines(){this.anchorsPolyline.remove(),this.buildAnchorLines()}subscribeLineToEvents(t,e){this.subscribeToEvents([{base:t.node,event:"pointermove",listener:t=>{if(this.isModifyRegionOnlyModeEnabled(t)){this.activeAnchorIndex=-1;const i=this.getActiveAnchorPoint(t);this.ghostAnchorLineIdx=e,this.dragOrigin=i,this.ghostAnchorAction=h.Add,window.requestAnimationFrame(()=>{this.ghostAnchor.attr({cx:i.x,cy:i.y,display:"block"})})}else this.ghostAnchorAction=h.None},bypass:!1}])}updateRegion(t){const e=this.regionData.copy();this.activeAnchorIndex>0&&this.activeAnchorIndex<=this.regionData.points.length&&e.setPoint(t,this.activeAnchorIndex-1),this.callbacks.onChange(this,e,s.ChangeEventType.MOVING)}onGhostPointerEnter(t){this.isModifyRegionOnlyModeEnabled(t)?this.regionData.points.length<=l.MIN_NUMBERS_OF_POINTS_PER_POLYGON&&(this.ghostAnchorAction=h.Delete):this.ghostAnchorAction=h.None,super.onGhostPointerEnter(t)}onGhostPointerMove(t){if(this.isModifyRegionOnlyModeEnabled(t)&&0!==this.activeAnchorIndex){const e=this.getActiveAnchorPoint(t);let i=Number.MAX_VALUE,n=-1;this.regionData.points.forEach((t,r)=>{const s=e.squareDistanceToPoint(t);s<i&&(i=s,n=r)});const r=i<l.ANCHOR_POINT_LINE_SWITCH_THRESHOLD;this.activeAnchorIndex<=0&&!r?(this.ghostAnchorAction=h.Add,this.activeAnchorIndex=-1):this.regionData.points.length>l.MIN_NUMBERS_OF_POINTS_PER_POLYGON&&r&&(this.activeAnchorIndex=n+1,this.ghostAnchorAction=h.Delete)}else this.ghostAnchorAction=h.None;super.onGhostPointerMove(t)}onGhostPointerUp(t){const e=this.regionData.copy();if(this.ghostAnchorAction===h.Delete)this.activeAnchorIndex>0&&this.activeAnchorIndex<=this.regionData.points.length&&e.splicePoints(this.activeAnchorIndex-1,1),this.ghostAnchorAction=h.None,this.callbacks.onChange(this,e,s.ChangeEventType.MOVEEND);else if(this.ghostAnchorAction===h.Add){const i=t.clientX-t.target.closest("svg").getBoundingClientRect().left,n=t.clientY-t.target.closest("svg").getBoundingClientRect().top,o=new r.Point2D(i,n),a=this.ghostAnchorLineIdx;e.splicePoints(a+1,0,o),this.ghostAnchorAction=h.Delete,this.callbacks.onChange(this,e,s.ChangeEventType.MOVEEND)}super.onGhostPointerUp(t)}getActiveAnchorPoint(t){if(this.activeAnchorIndex>0)return this.regionData.points[this.activeAnchorIndex-1];if(this.activeAnchorIndex<0){const e=t.clientX-t.target.closest("svg").getBoundingClientRect().left,i=t.clientY-t.target.closest("svg").getBoundingClientRect().top;return new r.Point2D(e,i)}return null}isModifyRegionOnlyModeEnabled(t){return n.ConfigurationManager.isModifyRegionOnlyMode||(null==t?void 0:t.ctrlKey)}}e.AnchorsElement=l,l.ANCHOR_POINT_LINE_SWITCH_THRESHOLD=5,l.MIN_NUMBERS_OF_POINTS_PER_POLYGON=3},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BezierController=void 0;const n=i(1),r=i(3),s=i(8);e.BezierController=class{constructor(t,e,i,n,r,s,o,a){this.anchorComponent=t,this.paper=e,this.paperRect=i,this.regionData=n,this.anchorsNode=r,this.callbacks=s,this.createAnchor=o,this.subscribeToEvents=a,this.isDragged=!1,this.controlPoints=[]}buildAnchors(){this.buildControlPoints(),this.controlGhostAnchor=this.createAnchor(this.paper,0,0,"ghost",s.AnchorsComponent.DEFAULT_GHOST_ANCHOR_RADIUS),this.controlGhostAnchor.attr({display:"none"}),this.anchorComponent.node.add(this.controlGhostAnchor),this.subscribeControlGhostToEvents(this.controlGhostAnchor)}redraw(){this.updateControlPoints()}updateControlPoints(){this.controlPoints.forEach(t=>{t.remove()}),this.controlPoints=[],this.buildControlPoints()}subscribeControlPointToEvents(t,e,i){this.subscribeToEvents([{event:"pointerenter",base:t.node,listener:()=>{this.activeControlPointId={index:e,name:i};const t=this.getActiveControlPoint();t&&window.requestAnimationFrame(()=>{this.controlGhostAnchor.attr({cx:t.x,cy:t.y,display:"block"})})},bypass:!1}])}createControlPoint(t,e,i,n=6){const r=t.circle(e,i,n);return r.addClass("bezierControlPointStyle"),r}createControlPointTangent(t,e){const i=t.polyline(e);return i.addClass("bezierControlPointTangentStyle"),i}createControlPointGroup(t,e,i,n){const r=this.paper.g(),s="c1"===n?e.start:e.end,o=i[n],a=this.createControlPoint(this.paper,o.x,o.y),h=this.createControlPointTangent(this.paper,[s.x,s.y,o.x,o.y]);return r.add(h),r.add(a),this.subscribeControlPointToEvents(a,t,n),r}buildControlPoints(){const t=this.regionData.getLineSegments();this.regionData.bezierControls.forEach((e,i)=>{const n=t[i],r=this.createControlPointGroup(i,n,e,"c1");this.anchorsNode.add(r);const s=this.createControlPointGroup(i,n,e,"c2");this.anchorsNode.add(s),this.controlPoints.push(r,s)})}subscribeControlGhostToEvents(t){const e=[{event:"pointerleave",base:t.node,listener:t=>{this.isDragged||window.requestAnimationFrame(()=>{this.controlGhostAnchor.attr({display:"none"})})},bypass:!0},{event:"pointermove",base:t.node,listener:t=>{if(this.isDragged){const e=t.target.getBoundingClientRect(),i=t.clientX-e.left,r=t.clientY-e.top,s=t.clientX-t.target.closest("svg").getBoundingClientRect().left,o=t.clientY-t.target.closest("svg").getBoundingClientRect().top;let a=s-this.dragOrigin.x,h=o-this.dragOrigin.y;if((i<0&&a>0||i>0&&a<0)&&(a=0),(r<0&&h>0||r>0&&h<0)&&(h=0),this.activeControlPointId){const t=this.getActiveControlPoint();let e=new n.Point2D(t.x+a,t.y+h);null!==this.paperRect&&(e=e.boundToRect(this.paperRect)),window.requestAnimationFrame(()=>{this.controlGhostAnchor.attr({cx:e.x,cy:e.y})}),this.updateRegion(e)}this.dragOrigin=new n.Point2D(s,o)}},bypass:!1},{event:"pointerdown",base:t.node,listener:t=>{this.controlGhostAnchor.node.setPointerCapture(t.pointerId);const e=t.clientX-t.target.closest("svg").getBoundingClientRect().left,i=t.clientY-t.target.closest("svg").getBoundingClientRect().top;this.dragOrigin=new n.Point2D(e,i),this.isDragged=!0,this.callbacks.onManipulationLockRequest(this.anchorComponent),this.callbacks.onChange(this.anchorComponent,this.regionData.copy(),r.ChangeEventType.MOVEBEGIN)},bypass:!1},{event:"pointerup",base:t.node,listener:t=>{this.controlGhostAnchor.node.releasePointerCapture(t.pointerId),this.callbacks.onManipulationLockRelease(this.anchorComponent),this.callbacks.onChange(this.anchorComponent,this.regionData.copy(),r.ChangeEventType.MOVEEND),this.activeControlPointId=void 0,this.dragOrigin=null,this.isDragged=!1,window.requestAnimationFrame(()=>{this.controlGhostAnchor.attr({display:"none"})})},bypass:!1}];this.subscribeToEvents(e)}getActiveControlPoint(){return this.activeControlPointId?this.regionData.bezierControls[this.activeControlPointId.index][this.activeControlPointId.name]:null}updateRegion(t){if(this.activeControlPointId){const e=this.regionData.copy();if(this.activeControlPointId){const i=e.bezierControls[this.activeControlPointId.index];i&&(i[this.activeControlPointId.name].move(t),e.setBezierControl(this.activeControlPointId.index,i))}this.callbacks.onChange(this.anchorComponent,e,r.ChangeEventType.MOVING)}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MidpointElement=void 0;const n=i(20),r=i(47);class s extends r.MidpointComponent{constructor(t,e=null,i,n){super(t,e,i,n)}subscribeMidpointToEvents(t,e){const i=[{event:"click",base:t.node,listener:t=>{t.stopPropagation(),this.createBezierControl(e)},bypass:!1}];this.subscribeToEvents(i)}createBezierControl(t){const e=this.regionData.copy(),i=e.getLineSegments()[t];e.setBezierControl(t,new n.CubicBezierControl({c1:i.pointsAlongLine.oneThird,c2:i.pointsAlongLine.twoThird})),this.callbacks.onChange(this,e)}}e.MidpointElement=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MidpointComponent=void 0;const n=i(5);class r extends n.RegionComponent{constructor(t,e=null,i,n){super(t,e,i,n),this.node=t.g(),this.node.addClass("midpointLayer"),this.midpointElements={},this.midpointNode=this.paper.g(),this.node.add(this.midpointNode);const r=this.regionData.getLineSegments();this.buildMidpoints(r)}redraw(){const t=this.regionData.bezierControls,e=this.regionData.getLineSegments();window.requestAnimationFrame(()=>{this.updateMidpoints(t,e)})}createMidpoint(t,e,i,n,s=r.DEFAULT_RADIUS){const o=t.circle(e,i,s);return o.addClass("midpointStyle"),void 0!==n&&""!==n&&o.addClass(n),o}teardownMidpoints(){Object.values(this.midpointElements).forEach(t=>{t.remove()}),this.midpointElements={}}buildMidpoints(t){this.teardownMidpoints();const e=this.regionData.bezierControls;t.forEach((t,i)=>{if(e[i])return;const n=this.createMidpoint(this.paper,t.pointsAlongLine.half.x,t.pointsAlongLine.half.y);this.midpointElements[i]=n,this.midpointNode.add(n),this.subscribeMidpointToEvents(n,i)})}updateMidpoints(t,e){const i=[],n=[],r=[];e.forEach((e,s)=>{t[s]||this.midpointElements[s]?!t[s]&&this.midpointElements[s]?r.push(s):t[s]&&this.midpointElements[s]&&i.push(s):n.push(s)}),Object.entries(this.midpointElements).forEach(([t])=>{e[t]||i.push(Number(t))}),i.forEach(t=>{this.midpointElements[t].remove(),delete this.midpointElements[t]}),n.forEach(t=>{this.midpointElements[t]&&this.midpointElements[t].remove();const i=this.createMidpoint(this.paper,e[t].pointsAlongLine.half.x,e[t].pointsAlongLine.half.y);this.midpointElements[t]=i,this.midpointNode.add(i),this.subscribeMidpointToEvents(i,t)}),r.forEach(t=>{const i=e[t];this.midpointElements[t].attr({cx:i.pointsAlongLine.half.x,cy:i.pointsAlongLine.half.y})})}}e.MidpointComponent=r,r.DEFAULT_RADIUS=6},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TagsElement=void 0;const n=i(9);class r extends n.TagsComponent{constructor(t,e,i,n,r,s,o){super(t,e,i,n,r,s,o),this.buildOn(t,n)}redraw(t=!1){const e=[];this.regionData.points.forEach(t=>{e.push(t.x,t.y)});const i=r.DEFAULT_SECONDARY_TAG_SIZE,s=this.x+this.width/2,o=this.y-i-5;window.requestAnimationFrame(()=>{this.primaryTagBoundRect.attr({x:this.x,y:this.y,width:this.width,height:this.height}),this.primaryTagPolygon.attr({d:this.regionData.toPath()}),t&&(this.primaryTagText.node.innerHTML=null!==this.tags.primary?this.tags.primary.name:"",this.textBox=n.TagsComponent.getCachedBBox(this.primaryTagText));if(this.textBox.width+10<=this.width&&this.textBox.height<=this.height?(this.primaryTagTextBG.attr({height:this.textBox.height+5,width:this.textBox.width+10,x:this.x+1,y:this.y+1}),this.primaryTagText.attr({visibility:"visible",x:this.x+5,y:this.y+this.textBox.height})):(this.primaryTagTextBG.attr({height:Math.min(10,this.height),width:Math.min(10,this.width),x:this.x,y:this.y}),this.primaryTagText.attr({visibility:"hidden",x:this.x+5,y:this.y+this.textBox.height})),this.secondaryTags&&this.secondaryTags.length>0){const t=this.secondaryTags.length;for(let e=0;e<t;e++){const n=this.secondaryTags[e],r=s+(2*e-t+.5)*i;n.attr({x:r,y:o})}}})}initStyleMaps(t){null!==t&&(null!==t.primary?(this.styleMap=[{rule:`.${this.styleId} .primaryTagBoundRectStyle`,style:`fill: ${t.primary.colorShadow};\n                                stroke: ${t.primary.colorAccent};`},{rule:`.regionStyle.selected.${this.styleId} .primaryTagBoundRectStyle`,style:`fill: ${t.primary.colorHighlight}; opacity: 1;`},{rule:`.${this.styleId}:hover .primaryTagBoundRectStyle`,style:`fill: ${t.primary.colorHighlight};`},{rule:`.${this.styleId} .primaryTagPolygonStyle`,style:`fill: ${t.primary.colorShadow};\n                                stroke: ${t.primary.colorPure};`},{rule:`.${this.styleId}:hover .primaryTagPolygonStyle`,style:`fill: ${t.primary.colorHighlight};\n                                stroke: ${t.primary.colorPure};`},{rule:`.regionStyle.${this.styleId} .primaryTagTextBGStyle`,style:`fill:${t.primary.colorAccent};`},{rule:`.regionStyle.selected.${this.styleId} .primaryTagPolygonStyle`,style:`fill: ${t.primary.colorHighlight};\n                                stroke: ${t.primary.colorPure};`},{rule:`.regionStyle.${this.styleId} .anchorStyle`,style:`stroke:${t.primary.colorDark};\n                                fill: ${t.primary.colorPure}`},{rule:`.regionStyle.${this.styleId}:hover .anchorStyle`,style:"stroke:#fff;"},{rule:`.regionStyle.${this.styleId} .anchorStyle.ghost`,style:"fill: var(--default-color-ghost);"}],this.styleLightMap=[{rule:`.${this.styleId} .primaryTagBoundRectStyle`,style:`fill: none;\n                                stroke: ${t.primary.colorAccent};`},{rule:`.${this.styleId} .primaryTagPolygonStyle`,style:`fill: ${t.primary.colorNoColor};\n                                stroke: ${t.primary.colorPure};\n                                stroke-width: 1px;`},{rule:`.regionStyle.${this.styleId}:hover .primaryTagPolygonStyle`,style:`fill: ${t.primary.colorHighlight};\n                                stroke: ${t.primary.colorPure};`},{rule:`.regionStyle.selected.${this.styleId} .primaryTagPolygonStyle`,style:`fill: ${t.primary.colorNoColor};\n                                stroke: ${t.primary.colorPure};`},{rule:`.regionStyle.${this.styleId} .primaryTagTextBGStyle`,style:`fill:${t.primary.colorNoColor};`},{rule:`.regionStyle.${this.styleId} .anchorStyle`,style:`stroke:${t.primary.colorDark};\n                                fill: ${t.primary.colorPure};\n                                stroke-width: 1px;`},{rule:`.regionStyle.${this.styleId}:hover .anchorStyle`,style:"stroke:#fff;"},{rule:`.regionStyle.${this.styleId} .anchorStyle.ghost`,style:"fill: var(--default-color-ghost);"},{rule:`.regionStyle.${this.styleId} .secondaryTagStyle`,style:"opacity:0.25;"}]):(this.styleMap=[],this.styleLightMap=[{rule:`.${this.styleId} .primaryTagPolygonStyle`,style:"fill: var(--default-color-transparent);"},{rule:`.regionStyle.selected.${this.styleId} .primaryTagPolygonStyle`,style:"fill: var(--default-color-transparent);"},{rule:`.${this.styleId} .primaryTagBoundRectStyle`,style:"fill: none;"},{rule:`.${this.styleId} .primaryTagPolylineStyle`,style:"stroke-width: 1px;"},{rule:`.regionStyle.${this.styleId} .anchorStyle`,style:"stroke-width: 1px;"},{rule:`.regionStyle.${this.styleId} .anchorStyle.ghost`,style:"fill: var(--default-color-ghost);"}]),null!==t.secondary&&void 0!==t.secondary&&t.secondary.forEach(t=>{const e={rule:".secondaryTagStyle.secondaryTag-"+t.name,style:`fill: ${t.colorAccent};`};this.styleMap.push(e),this.styleLightMap.push(e)}))}rebuildTagLabels(){for(const t of this.secondaryTags)t.remove();if(this.secondaryTags=[],this.tags&&(void 0!==this.tags.primary&&null!==this.tags.primary&&this.redraw(!0),this.tags.secondary&&this.tags.secondary.length>0)){const t=this.tags.secondary.length;for(let e=0;e<t;e++){const i=this.tags.secondary[e],n=r.DEFAULT_SECONDARY_TAG_SIZE,s=this.x+this.boundRect.width/2+(2*e-t+1)*n-n/2,o=this.y-n-5,a=this.paper.rect(s,o,n,n);window.requestAnimationFrame(()=>{a.addClass("secondaryTagStyle"),a.addClass("secondaryTag-"+i.name)}),this.secondaryTagsNode.add(a),this.secondaryTags.push(a)}}}buildOn(t,e){this.primaryTagNode=t.g(),this.primaryTagBoundRect=t.rect(this.x,this.y,this.boundRect.width,this.boundRect.height),this.primaryTagBoundRect.addClass("primaryTagBoundRectStyle"),this.primaryTagText=t.text(this.x,this.y,""),this.primaryTagText.addClass("primaryTagTextStyle"),this.textBox=n.TagsComponent.getCachedBBox(this.primaryTagText);const i=[];this.regionData.points.forEach(t=>{i.push(t.x,t.y)}),this.primaryTagPolygon=t.path(this.regionData.toPath()),this.primaryTagPolygon.addClass("primaryTagPolygonStyle"),this.primaryTagTextBG=t.rect(this.x,this.y,0,0),this.primaryTagTextBG.addClass("primaryTagTextBGStyle"),this.regionData.points.forEach(t=>{i.push(t.x,t.y)}),this.primaryTagNode.add(this.primaryTagBoundRect),this.primaryTagNode.add(this.primaryTagPolygon),this.primaryTagNode.add(this.primaryTagTextBG),this.primaryTagNode.add(this.primaryTagText),this.secondaryTagsNode=t.g(),this.secondaryTagsNode.addClass("secondaryTagsLayer"),this.secondaryTags=[],this.node.add(this.primaryTagNode),this.node.add(this.secondaryTagsNode),this.initStyleMaps(e),this.updateTags(e,this.tagsUpdateOptions)}}e.TagsElement=r,r.DEFAULT_PRIMARY_TAG_RADIUS=3,r.DEFAULT_SECONDARY_TAG_SIZE=6,r.DEFAULT_SECONDARY_TAG_DY=6},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DragElement=void 0;const n=i(14);class r extends n.DragComponent{constructor(t,e=null,i,n){super(t,e,i,n),this.dragNode=t.circle(this.x,this.y,r.DEFAULT_DRAG_RADIUS),this.dragNode.addClass("dragPointStyle"),this.node.add(this.dragNode),this.subscribeToDragEvents()}redraw(){window.requestAnimationFrame(()=>{this.dragNode.attr({cx:this.x,cy:this.y})})}}e.DragElement=r,r.DEFAULT_DRAG_RADIUS=6},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TagsElement=void 0;const n=i(9);class r extends n.TagsComponent{constructor(t,e,i,n,r,s,o){super(t,e,i,n,r,s,o),this.buildOn(t,n)}redraw(){const t=r.DEFAULT_SECONDARY_TAG_SIZE,e=this.x,i=this.y-t-r.DEFAULT_SECONDARY_TAG_DY;window.requestAnimationFrame(()=>{if(this.primaryTagNode.attr({cx:this.x,cy:this.y}),this.secondaryTags&&this.secondaryTags.length>0){const n=this.secondaryTags.length;for(let r=0;r<n;r++){const s=this.secondaryTags[r],o=e+(2*r-n+.5)*t;s.attr({x:o,y:i})}}})}initStyleMaps(t){null!==t&&(null!==t.primary?(this.styleMap=[{rule:`.${this.styleId} .primaryTagPointStyle`,style:`fill: ${t.primary.colorAccent};`},{rule:`.regionStyle.${this.styleId}:hover  .primaryTagPointStyle`,style:`fill: ${t.primary.colorHighlight};\n                                    stroke: #fff;`},{rule:`.regionStyle.selected.${this.styleId} .primaryTagPointStyle`,style:`fill: ${t.primary.colorAccent};\n                                stroke:${t.primary.colorHighlight};`}],this.styleLightMap=[{rule:`.${this.styleId} .primaryTagPointStyle`,style:`fill: ${t.primary.colorNoColor};\n                                stroke:${t.primary.colorAccent};\n                                stroke-width: 1px;`},{rule:`.regionStyle.${this.styleId}:hover  .primaryTagPointStyle`,style:`stroke:${t.primary.colorAccent};`},{rule:`.regionStyle.selected.${this.styleId} .primaryTagPointStyle`,style:`fill: ${t.primary.colorHighlight};\n                                stroke:${t.primary.colorAccent};`},{rule:`.regionStyle.${this.styleId} .secondaryTagStyle`,style:"opacity:0.25;"},{rule:`.regionStyle.${this.styleId} .dragPointStyle`,style:"opacity:0.25;"},{rule:`.regionStyle.selected.${this.styleId} .dragPointStyle`,style:"opacity:0.5;"}]):(this.styleMap=[],this.styleLightMap=[{rule:`.${this.styleId} .primaryTagPointStyle`,style:"fill: var(--default-color-transparent);\n                                stroke: var(--default-color-pure);\n                                stroke-width: 1px;"},{rule:`.regionStyle.${this.styleId} .dragPointStyle`,style:"opacity:0.25;"},{rule:`.regionStyle.selected.${this.styleId} .dragPointStyle`,style:"opacity:0.5;"}]),null!==t.secondary&&void 0!==t.secondary&&t.secondary.forEach(t=>{const e={rule:".secondaryTagStyle.secondaryTag-"+t.name,style:`fill: ${t.colorAccent};`};this.styleMap.push(e),this.styleLightMap.push(e)}))}rebuildTagLabels(){for(const t of this.secondaryTags)t.remove();if(this.secondaryTags=[],this.tags&&(void 0!==this.tags.primary&&this.tags.primary,this.tags.secondary&&this.tags.secondary.length>0)){const t=this.tags.secondary.length;for(let e=0;e<t;e++){const i=this.tags.secondary[e],n=r.DEFAULT_SECONDARY_TAG_SIZE,s=this.x+this.boundRect.width/2+(2*e-t+1)*n-n/2,o=this.y-n-r.DEFAULT_SECONDARY_TAG_DY,a=this.paper.rect(s,o,n,n);window.requestAnimationFrame(()=>{a.addClass("secondaryTagStyle"),a.addClass("secondaryTag-"+i.name)}),this.secondaryTagsNode.add(a),this.secondaryTags.push(a)}}}buildOn(t,e){this.primaryTagNode=t.circle(this.x,this.y,r.DEFAULT_PRIMARY_TAG_RADIUS),this.primaryTagNode.addClass("primaryTagPointStyle"),this.secondaryTagsNode=t.g(),this.secondaryTagsNode.addClass("secondaryTagsLayer"),this.secondaryTags=[],this.node.add(this.primaryTagNode),this.node.add(this.secondaryTagsNode),this.initStyleMaps(e),this.updateTags(e,this.tagsUpdateOptions)}}e.TagsElement=r,r.DEFAULT_PRIMARY_TAG_RADIUS=3,r.DEFAULT_SECONDARY_TAG_SIZE=6,r.DEFAULT_SECONDARY_TAG_DY=6},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PolygonRegion=void 0;const n=i(2),r=i(7),s=i(52),o=i(28),a=i(53);class h extends r.Region{constructor(t,e=null,i,r,s,o,a){super(t,e,i,Object.assign({},r),s,o,a),null!==e&&(this.paperRects={actual:new n.Rect(e.width-i.width,e.height-i.height),host:e}),this.buildOn(t);const h=this.callbacks.onChange;this.callbacks.onChange=(t,e,...i)=>{this.paperRects.actual.resize(this.paperRects.host.width-e.width,this.paperRects.host.height-e.height),h(this,e,...i)}}updateTags(t,e){super.updateTags(t,e),this.tagsNode.updateTags(t,e),this.node.select("title").node.innerHTML=null!==t?t.toString():""}resize(t,e){this.paperRects.actual.resize(this.paperRects.host.width-t,this.paperRects.host.height-e),super.resize(t,e)}buildOn(t){this.node=t.g(),this.node.addClass("regionStyle"),this.node.addClass(this.styleID),this.dragNode=new o.DragElement(t,this.paperRects.actual,this.regionData,this.callbacks),this.tagsNode=new a.TagsElement(t,this.paperRect,this.regionData,this.tags,this.styleID,this.styleSheet,this.tagsUpdateOptions),this.anchorNode=new s.AnchorsElement(t,this.paperRect,this.regionData,this.callbacks),this.toolTip=Snap.parse(`<title>${null!==this.tags?this.tags.toString():""}</title>`),this.node.append(this.toolTip),this.node.add(this.dragNode.node),this.node.add(this.tagsNode.node),this.node.add(this.anchorNode.node),this.UI.push(this.tagsNode,this.dragNode,this.anchorNode)}}e.PolygonRegion=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AnchorsElement=void 0;const n=i(12),r=i(1),s=i(3),o=i(8);var a;!function(t){t.Add="add",t.Delete="delete",t.None=""}(a||(a={}));class h extends o.AnchorsComponent{constructor(t,e=null,i,n){super(t,e,i,n),this.ghostAnchorActionState=a.None,this.anchorsLength=i.points.length}set ghostAnchorAction(t){this.ghostAnchor.removeClass("add"),this.ghostAnchor.removeClass("delete"),this.ghostAnchor.addClass(t),this.ghostAnchorActionState=t}get ghostAnchorAction(){return this.ghostAnchorActionState}redraw(){if(null!==this.regionData.points&&this.regionData.points.length>0){const t=this.regionData.points;this.anchorsLength!==t.length?(window.requestAnimationFrame(()=>{this.anchors.forEach(t=>{t.remove()}),this.anchors=[],this.buildPointAnchors()}),this.anchorsLength=t.length):this.anchors.length>0&&window.requestAnimationFrame(()=>{this.regionData.points.forEach((t,e)=>{this.anchors[e].attr({cx:t.x,cy:t.y})})});const e=[];this.regionData.points.forEach(t=>{e.push(t.x,t.y)}),e.push(this.regionData.points[0].x,this.regionData.points[0].y),this.anchorsPolyline.attr({points:e.toString()})}}buildAnchors(){this.buildPolylineAnchors(),super.buildAnchors()}buildPolylineAnchors(){const t=[];this.regionData.points.forEach(e=>{t.push(e.x,e.y)}),t.push(this.regionData.points[0].x,this.regionData.points[0].y),this.anchorsPolyline=this.paper.polyline(t),this.anchorsPolyline.addClass("anchorLineStyle"),this.subscribeLineToEvents(this.anchorsPolyline),this.anchorsNode.add(this.anchorsPolyline)}subscribeLineToEvents(t){this.subscribeToEvents([{base:t.node,event:"pointermove",listener:t=>{if(this.isModifyRegionOnlyModeEnabled(t)){this.activeAnchorIndex=-1;const e=this.getActiveAnchorPoint(t);this.dragOrigin=e,this.ghostAnchorAction=a.Add,window.requestAnimationFrame(()=>{this.ghostAnchor.attr({cx:e.x,cy:e.y,display:"block"})})}else this.ghostAnchorAction=a.None},bypass:!1}])}updateRegion(t){const e=this.regionData.copy();this.activeAnchorIndex>0&&this.activeAnchorIndex<=this.regionData.points.length&&e.setPoint(t,this.activeAnchorIndex-1),this.callbacks.onChange(this,e,s.ChangeEventType.MOVING)}onGhostPointerEnter(t){this.isModifyRegionOnlyModeEnabled(t)?this.regionData.points.length<=h.MIN_NUMBERS_OF_POINTS_PER_POLYGON&&(this.ghostAnchorAction=a.Delete):this.ghostAnchorAction=a.None,super.onGhostPointerEnter(t)}onGhostPointerMove(t){if(this.isModifyRegionOnlyModeEnabled(t)&&0!==this.activeAnchorIndex){const e=this.getActiveAnchorPoint(t);let i=Number.MAX_VALUE,n=-1;this.regionData.points.forEach((t,r)=>{const s=e.squareDistanceToPoint(t);s<i&&(i=s,n=r)});const r=i<h.ANCHOR_POINT_LINE_SWITCH_THRESHOLD;this.activeAnchorIndex<=0&&!r?(this.ghostAnchorAction=a.Add,this.activeAnchorIndex=-1):this.regionData.points.length>h.MIN_NUMBERS_OF_POINTS_PER_POLYGON&&r&&(this.activeAnchorIndex=n+1,this.ghostAnchorAction=a.Delete)}else this.ghostAnchorAction=a.None;super.onGhostPointerMove(t)}onGhostPointerUp(t){const e=this.regionData.copy();if(this.ghostAnchorAction===a.Delete){if(this.activeAnchorIndex>0&&this.activeAnchorIndex<=this.regionData.points.length){const t=e.points;t.splice(this.activeAnchorIndex-1,1),e.setPoints(t)}this.ghostAnchorAction=a.None,this.callbacks.onChange(this,e,s.ChangeEventType.MOVEEND)}else if(this.ghostAnchorAction===a.Add){const i=t.clientX-t.target.closest("svg").getBoundingClientRect().left,n=t.clientY-t.target.closest("svg").getBoundingClientRect().top,o=new r.Point2D(i,n),h=e.points;let l=0,c=Number.MAX_VALUE;for(let t=0;t<h.length;t++){let e;e=t<h.length-1?this.dragOrigin.squareDistanceToLine(h[t],h[t+1]):this.dragOrigin.squareDistanceToLine(h[t],h[0]),e<c&&(l=t,c=e)}h.splice(l+1,0,o),e.setPoints(h),this.ghostAnchorAction=a.Delete,this.callbacks.onChange(this,e,s.ChangeEventType.MOVEEND)}super.onGhostPointerUp(t)}getActiveAnchorPoint(t){if(this.activeAnchorIndex>0)return this.regionData.points[this.activeAnchorIndex-1];if(this.activeAnchorIndex<0){const e=t.clientX-t.target.closest("svg").getBoundingClientRect().left,i=t.clientY-t.target.closest("svg").getBoundingClientRect().top;return new r.Point2D(e,i)}return null}isModifyRegionOnlyModeEnabled(t){return n.ConfigurationManager.isModifyRegionOnlyMode||(null==t?void 0:t.ctrlKey)}}e.AnchorsElement=h,h.ANCHOR_POINT_LINE_SWITCH_THRESHOLD=5,h.MIN_NUMBERS_OF_POINTS_PER_POLYGON=3},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TagsElement=void 0;const n=i(9);class r extends n.TagsComponent{constructor(t,e,i,n,r,s,o){super(t,e,i,n,r,s,o),this.buildOn(t,n)}redraw(t=!1){const e=[];this.regionData.points.forEach(t=>{e.push(t.x,t.y)});const i=r.DEFAULT_SECONDARY_TAG_SIZE,s=this.x+this.width/2,o=this.y-i-5;window.requestAnimationFrame(()=>{this.primaryTagBoundRect.attr({x:this.x,y:this.y,width:this.width,height:this.height}),this.primaryTagPolygon.attr({points:e.toString()}),t&&(this.primaryTagText.node.innerHTML=null!==this.tags.primary?this.tags.primary.name:"",this.textBox=n.TagsComponent.getCachedBBox(this.primaryTagText));if(this.textBox.width+10<=this.width&&this.textBox.height<=this.height?(this.primaryTagTextBG.attr({height:this.textBox.height+5,width:this.textBox.width+10,x:this.x+1,y:this.y+1}),this.primaryTagText.attr({visibility:"visible",x:this.x+5,y:this.y+this.textBox.height})):(this.primaryTagTextBG.attr({height:Math.min(10,this.height),width:Math.min(10,this.width),x:this.x,y:this.y}),this.primaryTagText.attr({visibility:"hidden",x:this.x+5,y:this.y+this.textBox.height})),this.secondaryTags&&this.secondaryTags.length>0){const t=this.secondaryTags.length;for(let e=0;e<t;e++){const n=this.secondaryTags[e],r=s+(2*e-t+.5)*i;n.attr({x:r,y:o})}}})}initStyleMaps(t){null!==t&&(null!==t.primary?(this.styleMap=[{rule:`.${this.styleId} .primaryTagBoundRectStyle`,style:`fill: ${t.primary.colorShadow};\n                                stroke: ${t.primary.colorAccent};`},{rule:`.regionStyle.selected.${this.styleId} .primaryTagBoundRectStyle`,style:`fill: ${t.primary.colorHighlight}; opacity: 1;`},{rule:`.${this.styleId}:hover .primaryTagBoundRectStyle`,style:`fill: ${t.primary.colorHighlight};`},{rule:`.${this.styleId} .primaryTagPolygonStyle`,style:`fill: ${t.primary.colorShadow};\n                                stroke: ${t.primary.colorPure};`},{rule:`.${this.styleId}:hover .primaryTagPolygonStyle`,style:`fill: ${t.primary.colorHighlight};\n                                stroke: ${t.primary.colorPure};`},{rule:`.regionStyle.${this.styleId} .primaryTagTextBGStyle`,style:`fill:${t.primary.colorAccent};`},{rule:`.regionStyle.selected.${this.styleId} .primaryTagPolygonStyle`,style:`fill: ${t.primary.colorHighlight};\n                                stroke: ${t.primary.colorPure};`},{rule:`.regionStyle.${this.styleId} .anchorStyle`,style:`stroke:${t.primary.colorDark};\n                                fill: ${t.primary.colorPure}`},{rule:`.regionStyle.${this.styleId}:hover .anchorStyle`,style:"stroke:#fff;"},{rule:`.regionStyle.${this.styleId} .anchorStyle.ghost`,style:"fill: var(--default-color-ghost);"}],this.styleLightMap=[{rule:`.${this.styleId} .primaryTagBoundRectStyle`,style:`fill: none;\n                                stroke: ${t.primary.colorAccent};`},{rule:`.${this.styleId} .primaryTagPolygonStyle`,style:`fill: ${t.primary.colorNoColor};\n                                stroke: ${t.primary.colorPure};\n                                stroke-width: 1px;`},{rule:`.regionStyle.${this.styleId}:hover .primaryTagPolygonStyle`,style:`fill: ${t.primary.colorHighlight};\n                                stroke: ${t.primary.colorPure};`},{rule:`.regionStyle.selected.${this.styleId} .primaryTagPolygonStyle`,style:`fill: ${t.primary.colorNoColor};\n                                stroke: ${t.primary.colorPure};`},{rule:`.regionStyle.${this.styleId} .primaryTagTextBGStyle`,style:`fill:${t.primary.colorNoColor};`},{rule:`.regionStyle.${this.styleId} .anchorStyle`,style:`stroke:${t.primary.colorDark};\n                                fill: ${t.primary.colorPure};\n                                stroke-width: 1px;`},{rule:`.regionStyle.${this.styleId}:hover .anchorStyle`,style:"stroke:#fff;"},{rule:`.regionStyle.${this.styleId} .anchorStyle.ghost`,style:"fill: var(--default-color-ghost);"},{rule:`.regionStyle.${this.styleId} .secondaryTagStyle`,style:"opacity:0.25;"}]):(this.styleMap=[],this.styleLightMap=[{rule:`.${this.styleId} .primaryTagPolygonStyle`,style:"fill: var(--default-color-transparent);"},{rule:`.regionStyle.selected.${this.styleId} .primaryTagPolygonStyle`,style:"fill: var(--default-color-transparent);"},{rule:`.${this.styleId} .primaryTagBoundRectStyle`,style:"fill: none;"},{rule:`.${this.styleId} .primaryTagPolylineStyle`,style:"stroke-width: 1px;"},{rule:`.regionStyle.${this.styleId} .anchorStyle`,style:"stroke-width: 1px;"},{rule:`.regionStyle.${this.styleId} .anchorStyle.ghost`,style:"fill: var(--default-color-ghost);"}]),null!==t.secondary&&void 0!==t.secondary&&t.secondary.forEach(t=>{const e={rule:".secondaryTagStyle.secondaryTag-"+t.name,style:`fill: ${t.colorAccent};`};this.styleMap.push(e),this.styleLightMap.push(e)}))}rebuildTagLabels(){for(const t of this.secondaryTags)t.remove();if(this.secondaryTags=[],this.tags&&(void 0!==this.tags.primary&&null!==this.tags.primary&&this.redraw(!0),this.tags.secondary&&this.tags.secondary.length>0)){const t=this.tags.secondary.length;for(let e=0;e<t;e++){const i=this.tags.secondary[e],n=r.DEFAULT_SECONDARY_TAG_SIZE,s=this.x+this.boundRect.width/2+(2*e-t+1)*n-n/2,o=this.y-n-5,a=this.paper.rect(s,o,n,n);window.requestAnimationFrame(()=>{a.addClass("secondaryTagStyle"),a.addClass("secondaryTag-"+i.name)}),this.secondaryTagsNode.add(a),this.secondaryTags.push(a)}}}buildOn(t,e){this.primaryTagNode=t.g(),this.primaryTagBoundRect=t.rect(this.x,this.y,this.boundRect.width,this.boundRect.height),this.primaryTagBoundRect.addClass("primaryTagBoundRectStyle"),this.primaryTagText=t.text(this.x,this.y,""),this.primaryTagText.addClass("primaryTagTextStyle"),this.textBox=n.TagsComponent.getCachedBBox(this.primaryTagText);const i=[];this.regionData.points.forEach(t=>{i.push(t.x,t.y)}),this.primaryTagPolygon=t.polygon(i),this.primaryTagPolygon.addClass("primaryTagPolygonStyle"),this.primaryTagTextBG=t.rect(this.x,this.y,0,0),this.primaryTagTextBG.addClass("primaryTagTextBGStyle"),this.regionData.points.forEach(t=>{i.push(t.x,t.y)}),this.primaryTagNode.add(this.primaryTagBoundRect),this.primaryTagNode.add(this.primaryTagPolygon),this.primaryTagNode.add(this.primaryTagTextBG),this.primaryTagNode.add(this.primaryTagText),this.secondaryTagsNode=t.g(),this.secondaryTagsNode.addClass("secondaryTagsLayer"),this.secondaryTags=[],this.node.add(this.primaryTagNode),this.node.add(this.secondaryTagsNode),this.initStyleMaps(e),this.updateTags(e,this.tagsUpdateOptions)}}e.TagsElement=r,r.DEFAULT_PRIMARY_TAG_RADIUS=3,r.DEFAULT_SECONDARY_TAG_SIZE=6,r.DEFAULT_SECONDARY_TAG_DY=6},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PolylineRegion=void 0;const n=i(2),r=i(7),s=i(55),o=i(56),a=i(57);class h extends r.Region{constructor(t,e=null,i,r,s,o,a){super(t,e,i,Object.assign({},r),s,o,a),null!==e&&(this.paperRects={actual:new n.Rect(e.width-i.width,e.height-i.height),host:e}),this.buildOn(t);const h=this.callbacks.onChange;this.callbacks.onChange=(t,e,...i)=>{this.paperRects.actual.resize(this.paperRects.host.width-e.width,this.paperRects.host.height-e.height),h(this,e,...i)}}updateTags(t,e){super.updateTags(t,e),this.tagsNode.updateTags(t,e),this.node.select("title").node.innerHTML=null!==t?t.toString():""}resize(t,e){this.paperRects.actual.resize(this.paperRects.host.width-t,this.paperRects.host.height-e),super.resize(t,e)}buildOn(t){this.node=t.g(),this.node.addClass("regionStyle"),this.node.addClass(this.styleID),this.dragNode=new o.DragElement(t,this.paperRects.actual,this.regionData,this.callbacks),this.tagsNode=new a.TagsElement(t,this.paperRect,this.regionData,this.tags,this.styleID,this.styleSheet,this.tagsUpdateOptions),this.anchorNode=new s.AnchorsElement(t,this.paperRect,this.regionData,this.callbacks),this.toolTip=Snap.parse(`<title>${null!==this.tags?this.tags.toString():""}</title>`),this.node.append(this.toolTip),this.node.add(this.dragNode.node),this.node.add(this.tagsNode.node),this.node.add(this.anchorNode.node),this.UI.push(this.tagsNode,this.dragNode,this.anchorNode)}}e.PolylineRegion=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AnchorsElement=void 0;const n=i(1),r=i(3),s=i(8);class o extends s.AnchorsComponent{constructor(t,e=null,i,n){super(t,e,i,n),this.deleteOnPointerUp=!1,this.addOnPointerUp=!1,this.anchorsLength=i.points.length}redraw(){if(null!==this.regionData.points&&this.regionData.points.length>0){const t=this.regionData.points;this.anchorsLength!==t.length?(window.requestAnimationFrame(()=>{this.anchors.forEach(t=>{t.remove()}),this.anchors=[],this.buildPointAnchors()}),this.anchorsLength=t.length):this.anchors.length>0&&window.requestAnimationFrame(()=>{this.regionData.points.forEach((t,e)=>{this.anchors[e].attr({cx:t.x,cy:t.y})})});const e=[];this.regionData.points.forEach(t=>{e.push(t.x,t.y)}),this.anchorsPolyline.attr({points:e.toString()})}}buildAnchors(){this.buildPolylineAnchors(),super.buildAnchors()}buildPolylineAnchors(){const t=[];this.regionData.points.forEach(e=>{t.push(e.x,e.y)}),this.anchorsPolyline=this.paper.polyline(t),this.anchorsPolyline.addClass("anchorLineStyle"),this.subscribeLineToEvents(this.anchorsPolyline),this.anchorsNode.add(this.anchorsPolyline)}subscribeLineToEvents(t){this.subscribeToEvents([{base:t.node,event:"pointermove",listener:t=>{if(t.ctrlKey){this.activeAnchorIndex=-1;const e=this.getActiveAnchorPoint(t);this.dragOrigin=e,this.addOnPointerUp=!0,window.requestAnimationFrame(()=>{this.ghostAnchor.attr({cx:e.x,cy:e.y,display:"block"})})}else this.addOnPointerUp=!1},bypass:!1}])}updateRegion(t){const e=this.regionData.copy();this.activeAnchorIndex>=0&&this.activeAnchorIndex<=this.regionData.points.length&&e.setPoint(t,this.activeAnchorIndex-1),this.callbacks.onChange(this,e,r.ChangeEventType.MOVING)}onGhostPointerEnter(t){t.ctrlKey?this.addOnPointerUp&&this.activeAnchorIndex<0?this.ghostAnchor.addClass("add"):this.regionData.points.length>2&&(this.ghostAnchor.addClass("delete"),this.deleteOnPointerUp=!0,this.addOnPointerUp=!1):(this.ghostAnchor.removeClass("delete"),this.ghostAnchor.removeClass("add"),this.deleteOnPointerUp=!1),super.onGhostPointerEnter(t)}onGhostPointerMove(t){if(t.ctrlKey&&0!==this.activeAnchorIndex){const e=this.getActiveAnchorPoint(t);let i=Number.MAX_VALUE,n=-1;this.regionData.points.forEach((t,r)=>{const s=e.squareDistanceToPoint(t);s<i&&(i=s,n=r)});const r=i<o.ANCHOR_POINT_LINE_SWITCH_THRESHOLD;this.addOnPointerUp&&this.activeAnchorIndex<0&&!r?(this.ghostAnchor.addClass("add"),this.activeAnchorIndex=-1):(this.regionData.points.length>2||r)&&(this.ghostAnchor.removeClass("add"),this.ghostAnchor.addClass("delete"),this.activeAnchorIndex=n+1,this.deleteOnPointerUp=!0,this.addOnPointerUp=!1)}else this.ghostAnchor.removeClass("delete"),this.ghostAnchor.removeClass("add"),this.deleteOnPointerUp=!1,this.addOnPointerUp=!1;super.onGhostPointerMove(t)}onGhostPointerUp(t){const e=this.regionData.copy();if(this.deleteOnPointerUp){if(this.activeAnchorIndex>0&&this.activeAnchorIndex<=this.regionData.points.length){const t=e.points;t.splice(this.activeAnchorIndex-1,1),e.setPoints(t)}this.deleteOnPointerUp=!1,this.addOnPointerUp=!1,this.ghostAnchor.removeClass("delete"),this.ghostAnchor.removeClass("add"),this.callbacks.onChange(this,e,r.ChangeEventType.MOVEEND)}else if(this.addOnPointerUp){const i=t.clientX-t.target.closest("svg").getBoundingClientRect().left,s=t.clientY-t.target.closest("svg").getBoundingClientRect().top,o=new n.Point2D(i,s),a=e.points;let h=0,l=Number.MAX_VALUE;for(let t=0;t<a.length-1;t++){const e=this.dragOrigin.squareDistanceToLine(a[t],a[t+1]);e<l&&(h=t,l=e)}a.splice(h+1,0,o),e.setPoints(a),this.deleteOnPointerUp=!1,this.addOnPointerUp=!1,this.ghostAnchor.addClass("delete"),this.callbacks.onChange(this,e,r.ChangeEventType.MOVEEND)}super.onGhostPointerUp(t)}getActiveAnchorPoint(t){if(this.activeAnchorIndex>0)return this.regionData.points[this.activeAnchorIndex-1];if(this.activeAnchorIndex<0){const e=t.clientX-t.target.closest("svg").getBoundingClientRect().left,i=t.clientY-t.target.closest("svg").getBoundingClientRect().top;return new n.Point2D(e,i)}return null}}e.AnchorsElement=o,o.ANCHOR_POINT_LINE_SWITCH_THRESHOLD=5},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DragElement=void 0;const n=i(14);class r extends n.DragComponent{constructor(t,e=null,i,n){super(t,e,i,n),this.dragNode=t.rect(this.x,this.y,this.width,this.height),this.dragNode.addClass("dragRectStyle"),this.node.add(this.dragNode),this.subscribeToDragEvents()}redraw(){window.requestAnimationFrame(()=>{this.dragNode.attr({x:this.x,y:this.y,width:this.width,height:this.height})})}}e.DragElement=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TagsElement=void 0;const n=i(9);class r extends n.TagsComponent{constructor(t,e,i,n,r,s,o){super(t,e,i,n,r,s,o),this.buildOn(t,n)}redraw(){const t=[];this.regionData.points.forEach(e=>{t.push(e.x,e.y)});const e=r.DEFAULT_SECONDARY_TAG_SIZE,i=this.x+this.width/2,n=this.y-e-5;window.requestAnimationFrame(()=>{if(this.primaryTagBoundRect.attr({x:this.x,y:this.y,width:this.width,height:this.height}),this.primaryTagPolyline.attr({points:t.toString()}),this.secondaryTags&&this.secondaryTags.length>0){const t=this.secondaryTags.length;for(let r=0;r<t;r++){const s=this.secondaryTags[r],o=i+(2*r-t+.5)*e;s.attr({x:o,y:n})}}})}initStyleMaps(t){null!==t&&(null!==t.primary?(this.styleMap=[{rule:`.${this.styleId} .primaryTagBoundRectStyle`,style:`fill: ${t.primary.colorShadow};\n                                stroke: ${t.primary.colorAccent};`},{rule:`.regionStyle.selected.${this.styleId} .primaryTagBoundRectStyle`,style:`fill: ${t.primary.colorHighlight};`},{rule:`.${this.styleId}:hover .primaryTagBoundRectStyle`,style:`fill: ${t.primary.colorHighlight};`},{rule:`.${this.styleId} .primaryTagPolylineStyle`,style:`stroke: ${t.primary.colorPure};`},{rule:`.regionStyle.${this.styleId} .anchorStyle`,style:`stroke:${t.primary.colorDark};\n                                fill: ${t.primary.colorPure}`},{rule:`.regionStyle.${this.styleId}:hover .anchorStyle`,style:"stroke:#fff;"},{rule:`.regionStyle.${this.styleId} .anchorStyle.ghost`,style:"fill: var(--default-color-ghost);"}],this.styleLightMap=[{rule:`.${this.styleId} .primaryTagBoundRectStyle`,style:`fill: none;\n                                stroke: ${t.primary.colorAccent};`},{rule:`.${this.styleId} .primaryTagPolylineStyle`,style:`stroke: ${t.primary.colorPure};\n                                stroke-width: 1px;`},{rule:`.regionStyle.${this.styleId} .anchorStyle`,style:`stroke:${t.primary.colorDark};\n                                fill: ${t.primary.colorPure};\n                                stroke-width: 1px;`},{rule:`.regionStyle.${this.styleId}:hover .anchorStyle`,style:"stroke:#fff;"},{rule:`.regionStyle.${this.styleId} .anchorStyle.ghost`,style:"fill: var(--default-color-ghost);\n                                stroke-width: 0px;"},{rule:`.regionStyle.${this.styleId} .secondaryTagStyle`,style:"opacity:0.25;"}]):(this.styleMap=[],this.styleLightMap=[{rule:`.${this.styleId} .primaryTagBoundRectStyle`,style:"fill: none;\n                                stroke: var(--default-color-accent);"},{rule:`.${this.styleId} .primaryTagBoundRectStyle`,style:"fill: none;"},{rule:`.${this.styleId} .primaryTagPolylineStyle`,style:"stroke-width: 1px;"},{rule:`.regionStyle.${this.styleId} .anchorStyle`,style:"stroke-width: 1px;"},{rule:`.regionStyle.${this.styleId} .anchorStyle.ghost`,style:"fill: var(--default-color-ghost);"}]),null!==t.secondary&&void 0!==t.secondary&&t.secondary.forEach(t=>{const e={rule:".secondaryTagStyle.secondaryTag-"+t.name,style:`fill: ${t.colorAccent};`};this.styleMap.push(e),this.styleLightMap.push(e)}))}rebuildTagLabels(){for(const t of this.secondaryTags)t.remove();if(this.secondaryTags=[],this.tags&&(void 0!==this.tags.primary&&this.tags.primary,this.tags.secondary&&this.tags.secondary.length>0)){const t=this.tags.secondary.length;for(let e=0;e<t;e++){const i=this.tags.secondary[e],n=r.DEFAULT_SECONDARY_TAG_SIZE,s=this.x+this.boundRect.width/2+(2*e-t+1)*n-n/2,o=this.y-n-5,a=this.paper.rect(s,o,n,n);window.requestAnimationFrame(()=>{a.addClass("secondaryTagStyle"),a.addClass("secondaryTag-"+i.name)}),this.secondaryTagsNode.add(a),this.secondaryTags.push(a)}}}buildOn(t,e){this.primaryTagNode=t.g(),this.primaryTagBoundRect=t.rect(this.x,this.y,this.boundRect.width,this.boundRect.height),this.primaryTagBoundRect.addClass("primaryTagBoundRectStyle");const i=[];this.regionData.points.forEach(t=>{i.push(t.x,t.y)}),this.primaryTagPolyline=t.polyline(i),this.primaryTagPolyline.addClass("primaryTagPolylineStyle"),this.regionData.points.forEach(t=>{i.push(t.x,t.y)}),this.primaryTagNode.add(this.primaryTagBoundRect),this.primaryTagNode.add(this.primaryTagPolyline),this.secondaryTagsNode=t.g(),this.secondaryTagsNode.addClass("secondaryTagsLayer"),this.secondaryTags=[],this.node.add(this.primaryTagNode),this.node.add(this.secondaryTagsNode),this.initStyleMaps(e),this.updateTags(e,this.tagsUpdateOptions)}}e.TagsElement=r,r.DEFAULT_PRIMARY_TAG_RADIUS=3,r.DEFAULT_SECONDARY_TAG_SIZE=6,r.DEFAULT_SECONDARY_TAG_DY=6},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AnchorsElement=void 0;const n=i(1),r=i(3),s=i(8);class o extends s.AnchorsComponent{constructor(t,e=null,i,n){super(t,e,i,n)}redraw(){super.redraw();const[t,e,i,n]=[this.regionData.x,this.regionData.y,this.regionData.width,this.regionData.height],[r,s,o,a]=this.anchorBones;window.requestAnimationFrame(()=>{r.attr({x:t,y:e-this.boneThickness/2,width:i,height:this.boneThickness}),s.attr({x:t+i-this.boneThickness/2,y:e,width:this.boneThickness,height:n}),o.attr({x:t,y:e+n-this.boneThickness/2,width:i,height:this.boneThickness}),a.attr({x:t-this.boneThickness/2,y:e,width:this.boneThickness,height:n})})}buildAnchors(){this.buildBoneAnchors(),super.buildAnchors()}buildPointAnchors(){this.anchorPointStyles=["TL","TR","BR","BL"],this.regionData.points.forEach((t,e)=>{const i=this.createAnchor(this.paper,t.x,t.y,this.anchorPointStyles[e]);this.anchors.push(i),this.anchorsNode.add(i),this.subscribeAnchorToEvents(i,e+1)})}buildBoneAnchors(){this.anchorBoneStyles=["T","R","B","L"],this.anchorBones=[],this.boneThickness=s.AnchorsComponent.DEFAULT_GHOST_ANCHOR_RADIUS;const[t,e,i,n]=[this.regionData.x,this.regionData.y,this.regionData.width,this.regionData.height],r=[this.createAnchorBone(this.paper,t,e,i,0,"T",this.boneThickness),this.createAnchorBone(this.paper,t+i,e,0,n,"R",this.boneThickness),this.createAnchorBone(this.paper,t,e+n,i,0,"B",this.boneThickness),this.createAnchorBone(this.paper,t,e,0,n,"L",this.boneThickness)];this.anchorBones.push(...r),r.forEach((t,e)=>{this.anchorsNode.add(t),this.subscribeAnchorBoneToEvents(t,-(e+1))})}createAnchorBone(t,e,i,n,r,o,a=s.AnchorsComponent.DEFAULT_GHOST_ANCHOR_RADIUS){let h;if(0===n)h=t.rect(e-a/2,i,a,r);else{if(0!==r)throw Error("Rect bones that are neither vertical or horizontal are not supported.");h=t.rect(e,i-a/2,n,a)}return h.addClass("anchorBoneStyle"),void 0!==o&&""!==o&&h.addClass(o),h}updateRegion(t){let e,i,s=t.x,o=t.y,a=!1,h=!1,l=this.getActiveAnchor();switch(l){case"TL":e=this.x+this.width,i=this.y+this.height,a=e<s,h=i<o;break;case"TR":e=this.x,i=this.y+this.height,a=s<e,h=i<o;break;case"BL":i=this.y,e=this.x+this.width,a=e<s,h=o<i;break;case"BR":e=this.x,i=this.y,a=s<e,h=o<i;break;case"T":s=this.x,e=this.x+this.width,i=this.y+this.height,h=o>i;break;case"R":e=this.x,o=this.y,i=this.y+this.height,a=e>s;break;case"B":s=this.x,e=this.x+this.width,i=this.y,h=o<i;break;case"L":e=this.x+this.width,o=this.y,i=this.y+this.height,a=s>e}let c="";""!==l&&2===l.length&&(c+="T"===l[0]?h?"B":"T":h?"T":"B",c+="L"===l[1]?a?"R":"L":a?"L":"R"),""!==l&&1===l.length&&(c=a?"R"===l?"L":"R":h?"T"===l?"B":"T":l),l!==c&&(this.ghostAnchor.removeClass(l),2===c.length?this.activeAnchorIndex=this.anchorPointStyles.indexOf(c)+1:this.activeAnchorIndex=-(this.anchorBoneStyles.indexOf(c)+1),l=c,this.ghostAnchor.addClass(c));const d=new n.Point2D(Math.min(s,e),Math.min(o,i)).boundToRect(this.paperRect),g=new n.Point2D(Math.max(s,e),Math.max(o,i)).boundToRect(this.paperRect),u=this.regionData.copy();u.setPoints([d,new n.Point2D(g.x,d.y),g,new n.Point2D(d.x,g.y)]),this.callbacks.onChange(this,u,r.ChangeEventType.MOVING)}onGhostPointerEnter(t){this.ghostAnchor.addClass(this.getActiveAnchor()),super.onGhostPointerEnter(t)}onGhostPointerLeave(t){this.ghostAnchor.removeClass(this.getActiveAnchor()),super.onGhostPointerLeave(t)}subscribeAnchorBoneToEvents(t,e){this.subscribeToEvents([{event:"pointerenter",base:t.node,listener:t=>{if(!this.isFrozen){this.activeAnchorIndex=e;const i=this.getActiveAnchorPoint(t);window.requestAnimationFrame(()=>{this.ghostAnchor.attr({cx:i.x,cy:i.y,display:"block"})})}},bypass:!1}])}getActiveAnchorPoint(t){if(this.activeAnchorIndex>0)return this.regionData.points[this.activeAnchorIndex-1];if(this.activeAnchorIndex<0){if(void 0!==t){const e=t.clientX-t.target.closest("svg").getBoundingClientRect().left,i=t.clientY-t.target.closest("svg").getBoundingClientRect().top;return new n.Point2D(e,i)}{const t=this.anchorBones[-this.activeAnchorIndex-1].getBBox();return new n.Point2D(t.cx,t.cy)}}return null}getActiveAnchor(){return this.activeAnchorIndex>0?this.anchorPointStyles[this.activeAnchorIndex-1]:this.activeAnchorIndex<0?this.anchorBoneStyles[-this.activeAnchorIndex-1]:""}}e.AnchorsElement=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DragElement=void 0;const n=i(14);class r extends n.DragComponent{constructor(t,e=null,i,n){super(t,e,i,n),this.dragNode=t.rect(this.x,this.y,this.boundRect.width,this.boundRect.height),this.dragNode.addClass("dragRectStyle"),this.node.add(this.dragNode),this.subscribeToDragEvents()}redraw(){window.requestAnimationFrame(()=>{this.dragNode.attr({height:this.height,width:this.width,x:this.x,y:this.y})})}}e.DragElement=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TagsElement=void 0;const n=i(9);class r extends n.TagsComponent{constructor(t,e,i,n,r,s,o){super(t,e,i,n,r,s,o),this.buildOn(t,n)}redraw(t=!1){this.tags?window.requestAnimationFrame(()=>{if(void 0!==this.tags.primary&&null!==this.tags.primary){this.primaryTagRect.attr({height:this.height,width:this.width,x:this.x,y:this.y}),t&&(this.primaryTagText.node.innerHTML=null!==this.tags.primary?this.tags.primary.name:"",this.textBox=n.TagsComponent.getCachedBBox(this.primaryTagText));this.textBox.width+10<=this.width&&this.textBox.height<=this.height?(this.primaryTagTextBG.attr({height:this.textBox.height+5,width:this.textBox.width+10,x:this.x+1,y:this.y+1}),this.primaryTagText.attr({visibility:"visible",x:this.x+5,y:this.y+this.textBox.height})):(this.primaryTagTextBG.attr({height:Math.min(10,this.height),width:Math.min(10,this.width),x:this.x,y:this.y}),this.primaryTagText.attr({visibility:"hidden",x:this.x+5,y:this.y+this.textBox.height}))}else this.primaryTagRect.attr({height:this.height,width:this.width,x:this.x,y:this.y}),this.primaryTagTextBG.attr({height:0,width:0}),this.primaryTagText.attr({visibility:"hidden",x:this.x+5,y:this.y+this.textBox.height});if(t&&(this.secondaryTags.forEach(t=>{t.remove()}),this.secondaryTags=[]),this.tags.secondary&&this.tags.secondary.length>0){const e=6,i=this.x+.5*this.boundRect.width,n=this.y-e-5,r=this.tags.secondary.length;for(let s=0;s<r;s++){const o=this.tags.secondary[s],a=i+(2*s-r+1)*e-e/2;if(t){const t=this.paper.rect(a,n,e,e);t.addClass("secondaryTagStyle"),t.addClass("secondaryTag-"+o.name),this.secondaryTagsNode.add(t),this.secondaryTags.push(t)}else{this.secondaryTags[s].attr({x:a,y:n})}}}}):window.requestAnimationFrame(()=>{this.primaryTagRect.attr({height:this.height,width:this.width,x:this.x,y:this.y}),this.primaryTagText.node.innerHTML="",this.primaryTagTextBG.attr({height:0,width:0}),this.secondaryTags.forEach(t=>{t.remove()}),this.secondaryTags=[]})}initStyleMaps(t){null!==t&&(null!==t.primary?(this.styleMap=[{rule:`.${this.styleId} .primaryTagRectStyle`,style:`fill: ${t.primary.colorShadow};\n                                stroke:${t.primary.colorAccent};`},{rule:`.regionStyle.${this.styleId}:hover  .primaryTagRectStyle`,style:`fill: ${t.primary.colorHighlight};\n                                stroke: #fff;`},{rule:`.regionStyle.selected.${this.styleId} .primaryTagRectStyle`,style:`fill: ${t.primary.colorHighlight};\n                                stroke:${t.primary.colorAccent};`},{rule:`.regionStyle.${this.styleId} .primaryTagTextBGStyle`,style:`fill:${t.primary.colorAccent};`},{rule:`.regionStyle.${this.styleId} .anchorStyle`,style:`stroke:${t.primary.colorDark};\n                                fill: ${t.primary.colorPure}`},{rule:`.regionStyle.${this.styleId}:hover .anchorStyle`,style:"stroke:#fff;"},{rule:`.regionStyle.${this.styleId} .anchorStyle.ghost`,style:"fill: var(--default-color-ghost);"}],this.styleLightMap=[{rule:`.${this.styleId} .primaryTagRectStyle`,style:`fill: ${t.primary.colorNoColor};\n                                stroke:${t.primary.colorAccent};\n                                stroke-width: 1px;`},{rule:`.regionStyle.${this.styleId}:hover  .primaryTagRectStyle`,style:`fill: ${t.primary.colorHighlight};\n                                stroke: #fff;`},{rule:`.regionStyle.selected.${this.styleId} .primaryTagRectStyle`,style:`fill: ${t.primary.colorNoColor};\n                                stroke:${t.primary.colorAccent};`},{rule:`.regionStyle.${this.styleId} .primaryTagTextBGStyle`,style:`fill:${t.primary.colorNoColor};`},{rule:`.regionStyle.${this.styleId} .primaryTagTextStyle`,style:`fill:${t.primary.colorAccent};`},{rule:`.regionStyle.${this.styleId} .secondaryTagStyle`,style:"opacity:0.25;"},{rule:`.regionStyle.${this.styleId} .anchorStyle`,style:`stroke:${t.primary.colorDark};\n                                fill: ${t.primary.colorPure};\n                                stroke-width: 1px;`},{rule:`.regionStyle.${this.styleId}:hover .anchorStyle`,style:"stroke:#fff;"},{rule:`.regionStyle.${this.styleId} .anchorStyle.ghost`,style:"fill: var(--default-color-ghost);"}]):(this.styleMap=[],this.styleLightMap=[{rule:`.${this.styleId} .primaryTagRectStyle`,style:"fill: var(--default-color-transparent);\n                                stroke: var(--default-color-pure);\n                                stroke-width: 1px;"},{rule:`.regionStyle.selected.${this.styleId} .primaryTagRectStyle`,style:"fill: var(--default-color-transparent);\n                                stroke: var(--default-color-pure);"},{rule:`.regionStyle.${this.styleId} .anchorStyle`,style:"stroke-width: 1px;"},{rule:`.regionStyle.${this.styleId} .anchorStyle.ghost`,style:"fill: var(--default-color-ghost);"}]),null!==t.secondary&&void 0!==t.secondary&&t.secondary.forEach(t=>{const e={rule:".secondaryTagStyle.secondaryTag-"+t.name,style:`fill: ${t.colorAccent};`};this.styleMap.push(e),this.styleLightMap.push(e)}))}rebuildTagLabels(){this.redraw(!0)}buildOn(t,e){this.primaryTagNode=t.g(),this.primaryTagRect=t.rect(this.x,this.y,this.boundRect.width,this.boundRect.height),this.primaryTagRect.addClass("primaryTagRectStyle"),this.primaryTagText=t.text(this.x,this.y,""),this.primaryTagText.addClass("primaryTagTextStyle"),this.textBox=n.TagsComponent.getCachedBBox(this.primaryTagText),this.primaryTagTextBG=t.rect(this.x,this.y,0,0),this.primaryTagTextBG.addClass("primaryTagTextBGStyle"),this.primaryTagNode.add(this.primaryTagRect),this.primaryTagNode.add(this.primaryTagTextBG),this.primaryTagNode.add(this.primaryTagText),this.secondaryTagsNode=t.g(),this.secondaryTagsNode.addClass("secondaryTagsLayer"),this.secondaryTags=[],this.node.add(this.primaryTagNode),this.node.add(this.secondaryTagsNode),this.initStyleMaps(e),this.updateTags(e,this.tagsUpdateOptions)}}e.TagsElement=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MenuElement=void 0;const n=i(5);class r extends n.RegionComponent{constructor(t,e=null,i,n){super(t,e,i,n),this.menuItemSize=20,this.mw=this.menuItemSize+10,this.mh=this.menuItemSize+10,this.dh=20,this.dw=5,this.buildUI()}addAction(t,e,i){const n=this.menuGroup.g(),s=this.menuGroup.rect(5,5,this.menuItemSize,this.menuItemSize,5,5);s.addClass("menuItemBack");const o=this.menuGroup.path(r.PathCollection.delete.path);o.transform("scale(0.2) translate(26 26)"),o.addClass("menuIcon"),o.addClass("menuIcon-"+e);const a=this.menuGroup.rect(5,5,this.menuItemSize,this.menuItemSize,5,5);a.addClass("menuItem"),n.add(s),n.add(o),n.add(a),n.click(e=>{i(this.region,t)}),this.menuItemsGroup.add(n),this.menuItems.push(n)}attachTo(t){this.region=t,t&&(this.regionData.initFrom(t.regionData),this.rearrangeMenuPosition(),window.requestAnimationFrame(()=>{this.menuGroup.attr({x:this.mx,y:this.my})}))}move(t,e){super.move(t,e),this.rearrangeMenuPosition(),window.requestAnimationFrame(()=>{this.menuGroup.attr({x:this.mx,y:this.my})})}resize(t,e){super.resize(t,e),this.rearrangeMenuPosition(),window.requestAnimationFrame(()=>{this.menuGroup.attr({x:this.mx,y:this.my})})}redraw(){}hide(){window.requestAnimationFrame(()=>{this.menuGroup.attr({visibility:"hidden"})})}show(){window.requestAnimationFrame(()=>{this.menuGroup.attr({visibility:"visible"})})}showOnRegion(t){this.attachTo(t),this.show()}buildUI(){const t=this.paper.svg(this.mx,this.my,this.mw,this.mh,this.mx,this.my,this.mw,this.mh);this.menuGroup=Snap(t).paper,this.menuGroup.addClass("menuLayer"),this.rearrangeMenuPosition(),this.menuRect=this.menuGroup.rect(0,0,this.mw,this.mh,5,5),this.menuRect.addClass("menuRectStyle"),this.menuItemsGroup=this.menuGroup.g(),this.menuItemsGroup.addClass("menuItems"),this.menuItems=new Array,this.menuGroup.add(this.menuRect),this.menuGroup.add(this.menuItemsGroup),this.menuGroup.mouseover(t=>{this.callbacks.onManipulationBegin()}),this.menuGroup.mouseout(t=>{this.callbacks.onManipulationEnd()})}rearrangeMenuPosition(){this.y+this.mh+this.dw>this.paperRect.height?this.my=this.paperRect.height-this.mh-this.dw:this.my=this.y+this.dw,this.x+this.boundRect.width+this.mw+2*this.dw<this.paperRect.width?this.mx=this.x+this.boundRect.width+this.dw:this.x-this.mw-2*this.dw>0?this.mx=this.x-this.mw-this.dw:this.mx=this.x+this.boundRect.width-this.mw-this.dw}}e.MenuElement=r,r.PathCollection={delete:{iconSize:96,path:"M 83.4 21.1 L 74.9 12.6 L 48 39.5 L 21.1 12.6 L 12.6 21.1 L 39.5 48 L 12.6 74.9 L 21.1 83.4 L 48 56.5 L 74.9 83.4 L 83.4 74.9 L 56.5 48 Z"}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MaskSelector=void 0;e.MaskSelector=class{constructor(t){this.maskSelectorCallbacks=t}enableMode(t){this.maskSelectorCallbacks.onMaskSelection(!0,t),this.enabled=!0}disable(){this.maskSelectorCallbacks.onMaskSelection(!1),this.enabled=!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PointSelector=void 0;const n=i(1),r=i(4),s=i(15),o=i(10);class a extends o.Selector{constructor(t,e,i,n){super(t,e,i,n),this.buildUIElements(),this.hide()}reset(){this.buildUIElements()}resize(t,e){super.resize(t,e),this.crossA.resize(t,e)}hide(){super.hide(),this.hideAll([this.crossA,this.point])}show(){super.show(),this.showAll([this.crossA,this.point])}buildUIElements(){this.node=this.paper.g(),this.node.addClass("pointSelector"),this.crossA=new s.CrossElement(this.paper,this.boundRect),this.point=this.paper.circle(0,0,a.DEFAULT_POINT_RADIUS),this.point.addClass("pointStyle"),this.node.add(this.crossA.node),this.node.add(this.point);const t=[{event:"pointerenter",base:this.parentNode,listener:()=>this.show(),bypass:!1},{event:"pointerleave",base:this.parentNode,listener:()=>this.hide(),bypass:!1},{event:"pointerdown",base:this.parentNode,listener:t=>{this.show(),this.movePoint(this.point,this.crossA),"function"==typeof this.callbacks.onSelectionBegin&&this.callbacks.onSelectionBegin()},bypass:!1},{event:"pointerup",base:this.parentNode,listener:t=>{"function"==typeof this.callbacks.onSelectionEnd&&this.callbacks.onSelectionEnd(r.RegionData.BuildPointRegionData(this.crossA.x,this.crossA.y))},bypass:!1},{event:"pointermove",base:this.parentNode,listener:t=>{const e=this.parentNode.getClientRects(),i=new n.Point2D(t.clientX-e[0].left,t.clientY-e[0].top);this.moveCross(this.crossA,i),this.movePoint(this.point,this.crossA),t.preventDefault()},bypass:!1}];this.subscribeToEvents(t)}}e.PointSelector=a,a.DEFAULT_POINT_RADIUS=6},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PolygonSelector=void 0;const n=i(12),r=i(1),s=i(4),o=i(15),a=i(10);class h extends a.Selector{constructor(t,e,i,n){super(t,e,i,n),this.isCapturing=!1,this.redoQueue=[],this.buildUIElements(),this.reset(),this.hide()}resize(t,e,i,n){const[s,o]=[t/i,e/n];super.resize(t,e),this.crossA.resize(t,e),void 0===i&&void 0===n||(null!=this.lastPoint&&(this.lastPoint.x=Math.round(this.lastPoint.x*s),this.lastPoint.y=Math.round(this.lastPoint.y*o)),this.points=this.points.map(t=>new r.Point2D(Math.round(t.x*s),Math.round(t.y*o))),this.redrawPoints())}hide(){super.hide(),this.hideAll([this.crossA,this.nextPoint,this.nextSegment,this.polygon,this.pointsGroup])}show(){super.show(),this.showAll([this.crossA,this.nextPoint,this.nextSegment,this.polygon,this.pointsGroup])}undo(){if(this.canUndo()){const t=this.points.pop();this.pointsGroup.children().pop().remove(),this.lastPoint=this.points[this.points.length-1],this.redoQueue.push(t),this.redrawPoints()}}redo(){if(this.canRedo()){const t=this.redoQueue.pop();this.addPoint(t.x,t.y)}}canRedo(){return this.redoQueue.length>0}canUndo(){return this.points.length>1}disable(){super.disable(),this.reset()}reset(){this.points=new Array,this.lastPoint=null;let t=this.pointsGroup.children();for(;t.length>0;)t[0].remove(),t=this.pointsGroup.children();this.polygon.attr({points:""}),this.isCapturing&&(this.isCapturing=!1)}buildUIElements(){this.node=this.paper.g(),this.node.addClass("polygonSelector"),this.crossA=new o.CrossElement(this.paper,this.boundRect),this.nextPoint=this.paper.circle(0,0,h.DEFAULT_SELECTOR_RADIUS),this.nextPoint.addClass("nextPointStyle"),this.nextSegment=this.paper.g(),this.nextL1=this.paper.line(0,0,0,0),this.nextLN=this.paper.line(0,0,0,0),this.nextL1.addClass("nextSegmentStyle"),this.nextLN.addClass("nextSegmentStyle"),this.nextSegment.add(this.nextL1),this.nextSegment.add(this.nextLN),this.pointsGroup=this.paper.g(),this.pointsGroup.addClass("polygonGroupStyle"),this.polygon=this.paper.polygon([]),this.polygon.addClass("polygonStyle"),this.node.add(this.polygon),this.node.add(this.pointsGroup),this.node.add(this.crossA.node),this.node.add(this.nextSegment),this.node.add(this.nextPoint);const t=[{event:"pointerenter",base:this.parentNode,listener:()=>this.show(),bypass:!1},{event:"pointerleave",base:this.parentNode,listener:t=>{if(this.isCapturing){const e=this.parentNode.getClientRects(),i=new r.Point2D(t.clientX-e[0].left,t.clientY-e[0].top);this.moveCross(this.crossA,i),this.movePoint(this.nextPoint,i)}else this.hide()},bypass:!1},{event:"pointerdown",base:this.parentNode,listener:t=>{this.isCapturing||(this.isCapturing=!0,"function"==typeof this.callbacks.onSelectionBegin&&this.callbacks.onSelectionBegin())},bypass:!1},{event:"click",base:this.parentNode,listener:t=>{t.detail<=1&&this.isCapturing&&(window.requestAnimationFrame(()=>{const t=new r.Point2D(this.crossA.x,this.crossA.y);this.addPoint(t.x,t.y),this.lastPoint=t,this.redoQueue=[]}),"function"==typeof this.callbacks.onNextSelectionPoint&&this.callbacks.onNextSelectionPoint(new r.Point2D(this.crossA.x,this.crossA.y)))},bypass:!1},{event:"pointermove",base:this.parentNode,listener:t=>{window.requestAnimationFrame(()=>{const e=this.parentNode.getClientRects(),i=new r.Point2D(t.clientX-e[0].left,t.clientY-e[0].top);this.moveCross(this.crossA,i),this.movePoint(this.nextPoint,i),null!=this.lastPoint?(this.moveLine(this.nextLN,this.lastPoint,i),this.moveLine(this.nextL1,this.points[0],i)):(this.moveLine(this.nextLN,i,i),this.moveLine(this.nextL1,i,i))}),t.preventDefault()},bypass:!1},{event:"dblclick",base:this.parentNode,listener:()=>this.submitPolygon(),bypass:!1},{event:"keyup",base:window,listener:t=>{"Escape"===t.code&&this.submitPolygon()},bypass:!0}];this.subscribeToEvents(t)}addPoint(t,e){this.points.push(new r.Point2D(t,e));const i=this.paper.circle(t,e,h.DEFAULT_POINT_RADIUS);i.addClass("polygonPointStyle"),this.pointsGroup.add(i),this.redrawPoints()}redrawPoints(){this.polygon.attr({points:this.points.map(t=>`${t.x},${t.y}`).join(",")}),this.pointsGroup.children().forEach((t,e)=>{this.points[e]&&t.attr({cx:this.points[e].x,cy:this.points[e].y})})}submitPolygon(){if("function"==typeof this.callbacks.onSelectionEnd){const t=this.polygon.getBBox(),e=n.ConfigurationManager.isPathRegionEnabled?s.RegionDataType.Path:s.RegionDataType.Polygon;this.callbacks.onSelectionEnd(new s.RegionData(t.x,t.y,t.width,t.height,this.points.map(t=>t.copy()),e))}this.reset()}}e.PolygonSelector=h,h.DEFAULT_POINT_RADIUS=3,h.DEFAULT_SELECTOR_RADIUS=6},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PolylineSelector=void 0;const n=i(1),r=i(4),s=i(15),o=i(10);class a extends o.Selector{constructor(t,e,i,n){super(t,e,i,n),this.isCapturing=!1,this.buildUIElements(),this.reset(),this.hide()}resize(t,e){super.resize(t,e),this.crossA.resize(t,e)}hide(){super.hide(),this.crossA.hide(),this.nextPoint.node.setAttribute("visibility","hidden"),this.nextSegment.node.setAttribute("visibility","hidden"),this.polyline.node.setAttribute("visibility","hidden"),this.pointsGroup.node.setAttribute("visibility","hidden")}show(){super.show(),this.crossA.show(),this.nextPoint.node.setAttribute("visibility","visible"),this.nextSegment.node.setAttribute("visibility","visible"),this.polyline.node.setAttribute("visibility","visible"),this.pointsGroup.node.setAttribute("visibility","visible")}disable(){this.reset(),super.disable()}reset(){this.points=new Array,this.lastPoint=null;let t=this.pointsGroup.children();for(;t.length>0;)t[0].remove(),t=this.pointsGroup.children();this.polyline.attr({points:""}),this.isCapturing&&(this.isCapturing=!1)}buildUIElements(){this.node=this.paper.g(),this.node.addClass("polylineSelector"),this.crossA=new s.CrossElement(this.paper,this.boundRect),this.nextPoint=this.paper.circle(0,0,a.DEFAULT_SELECTOR_RADIUS),this.nextPoint.addClass("nextPointStyle"),this.nextSegment=this.paper.line(0,0,0,0),this.nextSegment.addClass("nextSegmentStyle"),this.pointsGroup=this.paper.g(),this.pointsGroup.addClass("polylineGroupStyle"),this.polyline=this.paper.polyline([]),this.polyline.addClass("polylineStyle"),this.node.add(this.polyline),this.node.add(this.pointsGroup),this.node.add(this.crossA.node),this.node.add(this.nextSegment),this.node.add(this.nextPoint);const t=[{event:"pointerenter",listener:this.onPointerEnter,base:this.parentNode,bypass:!1},{event:"pointerleave",listener:this.onPointerLeave,base:this.parentNode,bypass:!1},{event:"pointerdown",listener:this.onPointerDown,base:this.parentNode,bypass:!1},{event:"click",listener:this.onClick,base:this.parentNode,bypass:!1},{event:"pointermove",listener:this.onPointerMove,base:this.parentNode,bypass:!1},{event:"dblclick",listener:this.onDoubleClick,base:this.parentNode,bypass:!1},{event:"keyup",listener:this.onKeyUp,base:window,bypass:!0}];this.subscribeToEvents(t)}addPoint(t,e){this.points.push(new n.Point2D(t,e));const i=this.paper.circle(t,e,a.DEFAULT_POINT_RADIUS);i.addClass("polylinePointStyle"),this.pointsGroup.add(i);let r="";this.points.forEach(t=>{r+=`${t.x},${t.y},`}),this.polyline.attr({points:r.substr(0,r.length-1)})}onPointerEnter(t){window.requestAnimationFrame(()=>{this.show()})}onPointerLeave(t){if(this.isCapturing){const e=this.parentNode.getClientRects(),i=new n.Point2D(t.clientX-e[0].left,t.clientY-e[0].top);this.moveCross(this.crossA,i),this.movePoint(this.nextPoint,i)}else window.requestAnimationFrame(()=>{this.hide()})}onPointerDown(t){this.isCapturing||(this.isCapturing=!0,"function"==typeof this.callbacks.onSelectionBegin&&this.callbacks.onSelectionBegin())}onClick(t){t.detail<=1&&window.requestAnimationFrame(()=>{const t=new n.Point2D(this.crossA.x,this.crossA.y);this.addPoint(t.x,t.y),this.lastPoint=t})}onPointerMove(t){window.requestAnimationFrame(()=>{const e=this.parentNode.getClientRects(),i=new n.Point2D(t.clientX-e[0].left,t.clientY-e[0].top);this.show(),this.moveCross(this.crossA,i),this.movePoint(this.nextPoint,i),null!=this.lastPoint?this.moveLine(this.nextSegment,this.lastPoint,i):this.moveLine(this.nextSegment,i,i)}),t.preventDefault()}onDoubleClick(t){this.submitPolyline()}submitPolyline(){if("function"==typeof this.callbacks.onSelectionEnd){if(this.getPolylinePoints().length<=0)return;const t=this.polyline.getBBox();this.callbacks.onSelectionEnd(new r.RegionData(t.x,t.y,t.width,t.height,this.getPolylinePoints(),r.RegionDataType.Polyline))}this.reset()}getPolylinePoints(t=!0,e=5){const i=this.points.map(t=>t.copy());if(i.length>=3&&t){const t=i[0],n=i[i.length-1];(t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y)<=e*e&&(i[i.length-1]=t.copy())}return i}onKeyUp(t){"Escape"===t.code&&this.submitPolyline()}}e.PolylineSelector=a,a.DEFAULT_POINT_RADIUS=3,a.DEFAULT_SELECTOR_RADIUS=6},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RectCopySelector=void 0;const n=i(1),r=i(2),s=i(4),o=i(32),a=i(33),h=i(10);class l extends h.Selector{constructor(t,e,i,n,r){super(t,e,i,r),this.usingKeyboardCursor=!1,this.copyRect=n,this.buildUIElements(),this.hide()}setTemplate(t){this.copyRect=new r.Rect(t.width,t.height),this.copyRectEl.resize(t.width,t.height),this.moveCopyRect(this.copyRectEl,this.crossA)}resize(t,e){super.resize(t,e),this.crossA.resize(t,e)}reset(){this.buildUIElements()}hide(){super.hide(),this.hideAll([this.crossA,this.copyRectEl])}show(){super.show(),this.showAll([this.crossA,this.copyRectEl])}getUsingKeyboardCursor(){return this.usingKeyboardCursor}activateKeyboardCursor(){this.usingKeyboardCursor=!0}deactivateKeyboardCursor(){this.usingKeyboardCursor=!1}buildUIElements(){this.node=this.paper.g(),this.node.addClass("rectCopySelector"),this.crossA=new o.AlternatingCrossElement(this.paper,this.boundRect),this.copyRectEl=new a.RectElement(this.paper,this.boundRect,this.copyRect),this.copyRectEl.node.addClass("copyRectStyle"),this.node.add(this.crossA.node),this.node.add(this.copyRectEl.node);const t=[{event:"pointerenter",listener:this.onPointerEnter,base:this.parentNode,bypass:!1},{event:"pointerleave",listener:this.onPointerLeave,base:this.parentNode,bypass:!1},{event:"pointerdown",listener:this.onPointerDown,base:this.parentNode,bypass:!1},{event:"pointerup",listener:this.onPointerUp,base:this.parentNode,bypass:!1},{event:"pointermove",listener:this.onPointerMove,base:this.parentNode,bypass:!1},{event:"wheel",listener:this.onWheel,base:this.parentNode,bypass:!1},{event:"keydown",listener:this.onKeyDown,base:window,bypass:!1}];this.subscribeToEvents(t)}moveCopyRect(t,e){const i=e.x-t.rect.width/2,r=e.y-t.rect.height/2;t.move(new n.Point2D(i,r))}onPointerEnter(t){window.requestAnimationFrame(()=>{this.crossA.show(),this.copyRectEl.show()})}onPointerLeave(t){window.requestAnimationFrame(()=>{this.hide()})}onPointerDown(t){window.requestAnimationFrame(()=>{this.deactivateKeyboardCursor(),this.show(),this.moveCopyRect(this.copyRectEl,this.crossA),"function"==typeof this.callbacks.onSelectionBegin&&this.callbacks.onSelectionBegin()})}onPointerUp(t){window.requestAnimationFrame(()=>{this.createCopyRectBoundingBox()})}onPointerMove(t){window.requestAnimationFrame(()=>{var e,i;this.deactivateKeyboardCursor();const r=this.parentNode.getClientRects(),s=new n.Point2D(t.clientX-(null===(e=r[0])||void 0===e?void 0:e.left),t.clientY-(null===(i=r[0])||void 0===i?void 0:i.top));this.moveCross(this.crossA,s),this.moveCopyRect(this.copyRectEl,this.crossA)}),t.preventDefault()}onWheel(t){let e=this.copyRect.width,i=this.copyRect.height;const n=i/e;t.shiftKey?t.deltaY>0?(e*=1.1,i*=1.1):(e/=1.1,i/=1.1):t.deltaY>0?(e+=1,i+=n):(e-=1,i-=n),e<1&&(e=1,i=n),i<1&&(i=1,e=1/n),window.requestAnimationFrame(()=>{this.copyRect.resize(e,i),this.copyRectEl.resize(e,i),this.moveCopyRect(this.copyRectEl,this.crossA)})}onKeyDown(t){"k"!==t.key&&"K"!==t.key.toLocaleUpperCase()||(this.usingKeyboardCursor?this.createCopyRectBoundingBox():this.activateKeyboardCursor()),!t.ctrlKey&&t.shiftKey&&this.isKeyboardControlKey(t.key)&&this.usingKeyboardCursor&&(t.preventDefault(),this.moveKeyboardCursor(t.key))}isKeyboardControlKey(t){return"ArrowUp"===t||"ArrowDown"===t||"ArrowLeft"===t||"ArrowRight"===t}moveKeyboardCursor(t){const e={x:this.crossA.x,y:this.crossA.y};switch(t){case"ArrowUp":e.y-=20;break;case"ArrowDown":e.y+=20;break;case"ArrowLeft":e.x-=20;break;case"ArrowRight":e.x+=20}this.moveCross(this.crossA,e),this.moveCopyRect(this.copyRectEl,this.crossA)}createCopyRectBoundingBox(){if("function"==typeof this.callbacks.onSelectionEnd){let t=new n.Point2D(this.crossA.x-this.copyRect.width/2,this.crossA.y-this.copyRect.height/2),e=new n.Point2D(this.crossA.x+this.copyRect.width/2,this.crossA.y+this.copyRect.height/2);t=t.boundToRect(this.boundRect),e=e.boundToRect(this.boundRect);const i=e.x-t.x,r=e.y-t.y,o=s.RegionData.BuildRectRegionData(t.x,t.y,i,r);this.callbacks.onSelectionEnd(o)}}}e.RectCopySelector=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RectSelector=e.SelectionModificator=void 0;const n=i(1),r=i(2),s=i(4),o=i(32),a=i(33),h=i(10);var l;!function(t){t[t.RECT=0]="RECT",t[t.SQUARE=1]="SQUARE"}(l=e.SelectionModificator||(e.SelectionModificator={}));class c extends h.Selector{constructor(t,e,i,n){super(t,e,i,n),this.capturingState=!1,this.pointerCaptureId=-1,this.isTwoPoints=!1,this.selectionModificator=l.RECT,this.usingKeyboardCursor=!1,this.buildUIElements(),this.hide()}resize(t,e){super.resize(t,e),this.resizeAll([this.selectionBox,this.crossA,this.crossB])}reset(){this.buildUIElements()}hide(){super.hide(),this.hideAll([this.crossA,this.crossB,this.selectionBox]),this.pointerCaptureId>=0&&(this.parentNode.releasePointerCapture(this.pointerCaptureId),this.pointerCaptureId=-1)}show(){super.show(),this.crossA.show()}getUsingKeyboardCursor(){return this.usingKeyboardCursor}activateKeyboardCursor(){this.usingKeyboardCursor=!0,this.curKeyboardCross=this.crossA,this.isTwoPoints=!0,this.capturingState=!1,this.showAll([this.crossA]),this.hideAll([this.crossB,this.selectionBox])}deactivateKeyboardCursor(){this.usingKeyboardCursor=!1,this.curKeyboardCross=null}buildUIElements(){this.node=this.paper.g(),this.node.addClass("rectSelector"),this.crossA=new o.AlternatingCrossElement(this.paper,this.boundRect),this.crossB=new o.AlternatingCrossElement(this.paper,this.boundRect),this.selectionBox=new a.RectElement(this.paper,this.boundRect,new r.Rect(0,0)),this.selectionBox.node.addClass("selectionBoxStyle"),this.node.add(this.crossA.node),this.node.add(this.crossB.node),this.node.add(this.selectionBox.node);const t=[{event:"pointerenter",listener:this.onPointerEnter,base:this.parentNode,bypass:!1},{event:"pointerleave",listener:this.onPointerLeave,base:this.parentNode,bypass:!1},{event:"pointerdown",listener:this.onPointerDown,base:this.parentNode,bypass:!1},{event:"pointerup",listener:this.onPointerUp,base:this.parentNode,bypass:!1},{event:"pointermove",listener:this.onPointerMove,base:this.parentNode,bypass:!1},{event:"keydown",listener:this.onKeyDown,base:window,bypass:!1},{event:"keyup",listener:this.onKeyUp,base:window,bypass:!0}];this.subscribeToEvents(t)}moveSelectionBox(t,e,i){const r=e.x<i.x?e.x:i.x,s=e.y<i.y?e.y:i.y,o=Math.abs(e.x-i.x),a=Math.abs(e.y-i.y);t.move(new n.Point2D(r,s)),t.resize(o,a)}onPointerEnter(t){window.requestAnimationFrame(()=>{this.crossA.show()})}onPointerLeave(t){window.requestAnimationFrame(()=>{var e,i;const r=this.parentNode.getClientRects(),s=new n.Point2D(t.clientX-(null===(e=r[0])||void 0===e?void 0:e.left),t.clientY-(null===(i=r[0])||void 0===i?void 0:i.top));this.capturingState?this.isTwoPoints&&this.capturingState&&(this.moveCross(this.crossB,s),this.moveSelectionBox(this.selectionBox,this.crossA,this.crossB)):this.hideAll([this.crossA,this.crossB,this.selectionBox])})}onPointerDown(t){window.requestAnimationFrame(()=>{this.deactivateKeyboardCursor(),this.isTwoPoints||(this.capturingState=!0,this.pointerCaptureId=t.pointerId,this.parentNode.setPointerCapture(this.pointerCaptureId),this.moveCross(this.crossB,this.crossA),this.moveSelectionBox(this.selectionBox,this.crossA,this.crossB),this.showAll([this.crossA,this.crossB,this.selectionBox]),"function"==typeof this.callbacks.onSelectionBegin&&this.callbacks.onSelectionBegin())})}onPointerUp(t){window.requestAnimationFrame(()=>{var e,i;const r=this.parentNode.getClientRects(),o=new n.Point2D(t.clientX-(null===(e=r[0])||void 0===e?void 0:e.left),t.clientY-(null===(i=r[0])||void 0===i?void 0:i.top));if(this.isTwoPoints)this.capturingState?this.endTwoPointSelection(o):this.startTwoPointSelection(o);else if(this.capturingState=!1,this.pointerCaptureId>=0&&(this.parentNode.releasePointerCapture(this.pointerCaptureId),this.pointerCaptureId=-1),this.hideAll([this.crossB,this.selectionBox]),"function"==typeof this.callbacks.onSelectionEnd){const t=Math.min(this.crossA.x,this.crossB.x),e=Math.min(this.crossA.y,this.crossB.y),i=Math.abs(this.crossA.x-this.crossB.x),n=Math.abs(this.crossA.y-this.crossB.y);this.callbacks.onSelectionEnd(s.RegionData.BuildRectRegionData(t,e,i,n))}})}onPointerMove(t){window.requestAnimationFrame(()=>{var e,i;this.deactivateKeyboardCursor();const r=this.parentNode.getClientRects(),s=new n.Point2D(t.clientX-(null===(e=r[0])||void 0===e?void 0:e.left),t.clientY-(null===(i=r[0])||void 0===i?void 0:i.top));this.isTwoPoints?this.capturingState?(this.moveCross(this.crossB,s,this.selectionModificator===l.SQUARE,this.crossA),this.moveSelectionBox(this.selectionBox,this.crossA,this.crossB)):(this.moveCross(this.crossA,s),this.moveCross(this.crossB,s)):this.capturingState?(this.moveCross(this.crossB,s,this.selectionModificator===l.SQUARE,this.crossA),this.moveSelectionBox(this.selectionBox,this.crossA,this.crossB)):this.moveCross(this.crossA,s)}),t.preventDefault()}onKeyDown(t){t.shiftKey&&(this.selectionModificator=l.SQUARE),t.ctrlKey&&!this.capturingState&&(this.isTwoPoints=!0),"k"!==t.key&&"K"!==t.key.toLocaleUpperCase()||(this.usingKeyboardCursor?this.usingKeyboardCursor&&!this.capturingState?(this.startTwoPointSelection(this.curKeyboardCross),this.curKeyboardCross=this.crossB):this.usingKeyboardCursor&&this.capturingState&&(this.endTwoPointSelection(this.curKeyboardCross),this.curKeyboardCross=this.crossA):this.activateKeyboardCursor()),!t.ctrlKey&&t.shiftKey&&this.isKeyboardControlKey(t.key)&&this.usingKeyboardCursor&&(t.preventDefault(),this.moveKeyboardCursor(t.key))}onKeyUp(t){t.shiftKey||(this.selectionModificator=l.RECT),!t.ctrlKey&&this.isTwoPoints&&(this.isTwoPoints=!1,this.capturingState=!1,this.moveCross(this.crossA,this.crossB),this.hideAll([this.crossB,this.selectionBox]))}startTwoPointSelection(t){this.capturingState=!0,this.moveCross(this.crossB,t),this.moveSelectionBox(this.selectionBox,this.crossA,this.crossB),this.showAll([this.crossA,this.crossB,this.selectionBox]),"function"==typeof this.callbacks.onSelectionBegin&&this.callbacks.onSelectionBegin()}endTwoPointSelection(t){if(this.capturingState=!1,this.hideAll([this.crossB,this.selectionBox]),"function"==typeof this.callbacks.onSelectionEnd){const t=Math.min(this.crossA.x,this.crossB.x),e=Math.min(this.crossA.y,this.crossB.y),i=Math.abs(this.crossA.x-this.crossB.x),n=Math.abs(this.crossA.y-this.crossB.y);this.callbacks.onSelectionEnd(s.RegionData.BuildRectRegionData(t,e,i,n))}this.moveCross(this.crossA,t),this.moveCross(this.crossB,t)}isKeyboardControlKey(t){return"ArrowUp"===t||"ArrowDown"===t||"ArrowLeft"===t||"ArrowRight"===t}moveKeyboardCursor(t){const e={x:this.curKeyboardCross.x,y:this.curKeyboardCross.y};switch(t){case"ArrowUp":e.y-=20;break;case"ArrowDown":e.y+=20;break;case"ArrowLeft":e.x-=20;break;case"ArrowRight":e.x+=20}this.moveCross(this.curKeyboardCross,e),this.moveSelectionBox(this.selectionBox,this.crossA,this.crossB)}}e.RectSelector=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ToolbarSelectIcon=void 0;const n=i(6);class r extends n.ToolbarIcon{constructor(t,e,i){super(t,e),this.onAction=i,this.buildIconUI()}activate(){this.onAction(this.description.action),this.select()}move(t,e){super.move(t,e),this.iconBackgrounRect.attr({x:t,y:e}),void 0!==this.iconImageSVG&&this.iconImageSVG.attr({x:t,y:e})}resize(t,e){super.resize(t,e),this.iconBackgrounRect.attr({height:this.height,width:this.width}),this.iconImageSVG.attr({height:this.height,width:this.width})}buildIconUI(){this.node=this.paper.g(),this.node.addClass("iconStyle"),this.node.addClass("selector"),this.node.attr({tabindex:0,role:"button"}),this.iconBackgrounRect=this.paper.rect(0,0,this.width,this.height),this.iconBackgrounRect.addClass("iconBGRectStyle"),this.iconImage=this.paper.g(),void 0!==this.description.iconUrl&&Snap.load(this.description.iconUrl,t=>{this.iconImage.append(t),this.iconImageSVG=this.iconImage.children().find(t=>"svg"===t.type),void 0!==this.iconImageSVG&&(this.iconImageSVG.attr({height:this.height,width:this.width}),this.move(this.x,this.y))}),this.iconImage.addClass("iconImageStyle");const t=Snap.parse(`<title>${this.description.tooltip}</title>`);this.node.add(this.iconBackgrounRect),this.node.add(this.iconImage),this.node.append(t),this.node.click(t=>{this.activate()}),this.node.node.addEventListener("focus",this.onfocusCallback),this.node.node.addEventListener("focusout",this.onfocusoutCallback)}}e.ToolbarSelectIcon=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ToolbarSeparator=void 0;const n=i(6);class r extends n.ToolbarIcon{constructor(t,e){super(t,null),this.buildIconUI(),this.resize(e,1)}move(t,e){super.move(t,e),this.iconSeparator.attr({x1:t,x2:t+this.width,y1:e,y2:e})}resize(t,e){super.resize(t,1),this.iconSeparator.attr({width:this.width})}buildIconUI(){this.node=this.paper.g(),this.node.addClass("iconStyle"),this.node.addClass("separator"),this.iconSeparator=this.paper.line(0,0,this.width,0),this.node.add(this.iconSeparator)}}e.ToolbarSeparator=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ToolbarSwitchIcon=void 0;const n=i(6);class r extends n.ToolbarIcon{constructor(t,e,i){super(t,e),this.onAction=i,this.buildIconUI()}activate(){this.onAction(this.description.action),this.toggleSelection()}move(t,e){super.move(t,e),this.iconBackgrounRect.attr({x:t,y:e}),void 0!==this.iconImageSVG&&this.iconImageSVG.attr({x:t,y:e})}resize(t,e){super.resize(t,e),this.iconBackgrounRect.attr({height:this.height,width:this.width}),this.iconImageSVG.attr({height:this.height,width:this.width})}buildIconUI(){this.node=this.paper.g(),this.node.addClass("iconStyle"),this.node.addClass("switch"),this.node.attr({tabindex:0,role:"button"}),this.iconBackgrounRect=this.paper.rect(0,0,this.width,this.height),this.iconBackgrounRect.addClass("iconBGRectStyle"),this.iconImage=this.paper.g(),void 0!==this.description.iconUrl&&Snap.load(this.description.iconUrl,t=>{this.iconImage.append(t),this.iconImageSVG=this.iconImage.children().find(t=>"svg"===t.type),void 0!==this.iconImageSVG&&(this.iconImageSVG.attr({height:this.height,width:this.width}),this.move(this.x,this.y))}),this.iconImage.addClass("iconImageStyle");const t=Snap.parse(`<title>${this.description.tooltip}</title>`);this.node.add(this.iconBackgrounRect),this.node.add(this.iconImage),this.node.append(t),this.node.click(t=>{this.activate()}),this.node.node.addEventListener("focus",this.onfocusCallback),this.node.node.addEventListener("focusout",this.onfocusoutCallback)}}e.ToolbarSwitchIcon=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ToolbarTriggerIcon=void 0;const n=i(6);class r extends n.ToolbarIcon{constructor(t,e,i){super(t,e),this.onAction=i,this.buildIconUI()}activate(){this.onAction(this.description.action)}move(t,e){super.move(t,e),this.iconBackgrounRect.attr({x:t,y:e}),void 0!==this.iconImageSVG&&this.iconImageSVG.attr({x:t,y:e})}resize(t,e){super.resize(t,e),this.iconBackgrounRect.attr({height:this.height,width:this.width}),this.iconImageSVG.attr({height:this.height,width:this.width})}buildIconUI(){this.node=this.paper.g(),this.node.addClass("iconStyle"),this.node.addClass("selector"),this.node.attr({tabindex:0,role:"button"}),this.iconBackgrounRect=this.paper.rect(0,0,this.width,this.height),this.iconBackgrounRect.addClass("iconBGRectStyle"),this.iconImage=this.paper.g(),void 0!==this.description.iconUrl&&Snap.load(this.description.iconUrl,t=>{this.iconImage.append(t),this.iconImageSVG=this.iconImage.children().find(t=>"svg"===t.type),void 0!==this.iconImageSVG&&(this.iconImageSVG.attr({height:this.height,width:this.width}),this.move(this.x,this.y))}),this.iconImage.addClass("iconImageStyle");const t=Snap.parse(`<title>${this.description.tooltip}</title>`);this.node.add(this.iconBackgrounRect),this.node.add(this.iconImage),this.node.append(t),this.node.click(t=>{this.activate()}),this.node.node.addEventListener("focus",this.onfocusCallback),this.node.node.addEventListener("focusout",this.onfocusoutCallback)}}e.ToolbarTriggerIcon=r},function(t,e,i){"use strict";var n=this&&this.__await||function(t){return this instanceof n?(this.v=t,this):new n(t)},r=this&&this.__asyncGenerator||function(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,s=i.apply(t,e||[]),o=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(t){s[t]&&(r[t]=function(e){return new Promise((function(i,n){o.push([t,e,i,n])>1||h(t,e)}))})}function h(t,e){try{(i=s[t](e)).value instanceof n?Promise.resolve(i.value.v).then(l,c):d(o[0][2],i)}catch(t){d(o[0][3],t)}var i}function l(t){h("next",t)}function c(t){h("throw",t)}function d(t,e){t(e),o.shift(),o.length&&h(o[0][0],o[0][1])}};Object.defineProperty(e,"__esModule",{value:!0}),e.Palette=void 0;const s=i(22),o=i(11);e.Palette=class{constructor(t){this.settings={lightness:void 0===t.lightness?.65:Math.max(0,Math.min(1,t.lightness)),lightnessVariation:void 0===t.lightnessVariation?0:Math.max(0,Math.min(1,t.lightnessVariation)),minGrayness:void 0===t.minGrayness?0:Math.max(0,Math.min(1,t.minGrayness)),maxGrayness:void 0===t.maxGrayness?2:Math.max(0,Math.min(2,t.maxGrayness)),granularity:void 0===t.granularity?50:Math.max(10,t.granularity),abRange:void 0===t.abRange?1.3:Math.max(0,Math.min(2,t.abRange))},this.generateClusterPromise=this.generateGamutClusterAsync()}async gamut(){return void 0!==this.gamutCluster&&null!==this.gamutCluster?new Promise(t=>t(this.gamutCluster)):this.generateClusterPromise.then(t=>(this.gamutCluster=t,t))}async swatches(t){return this.gamut().then(e=>{const i=new Array,n=Math.round(Math.random()*e.length);i.push(e[n]);for(let n=0;n<t-1;n++)i.push(this.findNextColor(i,e));return i})}async more(t,e){return t.length>0?this.gamut().then(i=>{const n=new Array,r=t.map(t=>t);for(let t=0;t<e;t++){const t=this.findNextColor(r,i);r.push(t),n.push(t)}return n}):this.swatches(e)}swatchIterator(){return r(this,arguments,(function*(){const t=yield n(this.gamut()),e=t[Math.round(Math.random()*t.length)];yield yield n(e);const i=[e];let r=e,s=1;for(;s>0;){const e=this.findNextColor(i,t);i.push(e),s=e.LAB.distanceTo_00(r.LAB),r=e,s>0&&(yield yield n(e))}}))}findNextColor(t,e){let i=e[0],n=0;return e.forEach(e=>{const r=t.map(t=>e.LAB.distanceTo_00(t.LAB)),s=Math.min(...r);s>n&&(i=e,n=s)}),i}generateGamutClusterAsync(){return new Promise(t=>{this.gamutCluster=this.generateGamutCluster(),t(this.gamutCluster)})}generateGamutCluster(){let t=this.generatePointsCluster(this.settings.granularity);t=t.filter(t=>{const e=this.distanceToGray(t);return e>=this.settings.minGrayness&&e<=this.settings.maxGrayness});const e=new Array;return t.forEach(t=>{let i=this.settings.lightness;this.settings.lightnessVariation>0&&(i+=this.settings.lightnessVariation*(Math.random()-.5),i=Math.max(0,Math.min(1,i)));const n=new o.LABColor(i,t.a,t.b),r=new s.Color(n);r.sRGB.isValidColor()&&e.push(r)}),e}distanceToGray(t){return Math.sqrt(t.a*t.a+t.b*t.b)}generatePointsCluster(t){t=Math.round(t);const e=new Array(t*t),i=this.settings.abRange;for(let n=0;n<t;n++)for(let r=0;r<t;r++)e[n*t+r]={a:2*i*n/(t-1)-i,b:2*i*r/(t-1)-i};return e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TagsDescriptor=void 0;const n=i(35);class r{constructor(t,e=[]){void 0===t?(this.primaryTag=null,this.allTags=[]):t instanceof n.Tag?(this.allTags=e instanceof Array?new Array(t,...e):[t],this.primaryTag=t):t instanceof Array?(this.allTags=t.map(t=>t.copy()),t.length>0?this.primaryTag=t[0]:this.primaryTag=null):null===t&&(this.allTags=e instanceof Array?e.map(t=>t.copy()):[],this.primaryTag=null)}static BuildFromJSON(t){let e=null;null!==t.primary&&void 0!==t.primary&&(e=n.Tag.BuildFromJSON(t.primary));const i=void 0===t.secondary?[]:t.secondary.map(t=>n.Tag.BuildFromJSON(t));return new r(e,i)}get all(){return this.allTags.map(t=>t.copy())}get primary(){return null!==this.primaryTag?this.primaryTag.copy():null}get secondary(){return null!==this.primaryTag?this.all.filter(t=>t.name!==this.primary.name):this.all}toString(){let t="";return null!==this.primaryTag?(t+=this.primaryTag.name,this.secondary.forEach(e=>{t+=", "+e.name})):(this.secondary.forEach(e=>{t+=", "+e.name}),t=t.substring(2,t.length)),t}toJSON(){return null!==this.primaryTag?{primary:this.primaryTag.toJSON(),secondary:this.secondary.map(t=>t.toJSON())}:{primary:null,secondary:this.secondary.map(t=>t.toJSON())}}}e.TagsDescriptor=r},function(t,e,i){window.eve=i(75);var n=function(t){var e,i={},n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,16,(new Date).getTime()),!0},r=Array.isArray||function(t){return t instanceof Array||"[object Array]"==Object.prototype.toString.call(t)},s=0,o="M"+(+new Date).toString(36),a=Date.now||function(){return+new Date},h=function(t){var e=this;if(null==t)return e.s;var i=e.s-t;e.b+=e.dur*i,e.B+=e.dur*i,e.s=t},l=function(t){if(null==t)return this.spd;this.spd=t},c=function(t){var e=this;if(null==t)return e.dur;e.s=e.s*t/e.dur,e.dur=t},d=function(){var e=this;delete i[e.id],e.update(),t("mina.stop."+e.id,e)},g=function(){var t=this;t.pdif||(delete i[t.id],t.update(),t.pdif=t.get()-t.b)},u=function(){var t=this;t.pdif&&(t.b=t.get()-t.pdif,delete t.pdif,i[t.id]=t,f())},p=function(){var t,e=this;if(r(e.start)){t=[];for(var i=0,n=e.start.length;i<n;i++)t[i]=+e.start[i]+(e.end[i]-e.start[i])*e.easing(e.s)}else t=+e.start+(e.end-e.start)*e.easing(e.s);e.set(t)},f=function(r){if(r){var s=0;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o],h=a.get();s++,a.s=(h-a.b)/(a.dur/a.spd),a.s>=1&&(delete i[o],a.s=1,s--,function(e){setTimeout((function(){t("mina.finish."+e.id,e)}))}(a)),a.update()}e=!!s&&n(f)}else e||(e=n(f))},y=function(t,e,n,r,a,m,v){var b={id:o+(s++).toString(36),start:t,end:e,b:n,s:0,dur:r-n,spd:1,get:a,set:m,easing:v||y.linear,status:h,speed:l,duration:c,stop:d,pause:g,resume:u,update:p};i[b.id]=b;var S,x=0;for(S in i)if(i.hasOwnProperty(S)&&2==++x)break;return 1==x&&f(),b};return y.time=a,y.getById=function(t){return i[t]||null},y.linear=function(t){return t},y.easeout=function(t){return Math.pow(t,1.7)},y.easein=function(t){return Math.pow(t,.48)},y.easeinout=function(t){if(1==t)return 1;if(0==t)return 0;var e=.48-t/1.04,i=Math.sqrt(.1734+e*e),n=i-e,r=-i-e,s=Math.pow(Math.abs(n),1/3)*(n<0?-1:1)+Math.pow(Math.abs(r),1/3)*(r<0?-1:1)+.5;return 3*(1-s)*s*s+s*s*s},y.backin=function(t){if(1==t)return 1;var e=1.70158;return t*t*((e+1)*t-e)},y.backout=function(t){if(0==t)return 0;var e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},y.elastic=function(t){return t==!!t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*(2*Math.PI)/.3)+1},y.bounce=function(t){var e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375},window.mina=y,y}("undefined"==typeof eve?function(){}:eve),r=function(t){function e(t,n){if(t){if(t.nodeType)return Y(t);if(E(t,"array")&&e.set)return e.set.apply(e,t);if(t instanceof H)return t;if(null==n)try{return Y(t=i.doc.querySelector(String(t)))}catch(t){return null}}return new q(t=null==t?"100%":t,n=null==n?"100%":n)}e.version="0.5.1",e.toString=function(){return"Snap v"+this.version},e._={};var i={win:t.window,doc:t.window.document};e._.glob=i;var n,r,s="hasOwnProperty",o=String,a=parseFloat,h=parseInt,l=Math,c=l.max,d=l.min,u=l.abs,p=(l.pow,l.PI),f=(l.round,Object.prototype.toString),y=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\))\s*$/i,m=(e._.separator=/[,\s]+/,/[\s]*,[\s]*/),v={hs:1,rg:1},b=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,S=/([rstm])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,x=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\s]*,?[\s]*/gi,w=0,C="S"+(+new Date).toString(36),A=function(t){return(t&&t.type?t.type:"")+C+(w++).toString(36)},T="http://www.w3.org/1999/xlink",_="http://www.w3.org/2000/svg",R={};e.url=function(t){return"url('#"+t+"')"};function P(t,e){if(e){if("#text"==t&&(t=i.doc.createTextNode(e.text||e["#text"]||"")),"#comment"==t&&(t=i.doc.createComment(e.text||e["#text"]||"")),"string"==typeof t&&(t=P(t)),"string"==typeof e)return 1==t.nodeType?"xlink:"==e.substring(0,6)?t.getAttributeNS(T,e.substring(6)):"xml:"==e.substring(0,4)?t.getAttributeNS(_,e.substring(4)):t.getAttribute(e):"text"==e?t.nodeValue:null;if(1==t.nodeType){for(var n in e)if(e[s](n)){var r=o(e[n]);r?"xlink:"==n.substring(0,6)?t.setAttributeNS(T,n.substring(6),r):"xml:"==n.substring(0,4)?t.setAttributeNS(_,n.substring(4),r):t.setAttribute(n,r):t.removeAttribute(n)}}else"text"in e&&(t.nodeValue=e.text)}else t=i.doc.createElementNS(_,t);return t}function E(t,e){return"finite"==(e=o.prototype.toLowerCase.call(e))?isFinite(t):!("array"!=e||!(t instanceof Array||Array.isArray&&Array.isArray(t)))||("null"==e&&null===t||e==typeof t&&null!==t||"object"==e&&t===Object(t)||f.call(t).slice(8,-1).toLowerCase()==e)}function k(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return t.push(t.splice(i,1)[0])}function M(t,e,i){return function n(){var r=Array.prototype.slice.call(arguments,0),o=r.join(""),a=n.cache=n.cache||{},h=n.count=n.count||[];return a[s](o)?(k(h,o),i?i(a[o]):a[o]):(h.length>=1e3&&delete a[h.shift()],h.push(o),a[o]=t.apply(e,r),i?i(a[o]):a[o])}}function D(t){return t%360*p/180}e._.$=P,e._.id=A,e.format=(n=/\{([^\}]+)\}/g,r=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,function(t,e){return o(t).replace(n,(function(t,i){return function(t,e,i){var n=i;return e.replace(r,(function(t,e,i,r,s){e=e||r,n&&(e in n&&(n=n[e]),"function"==typeof n&&s&&(n=n()))})),n=(null==n||n==i?t:n)+""}(t,i,e)}))}),e._.clone=function t(e){if("function"==typeof e||Object(e)!==e)return e;var i=new e.constructor;for(var n in e)e[s](n)&&(i[n]=t(e[n]));return i},e._.cacher=M,e.rad=D,e.deg=function(t){return 180*t/p%360},e.sin=function(t){return l.sin(e.rad(t))},e.tan=function(t){return l.tan(e.rad(t))},e.cos=function(t){return l.cos(e.rad(t))},e.asin=function(t){return e.deg(l.asin(t))},e.acos=function(t){return e.deg(l.acos(t))},e.atan=function(t){return e.deg(l.atan(t))},e.atan2=function(t){return e.deg(l.atan2(t))},e.angle=function t(e,i,n,r,s,o){if(null==s){var a=e-n,h=i-r;return a||h?(180+180*l.atan2(-h,-a)/p+360)%360:0}return t(e,i,s,o)-t(n,r,s,o)},e.len=function(t,i,n,r){return Math.sqrt(e.len2(t,i,n,r))},e.len2=function(t,e,i,n){return(t-i)*(t-i)+(e-n)*(e-n)},e.closestPoint=function(t,e,i){function n(t){var n=t.x-e,r=t.y-i;return n*n+r*r}for(var r,s,o,a,h=t.node,l=h.getTotalLength(),c=l/h.pathSegList.numberOfItems*.125,d=1/0,g=0;g<=l;g+=c)(a=n(o=h.getPointAtLength(g)))<d&&(r=o,s=g,d=a);for(c*=.5;c>.5;){var u,p,f,y,m,v;(f=s-c)>=0&&(m=n(u=h.getPointAtLength(f)))<d?(r=u,s=f,d=m):(y=s+c)<=l&&(v=n(p=h.getPointAtLength(y)))<d?(r=p,s=y,d=v):c*=.5}return r={x:r.x,y:r.y,length:s,distance:Math.sqrt(d)}},e.is=E,e.snapTo=function(t,e,i){if(i=E(i,"finite")?i:10,E(t,"array")){for(var n=t.length;n--;)if(u(t[n]-e)<=i)return t[n]}else{var r=e%(t=+t);if(r<i)return e-r;if(r>t-i)return e-r+t}return e},e.getRGB=M((function(t){if(!t||(t=o(t)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:L};if("none"==t)return{r:-1,g:-1,b:-1,hex:"none",toString:L};if(!v[s](t.toLowerCase().substring(0,2))&&"#"!=t.charAt()&&(t=I(t)),!t)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:L};var i,n,r,g,u,p,f=t.match(y);return f?(f[2]&&(r=h(f[2].substring(5),16),n=h(f[2].substring(3,5),16),i=h(f[2].substring(1,3),16)),f[3]&&(r=h((u=f[3].charAt(3))+u,16),n=h((u=f[3].charAt(2))+u,16),i=h((u=f[3].charAt(1))+u,16)),f[4]&&(p=f[4].split(m),i=a(p[0]),"%"==p[0].slice(-1)&&(i*=2.55),n=a(p[1]),"%"==p[1].slice(-1)&&(n*=2.55),r=a(p[2]),"%"==p[2].slice(-1)&&(r*=2.55),"rgba"==f[1].toLowerCase().slice(0,4)&&(g=a(p[3])),p[3]&&"%"==p[3].slice(-1)&&(g/=100)),f[5]?(p=f[5].split(m),i=a(p[0]),"%"==p[0].slice(-1)&&(i/=100),n=a(p[1]),"%"==p[1].slice(-1)&&(n/=100),r=a(p[2]),"%"==p[2].slice(-1)&&(r/=100),("deg"==p[0].slice(-3)||""==p[0].slice(-1))&&(i/=360),"hsba"==f[1].toLowerCase().slice(0,4)&&(g=a(p[3])),p[3]&&"%"==p[3].slice(-1)&&(g/=100),e.hsb2rgb(i,n,r,g)):f[6]?(p=f[6].split(m),i=a(p[0]),"%"==p[0].slice(-1)&&(i/=100),n=a(p[1]),"%"==p[1].slice(-1)&&(n/=100),r=a(p[2]),"%"==p[2].slice(-1)&&(r/=100),("deg"==p[0].slice(-3)||""==p[0].slice(-1))&&(i/=360),"hsla"==f[1].toLowerCase().slice(0,4)&&(g=a(p[3])),p[3]&&"%"==p[3].slice(-1)&&(g/=100),e.hsl2rgb(i,n,r,g)):(i=d(l.round(i),255),n=d(l.round(n),255),r=d(l.round(r),255),g=d(c(g,0),1),(f={r:i,g:n,b:r,toString:L}).hex="#"+(16777216|r|n<<8|i<<16).toString(16).slice(1),f.opacity=E(g,"finite")?g:1,f)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:L}}),e),e.hsb=M((function(t,i,n){return e.hsb2rgb(t,i,n).hex})),e.hsl=M((function(t,i,n){return e.hsl2rgb(t,i,n).hex})),e.rgb=M((function(t,e,i,n){if(E(n,"finite")){var r=l.round;return"rgba("+[r(t),r(e),r(i),+n.toFixed(2)]+")"}return"#"+(16777216|i|e<<8|t<<16).toString(16).slice(1)}));var I=function(t){var e=i.doc.getElementsByTagName("head")[0]||i.doc.getElementsByTagName("svg")[0],n="rgb(255, 0, 0)";return(I=M((function(t){if("red"==t.toLowerCase())return n;e.style.color=n,e.style.color=t;var r=i.doc.defaultView.getComputedStyle(e,"").getPropertyValue("color");return r==n?null:r})))(t)},B=function(){return"hsb("+[this.h,this.s,this.b]+")"},O=function(){return"hsl("+[this.h,this.s,this.l]+")"},L=function(){return 1==this.opacity||null==this.opacity?this.hex:"rgba("+[this.r,this.g,this.b,this.opacity]+")"},F=function(t,i,n){if(null==i&&E(t,"object")&&"r"in t&&"g"in t&&"b"in t&&(n=t.b,i=t.g,t=t.r),null==i&&E(t,string)){var r=e.getRGB(t);t=r.r,i=r.g,n=r.b}return(t>1||i>1||n>1)&&(t/=255,i/=255,n/=255),[t,i,n]},G=function(t,i,n,r){var s={r:t=l.round(255*t),g:i=l.round(255*i),b:n=l.round(255*n),opacity:E(r,"finite")?r:1,hex:e.rgb(t,i,n),toString:L};return E(r,"finite")&&(s.opacity=r),s};e.color=function(t){var i;return E(t,"object")&&"h"in t&&"s"in t&&"b"in t?(i=e.hsb2rgb(t),t.r=i.r,t.g=i.g,t.b=i.b,t.opacity=1,t.hex=i.hex):E(t,"object")&&"h"in t&&"s"in t&&"l"in t?(i=e.hsl2rgb(t),t.r=i.r,t.g=i.g,t.b=i.b,t.opacity=1,t.hex=i.hex):(E(t,"string")&&(t=e.getRGB(t)),E(t,"object")&&"r"in t&&"g"in t&&"b"in t&&!("error"in t)?(i=e.rgb2hsl(t),t.h=i.h,t.s=i.s,t.l=i.l,i=e.rgb2hsb(t),t.v=i.b):((t={hex:"none"}).r=t.g=t.b=t.h=t.s=t.v=t.l=-1,t.error=1)),t.toString=L,t},e.hsb2rgb=function(t,e,i,n){var r,s,o,a,h;return E(t,"object")&&"h"in t&&"s"in t&&"b"in t&&(i=t.b,e=t.s,n=t.o,t=t.h),a=(h=i*e)*(1-u((t=(t*=360)%360/60)%2-1)),r=s=o=i-h,G(r+=[h,a,0,0,a,h][t=~~t],s+=[a,h,h,a,0,0][t],o+=[0,0,a,h,h,a][t],n)},e.hsl2rgb=function(t,e,i,n){var r,s,o,a,h;return E(t,"object")&&"h"in t&&"s"in t&&"l"in t&&(i=t.l,e=t.s,t=t.h),(t>1||e>1||i>1)&&(t/=360,e/=100,i/=100),a=(h=2*e*(i<.5?i:1-i))*(1-u((t=(t*=360)%360/60)%2-1)),r=s=o=i-h/2,G(r+=[h,a,0,0,a,h][t=~~t],s+=[a,h,h,a,0,0][t],o+=[0,0,a,h,h,a][t],n)},e.rgb2hsb=function(t,e,i){var n,r;return t=(i=F(t,e,i))[0],e=i[1],i=i[2],{h:((0==(r=(n=c(t,e,i))-d(t,e,i))?null:n==t?(e-i)/r:n==e?(i-t)/r+2:(t-e)/r+4)+360)%6*60/360,s:0==r?0:r/n,b:n,toString:B}},e.rgb2hsl=function(t,e,i){var n,r,s,o;return t=(i=F(t,e,i))[0],e=i[1],i=i[2],n=((r=c(t,e,i))+(s=d(t,e,i)))/2,{h:((0==(o=r-s)?null:r==t?(e-i)/o:r==e?(i-t)/o+2:(t-e)/o+4)+360)%6*60/360,s:0==o?0:n<.5?o/(2*n):o/(2-2*n),l:n,toString:O}},e.parsePathString=function(t){if(!t)return null;var i=e.path(t);if(i.arr)return e.path.clone(i.arr);var n={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},r=[];return E(t,"array")&&E(t[0],"array")&&(r=e.path.clone(t)),r.length||o(t).replace(b,(function(t,e,i){var s=[],o=e.toLowerCase();if(i.replace(x,(function(t,e){e&&s.push(+e)})),"m"==o&&s.length>2&&(r.push([e].concat(s.splice(0,2))),o="l",e="m"==e?"l":"L"),"o"==o&&1==s.length&&r.push([e,s[0]]),"r"==o)r.push([e].concat(s));else for(;s.length>=n[o]&&(r.push([e].concat(s.splice(0,n[o]))),n[o]););})),r.toString=e.path.toString,i.arr=e.path.clone(r),r};var N=e.parseTransformString=function(t){if(!t)return null;var i=[];return E(t,"array")&&E(t[0],"array")&&(i=e.path.clone(t)),i.length||o(t).replace(S,(function(t,e,n){var r=[];e.toLowerCase();n.replace(x,(function(t,e){e&&r.push(+e)})),i.push([e].concat(r))})),i.toString=e.path.toString,i};e._.svgTransform2string=function(t){var e=[];return t=t.replace(/(?:^|\s)(\w+)\(([^)]+)\)/g,(function(t,i,n){return n=n.split(/\s*,\s*|\s+/),"rotate"==i&&1==n.length&&n.push(0,0),"scale"==i&&(n.length>2?n=n.slice(0,2):2==n.length&&n.push(0,0),1==n.length&&n.push(n[0],0,0)),"skewX"==i?e.push(["m",1,0,l.tan(D(n[0])),1,0,0]):"skewY"==i?e.push(["m",1,l.tan(D(n[0])),0,1,0,0]):e.push([i.charAt(0)].concat(n)),t})),e},e._.rgTransform=/^[a-z][\s]*-?\.?\d/i,e._.transform2matrix=function(t,i){var n=N(t),r=new e.Matrix;if(n)for(var s=0,a=n.length;s<a;s++){var h,l,c,d,g,u=n[s],p=u.length,f=o(u[0]).toLowerCase(),y=u[0]!=f,m=y?r.invert():0;"t"==f&&2==p?r.translate(u[1],0):"t"==f&&3==p?y?(h=m.x(0,0),l=m.y(0,0),c=m.x(u[1],u[2]),d=m.y(u[1],u[2]),r.translate(c-h,d-l)):r.translate(u[1],u[2]):"r"==f?2==p?(g=g||i,r.rotate(u[1],g.x+g.width/2,g.y+g.height/2)):4==p&&(y?(c=m.x(u[2],u[3]),d=m.y(u[2],u[3]),r.rotate(u[1],c,d)):r.rotate(u[1],u[2],u[3])):"s"==f?2==p||3==p?(g=g||i,r.scale(u[1],u[p-1],g.x+g.width/2,g.y+g.height/2)):4==p?y?(c=m.x(u[2],u[3]),d=m.y(u[2],u[3]),r.scale(u[1],u[1],c,d)):r.scale(u[1],u[1],u[2],u[3]):5==p&&(y?(c=m.x(u[3],u[4]),d=m.y(u[3],u[4]),r.scale(u[1],u[2],c,d)):r.scale(u[1],u[2],u[3],u[4])):"m"==f&&7==p&&r.add(u[1],u[2],u[3],u[4],u[5],u[6])}return r},e._unit2px=function(t,e,i){var n=z(t).node,r={},s=n.querySelector(".svg---mgr");s||(s=P("rect"),P(s,{x:-9e9,y:-9e9,width:10,height:10,class:"svg---mgr",fill:"none"}),n.appendChild(s));function o(t){if(null==t)return"";if(t==+t)return t;P(s,{width:t});try{return s.getBBox().width}catch(t){return 0}}function a(t){if(null==t)return"";if(t==+t)return t;P(s,{height:t});try{return s.getBBox().height}catch(t){return 0}}function h(n,s){null==e?r[n]=s(t.attr(n)||0):n==e&&(r=s(null==i?t.attr(n)||0:i))}switch(t.type){case"rect":h("rx",o),h("ry",a);case"image":h("width",o),h("height",a);case"text":h("x",o),h("y",a);break;case"circle":h("cx",o),h("cy",a),h("r",o);break;case"ellipse":h("cx",o),h("cy",a),h("rx",o),h("ry",a);break;case"line":h("x1",o),h("x2",o),h("y1",a),h("y2",a);break;case"marker":h("refX",o),h("markerWidth",o),h("refY",a),h("markerHeight",a);break;case"radialGradient":h("fx",o),h("fy",a);break;case"tspan":h("dx",o),h("dy",a);break;default:h(e,o)}return n.removeChild(s),r};i.doc.contains||i.doc.compareDocumentPosition;function z(t){return t.node.ownerSVGElement&&Y(t.node.ownerSVGElement)||e.select("svg")}function U(t){E(t,"array")||(t=Array.prototype.slice.call(arguments,0));for(var e=0,i=0,n=this.node;this[e];)delete this[e++];for(e=0;e<t.length;e++)"set"==t[e].type?t[e].forEach((function(t){n.appendChild(t.node)})):n.appendChild(t[e].node);var r=n.childNodes;for(e=0;e<r.length;e++)this[i++]=Y(r[e]);return this}function H(t){if(t.snap in R)return R[t.snap];var e;try{e=t.ownerSVGElement}catch(t){}this.node=t,e&&(this.paper=new q(e)),this.type=t.tagName||t.nodeName;var i=this.id=A(this);if(this.anims={},this._={transform:[]},t.snap=i,R[i]=this,"g"==this.type&&(this.add=U),this.type in{g:1,mask:1,pattern:1,symbol:1})for(var n in q.prototype)q.prototype[s](n)&&(this[n]=q.prototype[n])}function j(t){this.node=t}function $(t,e){var i=P(t);return e.appendChild(i),Y(i)}function q(t,e){var n,r,o,a=q.prototype;if(t&&t.tagName&&"svg"==t.tagName.toLowerCase()){if(t.snap in R)return R[t.snap];var h=t.ownerDocument;for(var l in n=new H(t),r=t.getElementsByTagName("desc")[0],o=t.getElementsByTagName("defs")[0],r||((r=P("desc")).appendChild(h.createTextNode("Created with Snap")),n.node.appendChild(r)),o||(o=P("defs"),n.node.appendChild(o)),n.defs=o,a)a[s](l)&&(n[l]=a[l]);n.paper=n.root=n}else P((n=$("svg",i.doc.body)).node,{height:e,version:1.1,width:t,xmlns:_});return n}function Y(t){return t?t instanceof H||t instanceof j?t:t.tagName&&"svg"==t.tagName.toLowerCase()?new q(t):t.tagName&&"object"==t.tagName.toLowerCase()&&"image/svg+xml"==t.type?new q(t.contentDocument.getElementsByTagName("svg")[0]):new H(t):t}e._.getSomeDefs=function(t){var i=t.node.ownerSVGElement&&Y(t.node.ownerSVGElement)||t.node.parentNode&&Y(t.node.parentNode)||e.select("svg")||e(0,0),n=i.select("defs"),r=null!=n&&n.node;return r||(r=$("defs",i.node).node),r},e._.getSomeSVG=z,e.select=function(t){return t=o(t).replace(/([^\\]):/g,"$1\\:"),Y(i.doc.querySelector(t))},e.selectAll=function(t){for(var n=i.doc.querySelectorAll(t),r=(e.set||Array)(),s=0;s<n.length;s++)r.push(Y(n[s]));return r},setInterval((function(){for(var t in R)if(R[s](t)){var e=R[t],i=e.node;("svg"!=e.type&&!i.ownerSVGElement||"svg"==e.type&&(!i.parentNode||"ownerSVGElement"in i.parentNode&&!i.ownerSVGElement))&&delete R[t]}}),1e4),H.prototype.attr=function(t,e){var i=this,n=i.node;if(!t){if(1!=n.nodeType)return{text:n.nodeValue};for(var r=n.attributes,o={},a=0,h=r.length;a<h;a++)o[r[a].nodeName]=r[a].nodeValue;return o}if(E(t,"string")){if(!(arguments.length>1))return eve("snap.util.getattr."+t,i).firstDefined();var l={};l[t]=e,t=l}for(var c in t)t[s](c)&&eve("snap.util.attr."+c,i,t[c]);return i},e.parse=function(t){var e=i.doc.createDocumentFragment(),n=!0,r=i.doc.createElement("div");if((t=o(t)).match(/^\s*<\s*svg(?:\s|>)/)||(t="<svg>"+t+"</svg>",n=!1),r.innerHTML=t,t=r.getElementsByTagName("svg")[0])if(n)e=t;else for(;t.firstChild;)e.appendChild(t.firstChild);return new j(e)},e.fragment=function(){for(var t=Array.prototype.slice.call(arguments,0),n=i.doc.createDocumentFragment(),r=0,s=t.length;r<s;r++){var o=t[r];o.node&&o.node.nodeType&&n.appendChild(o.node),o.nodeType&&n.appendChild(o),"string"==typeof o&&n.appendChild(e.parse(o).node)}return new j(n)},e._.make=$,e._.wrap=Y,q.prototype.el=function(t,e){var i=$(t,this.node);return e&&i.attr(e),i},H.prototype.children=function(){for(var t=[],i=this.node.childNodes,n=0,r=i.length;n<r;n++)t[n]=e(i[n]);return t},H.prototype.toJSON=function(){var t=[];return function t(e,i){for(var n=0,r=e.length;n<r;n++){var s={type:e[n].type,attr:e[n].attr()},o=e[n].children();i.push(s),o.length&&t(o,s.childNodes=[])}}([this],t),t[0]},eve.on("snap.util.getattr",(function(){var t=eve.nt(),e=(t=t.substring(t.lastIndexOf(".")+1)).replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()}));return V[s](e)?this.node.ownerDocument.defaultView.getComputedStyle(this.node,null).getPropertyValue(e):P(this.node,t)}));var V={"alignment-baseline":0,"baseline-shift":0,clip:0,"clip-path":0,"clip-rule":0,color:0,"color-interpolation":0,"color-interpolation-filters":0,"color-profile":0,"color-rendering":0,cursor:0,direction:0,display:0,"dominant-baseline":0,"enable-background":0,fill:0,"fill-opacity":0,"fill-rule":0,filter:0,"flood-color":0,"flood-opacity":0,font:0,"font-family":0,"font-size":0,"font-size-adjust":0,"font-stretch":0,"font-style":0,"font-variant":0,"font-weight":0,"glyph-orientation-horizontal":0,"glyph-orientation-vertical":0,"image-rendering":0,kerning:0,"letter-spacing":0,"lighting-color":0,marker:0,"marker-end":0,"marker-mid":0,"marker-start":0,mask:0,opacity:0,overflow:0,"pointer-events":0,"shape-rendering":0,"stop-color":0,"stop-opacity":0,stroke:0,"stroke-dasharray":0,"stroke-dashoffset":0,"stroke-linecap":0,"stroke-linejoin":0,"stroke-miterlimit":0,"stroke-opacity":0,"stroke-width":0,"text-anchor":0,"text-decoration":0,"text-rendering":0,"unicode-bidi":0,visibility:0,"word-spacing":0,"writing-mode":0};eve.on("snap.util.attr",(function(t){var e=eve.nt(),i={};i[e=e.substring(e.lastIndexOf(".")+1)]=t;var n=e.replace(/-(\w)/gi,(function(t,e){return e.toUpperCase()})),r=e.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()}));V[s](r)?this.node.style[n]=null==t?"":t:P(this.node,i)})),q.prototype,e.ajax=function(t,e,i,n){var r=new XMLHttpRequest,s=A();if(r){if(E(e,"function"))n=i,i=e,e=null;else if(E(e,"object")){var o=[];for(var a in e)e.hasOwnProperty(a)&&o.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));e=o.join("&")}return r.open(e?"POST":"GET",t,!0),e&&(r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Content-type","application/x-www-form-urlencoded")),i&&(eve.once("snap.ajax."+s+".0",i),eve.once("snap.ajax."+s+".200",i),eve.once("snap.ajax."+s+".304",i)),r.onreadystatechange=function(){4==r.readyState&&eve("snap.ajax."+s+"."+r.status,n,r)},4==r.readyState?r:(r.send(e),r)}},e.load=function(t,i,n){e.ajax(t,(function(t){var r=e.parse(t.responseText);n?i.call(n,r):i(r)}))};return e.getElementByPoint=function(t,e){this.canvas;var n,r,s,o,a,h,l,c=i.doc.elementFromPoint(t,e);if(i.win.opera&&"svg"==c.tagName){var d=(r=(n=c).getBoundingClientRect(),s=n.ownerDocument,o=s.body,a=s.documentElement,h=a.clientTop||o.clientTop||0,l=a.clientLeft||o.clientLeft||0,{y:r.top+(g.win.pageYOffset||a.scrollTop||o.scrollTop)-h,x:r.left+(g.win.pageXOffset||a.scrollLeft||o.scrollLeft)-l}),u=c.createSVGRect();u.x=t-d.x,u.y=e-d.y,u.width=u.height=1;var p=c.getIntersectionList(u,null);p.length&&(c=p[p.length-1])}return c?Y(c):null},e.plugin=function(t){t(e,H,q,i,j)},i.win.Snap=e,e}(window||this);r.plugin((function(t,e,i,n,r){var s=e.prototype,o=t.is,a=String,h=t._unit2px,l=t._.$,c=t._.make,d=t._.getSomeDefs,g="hasOwnProperty",u=t._.wrap;s.getBBox=function(e){if("tspan"==this.type)return t._.box(this.node.getClientRects().item(0));if(!t.Matrix||!t.path)return this.node.getBBox();var i=this,n=new t.Matrix;if(i.removed)return t._.box();for(;"use"==i.type;)if(e||(n=n.add(i.transform().localMatrix.translate(i.attr("x")||0,i.attr("y")||0))),i.original)i=i.original;else{var r=i.attr("xlink:href");i=i.original=i.node.ownerDocument.getElementById(r.substring(r.indexOf("#")+1))}var s=i._,o=t.path.get[i.type]||t.path.get.deflt;try{return e?(s.bboxwt=o?t.path.getBBox(i.realPath=o(i)):t._.box(i.node.getBBox()),t._.box(s.bboxwt)):(i.realPath=o(i),i.matrix=i.transform().localMatrix,s.bbox=t.path.getBBox(t.path.map(i.realPath,n.add(i.matrix))),t._.box(s.bbox))}catch(e){return t._.box()}};var p=function(){return this.string};function f(e,i){if(null==i){var n=!0;if(!(i="linearGradient"==e.type||"radialGradient"==e.type?e.node.getAttribute("gradientTransform"):"pattern"==e.type?e.node.getAttribute("patternTransform"):e.node.getAttribute("transform")))return new t.Matrix;i=t._.svgTransform2string(i)}else i=t._.rgTransform.test(i)?a(i).replace(/\.{3}|\u2026/g,e._.transform||""):t._.svgTransform2string(i),o(i,"array")&&(i=t.path?t.path.toString.call(i):a(i)),e._.transform=i;var r=t._.transform2matrix(i,e.getBBox(1));if(n)return r;e.matrix=r}s.transform=function(e){var i=this._;if(null==e){for(var n,r=this,s=new t.Matrix(this.node.getCTM()),o=f(this),h=[o],c=new t.Matrix,d=o.toTransformString(),g=a(o)==a(this.matrix)?a(i.transform):d;"svg"!=r.type&&(r=r.parent());)h.push(f(r));for(n=h.length;n--;)c.add(h[n]);return{string:g,globalMatrix:s,totalMatrix:c,localMatrix:o,diffMatrix:s.clone().add(o.invert()),global:s.toTransformString(),total:c.toTransformString(),local:d,toString:p}}return e instanceof t.Matrix?(this.matrix=e,this._.transform=e.toTransformString()):f(this,e),this.node&&("linearGradient"==this.type||"radialGradient"==this.type?l(this.node,{gradientTransform:this.matrix}):"pattern"==this.type?l(this.node,{patternTransform:this.matrix}):l(this.node,{transform:this.matrix})),this},s.parent=function(){return u(this.node.parentNode)},s.append=s.add=function(t){if(t){if("set"==t.type){var e=this;return t.forEach((function(t){e.add(t)})),this}t=u(t),this.node.appendChild(t.node),t.paper=this.paper}return this},s.appendTo=function(t){return t&&(t=u(t)).append(this),this},s.prepend=function(t){if(t){if("set"==t.type){var e,i=this;return t.forEach((function(t){e?e.after(t):i.prepend(t),e=t})),this}var n=(t=u(t)).parent();this.node.insertBefore(t.node,this.node.firstChild),this.add&&this.add(),t.paper=this.paper,this.parent()&&this.parent().add(),n&&n.add()}return this},s.prependTo=function(t){return(t=u(t)).prepend(this),this},s.before=function(t){if("set"==t.type){var e=this;return t.forEach((function(t){var i=t.parent();e.node.parentNode.insertBefore(t.node,e.node),i&&i.add()})),this.parent().add(),this}var i=(t=u(t)).parent();return this.node.parentNode.insertBefore(t.node,this.node),this.parent()&&this.parent().add(),i&&i.add(),t.paper=this.paper,this},s.after=function(t){var e=(t=u(t)).parent();return this.node.nextSibling?this.node.parentNode.insertBefore(t.node,this.node.nextSibling):this.node.parentNode.appendChild(t.node),this.parent()&&this.parent().add(),e&&e.add(),t.paper=this.paper,this},s.insertBefore=function(t){t=u(t);var e=this.parent();return t.node.parentNode.insertBefore(this.node,t.node),this.paper=t.paper,e&&e.add(),t.parent()&&t.parent().add(),this},s.insertAfter=function(t){t=u(t);var e=this.parent();return t.node.parentNode.insertBefore(this.node,t.node.nextSibling),this.paper=t.paper,e&&e.add(),t.parent()&&t.parent().add(),this},s.remove=function(){var t=this.parent();return this.node.parentNode&&this.node.parentNode.removeChild(this.node),delete this.paper,this.removed=!0,t&&t.add(),this},s.select=function(t){return u(this.node.querySelector(t))},s.selectAll=function(e){for(var i=this.node.querySelectorAll(e),n=(t.set||Array)(),r=0;r<i.length;r++)n.push(u(i[r]));return n},s.asPX=function(t,e){return null==e&&(e=this.attr(t)),+h(this,t,e)},s.use=function(){var t,e=this.node.id;return e||(e=this.id,l(this.node,{id:e})),t="linearGradient"==this.type||"radialGradient"==this.type||"pattern"==this.type?c(this.type,this.node.parentNode):c("use",this.node.parentNode),l(t.node,{"xlink:href":"#"+e}),t.original=this,t},s.clone=function(){var e=u(this.node.cloneNode(!0));return l(e.node,"id")&&l(e.node,{id:e.id}),function(e){var i,n=e.selectAll("*"),r=/^\s*url\(("|'|)(.*)\1\)\s*$/,s=[],o={};function a(e,i){var n=l(e.node,i);(n=(n=n&&n.match(r))&&n[2])&&"#"==n.charAt()&&(n=n.substring(1))&&(o[n]=(o[n]||[]).concat((function(n){var r={};r[i]=t.url(n),l(e.node,r)})))}function h(t){var e=l(t.node,"xlink:href");e&&"#"==e.charAt()&&(e=e.substring(1))&&(o[e]=(o[e]||[]).concat((function(e){t.attr("xlink:href","#"+e)})))}for(var c=0,d=n.length;c<d;c++){a(i=n[c],"fill"),a(i,"stroke"),a(i,"filter"),a(i,"mask"),a(i,"clip-path"),h(i);var g=l(i.node,"id");g&&(l(i.node,{id:i.id}),s.push({old:g,id:i.id}))}for(c=0,d=s.length;c<d;c++){var u=o[s[c].old];if(u)for(var p=0,f=u.length;p<f;p++)u[p](s[c].id)}}(e),e.insertAfter(this),e},s.toDefs=function(){return d(this).appendChild(this.node),this},s.pattern=s.toPattern=function(t,e,i,n){var r=c("pattern",d(this));return null==t&&(t=this.getBBox()),o(t,"object")&&"x"in t&&(e=t.y,i=t.width,n=t.height,t=t.x),l(r.node,{x:t,y:e,width:i,height:n,patternUnits:"userSpaceOnUse",id:r.id,viewBox:[t,e,i,n].join(" ")}),r.node.appendChild(this.node),r},s.marker=function(t,e,i,n,r,s){var a=c("marker",d(this));return null==t&&(t=this.getBBox()),o(t,"object")&&"x"in t&&(e=t.y,i=t.width,n=t.height,r=t.refX||t.cx,s=t.refY||t.cy,t=t.x),l(a.node,{viewBox:[t,e,i,n].join(" "),markerWidth:i,markerHeight:n,orient:"auto",refX:r||0,refY:s||0,id:a.id}),a.node.appendChild(this.node),a};var y={};function m(t){return function(){var e=t?"<"+this.type:"",i=this.node.attributes,n=this.node.childNodes;if(t)for(var r=0,s=i.length;r<s;r++)e+=" "+i[r].name+'="'+i[r].value.replace(/"/g,'\\"')+'"';if(n.length){for(t&&(e+=">"),r=0,s=n.length;r<s;r++)3==n[r].nodeType?e+=n[r].nodeValue:1==n[r].nodeType&&(e+=u(n[r]).toString());t&&(e+="</"+this.type+">")}else t&&(e+="/>");return e}}s.data=function(e,i){var n=y[this.id]=y[this.id]||{};if(0==arguments.length)return eve("snap.data.get."+this.id,this,n,null),n;if(1==arguments.length){if(t.is(e,"object")){for(var r in e)e[g](r)&&this.data(r,e[r]);return this}return eve("snap.data.get."+this.id,this,n[e],e),n[e]}return n[e]=i,eve("snap.data.set."+this.id,this,i,e),this},s.removeData=function(t){return null==t?y[this.id]={}:y[this.id]&&delete y[this.id][t],this},s.outerSVG=s.toString=m(1),s.innerSVG=m(),s.toDataURL=function(){if(window&&window.btoa){var e=this.getBBox(),i=t.format('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="{width}" height="{height}" viewBox="{x} {y} {width} {height}">{contents}</svg>',{x:+e.x.toFixed(3),y:+e.y.toFixed(3),width:+e.width.toFixed(3),height:+e.height.toFixed(3),contents:this.outerSVG()});return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(i)))}},r.prototype.select=s.select,r.prototype.selectAll=s.selectAll})),r.plugin((function(t,e,i,n,r){var s=Object.prototype.toString,o=String,a=Math;function h(t,e,i,n,r,o){if(null==e&&"[object SVGMatrix]"==s.call(t))return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,void(this.f=t.f);null!=t?(this.a=+t,this.b=+e,this.c=+i,this.d=+n,this.e=+r,this.f=+o):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}!function(e){function i(t){return t[0]*t[0]+t[1]*t[1]}function n(t){var e=a.sqrt(i(t));t[0]&&(t[0]/=e),t[1]&&(t[1]/=e)}e.add=function(t,e,i,n,r,s){if(t&&t instanceof h)return this.add(t.a,t.b,t.c,t.d,t.e,t.f);var o=t*this.a+e*this.c,a=t*this.b+e*this.d;return this.e+=r*this.a+s*this.c,this.f+=r*this.b+s*this.d,this.c=i*this.a+n*this.c,this.d=i*this.b+n*this.d,this.a=o,this.b=a,this},h.prototype.multLeft=function(t,e,i,n,r,s){if(t&&t instanceof h)return this.multLeft(t.a,t.b,t.c,t.d,t.e,t.f);var o=t*this.a+i*this.b,a=t*this.c+i*this.d,l=t*this.e+i*this.f+r;return this.b=e*this.a+n*this.b,this.d=e*this.c+n*this.d,this.f=e*this.e+n*this.f+s,this.a=o,this.c=a,this.e=l,this},e.invert=function(){var t=this,e=t.a*t.d-t.b*t.c;return new h(t.d/e,-t.b/e,-t.c/e,t.a/e,(t.c*t.f-t.d*t.e)/e,(t.b*t.e-t.a*t.f)/e)},e.clone=function(){return new h(this.a,this.b,this.c,this.d,this.e,this.f)},e.translate=function(t,e){return this.e+=t*this.a+e*this.c,this.f+=t*this.b+e*this.d,this},e.scale=function(t,e,i,n){return null==e&&(e=t),(i||n)&&this.translate(i,n),this.a*=t,this.b*=t,this.c*=e,this.d*=e,(i||n)&&this.translate(-i,-n),this},e.rotate=function(e,i,n){e=t.rad(e),i=i||0,n=n||0;var r=+a.cos(e).toFixed(9),s=+a.sin(e).toFixed(9);return this.add(r,s,-s,r,i,n),this.add(1,0,0,1,-i,-n)},e.skewX=function(t){return this.skew(t,0)},e.skewY=function(t){return this.skew(0,t)},e.skew=function(e,i){e=e||0,i=i||0,e=t.rad(e),i=t.rad(i);var n=a.tan(e).toFixed(9),r=a.tan(i).toFixed(9);return this.add(1,r,n,1,0,0)},e.x=function(t,e){return t*this.a+e*this.c+this.e},e.y=function(t,e){return t*this.b+e*this.d+this.f},e.get=function(t){return+this[o.fromCharCode(97+t)].toFixed(4)},e.toString=function(){return"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")"},e.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},e.determinant=function(){return this.a*this.d-this.b*this.c},e.split=function(){var e={};e.dx=this.e,e.dy=this.f;var r=[[this.a,this.b],[this.c,this.d]];e.scalex=a.sqrt(i(r[0])),n(r[0]),e.shear=r[0][0]*r[1][0]+r[0][1]*r[1][1],r[1]=[r[1][0]-r[0][0]*e.shear,r[1][1]-r[0][1]*e.shear],e.scaley=a.sqrt(i(r[1])),n(r[1]),e.shear/=e.scaley,this.determinant()<0&&(e.scalex=-e.scalex);var s=r[0][1],o=r[1][1];return o<0?(e.rotate=t.deg(a.acos(o)),s<0&&(e.rotate=360-e.rotate)):e.rotate=t.deg(a.asin(s)),e.isSimple=!(+e.shear.toFixed(9)||e.scalex.toFixed(9)!=e.scaley.toFixed(9)&&e.rotate),e.isSuperSimple=!+e.shear.toFixed(9)&&e.scalex.toFixed(9)==e.scaley.toFixed(9)&&!e.rotate,e.noRotation=!+e.shear.toFixed(9)&&!e.rotate,e},e.toTransformString=function(t){var e=t||this.split();return+e.shear.toFixed(9)?"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]:(e.scalex=+e.scalex.toFixed(4),e.scaley=+e.scaley.toFixed(4),e.rotate=+e.rotate.toFixed(4),(e.dx||e.dy?"t"+[+e.dx.toFixed(4),+e.dy.toFixed(4)]:"")+(e.rotate?"r"+[+e.rotate.toFixed(4),0,0]:"")+(1!=e.scalex||1!=e.scaley?"s"+[e.scalex,e.scaley,0,0]:""))}}(h.prototype),t.Matrix=h,t.matrix=function(t,e,i,n,r,s){return new h(t,e,i,n,r,s)}})),r.plugin((function(t,e,i,n,r){var s,o=t._.make,a=t._.wrap,h=t.is,l=t._.getSomeDefs,c=/^url\((['"]?)([^)]+)\1\)$/,d=t._.$,g=t.url,u=String,p=t._.separator;function f(i){return function(n){if(eve.stop(),n instanceof r&&1==n.node.childNodes.length&&("radialGradient"==n.node.firstChild.tagName||"linearGradient"==n.node.firstChild.tagName||"pattern"==n.node.firstChild.tagName)&&(n=n.node.firstChild,l(this).appendChild(n),n=a(n)),n instanceof e)if("radialGradient"==n.type||"linearGradient"==n.type||"pattern"==n.type){n.node.id||d(n.node,{id:n.id});var s=g(n.node.id)}else s=n.attr(i);else if((s=t.color(n)).error){var o=t(l(this).ownerSVGElement).gradient(n);o?(o.node.id||d(o.node,{id:o.id}),s=g(o.node.id)):s=n}else s=u(s);var h={};h[i]=s,d(this.node,h),this.node.style[i]=""}}t.deurl=function(t){var e=String(t).match(c);return e?e[2]:t},eve.on("snap.util.attr.mask",(function(t){if(t instanceof e||t instanceof r){if(eve.stop(),t instanceof r&&1==t.node.childNodes.length&&(t=t.node.firstChild,l(this).appendChild(t),t=a(t)),"mask"==t.type)var i=t;else(i=o("mask",l(this))).node.appendChild(t.node);!i.node.id&&d(i.node,{id:i.id}),d(this.node,{mask:g(i.id)})}})),s=function(t){if(t instanceof e||t instanceof r){eve.stop();for(var i,n=t.node;n;){if("clipPath"===n.nodeName){i=new e(n);break}if("svg"===n.nodeName){i=void 0;break}n=n.parentNode}i||((i=o("clipPath",l(this))).node.appendChild(t.node),!i.node.id&&d(i.node,{id:i.id})),d(this.node,{"clip-path":g(i.node.id||i.id)})}},eve.on("snap.util.attr.clip",s),eve.on("snap.util.attr.clip-path",s),eve.on("snap.util.attr.clipPath",s),eve.on("snap.util.attr.fill",f("fill")),eve.on("snap.util.attr.stroke",f("stroke"));var y=/^([lr])(?:\(([^)]*)\))?(.*)$/i;function m(t){eve.stop(),t==+t&&(t+="px"),this.node.style.fontSize=t}function v(){return eve.stop(),this.node.style.fontSize}eve.on("snap.util.grad.parse",(function(t){var e=(t=u(t)).match(y);if(!e)return null;var i=e[1],n=e[2],r=e[3];1==(n=n.split(/\s*,\s*/).map((function(t){return+t==t?+t:t}))).length&&0==n[0]&&(n=[]);var s=(r=(r=r.split("-")).map((function(t){var e={color:(t=t.split(":"))[0]};return t[1]&&(e.offset=parseFloat(t[1])),e}))).length,o=0,a=0;function h(t,e){for(var i=(e-o)/(t-a),n=a;n<t;n++)r[n].offset=+(+o+i*(n-a)).toFixed(2);a=t,o=e}s--;for(var l=0;l<s;l++)"offset"in r[l]&&h(l,r[l].offset);return r[s].offset=r[s].offset||100,h(s,r[s].offset),{type:i,params:n,stops:r}})),eve.on("snap.util.attr.d",(function(e){eve.stop(),h(e,"array")&&h(e[0],"array")&&(e=t.path.toString.call(e)),(e=u(e)).match(/[ruo]/i)&&(e=t.path.toAbsolute(e)),d(this.node,{d:e})}))(-1),eve.on("snap.util.attr.#text",(function(t){eve.stop(),t=u(t);for(var e=n.doc.createTextNode(t);this.node.firstChild;)this.node.removeChild(this.node.firstChild);this.node.appendChild(e)}))(-1),eve.on("snap.util.attr.path",(function(t){eve.stop(),this.attr({d:t})}))(-1),eve.on("snap.util.attr.class",(function(t){eve.stop(),this.node.className.baseVal=t}))(-1),eve.on("snap.util.attr.viewBox",(function(t){var e;e=h(t,"object")&&"x"in t?[t.x,t.y,t.width,t.height].join(" "):h(t,"array")?t.join(" "):t,d(this.node,{viewBox:e}),eve.stop()}))(-1),eve.on("snap.util.attr.transform",(function(t){this.transform(t),eve.stop()}))(-1),eve.on("snap.util.attr.r",(function(t){"rect"==this.type&&(eve.stop(),d(this.node,{rx:t,ry:t}))}))(-1),eve.on("snap.util.attr.textpath",(function(t){if(eve.stop(),"text"==this.type){var i,n,r;if(!t&&this.textPath){for(n=this.textPath;n.node.firstChild;)this.node.appendChild(n.node.firstChild);return n.remove(),void delete this.textPath}if(h(t,"string")){var s=l(this),o=a(s.parentNode).path(t);s.appendChild(o.node),i=o.id,o.attr({id:i})}else(t=a(t))instanceof e&&((i=t.attr("id"))||(i=t.id,t.attr({id:i})));if(i)if(n=this.textPath,r=this.node,n)n.attr({"xlink:href":"#"+i});else{for(n=d("textPath",{"xlink:href":"#"+i});r.firstChild;)n.appendChild(r.firstChild);r.appendChild(n),this.textPath=a(n)}}}))(-1),eve.on("snap.util.attr.text",(function(t){if("text"==this.type){for(var e=this.node,i=function(t){var e=d("tspan");if(h(t,"array"))for(var r=0;r<t.length;r++)e.appendChild(i(t[r]));else e.appendChild(n.doc.createTextNode(t));return e.normalize&&e.normalize(),e};e.firstChild;)e.removeChild(e.firstChild);for(var r=i(t);r.firstChild;)e.appendChild(r.firstChild)}eve.stop()}))(-1),eve.on("snap.util.attr.fontSize",m)(-1),eve.on("snap.util.attr.font-size",m)(-1),eve.on("snap.util.getattr.transform",(function(){return eve.stop(),this.transform()}))(-1),eve.on("snap.util.getattr.textpath",(function(){return eve.stop(),this.textPath}))(-1),function(){function e(e){return function(){eve.stop();var i=n.doc.defaultView.getComputedStyle(this.node,null).getPropertyValue("marker-"+e);return"none"==i?i:t(n.doc.getElementById(i.match(c)[1]))}}function i(t){return function(e){eve.stop();var i="marker"+t.charAt(0).toUpperCase()+t.substring(1);if(""!=e&&e){if("marker"==e.type){var n=e.node.id;return n||d(e.node,{id:e.id}),void(this.node.style[i]=g(n))}}else this.node.style[i]="none"}}eve.on("snap.util.getattr.marker-end",e("end"))(-1),eve.on("snap.util.getattr.markerEnd",e("end"))(-1),eve.on("snap.util.getattr.marker-start",e("start"))(-1),eve.on("snap.util.getattr.markerStart",e("start"))(-1),eve.on("snap.util.getattr.marker-mid",e("mid"))(-1),eve.on("snap.util.getattr.markerMid",e("mid"))(-1),eve.on("snap.util.attr.marker-end",i("end"))(-1),eve.on("snap.util.attr.markerEnd",i("end"))(-1),eve.on("snap.util.attr.marker-start",i("start"))(-1),eve.on("snap.util.attr.markerStart",i("start"))(-1),eve.on("snap.util.attr.marker-mid",i("mid"))(-1),eve.on("snap.util.attr.markerMid",i("mid"))(-1)}(),eve.on("snap.util.getattr.r",(function(){if("rect"==this.type&&d(this.node,"rx")==d(this.node,"ry"))return eve.stop(),d(this.node,"rx")}))(-1),eve.on("snap.util.getattr.text",(function(){if("text"==this.type||"tspan"==this.type){eve.stop();var t=function t(e){for(var i=[],n=e.childNodes,r=0,s=n.length;r<s;r++){var o=n[r];3==o.nodeType&&i.push(o.nodeValue),"tspan"==o.tagName&&(1==o.childNodes.length&&3==o.firstChild.nodeType?i.push(o.firstChild.nodeValue):i.push(t(o)))}return i}(this.node);return 1==t.length?t[0]:t}}))(-1),eve.on("snap.util.getattr.#text",(function(){return this.node.textContent}))(-1),eve.on("snap.util.getattr.fill",(function(e){if(!e){eve.stop();var i=eve("snap.util.getattr.fill",this,!0).firstDefined();return t(t.deurl(i))||i}}))(-1),eve.on("snap.util.getattr.stroke",(function(e){if(!e){eve.stop();var i=eve("snap.util.getattr.stroke",this,!0).firstDefined();return t(t.deurl(i))||i}}))(-1),eve.on("snap.util.getattr.viewBox",(function(){eve.stop();var e=d(this.node,"viewBox");return e?(e=e.split(p),t._.box(+e[0],+e[1],+e[2],+e[3])):void 0}))(-1),eve.on("snap.util.getattr.points",(function(){var t=d(this.node,"points");return eve.stop(),t?t.split(p):void 0}))(-1),eve.on("snap.util.getattr.path",(function(){var t=d(this.node,"d");return eve.stop(),t}))(-1),eve.on("snap.util.getattr.class",(function(){return this.node.className.baseVal}))(-1),eve.on("snap.util.getattr.fontSize",v)(-1),eve.on("snap.util.getattr.font-size",v)(-1)})),r.plugin((function(t,e,i,n,r){var s=/\S+/g,o=String,a=e.prototype;a.addClass=function(t){var e,i,n,r=o(t||"").match(s)||[],a=this.node,h=a.className.baseVal,l=h.match(s)||[];if(r.length){for(e=0;i=r[e++];)~l.indexOf(i)||l.push(i);h!=(n=l.join(" "))&&(a.className.baseVal=n)}return this},a.removeClass=function(t){var e,i,n,r,a=o(t||"").match(s)||[],h=this.node,l=h.className.baseVal,c=l.match(s)||[];if(c.length){for(e=0;n=a[e++];)~(i=c.indexOf(n))&&c.splice(i,1);l!=(r=c.join(" "))&&(h.className.baseVal=r)}return this},a.hasClass=function(t){return!!~(this.node.className.baseVal.match(s)||[]).indexOf(t)},a.toggleClass=function(t,e){if(null!=e)return e?this.addClass(t):this.removeClass(t);var i,n,r,o,a=(t||"").match(s)||[],h=this.node,l=h.className.baseVal,c=l.match(s)||[];for(i=0;r=a[i++];)~(n=c.indexOf(r))?c.splice(n,1):c.push(r);return l!=(o=c.join(" "))&&(h.className.baseVal=o),this}})),r.plugin((function(t,e,i,n,r){var s={"+":function(t,e){return t+e},"-":function(t,e){return t-e},"/":function(t,e){return t/e},"*":function(t,e){return t*e}},o=String,a=/[a-z]+$/i,h=/^\s*([+\-\/*])\s*=\s*([\d.eE+\-]+)\s*([^\d\s]+)?\s*$/;function l(t){return t}function c(t){return function(e){return+e.toFixed(3)+t}}eve.on("snap.util.attr",(function(t){var e=o(t).match(h);if(e){var i=eve.nt(),n=i.substring(i.lastIndexOf(".")+1),r=this.attr(n),l={};eve.stop();var c=e[3]||"",d=r.match(a),g=s[e[1]];if(d&&d==c?t=g(parseFloat(r),+e[2]):(r=this.asPX(n),t=g(this.asPX(n),this.asPX(n,e[2]+c))),isNaN(r)||isNaN(t))return;l[n]=t,this.attr(l)}}))(-10),eve.on("snap.util.equal",(function(t,e){var i=o(this.attr(t)||""),n=o(e).match(h);if(n){eve.stop();var r=n[3]||"",d=i.match(a),g=s[n[1]];return d&&d==r?{from:parseFloat(i),to:g(parseFloat(i),+n[2]),f:c(d)}:{from:i=this.asPX(t),to:g(i,this.asPX(t,n[2]+r)),f:l}}}))(-10)})),r.plugin((function(t,e,i,n,r){var s=i.prototype,o=t.is;s.rect=function(t,e,i,n,r,s){var a;return null==s&&(s=r),o(t,"object")&&"[object Object]"==t?a=t:null!=t&&(a={x:t,y:e,width:i,height:n},null!=r&&(a.rx=r,a.ry=s)),this.el("rect",a)},s.circle=function(t,e,i){var n;return o(t,"object")&&"[object Object]"==t?n=t:null!=t&&(n={cx:t,cy:e,r:i}),this.el("circle",n)};var a=function(){function t(){this.parentNode.removeChild(this)}return function(e,i){var r=n.doc.createElement("img"),s=n.doc.body;r.style.cssText="position:absolute;left:-9999em;top:-9999em",r.onload=function(){i.call(r),r.onload=r.onerror=null,s.removeChild(r)},r.onerror=t,s.appendChild(r),r.src=e}}();s.image=function(e,i,n,r,s){var h=this.el("image");if(o(e,"object")&&"src"in e)h.attr(e);else if(null!=e){var l={"xlink:href":e,preserveAspectRatio:"none"};null!=i&&null!=n&&(l.x=i,l.y=n),null!=r&&null!=s?(l.width=r,l.height=s):a(e,(function(){t._.$(h.node,{width:this.offsetWidth,height:this.offsetHeight})})),t._.$(h.node,l)}return h},s.ellipse=function(t,e,i,n){var r;return o(t,"object")&&"[object Object]"==t?r=t:null!=t&&(r={cx:t,cy:e,rx:i,ry:n}),this.el("ellipse",r)},s.path=function(t){var e;return o(t,"object")&&!o(t,"array")?e=t:t&&(e={d:t}),this.el("path",e)},s.group=s.g=function(t){var e=this.el("g");return 1==arguments.length&&t&&!t.type?e.attr(t):arguments.length&&e.add(Array.prototype.slice.call(arguments,0)),e},s.svg=function(t,e,i,n,r,s,a,h){var l={};return o(t,"object")&&null==e?l=t:(null!=t&&(l.x=t),null!=e&&(l.y=e),null!=i&&(l.width=i),null!=n&&(l.height=n),null!=r&&null!=s&&null!=a&&null!=h&&(l.viewBox=[r,s,a,h])),this.el("svg",l)},s.mask=function(t){var e=this.el("mask");return 1==arguments.length&&t&&!t.type?e.attr(t):arguments.length&&e.add(Array.prototype.slice.call(arguments,0)),e},s.ptrn=function(t,e,i,n,r,s,a,h){if(o(t,"object"))var l=t;else l={patternUnits:"userSpaceOnUse"},t&&(l.x=t),e&&(l.y=e),null!=i&&(l.width=i),null!=n&&(l.height=n),l.viewBox=null!=r&&null!=s&&null!=a&&null!=h?[r,s,a,h]:[t||0,e||0,i||0,n||0];return this.el("pattern",l)},s.use=function(i){return null!=i?(i instanceof e&&(i.attr("id")||i.attr({id:t._.id(i)}),i=i.attr("id")),"#"==String(i).charAt()&&(i=i.substring(1)),this.el("use",{"xlink:href":"#"+i})):e.prototype.use.call(this)},s.symbol=function(t,e,i,n){var r={};return null!=t&&null!=e&&null!=i&&null!=n&&(r.viewBox=[t,e,i,n]),this.el("symbol",r)},s.text=function(t,e,i){var n={};return o(t,"object")?n=t:null!=t&&(n={x:t,y:e,text:i||""}),this.el("text",n)},s.line=function(t,e,i,n){var r={};return o(t,"object")?r=t:null!=t&&(r={x1:t,x2:i,y1:e,y2:n}),this.el("line",r)},s.polyline=function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments,0));var e={};return o(t,"object")&&!o(t,"array")?e=t:null!=t&&(e={points:t}),this.el("polyline",e)},s.polygon=function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments,0));var e={};return o(t,"object")&&!o(t,"array")?e=t:null!=t&&(e={points:t}),this.el("polygon",e)},function(){var e=t._.$;function i(){return this.selectAll("stop")}function n(i,n){var r=e("stop"),s={offset:+n+"%"};i=t.color(i),s["stop-color"]=i.hex,i.opacity<1&&(s["stop-opacity"]=i.opacity),e(r,s);for(var o,a=this.stops(),h=0;h<a.length;h++){if(parseFloat(a[h].attr("offset"))>n){this.node.insertBefore(r,a[h].node),o=!0;break}}return o||this.node.appendChild(r),this}function r(){if("linearGradient"==this.type){var i=e(this.node,"x1")||0,n=e(this.node,"x2")||1,r=e(this.node,"y1")||0,s=e(this.node,"y2")||0;return t._.box(i,r,math.abs(n-i),math.abs(s-r))}var o=this.node.cx||.5,a=this.node.cy||.5,h=this.node.r||0;return t._.box(o-h,a-h,2*h,2*h)}function o(e){var i=e,n=this.stops();if("string"==typeof e&&(i=eve("snap.util.grad.parse",null,"l(0,0,0,1)"+e).firstDefined().stops),t.is(i,"array")){for(var r=0;r<n.length;r++)if(i[r]){var s=t.color(i[r].color),o={offset:i[r].offset+"%"};o["stop-color"]=s.hex,s.opacity<1&&(o["stop-opacity"]=s.opacity),n[r].attr(o)}else n[r].remove();for(r=n.length;r<i.length;r++)this.addStop(i[r].color,i[r].offset);return this}}function a(s,a,h,l,c){var d=t._.make("linearGradient",s);return d.stops=i,d.addStop=n,d.getBBox=r,d.setStops=o,null!=a&&e(d.node,{x1:a,y1:h,x2:l,y2:c}),d}function h(s,o,a,h,l,c){var d=t._.make("radialGradient",s);return d.stops=i,d.addStop=n,d.getBBox=r,null!=o&&e(d.node,{cx:o,cy:a,r:h}),null!=l&&null!=c&&e(d.node,{fx:l,fy:c}),d}s.gradient=function(t){return function(t,i){var n,r=eve("snap.util.grad.parse",null,i).firstDefined();if(!r)return null;r.params.unshift(t),n="l"==r.type.toLowerCase()?a.apply(0,r.params):h.apply(0,r.params),r.type!=r.type.toLowerCase()&&e(n.node,{gradientUnits:"userSpaceOnUse"});for(var s=r.stops,o=s.length,l=0;l<o;l++){var c=s[l];n.addStop(c.color,c.offset)}return n}(this.defs,t)},s.gradientLinear=function(t,e,i,n){return a(this.defs,t,e,i,n)},s.gradientRadial=function(t,e,i,n,r){return h(this.defs,t,e,i,n,r)},s.toString=function(){var e,i=this.node.ownerDocument,n=i.createDocumentFragment(),r=i.createElement("div"),s=this.node.cloneNode(!0);return n.appendChild(r),r.appendChild(s),t._.$(s,{xmlns:"http://www.w3.org/2000/svg"}),e=r.innerHTML,n.removeChild(n.firstChild),e},s.toDataURL=function(){if(window&&window.btoa)return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(this)))},s.clear=function(){for(var t,e=this.node.firstChild;e;)t=e.nextSibling,"defs"!=e.tagName?e.parentNode.removeChild(e):s.clear.call({node:e}),e=t}}()})),r.plugin((function(t,e,i,n){var r=e.prototype,s=t.is,o=t._.clone,a=/,?([a-z]),?/gi,h=parseFloat,l=Math,c=l.PI,d=l.min,g=l.max,u=l.pow,p=l.abs;function f(t){var e=f.ps=f.ps||{};return e[t]?e[t].sleep=100:e[t]={sleep:100},setTimeout((function(){for(var i in e)e.hasOwnProperty(i)&&i!=t&&(e[i].sleep--,!e[i].sleep&&delete e[i])})),e[t]}function y(t,e,i,n){return null==t&&(t=e=i=n=0),null==e&&(e=t.y,i=t.width,n=t.height,t=t.x),{x:t,y:e,width:i,w:i,height:n,h:n,x2:t+i,y2:e+n,cx:t+i/2,cy:e+n/2,r1:l.min(i,n)/2,r2:l.max(i,n)/2,r0:l.sqrt(i*i+n*n)/2,path:B(t,e,i,n),vb:[t,e,i,n].join(" ")}}function m(){return this.join(",").replace(a,"$1")}function v(t){var e=o(t);return e.toString=m,e}function b(t,e,i,n,r,s,o,a,h){return null==h?E(t,e,i,n,r,s,o,a):A(t,e,i,n,r,s,o,a,function(t,e,i,n,r,s,o,a,h){if(h<0||E(t,e,i,n,r,s,o,a)<h)return;var l,c=.5,d=1-c;l=E(t,e,i,n,r,s,o,a,d);for(;p(l-h)>.01;)l=E(t,e,i,n,r,s,o,a,d+=(l<h?1:-1)*(c/=2));return d}(t,e,i,n,r,s,o,a,h))}function S(i,n){function r(t){return+(+t).toFixed(3)}return t._.cacher((function(t,s,o){t instanceof e&&(t=t.attr("d"));for(var a,h,l,c,d,g="",u={},p=0,f=0,y=(t=j(t)).length;f<y;f++){if("M"==(l=t[f])[0])a=+l[1],h=+l[2];else{if(p+(c=b(a,h,l[1],l[2],l[3],l[4],l[5],l[6]))>s){if(n&&!u.start){if(g+=["C"+r((d=b(a,h,l[1],l[2],l[3],l[4],l[5],l[6],s-p)).start.x),r(d.start.y),r(d.m.x),r(d.m.y),r(d.x),r(d.y)],o)return g;u.start=g,g=["M"+r(d.x),r(d.y)+"C"+r(d.n.x),r(d.n.y),r(d.end.x),r(d.end.y),r(l[5]),r(l[6])].join(),p+=c,a=+l[5],h=+l[6];continue}if(!i&&!n)return d=b(a,h,l[1],l[2],l[3],l[4],l[5],l[6],s-p)}p+=c,a=+l[5],h=+l[6]}g+=l.shift()+l}return u.end=g,d=i?p:n?u:A(a,h,l[0],l[1],l[2],l[3],l[4],l[5],1)}),null,t._.clone)}var x=S(1),w=S(),C=S(0,1);function A(t,e,i,n,r,s,o,a,h){var d=1-h,g=u(d,3),p=u(d,2),f=h*h,y=f*h,m=t+2*h*(i-t)+f*(r-2*i+t),v=e+2*h*(n-e)+f*(s-2*n+e),b=i+2*h*(r-i)+f*(o-2*r+i),S=n+2*h*(s-n)+f*(a-2*s+n);return{x:g*t+3*p*h*i+3*d*h*h*r+y*o,y:g*e+3*p*h*n+3*d*h*h*s+y*a,m:{x:m,y:v},n:{x:b,y:S},start:{x:d*t+h*i,y:d*e+h*n},end:{x:d*r+h*o,y:d*s+h*a},alpha:90-180*l.atan2(m-b,v-S)/c}}function T(e,i,n,r,s,o,a,h){t.is(e,"array")||(e=[e,i,n,r,s,o,a,h]);var l=H.apply(null,e);return y(l.min.x,l.min.y,l.max.x-l.min.x,l.max.y-l.min.y)}function _(t,e,i){return e>=t.x&&e<=t.x+t.width&&i>=t.y&&i<=t.y+t.height}function R(t,e){return t=y(t),_(e=y(e),t.x,t.y)||_(e,t.x2,t.y)||_(e,t.x,t.y2)||_(e,t.x2,t.y2)||_(t,e.x,e.y)||_(t,e.x2,e.y)||_(t,e.x,e.y2)||_(t,e.x2,e.y2)||(t.x<e.x2&&t.x>e.x||e.x<t.x2&&e.x>t.x)&&(t.y<e.y2&&t.y>e.y||e.y<t.y2&&e.y>t.y)}function P(t,e,i,n,r){return t*(t*(-3*e+9*i-9*n+3*r)+6*e-12*i+6*n)-3*e+3*i}function E(t,e,i,n,r,s,o,a,h){null==h&&(h=1);for(var c=(h=h>1?1:h<0?0:h)/2,d=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],g=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],u=0,p=0;p<12;p++){var f=c*d[p]+c,y=P(f,t,i,r,o),m=P(f,e,n,s,a),v=y*y+m*m;u+=g[p]*l.sqrt(v)}return c*u}function k(t,e,i,n,r,s,o,a){if(!(g(t,i)<d(r,o)||d(t,i)>g(r,o)||g(e,n)<d(s,a)||d(e,n)>g(s,a))){var h=(t-i)*(s-a)-(e-n)*(r-o);if(h){var l=((t*n-e*i)*(r-o)-(t-i)*(r*a-s*o))/h,c=((t*n-e*i)*(s-a)-(e-n)*(r*a-s*o))/h,u=+l.toFixed(2),p=+c.toFixed(2);if(!(u<+d(t,i).toFixed(2)||u>+g(t,i).toFixed(2)||u<+d(r,o).toFixed(2)||u>+g(r,o).toFixed(2)||p<+d(e,n).toFixed(2)||p>+g(e,n).toFixed(2)||p<+d(s,a).toFixed(2)||p>+g(s,a).toFixed(2)))return{x:l,y:c}}}}function M(t,e,i){if(!R(T(t),T(e)))return i?0:[];for(var n=~~(E.apply(0,t)/8),r=~~(E.apply(0,e)/8),s=[],o=[],a={},h=i?0:[],l=0;l<n+1;l++){var c=A.apply(0,t.concat(l/n));s.push({x:c.x,y:c.y,t:l/n})}for(l=0;l<r+1;l++)c=A.apply(0,e.concat(l/r)),o.push({x:c.x,y:c.y,t:l/r});for(l=0;l<n;l++)for(var d=0;d<r;d++){var g=s[l],u=s[l+1],f=o[d],y=o[d+1],m=p(u.x-g.x)<.001?"y":"x",v=p(y.x-f.x)<.001?"y":"x",b=k(g.x,g.y,u.x,u.y,f.x,f.y,y.x,y.y);if(b){if(a[b.x.toFixed(4)]==b.y.toFixed(4))continue;a[b.x.toFixed(4)]=b.y.toFixed(4);var S=g.t+p((b[m]-g[m])/(u[m]-g[m]))*(u.t-g.t),x=f.t+p((b[v]-f[v])/(y[v]-f[v]))*(y.t-f.t);S>=0&&S<=1&&x>=0&&x<=1&&(i?h++:h.push({x:b.x,y:b.y,t1:S,t2:x}))}}return h}function D(t,e,i){t=j(t),e=j(e);for(var n,r,s,o,a,h,l,c,d,g,u=i?0:[],p=0,f=t.length;p<f;p++){var y=t[p];if("M"==y[0])n=a=y[1],r=h=y[2];else{"C"==y[0]?(d=[n,r].concat(y.slice(1)),n=d[6],r=d[7]):(d=[n,r,n,r,a,h,a,h],n=a,r=h);for(var m=0,v=e.length;m<v;m++){var b=e[m];if("M"==b[0])s=l=b[1],o=c=b[2];else{"C"==b[0]?(g=[s,o].concat(b.slice(1)),s=g[6],o=g[7]):(g=[s,o,s,o,l,c,l,c],s=l,o=c);var S=M(d,g,i);if(i)u+=S;else{for(var x=0,w=S.length;x<w;x++)S[x].segment1=p,S[x].segment2=m,S[x].bez1=d,S[x].bez2=g;u=u.concat(S)}}}}}return u}function I(t){var e=f(t);if(e.bbox)return o(e.bbox);if(!t)return y();for(var i,n=0,r=0,s=[],a=[],h=0,l=(t=j(t)).length;h<l;h++)if("M"==(i=t[h])[0])n=i[1],r=i[2],s.push(n),a.push(r);else{var c=H(n,r,i[1],i[2],i[3],i[4],i[5],i[6]);s=s.concat(c.min.x,c.max.x),a=a.concat(c.min.y,c.max.y),n=i[5],r=i[6]}var u=d.apply(0,s),p=d.apply(0,a),m=y(u,p,g.apply(0,s)-u,g.apply(0,a)-p);return e.bbox=o(m),m}function B(t,e,i,n,r){if(r)return[["M",+t+ +r,e],["l",i-2*r,0],["a",r,r,0,0,1,r,r],["l",0,n-2*r],["a",r,r,0,0,1,-r,r],["l",2*r-i,0],["a",r,r,0,0,1,-r,-r],["l",0,2*r-n],["a",r,r,0,0,1,r,-r],["z"]];var s=[["M",t,e],["l",i,0],["l",0,n],["l",-i,0],["z"]];return s.toString=m,s}function O(t,e,i,n,r){if(null==r&&null==n&&(n=i),t=+t,e=+e,i=+i,n=+n,null!=r)var s=Math.PI/180,o=t+i*Math.cos(-n*s),a=t+i*Math.cos(-r*s),h=[["M",o,e+i*Math.sin(-n*s)],["A",i,i,0,+(r-n>180),0,a,e+i*Math.sin(-r*s)]];else h=[["M",t,e],["m",0,-n],["a",i,n,0,1,1,0,2*n],["a",i,n,0,1,1,0,-2*n],["z"]];return h.toString=m,h}var L=t._unit2px,F={path:function(t){return t.attr("path")},circle:function(t){var e=L(t);return O(e.cx,e.cy,e.r)},ellipse:function(t){var e=L(t);return O(e.cx||0,e.cy||0,e.rx,e.ry)},rect:function(t){var e=L(t);return B(e.x||0,e.y||0,e.width,e.height,e.rx,e.ry)},image:function(t){var e=L(t);return B(e.x||0,e.y||0,e.width,e.height)},line:function(t){return"M"+[t.attr("x1")||0,t.attr("y1")||0,t.attr("x2"),t.attr("y2")]},polyline:function(t){return"M"+t.attr("points")},polygon:function(t){return"M"+t.attr("points")+"z"},deflt:function(t){var e=t.node.getBBox();return B(e.x,e.y,e.width,e.height)}};function G(e){var i=f(e);if(i.abs)return v(i.abs);if(s(e,"array")&&s(e&&e[0],"array")||(e=t.parsePathString(e)),!e||!e.length)return[["M",0,0]];var n,r=[],o=0,a=0,h=0,l=0,c=0;"M"==e[0][0]&&(h=o=+e[0][1],l=a=+e[0][2],c++,r[0]=["M",o,a]);for(var d,g,u=3==e.length&&"M"==e[0][0]&&"R"==e[1][0].toUpperCase()&&"Z"==e[2][0].toUpperCase(),p=c,y=e.length;p<y;p++){if(r.push(d=[]),(n=(g=e[p])[0])!=n.toUpperCase())switch(d[0]=n.toUpperCase(),d[0]){case"A":d[1]=g[1],d[2]=g[2],d[3]=g[3],d[4]=g[4],d[5]=g[5],d[6]=+g[6]+o,d[7]=+g[7]+a;break;case"V":d[1]=+g[1]+a;break;case"H":d[1]=+g[1]+o;break;case"R":for(var b=[o,a].concat(g.slice(1)),S=2,x=b.length;S<x;S++)b[S]=+b[S]+o,b[++S]=+b[S]+a;r.pop(),r=r.concat($(b,u));break;case"O":r.pop(),(b=O(o,a,g[1],g[2])).push(b[0]),r=r.concat(b);break;case"U":r.pop(),r=r.concat(O(o,a,g[1],g[2],g[3])),d=["U"].concat(r[r.length-1].slice(-2));break;case"M":h=+g[1]+o,l=+g[2]+a;default:for(S=1,x=g.length;S<x;S++)d[S]=+g[S]+(S%2?o:a)}else if("R"==n)b=[o,a].concat(g.slice(1)),r.pop(),r=r.concat($(b,u)),d=["R"].concat(g.slice(-2));else if("O"==n)r.pop(),(b=O(o,a,g[1],g[2])).push(b[0]),r=r.concat(b);else if("U"==n)r.pop(),r=r.concat(O(o,a,g[1],g[2],g[3])),d=["U"].concat(r[r.length-1].slice(-2));else for(var w=0,C=g.length;w<C;w++)d[w]=g[w];if("O"!=(n=n.toUpperCase()))switch(d[0]){case"Z":o=+h,a=+l;break;case"H":o=d[1];break;case"V":a=d[1];break;case"M":h=d[d.length-2],l=d[d.length-1];default:o=d[d.length-2],a=d[d.length-1]}}return r.toString=m,i.abs=v(r),r}function N(t,e,i,n){return[t,e,i,n,i,n]}function z(t,e,i,n,r,s){return[1/3*t+2/3*i,1/3*e+2/3*n,1/3*r+2/3*i,1/3*s+2/3*n,r,s]}function U(e,i,n,r,s,o,a,h,d,g){var u,f=120*c/180,y=c/180*(+s||0),m=[],v=t._.cacher((function(t,e,i){return{x:t*l.cos(i)-e*l.sin(i),y:t*l.sin(i)+e*l.cos(i)}}));if(!n||!r)return[e,i,h,d,h,d];if(g)R=g[0],P=g[1],T=g[2],_=g[3];else{e=(u=v(e,i,-y)).x,i=u.y,h=(u=v(h,d,-y)).x,d=u.y;l.cos(c/180*s),l.sin(c/180*s);var b=(e-h)/2,S=(i-d)/2,x=b*b/(n*n)+S*S/(r*r);x>1&&(n*=x=l.sqrt(x),r*=x);var w=n*n,C=r*r,A=(o==a?-1:1)*l.sqrt(p((w*C-w*S*S-C*b*b)/(w*S*S+C*b*b))),T=A*n*S/r+(e+h)/2,_=A*-r*b/n+(i+d)/2,R=l.asin(((i-_)/r).toFixed(9)),P=l.asin(((d-_)/r).toFixed(9));(R=e<T?c-R:R)<0&&(R=2*c+R),(P=h<T?c-P:P)<0&&(P=2*c+P),a&&R>P&&(R-=2*c),!a&&P>R&&(P-=2*c)}var E=P-R;if(p(E)>f){var k=P,M=h,D=d;P=R+f*(a&&P>R?1:-1),m=U(h=T+n*l.cos(P),d=_+r*l.sin(P),n,r,s,0,a,M,D,[P,k,T,_])}E=P-R;var I=l.cos(R),B=l.sin(R),O=l.cos(P),L=l.sin(P),F=l.tan(E/4),G=4/3*n*F,N=4/3*r*F,z=[e,i],H=[e+G*B,i-N*I],j=[h+G*L,d-N*O],$=[h,d];if(H[0]=2*z[0]-H[0],H[1]=2*z[1]-H[1],g)return[H,j,$].concat(m);for(var q=[],Y=0,V=(m=[H,j,$].concat(m).join().split(",")).length;Y<V;Y++)q[Y]=Y%2?v(m[Y-1],m[Y],y).y:v(m[Y],m[Y+1],y).x;return q}function H(t,e,i,n,r,s,o,a){for(var h,c,u,f,y,m,v,b,S=[],x=[[],[]],w=0;w<2;++w)if(0==w?(c=6*t-12*i+6*r,h=-3*t+9*i-9*r+3*o,u=3*i-3*t):(c=6*e-12*n+6*s,h=-3*e+9*n-9*s+3*a,u=3*n-3*e),p(h)<1e-12){if(p(c)<1e-12)continue;0<(f=-u/c)&&f<1&&S.push(f)}else v=c*c-4*u*h,b=l.sqrt(v),v<0||(0<(y=(-c+b)/(2*h))&&y<1&&S.push(y),0<(m=(-c-b)/(2*h))&&m<1&&S.push(m));for(var C,A=S.length,T=A;A--;)C=1-(f=S[A]),x[0][A]=C*C*C*t+3*C*C*f*i+3*C*f*f*r+f*f*f*o,x[1][A]=C*C*C*e+3*C*C*f*n+3*C*f*f*s+f*f*f*a;return x[0][T]=t,x[1][T]=e,x[0][T+1]=o,x[1][T+1]=a,x[0].length=x[1].length=T+2,{min:{x:d.apply(0,x[0]),y:d.apply(0,x[1])},max:{x:g.apply(0,x[0]),y:g.apply(0,x[1])}}}function j(t,e){var i=!e&&f(t);if(!e&&i.curve)return v(i.curve);for(var n=G(t),r=e&&G(e),s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a=function(t,e,i){var n,r;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"].concat(U.apply(0,[e.x,e.y].concat(t.slice(1))));break;case"S":"C"==i||"S"==i?(n=2*e.x-e.bx,r=2*e.y-e.by):(n=e.x,r=e.y),t=["C",n,r].concat(t.slice(1));break;case"T":"Q"==i||"T"==i?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"].concat(z(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"].concat(z(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"].concat(N(e.x,e.y,t[1],t[2]));break;case"H":t=["C"].concat(N(e.x,e.y,t[1],e.y));break;case"V":t=["C"].concat(N(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"].concat(N(e.x,e.y,e.X,e.Y))}return t},l=function(t,e){if(t[e].length>7){t[e].shift();for(var i=t[e];i.length;)d[e]="A",r&&(u[e]="A"),t.splice(e++,0,["C"].concat(i.splice(0,6)));t.splice(e,1),b=g(n.length,r&&r.length||0)}},c=function(t,e,i,s,o){t&&e&&"M"==t[o][0]&&"M"!=e[o][0]&&(e.splice(o,0,["M",s.x,s.y]),i.bx=0,i.by=0,i.x=t[o][1],i.y=t[o][2],b=g(n.length,r&&r.length||0))},d=[],u=[],p="",y="",m=0,b=g(n.length,r&&r.length||0);m<b;m++){n[m]&&(p=n[m][0]),"C"!=p&&(d[m]=p,m&&(y=d[m-1])),n[m]=a(n[m],s,y),"A"!=d[m]&&"C"==p&&(d[m]="C"),l(n,m),r&&(r[m]&&(p=r[m][0]),"C"!=p&&(u[m]=p,m&&(y=u[m-1])),r[m]=a(r[m],o,y),"A"!=u[m]&&"C"==p&&(u[m]="C"),l(r,m)),c(n,r,s,o,m),c(r,n,o,s,m);var S=n[m],x=r&&r[m],w=S.length,C=r&&x.length;s.x=S[w-2],s.y=S[w-1],s.bx=h(S[w-4])||s.x,s.by=h(S[w-3])||s.y,o.bx=r&&(h(x[C-4])||o.x),o.by=r&&(h(x[C-3])||o.y),o.x=r&&x[C-2],o.y=r&&x[C-1]}return r||(i.curve=v(n)),r?[n,r]:n}function $(t,e){for(var i=[],n=0,r=t.length;r-2*!e>n;n+=2){var s=[{x:+t[n-2],y:+t[n-1]},{x:+t[n],y:+t[n+1]},{x:+t[n+2],y:+t[n+3]},{x:+t[n+4],y:+t[n+5]}];e?n?r-4==n?s[3]={x:+t[0],y:+t[1]}:r-2==n&&(s[2]={x:+t[0],y:+t[1]},s[3]={x:+t[2],y:+t[3]}):s[0]={x:+t[r-2],y:+t[r-1]}:r-4==n?s[3]=s[2]:n||(s[0]={x:+t[n],y:+t[n+1]}),i.push(["C",(-s[0].x+6*s[1].x+s[2].x)/6,(-s[0].y+6*s[1].y+s[2].y)/6,(s[1].x+6*s[2].x-s[3].x)/6,(s[1].y+6*s[2].y-s[3].y)/6,s[2].x,s[2].y])}return i}t.path=f,t.path.getTotalLength=x,t.path.getPointAtLength=w,t.path.getSubpath=function(t,e,i){if(this.getTotalLength(t)-i<1e-6)return C(t,e).end;var n=C(t,i,1);return e?C(n,e).end:n},r.getTotalLength=function(){if(this.node.getTotalLength)return this.node.getTotalLength()},r.getPointAtLength=function(t){return w(this.attr("d"),t)},r.getSubpath=function(e,i){return t.path.getSubpath(this.attr("d"),e,i)},t._.box=y,t.path.findDotsAtSegment=A,t.path.bezierBBox=T,t.path.isPointInsideBBox=_,t.closest=function(e,i,n,r){for(var s=100,o=y(e-s/2,i-s/2,s,s),a=[],h=n[0].hasOwnProperty("x")?function(t){return{x:n[t].x,y:n[t].y}}:function(t){return{x:n[t],y:r[t]}},l=0;s<=1e6&&!l;){for(var c=0,d=n.length;c<d;c++){var g=h(c);if(_(o,g.x,g.y)){l++,a.push(g);break}}l||(o=y(e-(s*=2)/2,i-s/2,s,s))}if(1e6!=s){var u,p=1/0;for(c=0,d=a.length;c<d;c++){var f=t.len(e,i,a[c].x,a[c].y);p>f&&(p=f,a[c].len=f,u=a[c])}return u}},t.path.isBBoxIntersect=R,t.path.intersection=function(t,e){return D(t,e)},t.path.intersectionNumber=function(t,e){return D(t,e,1)},t.path.isPointInside=function(t,e,i){var n=I(t);return _(n,e,i)&&D(t,[["M",e,i],["H",n.x2+10]],1)%2==1},t.path.getBBox=I,t.path.get=F,t.path.toRelative=function(e){var i=f(e),n=String.prototype.toLowerCase;if(i.rel)return v(i.rel);t.is(e,"array")&&t.is(e&&e[0],"array")||(e=t.parsePathString(e));var r=[],s=0,o=0,a=0,h=0,l=0;"M"==e[0][0]&&(a=s=e[0][1],h=o=e[0][2],l++,r.push(["M",s,o]));for(var c=l,d=e.length;c<d;c++){var g=r[c]=[],u=e[c];if(u[0]!=n.call(u[0]))switch(g[0]=n.call(u[0]),g[0]){case"a":g[1]=u[1],g[2]=u[2],g[3]=u[3],g[4]=u[4],g[5]=u[5],g[6]=+(u[6]-s).toFixed(3),g[7]=+(u[7]-o).toFixed(3);break;case"v":g[1]=+(u[1]-o).toFixed(3);break;case"m":a=u[1],h=u[2];default:for(var p=1,y=u.length;p<y;p++)g[p]=+(u[p]-(p%2?s:o)).toFixed(3)}else{g=r[c]=[],"m"==u[0]&&(a=u[1]+s,h=u[2]+o);for(var b=0,S=u.length;b<S;b++)r[c][b]=u[b]}var x=r[c].length;switch(r[c][0]){case"z":s=a,o=h;break;case"h":s+=+r[c][x-1];break;case"v":o+=+r[c][x-1];break;default:s+=+r[c][x-2],o+=+r[c][x-1]}}return r.toString=m,i.rel=v(r),r},t.path.toAbsolute=G,t.path.toCubic=j,t.path.map=function(t,e){if(!e)return t;var i,n,r,s,o,a,h;for(r=0,o=(t=j(t)).length;r<o;r++)for(s=1,a=(h=t[r]).length;s<a;s+=2)i=e.x(h[s],h[s+1]),n=e.y(h[s],h[s+1]),h[s]=i,h[s+1]=n;return t},t.path.toString=m,t.path.clone=v})),r.plugin((function(t,e,i,r){var s=Math.max,o=Math.min,a=function(t){if(this.items=[],this.bindings={},this.length=0,this.type="set",t)for(var e=0,i=t.length;e<i;e++)t[e]&&(this[this.items.length]=this.items[this.items.length]=t[e],this.length++)},h=a.prototype;h.push=function(){for(var t,e,i=0,n=arguments.length;i<n;i++)(t=arguments[i])&&(this[e=this.items.length]=this.items[e]=t,this.length++);return this},h.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},h.forEach=function(t,e){for(var i=0,n=this.items.length;i<n;i++)if(!1===t.call(e,this.items[i],i))return this;return this},h.animate=function(e,i,r,s){"function"!=typeof r||r.length||(s=r,r=n.linear),e instanceof t._.Animation&&(s=e.callback,r=e.easing,i=r.dur,e=e.attr);var o=arguments;if(t.is(e,"array")&&t.is(o[o.length-1],"array"))var a=!0;var h,l=function(){h?this.b=h:h=this.b},c=0,d=this,g=s&&function(){++c==d.length&&s.call(this)};return this.forEach((function(t,n){eve.once("snap.animcreated."+t.id,l),a?o[n]&&t.animate.apply(t,o[n]):t.animate(e,i,r,g)}))},h.remove=function(){for(;this.length;)this.pop().remove();return this},h.bind=function(t,e,i){var n={};if("function"==typeof e)this.bindings[t]=e;else{var r=i||t;this.bindings[t]=function(t){n[r]=t,e.attr(n)}}return this},h.attr=function(t){var e={};for(var i in t)this.bindings[i]?this.bindings[i](t[i]):e[i]=t[i];for(var n=0,r=this.items.length;n<r;n++)this.items[n].attr(e);return this},h.clear=function(){for(;this.length;)this.pop()},h.splice=function(t,e,i){t=t<0?s(this.length+t,0):t,e=s(0,o(this.length-t,e));var n,r=[],h=[],l=[];for(n=2;n<arguments.length;n++)l.push(arguments[n]);for(n=0;n<e;n++)h.push(this[t+n]);for(;n<this.length-t;n++)r.push(this[t+n]);var c=l.length;for(n=0;n<c+r.length;n++)this.items[t+n]=this[t+n]=n<c?l[n]:r[n-c];for(n=this.items.length=this.length-=e-c;this[n];)delete this[n++];return new a(h)},h.exclude=function(t){for(var e=0,i=this.length;e<i;e++)if(this[e]==t)return this.splice(e,1),!0;return!1},h.insertAfter=function(t){for(var e=this.items.length;e--;)this.items[e].insertAfter(t);return this},h.getBBox=function(){for(var t=[],e=[],i=[],n=[],r=this.items.length;r--;)if(!this.items[r].removed){var a=this.items[r].getBBox();t.push(a.x),e.push(a.y),i.push(a.x+a.width),n.push(a.y+a.height)}return{x:t=o.apply(0,t),y:e=o.apply(0,e),x2:i=s.apply(0,i),y2:n=s.apply(0,n),width:i-t,height:n-e,cx:t+(i-t)/2,cy:e+(n-e)/2}},h.clone=function(t){t=new a;for(var e=0,i=this.items.length;e<i;e++)t.push(this.items[e].clone());return t},h.toString=function(){return"Snaps set"},h.type="set",t.Set=a,t.set=function(){var t=new a;return arguments.length&&t.push.apply(t,Array.prototype.slice.call(arguments,0)),t}})),r.plugin((function(t,e,i,n){var r={},s=/[%a-z]+$/i,o=String;function a(t){var e=t[0];switch(e.toLowerCase()){case"t":return[e,0,0];case"m":return[e,1,0,0,1,0,0];case"r":return 4==t.length?[e,0,t[2],t[3]]:[e,0];case"s":return 5==t.length?[e,1,1,t[3],t[4]]:3==t.length?[e,1,1]:[e,1]}}function h(t){return t}function l(t){return t.join(" ")}function c(e){return t.rgb(e[0],e[1],e[2],e[3])}function d(t){var e,i,n,r,s,o,a=0,h=[];for(e=0,i=t.length;e<i;e++){for(s="[",o=['"'+t[e][0]+'"'],n=1,r=t[e].length;n<r;n++)o[n]="val["+a+++"]";s+=o+"]",h[e]=s}return Function("val","return Snap.path.toString.call(["+h+"])")}function g(t){for(var e=[],i=0,n=t.length;i<n;i++)for(var r=1,s=t[i].length;r<s;r++)e.push(t[i][r]);return e}function u(t){return isFinite(t)}r.stroke=r.fill="colour",e.prototype.equal=function(t,e){return eve("snap.util.equal",this,t,e).firstDefined()},eve.on("snap.util.equal",(function(e,i){var n,p,f=o(this.attr(e)||""),y=this;if("colour"==r[e])return n=t.color(f),p=t.color(i),{from:[n.r,n.g,n.b,n.opacity],to:[p.r,p.g,p.b,p.opacity],f:c};if("viewBox"==e)return{from:n=this.attr(e).vb.split(" ").map(Number),to:p=i.split(" ").map(Number),f:l};if("transform"==e||"gradientTransform"==e||"patternTransform"==e)return"string"==typeof i&&(i=o(i).replace(/\.{3}|\u2026/g,f)),function(e,i,n){e=e||new t.Matrix,i=i||new t.Matrix,e=t.parseTransformString(e.toTransformString())||[],i=t.parseTransformString(i.toTransformString())||[];for(var r,s,o,h,l=Math.max(e.length,i.length),c=[],u=[],p=0;p<l;p++){if(o=e[p]||a(i[p]),h=i[p]||a(o),o[0]!=h[0]||"r"==o[0].toLowerCase()&&(o[2]!=h[2]||o[3]!=h[3])||"s"==o[0].toLowerCase()&&(o[3]!=h[3]||o[4]!=h[4])){e=t._.transform2matrix(e,n()),i=t._.transform2matrix(i,n()),c=[["m",e.a,e.b,e.c,e.d,e.e,e.f]],u=[["m",i.a,i.b,i.c,i.d,i.e,i.f]];break}for(c[p]=[],u[p]=[],r=0,s=Math.max(o.length,h.length);r<s;r++)r in o&&(c[p][r]=o[r]),r in h&&(u[p][r]=h[r])}return{from:g(c),to:g(u),f:d(c)}}(f=this.matrix,i=t._.rgTransform.test(i)?t._.transform2matrix(i,this.getBBox()):t._.transform2matrix(t._.svgTransform2string(i),this.getBBox()),(function(){return y.getBBox(1)}));if("d"==e||"path"==e)return{from:g((n=t.path.toCubic(f,i))[0]),to:g(n[1]),f:d(n[0])};if("points"==e)return{from:n=o(f).split(t._.separator),to:p=o(i).split(t._.separator),f:function(t){return t}};if(u(f)&&u(i))return{from:parseFloat(f),to:parseFloat(i),f:h};var m,v,b,S=f.match(s),x=o(i).match(s);return S&&(v=S,b=x,t.is(v,"array")&&t.is(b,"array")&&v.toString()==b.toString())?{from:parseFloat(f),to:parseFloat(i),f:(m=S,function(t){return+t.toFixed(3)+m})}:{from:this.asPX(e),to:this.asPX(e,i),f:h}}))})),r.plugin((function(t,e,i,n){for(var r=e.prototype,s=("createTouch"in n.doc),o=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","touchstart","touchmove","touchend","touchcancel"],a={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},h=function(t,e){var i="y"==t?"scrollTop":"scrollLeft",r=e&&e.node?e.node.ownerDocument:n.doc;return r[i in r.documentElement?"documentElement":"body"][i]},l=function(){return this.originalEvent.preventDefault()},c=function(){return this.originalEvent.stopPropagation()},d=function(t,e,i,n){var r=s&&a[e]?a[e]:e,o=function(r){var o=h("y",n),d=h("x",n);if(s&&a.hasOwnProperty(e))for(var g=0,u=r.targetTouches&&r.targetTouches.length;g<u;g++)if(r.targetTouches[g].target==t||t.contains(r.targetTouches[g].target)){var p=r;(r=r.targetTouches[g]).originalEvent=p,r.preventDefault=l,r.stopPropagation=c;break}var f=r.clientX+d,y=r.clientY+o;return i.call(n,r,f,y)};return e!==r&&t.addEventListener(e,o,!1),t.addEventListener(r,o,!1),function(){return e!==r&&t.removeEventListener(e,o,!1),t.removeEventListener(r,o,!1),!0}},g=[],u=function(t){for(var e,i=t.clientX,n=t.clientY,r=h("y"),o=h("x"),a=g.length;a--;){if(e=g[a],s){for(var l,c=t.touches&&t.touches.length;c--;)if((l=t.touches[c]).identifier==e.el._drag.id||e.el.node.contains(l.target)){i=l.clientX,n=l.clientY,(t.originalEvent?t.originalEvent:t).preventDefault();break}}else t.preventDefault();var d=e.el.node;d.nextSibling,d.parentNode,d.style.display;i+=o,n+=r,eve("snap.drag.move."+e.el.id,e.move_scope||e.el,i-e.el._drag.x,n-e.el._drag.y,i,n,t)}},p=function(e){t.unmousemove(u).unmouseup(p);for(var i,n=g.length;n--;)(i=g[n]).el._drag={},eve("snap.drag.end."+i.el.id,i.end_scope||i.start_scope||i.move_scope||i.el,e),eve.off("snap.drag.*."+i.el.id);g=[]},f=o.length;f--;)!function(e){t[e]=r[e]=function(i,n){if(t.is(i,"function"))this.events=this.events||[],this.events.push({name:e,f:i,unbind:d(this.node||document,e,i,n||this)});else for(var r=0,s=this.events.length;r<s;r++)if(this.events[r].name==e)try{this.events[r].f.call(this)}catch(t){}return this},t["un"+e]=r["un"+e]=function(t){for(var i=this.events||[],n=i.length;n--;)if(i[n].name==e&&(i[n].f==t||!t))return i[n].unbind(),i.splice(n,1),!i.length&&delete this.events,this;return this}}(o[f]);r.hover=function(t,e,i,n){return this.mouseover(t,i).mouseout(e,n||i)},r.unhover=function(t,e){return this.unmouseover(t).unmouseout(e)};var y=[];r.drag=function(e,i,n,r,s,o){var a,h=this;if(!arguments.length)return h.drag((function(t,e){this.attr({transform:a+(a?"T":"t")+[t,e]})}),(function(){a=this.transform().local}));function l(a,l,c){(a.originalEvent||a).preventDefault(),h._drag.x=l,h._drag.y=c,h._drag.id=a.identifier,!g.length&&t.mousemove(u).mouseup(p),g.push({el:h,move_scope:r,start_scope:s,end_scope:o}),i&&eve.on("snap.drag.start."+h.id,i),e&&eve.on("snap.drag.move."+h.id,e),n&&eve.on("snap.drag.end."+h.id,n),eve("snap.drag.start."+h.id,s||r||h,l,c,a)}function c(t,e,i){eve("snap.draginit."+h.id,h,t,e,i)}return eve.on("snap.draginit."+h.id,l),h._drag={},y.push({el:h,start:l,init:c}),h.mousedown(c),h},r.undrag=function(){for(var e=y.length;e--;)y[e].el==this&&(this.unmousedown(y[e].init),y.splice(e,1),eve.unbind("snap.drag.*."+this.id),eve.unbind("snap.draginit."+this.id));return!y.length&&t.unmousemove(u).unmouseup(p),this}})),r.plugin((function(t,e,i,n){e.prototype;var r=i.prototype,s=/^\s*url\((.+)\)/,o=String,a=t._.$;t.filter={},r.filter=function(i){var n=this;"svg"!=n.type&&(n=n.paper);var r=t.parse(o(i)),s=t._.id(),h=(n.node.offsetWidth,n.node.offsetHeight,a("filter"));return a(h,{id:s,filterUnits:"userSpaceOnUse"}),h.appendChild(r.node),n.defs.appendChild(h),new e(h)},eve.on("snap.util.getattr.filter",(function(){eve.stop();var e=a(this.node,"filter");if(e){var i=o(e).match(s);return i&&t.select(i[1])}})),eve.on("snap.util.attr.filter",(function(i){if(i instanceof e&&"filter"==i.type){eve.stop();var n=i.node.id;n||(a(i.node,{id:i.id}),n=i.id),a(this.node,{filter:t.url(n)})}i&&"none"!=i||(eve.stop(),this.node.removeAttribute("filter"))})),t.filter.blur=function(e,i){null==e&&(e=2);var n=null==i?e:[e,i];return t.format('<feGaussianBlur stdDeviation="{def}"/>',{def:n})},t.filter.blur.toString=function(){return this()},t.filter.shadow=function(e,i,n,r,s){return null==s&&(null==r?(s=n,n=4,r="#000"):(s=r,r=n,n=4)),null==n&&(n=4),null==s&&(s=1),null==e&&(e=0,i=2),null==i&&(i=e),r=t.color(r),t.format('<feGaussianBlur in="SourceAlpha" stdDeviation="{blur}"/><feOffset dx="{dx}" dy="{dy}" result="offsetblur"/><feFlood flood-color="{color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="{opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>',{color:r,dx:e,dy:i,blur:n,opacity:s})},t.filter.shadow.toString=function(){return this()},t.filter.grayscale=function(e){return null==e&&(e=1),t.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {b} {h} 0 0 0 0 0 1 0"/>',{a:.2126+.7874*(1-e),b:.7152-.7152*(1-e),c:.0722-.0722*(1-e),d:.2126-.2126*(1-e),e:.7152+.2848*(1-e),f:.0722-.0722*(1-e),g:.2126-.2126*(1-e),h:.0722+.9278*(1-e)})},t.filter.grayscale.toString=function(){return this()},t.filter.sepia=function(e){return null==e&&(e=1),t.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {h} {i} 0 0 0 0 0 1 0"/>',{a:.393+.607*(1-e),b:.769-.769*(1-e),c:.189-.189*(1-e),d:.349-.349*(1-e),e:.686+.314*(1-e),f:.168-.168*(1-e),g:.272-.272*(1-e),h:.534-.534*(1-e),i:.131+.869*(1-e)})},t.filter.sepia.toString=function(){return this()},t.filter.saturate=function(e){return null==e&&(e=1),t.format('<feColorMatrix type="saturate" values="{amount}"/>',{amount:1-e})},t.filter.saturate.toString=function(){return this()},t.filter.hueRotate=function(e){return e=e||0,t.format('<feColorMatrix type="hueRotate" values="{angle}"/>',{angle:e})},t.filter.hueRotate.toString=function(){return this()},t.filter.invert=function(e){return null==e&&(e=1),t.format('<feComponentTransfer><feFuncR type="table" tableValues="{amount} {amount2}"/><feFuncG type="table" tableValues="{amount} {amount2}"/><feFuncB type="table" tableValues="{amount} {amount2}"/></feComponentTransfer>',{amount:e,amount2:1-e})},t.filter.invert.toString=function(){return this()},t.filter.brightness=function(e){return null==e&&(e=1),t.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}"/><feFuncG type="linear" slope="{amount}"/><feFuncB type="linear" slope="{amount}"/></feComponentTransfer>',{amount:e})},t.filter.brightness.toString=function(){return this()},t.filter.contrast=function(e){return null==e&&(e=1),t.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}" intercept="{amount2}"/><feFuncG type="linear" slope="{amount}" intercept="{amount2}"/><feFuncB type="linear" slope="{amount}" intercept="{amount2}"/></feComponentTransfer>',{amount:e,amount2:.5-e/2})},t.filter.contrast.toString=function(){return this()}})),r.plugin((function(t,e,i,n,r){var s=t._.box,o=t.is,a=/^[^a-z]*([tbmlrc])/i,h=function(){return"T"+this.dx+","+this.dy};e.prototype.getAlign=function(t,e){null==e&&o(t,"string")&&(e=t,t=null);var i=(t=t||this.paper).getBBox?t.getBBox():s(t),n=this.getBBox(),r={};switch(e=(e=e&&e.match(a))?e[1].toLowerCase():"c"){case"t":r.dx=0,r.dy=i.y-n.y;break;case"b":r.dx=0,r.dy=i.y2-n.y2;break;case"m":r.dx=0,r.dy=i.cy-n.cy;break;case"l":r.dx=i.x-n.x,r.dy=0;break;case"r":r.dx=i.x2-n.x2,r.dy=0;break;default:r.dx=i.cx-n.cx,r.dy=0}return r.toString=h,r},e.prototype.align=function(t,e){return this.transform("..."+this.getAlign(t,e))}})),r.plugin((function(t,e,i,r,s){var o=e.prototype,a=t.is,h=String,l="hasOwnProperty";function c(t,e,i){return function(n){var r=n.slice(t,e);return 1==r.length&&(r=r[0]),i?i(r):r}}var d=function(t,e,i,r){"function"!=typeof i||i.length||(r=i,i=n.linear),this.attr=t,this.dur=e,i&&(this.easing=i),r&&(this.callback=r)};t._.Animation=d,t.animation=function(t,e,i,n){return new d(t,e,i,n)},o.inAnim=function(){var t=[];for(var e in this.anims)this.anims[l](e)&&function(e){t.push({anim:new d(e._attrs,e.dur,e.easing,e._callback),mina:e,curStatus:e.status(),status:function(t){return e.status(t)},stop:function(){e.stop()}})}(this.anims[e]);return t},t.animate=function(t,e,i,r,s,o){"function"!=typeof s||s.length||(o=s,s=n.linear);var a=n.time(),h=n(t,e,a,a+r,n.time,i,s);return o&&eve.once("mina.finish."+h.id,o),h},o.stop=function(){for(var t=this.inAnim(),e=0,i=t.length;e<i;e++)t[e].stop();return this},o.animate=function(t,e,i,r){"function"!=typeof i||i.length||(r=i,i=n.linear),t instanceof d&&(r=t.callback,i=t.easing,e=t.dur,t=t.attr);var s,o,g,u,p=[],f=[],y={},m=this;for(var v in t)if(t[l](v)){m.equal?(s=(u=m.equal(v,h(t[v]))).from,o=u.to,g=u.f):(s=+m.attr(v),o=+t[v]);var b=a(s,"array")?s.length:1;y[v]=c(p.length,p.length+b,g),p=p.concat(s),f=f.concat(o)}var S=n.time(),x=n(p,f,S,S+e,n.time,(function(t){var e={};for(var i in y)y[l](i)&&(e[i]=y[i](t));m.attr(e)}),i);return m.anims[x.id]=x,x._attrs=t,x._callback=r,eve("snap.animcreated."+m.id,x),eve.once("mina.finish."+x.id,(function(){eve.off("mina.*."+x.id),delete m.anims[x.id],r&&r.call(m)})),eve.once("mina.stop."+x.id,(function(){eve.off("mina.*."+x.id),delete m.anims[x.id]})),m}})),r.plugin((function(t,e,i,n){function r(t){t=t.split(/(?=#)/);var e=new String(t[5]);return e[50]=t[0],e[100]=t[1],e[200]=t[2],e[300]=t[3],e[400]=t[4],e[500]=t[5],e[600]=t[6],e[700]=t[7],e[800]=t[8],e[900]=t[9],t[10]&&(e.A100=t[10],e.A200=t[11],e.A400=t[12],e.A700=t[13]),e}t.mui={},t.flat={},t.mui.red=r("#ffebee#ffcdd2#ef9a9a#e57373#ef5350#f44336#e53935#d32f2f#c62828#b71c1c#ff8a80#ff5252#ff1744#d50000"),t.mui.pink=r("#FCE4EC#F8BBD0#F48FB1#F06292#EC407A#E91E63#D81B60#C2185B#AD1457#880E4F#FF80AB#FF4081#F50057#C51162"),t.mui.purple=r("#F3E5F5#E1BEE7#CE93D8#BA68C8#AB47BC#9C27B0#8E24AA#7B1FA2#6A1B9A#4A148C#EA80FC#E040FB#D500F9#AA00FF"),t.mui.deeppurple=r("#EDE7F6#D1C4E9#B39DDB#9575CD#7E57C2#673AB7#5E35B1#512DA8#4527A0#311B92#B388FF#7C4DFF#651FFF#6200EA"),t.mui.indigo=r("#E8EAF6#C5CAE9#9FA8DA#7986CB#5C6BC0#3F51B5#3949AB#303F9F#283593#1A237E#8C9EFF#536DFE#3D5AFE#304FFE"),t.mui.blue=r("#E3F2FD#BBDEFB#90CAF9#64B5F6#64B5F6#2196F3#1E88E5#1976D2#1565C0#0D47A1#82B1FF#448AFF#2979FF#2962FF"),t.mui.lightblue=r("#E1F5FE#B3E5FC#81D4FA#4FC3F7#29B6F6#03A9F4#039BE5#0288D1#0277BD#01579B#80D8FF#40C4FF#00B0FF#0091EA"),t.mui.cyan=r("#E0F7FA#B2EBF2#80DEEA#4DD0E1#26C6DA#00BCD4#00ACC1#0097A7#00838F#006064#84FFFF#18FFFF#00E5FF#00B8D4"),t.mui.teal=r("#E0F2F1#B2DFDB#80CBC4#4DB6AC#26A69A#009688#00897B#00796B#00695C#004D40#A7FFEB#64FFDA#1DE9B6#00BFA5"),t.mui.green=r("#E8F5E9#C8E6C9#A5D6A7#81C784#66BB6A#4CAF50#43A047#388E3C#2E7D32#1B5E20#B9F6CA#69F0AE#00E676#00C853"),t.mui.lightgreen=r("#F1F8E9#DCEDC8#C5E1A5#AED581#9CCC65#8BC34A#7CB342#689F38#558B2F#33691E#CCFF90#B2FF59#76FF03#64DD17"),t.mui.lime=r("#F9FBE7#F0F4C3#E6EE9C#DCE775#D4E157#CDDC39#C0CA33#AFB42B#9E9D24#827717#F4FF81#EEFF41#C6FF00#AEEA00"),t.mui.yellow=r("#FFFDE7#FFF9C4#FFF59D#FFF176#FFEE58#FFEB3B#FDD835#FBC02D#F9A825#F57F17#FFFF8D#FFFF00#FFEA00#FFD600"),t.mui.amber=r("#FFF8E1#FFECB3#FFE082#FFD54F#FFCA28#FFC107#FFB300#FFA000#FF8F00#FF6F00#FFE57F#FFD740#FFC400#FFAB00"),t.mui.orange=r("#FFF3E0#FFE0B2#FFCC80#FFB74D#FFA726#FF9800#FB8C00#F57C00#EF6C00#E65100#FFD180#FFAB40#FF9100#FF6D00"),t.mui.deeporange=r("#FBE9E7#FFCCBC#FFAB91#FF8A65#FF7043#FF5722#F4511E#E64A19#D84315#BF360C#FF9E80#FF6E40#FF3D00#DD2C00"),t.mui.brown=r("#EFEBE9#D7CCC8#BCAAA4#A1887F#8D6E63#795548#6D4C41#5D4037#4E342E#3E2723"),t.mui.grey=r("#FAFAFA#F5F5F5#EEEEEE#E0E0E0#BDBDBD#9E9E9E#757575#616161#424242#212121"),t.mui.bluegrey=r("#ECEFF1#CFD8DC#B0BEC5#90A4AE#78909C#607D8B#546E7A#455A64#37474F#263238"),t.flat.turquoise="#1abc9c",t.flat.greensea="#16a085",t.flat.sunflower="#f1c40f",t.flat.orange="#f39c12",t.flat.emerland="#2ecc71",t.flat.nephritis="#27ae60",t.flat.carrot="#e67e22",t.flat.pumpkin="#d35400",t.flat.peterriver="#3498db",t.flat.belizehole="#2980b9",t.flat.alizarin="#e74c3c",t.flat.pomegranate="#c0392b",t.flat.amethyst="#9b59b6",t.flat.wisteria="#8e44ad",t.flat.clouds="#ecf0f1",t.flat.silver="#bdc3c7",t.flat.wetasphalt="#34495e",t.flat.midnightblue="#2c3e50",t.flat.concrete="#95a5a6",t.flat.asbestos="#7f8c8d",t.importMUIColors=function(){for(var e in t.mui)t.mui.hasOwnProperty(e)&&(window[e]=t.mui[e])}})),t.exports=r},function(t,e,i){var n;!function(i){var r,s,o="hasOwnProperty",a=/[\.\/]/,h=/\s*,\s*/,l=function(t,e){return t-e},c={n:{}},d=function(){for(var t=0,e=this.length;t<e;t++)if(void 0!==this[t])return this[t]},g=function(){for(var t=this.length;--t;)if(void 0!==this[t])return this[t]},u=Object.prototype.toString,p=String,f=Array.isArray||function(t){return t instanceof Array||"[object Array]"==u.call(t)},y=function(t,e){var i,n=s,o=Array.prototype.slice.call(arguments,2),a=y.listeners(t),h=0,c=[],u={},p=[],f=r;p.firstDefined=d,p.lastDefined=g,r=t,s=0;for(var m=0,v=a.length;m<v;m++)"zIndex"in a[m]&&(c.push(a[m].zIndex),a[m].zIndex<0&&(u[a[m].zIndex]=a[m]));for(c.sort(l);c[h]<0;)if(i=u[c[h++]],p.push(i.apply(e,o)),s)return s=n,p;for(m=0;m<v;m++)if("zIndex"in(i=a[m]))if(i.zIndex==c[h]){if(p.push(i.apply(e,o)),s)break;do{if((i=u[c[++h]])&&p.push(i.apply(e,o)),s)break}while(i)}else u[i.zIndex]=i;else if(p.push(i.apply(e,o)),s)break;return s=n,r=f,p};y._events=c,y.listeners=function(t){var e,i,n,r,s,o,h,l,d=f(t)?t:t.split(a),g=c,u=[g],p=[];for(r=0,s=d.length;r<s;r++){for(l=[],o=0,h=u.length;o<h;o++)for(i=[(g=u[o].n)[d[r]],g["*"]],n=2;n--;)(e=i[n])&&(l.push(e),p=p.concat(e.f||[]));u=l}return p},y.separator=function(t){t?(t="["+(t=p(t).replace(/(?=[\.\^\]\[\-])/g,"\\"))+"]",a=new RegExp(t)):a=/[\.\/]/},y.on=function(t,e){if("function"!=typeof e)return function(){};for(var i=f(t)?f(t[0])?t:[t]:p(t).split(h),n=0,r=i.length;n<r;n++)!function(t){for(var i,n=f(t)?t:p(t).split(a),r=c,s=0,o=n.length;s<o;s++)r=(r=r.n).hasOwnProperty(n[s])&&r[n[s]]||(r[n[s]]={n:{}});for(r.f=r.f||[],s=0,o=r.f.length;s<o;s++)if(r.f[s]==e){i=!0;break}!i&&r.f.push(e)}(i[n]);return function(t){+t==+t&&(e.zIndex=+t)}},y.f=function(t){var e=[].slice.call(arguments,1);return function(){y.apply(null,[t,null].concat(e).concat([].slice.call(arguments,0)))}},y.stop=function(){s=1},y.nt=function(t){var e=f(r)?r.join("."):r;return t?new RegExp("(?:\\.|\\/|^)"+t+"(?:\\.|\\/|$)").test(e):e},y.nts=function(){return f(r)?r:r.split(a)},y.off=y.unbind=function(t,e){if(t){var i=f(t)?f(t[0])?t:[t]:p(t).split(h);if(i.length>1)for(var n=0,r=i.length;n<r;n++)y.off(i[n],e);else{i=f(t)?t:p(t).split(a);var s,l,d,g,u,m=[c],v=[];for(n=0,r=i.length;n<r;n++)for(g=0;g<m.length;g+=d.length-2){if(d=[g,1],s=m[g].n,"*"!=i[n])s[i[n]]&&(d.push(s[i[n]]),v.unshift({n:s,name:i[n]}));else for(l in s)s[o](l)&&(d.push(s[l]),v.unshift({n:s,name:l}));m.splice.apply(m,d)}for(n=0,r=m.length;n<r;n++)for(s=m[n];s.n;){if(e){if(s.f){for(g=0,u=s.f.length;g<u;g++)if(s.f[g]==e){s.f.splice(g,1);break}!s.f.length&&delete s.f}for(l in s.n)if(s.n[o](l)&&s.n[l].f){var b=s.n[l].f;for(g=0,u=b.length;g<u;g++)if(b[g]==e){b.splice(g,1);break}!b.length&&delete s.n[l].f}}else for(l in delete s.f,s.n)s.n[o](l)&&s.n[l].f&&delete s.n[l].f;s=s.n}t:for(n=0,r=v.length;n<r;n++){for(l in(s=v[n]).n[s.name].f)continue t;for(l in s.n[s.name].n)continue t;delete s.n[s.name]}}}else y._events=c={n:{}}},y.once=function(t,e){var i=function(){return y.off(t,i),e.apply(this,arguments)};return y.on(t,i)},y.version="0.5.4",y.toString=function(){return"You are running Eve 0.5.4"},i.eve=y,t.exports?t.exports=y:void 0===(n=function(){return y}.apply(e,[]))||(t.exports=n)}("undefined"!=typeof window?window:this)},function(t,e,i){var n=i(77);"string"==typeof n&&(n=[[t.i,n,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};i(79)(n,r);n.locals&&(t.exports=n.locals)},function(t,e,i){(t.exports=i(78)(!1)).push([t.i,"/* CanvasTools.css */\r\n\r\n/* 1. Editor */\r\n/* 1.1. Cursors */\r\n.CanvasToolsEditor {\r\n    --cursor-pointer: -webkit-image-set(url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAABUklEQVRoQ+3YMW6EMBAF0NkTmNOkTkVtCjdUcIFcAY4CNQ1HSNqkSx8JpBwATpDIllhptezCekg8XzIVErI1bz62JZ+MMa9d1z0T6HMioh9jzBsqwgFs81ERDqCUonmeIREOUFUVDcNAbdvCIc6Auq6pKAo4xAXArgU0xBUADbEKQELcBKAg7gIQEJsA6YhdAMmI3QCpiIcAEhEPA6QhvACSEN4AKQgWQAKCDQiNOAQQEnEYIBTiUEAIxOGA/0bsApRlSU3TeN0c/fVtxyZgKT5N0y+l1LePIsuylzzPP33Gbo25C1iK11p/9H3/tDVZiO83AQjF24atAlCKXwUgFX8FQCv+AjCOo9sqJS/YtU3CrYEkSWiaJrjizwnYF7TOL2m4BFCLdwlord+lHlJ7DkabAPQTAaHjiwnEBJgdiL8Qs4Hs4TEBdguZE8QEmA1kD/8FUOpiQO9zcnQAAAAASUVORK5CYII=') 2x), pointer;\r\n    --cursor-move: -webkit-image-set(url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAACgElEQVRoQ+2ZS27CMBCGyQFygnZJb1Ep6SY3yJpHeweWQNVjVAHWvkE2hXtQVlwAcQCqiQhygsceP8bqAkuoqpqM/88ez/wuySDwmE6n38fjMavr+iVwaGW4JOQkIL6qqneIWRTFPgZEMIBW/Gg0atZks9lEgQgCIItfr9cNwHg8jgLhDaAS36ZlDAgvAJ34WBDOABTxMSCcAGzEc0NYA7iI54SwApDrvKp/zOfzwWKxaP4EP5fLJdpmQvUJMsBsNns9HA5fmCIhRKYCKMtyh72Tpum+qqoPn2ZKAoCVP5/PQyFErpnsguwAOkdZltvT6fTk07GNAG3awEpyAMDO+aSTFkDOeU4AH++EAsjVBnwNJwD4J1fvpATol8okSVgBLpeLs3e6A1DV+RgArgawA4A1qVgALhA3AF2HBQDKsGlkcjxIIXnYuNhGmcketN3VBJHn+QA+MLbbbfOhDFV8KkRiEk8RwPUMBeIGAA+vVisuLU5xJ5PJAG54RVH81nU9VAXppBAGoTNlctAsyzoptNuhNqijBc5Of1DEwzt3h1gFEfsQU8V3AOTD3IeIWUZtxN8BYBCxAGzFKwFUEDEAXMSjAH0IqAScZg5S1lRtsDL2n+w0Wip1NdjoESJdaJzEa1NIpma+Uj5jTYrS/Yw70Aa5Xuo/saBCiDfkUv+DvZOm6SHKpb4VEPjfKs5pIy8IeQf6EC7eybVUeh1i1cvtTthAcIgnH2JfCC7xXgA67yQDc4r3BjBBcIsPAoBBxBAfDKAPAb+7ehtK8/Iqo7oJel+zBqnzJiDrPmAKeP2iO/exB6Y52HbAZuJQzwbfgVDCqHEeANSV4nrusQNcK0uN+wdgZhRePQu00wAAAABJRU5ErkJggg==') 2x) 8 8, move;\r\n    --cursor-resize: -webkit-image-set(url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAADKElEQVRoQ+2ZK6waQRSGB8W25iJBgWiTrQKNKWo1ZF1LwuM2teARgMCDbxdIqCSgUSgsoLqiTWhCAhLUBbXN2bBkgN15MWy5KVjm8X9zHvMPBJDkT7FY/LZcLj+ORqP3kpd2XS4gcxMQbxjGM6ypadovPyCkATjic7mcfSbdbtcXCCkAuPhOp2MD5PN5XyCuBnAT76SlHxBXAZDE+wUhDMAi3g8IIQBHfCgUQuVymamRNZtNtNlspBc2NwDeKpmUuwyS2WK5AURF32reA+BWJ8u6LjUCh5z/wrqgyLhDTbwTmUsEwAqWCiqyOTbHEi1sT2Fn3ebmAKIG0FWYI/7p6Qltt1tYmwoAcyaTySfTNN/ABFVVX5LJZM8wjK8M0bGcvXgjcSEMv2FjsRiq1+tEgEqlEu33+z9BeDweR6lUytY7Ho/RfD63QXRd/9BoNP4QQKxqtYoWiwW3ATwBOLcHtVqNCgACV6uVAi40nU6faBwOh7YrjUQiL6ZpvqUBwH68BvAI4OZtaADZbHbQ6/XSg8HgQrwjFiAymQwqFovfDcPw6mZ2BGA/XituA3gZMxoAnH4wGFRmsxkxzROJBNrv96QonADwQARIrpIGgBCySqUSAqNG+oDha7VapFq6AGCFOAJA7rXb7RMddwTwezQauV50Jyl0DkEDgBRSFEWZTqcsKbRzWqzLYFIKeYo/CamTSjgEDcCHIiaKv8jJcwgagHNhrddrBdLPrY0WCgUUDodJpw/LHCOAtVGqeNeiwiGi0Sj1HjhcZKZpmgp0G/wig+6kqupO13WV8yJjEu/ZFfAnIzwDOazEZwA5RGaXTCZ/EHo/XgoWPE8PT05m8URh/8jMcYmnnqzPdppbPBUAu6Vf54OG2Nzv5Euqz78TnZ4y/j8AST9sCRWsWxiEIoDfE+BGWT7gWOF5qmmaNPFMXchLnJt38hrLaw9YDsQZIxQBZzILxC3FXxUBFohbi5cCgF12z7gV90O8NIBzCMuynJ9HpBastC5EK2z4Xna38drzqiJ2W/TwR3fK6w3L02FYxkoHYNlU5pgHgMzTFFnrEQGRU5M559VH4C9ocYlPRB5IuQAAAABJRU5ErkJggg==') 2x) 8 8, nesw-resize;\r\n    --cursor-delete: -webkit-image-set(url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAABn0lEQVRoQ+3YMW6EMBAAwL0XmNekhYraFG6o4AP5AvATqGl4ArRJlz4SSHkAvIDIljjlBHesAQevhKuTzpidXa8R3IQQdVmWHhAdNwAYhRANVYQCyORTRSgAYwyGYSCJUIAkSaBtWyiKghziDkjTFKIoIod4AMhe0ESo/tk45L13jxlAEzG6rguehz+F67qGpmnkbcwBNBCqf+T2ww45N8sy8wAkwm4AAjHK7aO7heQ2Mr6F/m6JF41tZxMv7WfN0wnbErvnLZ5Cz1a1EaEFQPTE7ozqLqANsA2xCWATYjPAFsQugA2I3YCzEYcAzkQcBjgLcSjgDMThgP9GoABxHEOe57oPSTXf9NeOVcAUvO/734yxny2KIAjewzD82nLt2jUvAVPwnPPPqqre1hY74/+nAArBT29Fs9dCKsEvAigFPwNQC/4B0HWdOiptbtilQ0I1seM40Pc9ueDvFZA/qGV+qoaqANXgVQU45x+2PqQwD8ZDPrBibmRqzgUwlVnsulcFsJkyNe+qgKnMYte9KoDNlKl5VwVMZRa7LvkK/AIya4BAvmH9YQAAAABJRU5ErkJggg==') 2x), pointer;\r\n    --cursor-add: -webkit-image-set(url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAACEElEQVRoQ+2YsW7CMBCGnZEs4Wm6hol2DEOkKkMEL9BXAN4EmCqxMLZbsrZb90og9QFggTHVWZgGY+JLbNexlJOQIsU+33f/ne3gxXGcrdfrAXHUPEJIEcdxrgNitVo9H4/HRz4Xvu+/p2n6aiJHFAAc64A4qxnygerwfQ+eAgRBQA6HgzIEAygKmhNqnucp+61SjgJMp1Oy3W7JcrlUWswqwGw2I+PxWAnCOgBIVRPir1ZKOvMldKcEQH1lu5QQKMCsBkQRhiEZDK534bKv8jP4z7KM5HlO20M5+rMT2gP8QkgI4dyqwGCd+XxuHgBZTu0GQEAUUD58CYGizCDjsJUygxKCn/ESKpdBRTm1s4lFNYzpiVZso1UNKINoPYCsJ5wAqIKwdpkTnQOyQ0ZUTnCdPp1OT/zcXq/3ZvQ63QRAVk6yBOh6L7xK1HEua+w6vpqMVQawrYQWAJsQ2gBsQWgFsAGhHeC/IVAAk8mELBaLJpuE0jc2ZkEpAAt+OBx+B0Hwg3HKjxmNRi9Jknw1mSubUwnAgo+i6HOz2TzInNl4fxfAheDZV9HNZ6ErwQsBXAr+BsC14K8Adrsd3Srb3LCiTYI2cb/fJ/v93rngLwrAg2uZZ2pQBVwNnioQRdFHWw8pzMGo5Q9WzEKmxnQApjKL9dspgM2UqXGdAqYyi/XbKYDNlKlxnQKmMov167wCv7Mu7kBLP7biAAAAAElFTkSuQmCC') 2x), pointer;\r\n}\r\n\r\n/* 1.2. Layout */\r\n.CanvasToolsEditor {\r\n    display: grid;\r\n    grid-template-rows: 1fr;\r\n    grid-template-columns: 1fr; \r\n    width: 100%;\r\n    height: 100%;\r\n    box-sizing: content-box;\r\n}\r\n\r\n.CanvasToolsEditor * {\r\n    box-sizing: content-box;\r\n}\r\n\r\n.CanvasToolsEditor canvas {\r\n    position: relative;\r\n    grid-row: 1;\r\n    grid-column: 1;\r\n    width: 100%;\r\n    height: 100%;\r\n    pointer-events: none;\r\n    background-color: #111;\r\n}\r\n\r\n.CanvasToolsEditor svg {\r\n    position: relative;\r\n    grid-row: 1;\r\n    grid-column: 1;\r\n    width: 100%;\r\n    height: 100%;\r\n}\r\n\r\n.CanvasToolsEditor svg {\r\n    cursor: var(--cursor-pointer);\r\n}\r\n\r\n.CanvasToolsEditor svg title {\r\n    -moz-user-select: none; /* Firefox */\r\n    -ms-user-select: none; /* Internet Explorer/Edge */\r\n    user-select: none;\r\n    pointer-events: none;\r\n}\r\n\r\n.CanvasToolsEditor #konvaContainer {\r\n    position: relative;\r\n    grid-row: 1;\r\n    grid-column: 1;\r\n    width: 100%;\r\n    height: 100%;\r\n}\r\n\r\n.CanvasToolsEditor #konvaWrapper {\r\n    position: relative;\r\n    grid-row: 1;\r\n    grid-column: 1;\r\n    width: 100%;\r\n    height: 100%;\r\n    overflow: hidden;\r\n}\r\n\r\n.konvajs-content canvas {\r\n    opacity: 0.5;\r\n}\r\n\r\n.CanvasToolsContainer {\r\n    overflow: auto;\r\n    height: 100%;\r\n    width: 100%;\r\n}\r\n\r\n.CanvasToolsContainer:focus {\r\n    outline: none;\r\n}\r\n\r\n/* 2. RegionsManager\r\n\r\n.regionManager\r\n--\x3e.regionStyle\r\n    --\x3e .tagsLayer\r\n    --\x3e .dragLayer\r\n    --\x3e .anchorsLayer\r\n    \r\n--\x3e .menuLayer\r\n    --\x3e .menuRectStyle\r\n*/\r\n\r\n/* 2.1. General settings and layout */\r\n.regionManager {\r\n    pointer-events: none;\r\n}\r\n\r\n.regionStyle {\r\n    pointer-events: visiblePainted;\r\n}\r\n\r\n.dragRectStyle {\r\n    fill: transparent; \r\n    stroke-width: 0;\r\n    pointer-events: all;\r\n    cursor: var(--cursor-move);\r\n}\r\n\r\n.dragPointStyle {\r\n    stroke-width: 0;\r\n    pointer-events: all;\r\n    cursor: var(--cursor-move);\r\n    filter: url(#black-glow);\r\n}\r\n\r\n.tagsLayer {\r\n    pointer-events: none;\r\n}\r\n\r\n.primaryTagRectStyle {\r\n    stroke-width: 2;\r\n    stroke-dasharray: 0.5 4;\r\n    stroke-linecap: round;\r\n    filter: url(#black-glow);\r\n}\r\n\r\n.primaryTagPointStyle {\r\n    stroke-width: 1; \r\n}\r\n\r\n.primaryTagTextStyle {\r\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n    font-size: 9pt;\r\n    fill: #fff;\r\n    -moz-user-select: none; /* Firefox */\r\n    -ms-user-select: none; /* Internet Explorer/Edge */\r\n    user-select: none;\r\n    pointer-events: none;\r\n}\r\n\r\n.primaryTagTextStyle::selection {\r\n    background: none;\r\n    fill: #fff;\r\n}\r\n\r\n.secondaryTagStyle {\r\n    stroke-width: 0;\r\n    pointer-events: none;\r\n}\r\n\r\n.midpointStyle {\r\n    stroke-width: 2;\r\n}\r\n\r\n.bezierControlPointTangentStyle,\r\n.bezierControlPointStyle {\r\n    stroke-width: 2;\r\n}\r\n\r\n.anchorStyle {\r\n    stroke-width: 2;\r\n}\r\n\r\n.anchorStyle.ghost {\r\n    cursor: var(--cursor-resize);\r\n}\r\n\r\n.anchorStyle.ghost.delete {\r\n    cursor: var(--cursor-delete);\r\n}\r\n\r\n.anchorStyle.ghost.add {\r\n    cursor: var(--cursor-add);\r\n}\r\n\r\n.anchorStyle.ghost {\r\n    stroke-width: 0;\r\n}\r\n\r\n.primaryTagBoundRectStyle {\r\n    stroke-width: 2;\r\n}\r\n\r\n.primaryTagPolylineStyle, .primaryTagPolygonStyle {\r\n    stroke-width: 2;\r\n    stroke-linecap: round;\r\n    stroke-dasharray: 0.5 4;\r\n}\r\n\r\n/* 2.2. Default colors */\r\n.regionManager {\r\n    --default-color-pure: rgb(128, 128, 128);\r\n    --default-color-accent: rgba(128, 128, 128, 0.8);\r\n    --default-color-dark: rgba(64, 64, 64, 0.8);\r\n    --default-color-shadow: rgba(128, 128, 128, 0.4);\r\n    --default-color-highlight: rgba(128, 128, 128, 0.2);\r\n    --default-color-white: rgb(255, 255, 255);\r\n    --default-color-transparent: rgba(255, 255, 255, 0);\r\n    --default-color-ghost: rgba(255, 255, 255, 0.5);\r\n    --default-color-delete: rgba(216, 24, 65, 1.0);\r\n    --default-color-add: rgba(21, 127, 240, 1.0);\r\n    --default-color-control: rgb(253, 128, 45);\r\n}\r\n\r\n/* 2.2.1. Shared colors */\r\n.secondaryTagStyle {\r\n    fill: var(--default-color-accent);\r\n}\r\n\r\n.midpointStyle {\r\n    stroke: none;\r\n    fill: none;\r\n}\r\n\r\n.bezierControlPointTangentStyle,\r\n.bezierControlPointStyle {\r\n    stroke: none;\r\n    fill: none;\r\n}\r\n\r\n.anchorStyle {\r\n    stroke: var(--default-color-dark);\r\n    fill: var(--default-color-pure);\r\n}\r\n\r\n.regionStyle:hover .anchorStyle {\r\n    stroke: var(--default-color-white);\r\n}\r\n\r\n.regionStyle:hover .midpointStyle {\r\n    stroke: var(--default-color-white);\r\n    fill: var(--default-color-white);\r\n}\r\n\r\n.regionStyle:hover .midpointStyle:hover {\r\n    stroke: var(--default-color-accent);\r\n}\r\n\r\n.regionStyle.selected .bezierControlPointTangentStyle,\r\n.regionStyle:hover .bezierControlPointTangentStyle {\r\n    stroke: var(--default-color-control);\r\n    stroke-dasharray: 4;\r\n}\r\n\r\n.regionStyle.selected .bezierControlPointStyle,\r\n.regionStyle:hover .bezierControlPointStyle {\r\n    stroke: var(--default-color-control);\r\n    fill: var(--default-color-pure);\r\n}\r\n\r\n.regionStyle.selected .bezierControlPointStyle:hover,\r\n.regionStyle:hover .bezierControlPointStyle:hover {\r\n    cursor: var(--cursor-resize);\r\n    stroke: var(--default-color-control);\r\n    fill: var(--default-color-control);\r\n}\r\n\r\n.anchorStyle.ghost,\r\n.anchorStyle.ghost:hover,\r\n.regionStyle.selected .anchorStyle.ghost,\r\n.regionStyle.selected .anchorStyle.ghost:hover {\r\n    fill: var(--default-color-ghost);\r\n}\r\n\r\n.anchorStyle:hover {\r\n    stroke: var(--default-color-white);\r\n}\r\n\r\n/* 2.2.2. Rect region colors */\r\n.primaryTagRectStyle {\r\n    fill: var(--default-color-shadow);\r\n    stroke:var(--default-color-accent);\r\n}\r\n\r\n.regionStyle:hover .primaryTagRectStyle {\r\n    fill: var(--default-color-highlight);\r\n    stroke: var(--default-color-white);\r\n}\r\n\r\n.regionStyle.selected .primaryTagRectStyle {\r\n    fill: var(--default-color-highlight);\r\n    stroke-dasharray: none;\r\n}\r\n\r\n.primaryTagTextBGStyle {\r\n    fill: var(--default-color-dark);\r\n}\r\n\r\n.anchorBoneStyle {\r\n    fill: var(--default-color-transparent);\r\n}\r\n\r\n/* 2.2.3. Point region  colors */\r\n.primaryTagPointStyle {\r\n    fill: var(--default-color-pure);\r\n    stroke:var(--default-color-white);\r\n}\r\n\r\n.dragPointStyle {\r\n    fill: var(--default-color-ghost);\r\n    opacity: 0.5;\r\n}\r\n\r\n.regionStyle:hover .dragPointStyle,\r\n.regionStyle.selected .dragPointStyle {\r\n    fill: var(--default-color-ghost);\r\n    opacity: 1.0;\r\n}\r\n\r\n/* 2.2.4. Polyline, polygon region colors */\r\n.primaryTagBoundRectStyle {\r\n    fill: var(--default-color-shadow);\r\n    stroke:var(--default-color-accent);\r\n    opacity: 0.25;\r\n}\r\n\r\n.regionStyle.selected .primaryTagBoundRectStyle {\r\n    fill: var(--default-color-highlight);\r\n    opacity: 1;\r\n}\r\n\r\n.regionStyle:hover .primaryTagBoundRectStyle {\r\n    fill: var(--default-color-highlight);\r\n    stroke: var(--default-color-white);\r\n    opacity: 0.75;\r\n}\r\n\r\n.primaryTagPolylineStyle {\r\n    fill: var(--default-color-transparent);\r\n    stroke: var(--default-color-pure);\r\n}\r\n\r\n.regionStyle.selected .primaryTagPolylineStyle {\r\n    filter: url(#black-glow);\r\n    stroke-dasharray: none;\r\n}\r\n\r\n.primaryTagPolygonStyle {\r\n    fill: var(--default-color-shadow);\r\n    stroke: var(--default-color-pure);\r\n}\r\n\r\n.regionStyle.selected .primaryTagPolygonStyle {\r\n    fill: var(--default-color-highlight);\r\n    filter: url(#black-glow);\r\n    stroke-dasharray: none;\r\n}\r\n\r\n.regionStyle:hover .primaryTagPolygonStyle {\r\n    fill: var(--default-color-highlight);\r\n}\r\n\r\n.regionStyle:hover .anchorStyle.ghost.delete,\r\n.regionStyle.selected .anchorStyle.ghost.delete,\r\n.anchorStyle.ghost.delete,\r\n.anchorStyle.ghost.delete:hover {\r\n    stroke: var(--default-color-delete);\r\n    stroke-width: 2px;\r\n    fill: var(--default-color-transparent);\r\n}\r\n\r\n.regionStyle:hover .anchorStyle.ghost.add,\r\n.regionStyle.selected .anchorStyle.ghost.add,\r\n.anchorStyle.ghost.add,\r\n.anchorStyle.ghost.add:hover {\r\n    stroke: var(--default-color-add);\r\n    stroke-width: 2px;\r\n    fill: var(--default-color-transparent);\r\n}\r\n\r\n.anchorLineStyle {\r\n    fill: none;\r\n    stroke-width: 5;\r\n    stroke: var(--default-color-transparent);  \r\n}\r\n\r\nsvg:not(:root) .menuLayer {\r\n    overflow: visible;\r\n}\r\n\r\n.menuRectStyle { \r\n    stroke-width:0;\r\n    fill: #000;\r\n    filter: url(#black-glow); \r\n}\r\n\r\n.menuItemBack {\r\n    stroke-width: 1.5;\r\n    stroke: rgba(198, 198, 198, 0.2);\r\n    fill:  #000;\r\n}\r\n\r\n.menuIcon {\r\n    font-family: 'Segoe UI Emoji', Tahoma, Geneva, Verdana, sans-serif;\r\n    font-size: 10pt;\r\n    fill: #fff;\r\n}\r\n\r\n.menuItem {\r\n    stroke-width: 1.5;\r\n    stroke: #fff;\r\n    fill:transparent;\r\n}\r\n\r\n.menuItem:hover {\r\n    stroke: #157ff0;\r\n}\r\n\r\n/* Freezing regions */ \r\n\r\n.regionManager.frozen .regionStyle.old,\r\n.regionManager.frozen .regionStyle.old .dragRectStyle,\r\n.regionManager.frozen .regionStyle.old .dragPointStyle {\r\n    pointer-events: none;\r\n}\r\n\r\n.regionManager.frozen .regionStyle.old .dragRectStyle, \r\n.regionManager.frozen .regionStyle.old .anchorStyle.TL, \r\n.regionManager.frozen .regionStyle.old .anchorStyle.BR, \r\n.regionManager.frozen .regionStyle.old .anchorStyle.TR, \r\n.regionManager.frozen .regionStyle.old .anchorStyle.BL {\r\n    cursor: default; \r\n}\r\n\r\n.regionManager.frozen .anchorStyle.ghost {\r\n    display: none;\r\n}\r\n\r\n.regionManager.frozen .regionStyle.old, \r\n.regionManager.frozen .regionStyle.old:hover{\r\n    opacity: 0.5;\r\n}\r\n\r\n.regionManager.frozen .regionStyle.old .primaryTagRectStyle,\r\n.regionManager.frozen .regionStyle.old .primaryTagPointStyle,\r\n.regionManager.frozen .regionStyle.old .primaryTagPolylineStyle,\r\n.regionManager.frozen .regionStyle.old .primaryTagPolygonStyle {\r\n    stroke-width: 1;\r\n    stroke-dasharray: 0 0;\r\n}\r\n\r\n.regionManager.frozen .regionStyle.old .anchorStyle {\r\n    display: none;\r\n}\r\n\r\n.regionManager.frozen .regionStyle.old .primaryTagTextStyle,\r\n.regionManager.frozen .regionStyle.old .primaryTagTextBGStyle {\r\n    opacity: 0.25;\r\n}\r\n\r\n/* AreaSelector\r\n\r\n.areaSelector\r\n--\x3e.rectSelector\r\n    --\x3e .maskStyle\r\n        [mask]\r\n            .maskInStyle\r\n            .maskOutStyle\r\n        .crossStyle\r\n            line\r\n            line\r\n--\x3e.rectCopySelector\r\n    --\x3e .crossStyle\r\n            line\r\n            line\r\n        .copyRectStyle\r\n--\x3e.pointSelector\r\n    --\x3e .crossStyle\r\n        .pointStyle\r\n--\x3e.polylineSelector\r\n    --\x3e .polylineStyle\r\n        .polylineGroupStyle\r\n        --\x3e .polylinePointStyle\r\n        .nextSegmentStyle\r\n        .nextPointStyle\r\n--\x3e.polygonSelector\r\n    --\x3e .polygonStyle\r\n        .polygonGroupStyle\r\n        --\x3e .polygonPointStyle\r\n        .nextSegmentStyle\r\n        .nextPointStyle\r\n*/\r\n\r\n#selectionOverlay {\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n    pointer-events: none;\r\n}\r\n\r\n.crossStyle line {\r\n    stroke-width:1;\r\n    stroke-dasharray: 3 3;\r\n    stroke: #666;\r\n    pointer-events: none; \r\n}\r\n\r\n.crossStyle .blackDashes {\r\n    stroke-width:3;\r\n    stroke-dasharray: 3 3;\r\n    stroke: #000;\r\n    pointer-events: none; \r\n}\r\n\r\n.crossStyle .whiteDashes {\r\n    stroke-width:3;\r\n    stroke-dasharray: 0 3 0;\r\n    stroke: #fff;\r\n    pointer-events: none; \r\n}\r\n\r\n.selectionBoxStyle {\r\n    fill: #fff;\r\n    fill-opacity: 0.25;\r\n    stroke-width: 0;\r\n    pointer-events: none;\r\n}\r\n\r\n.rectCopySelector .copyRectStyle {\r\n    stroke-width:3;\r\n    stroke: #000;\r\n    fill: transparent;\r\n    pointer-events: none; \r\n}\r\n\r\n.pointSelector .pointStyle {\r\n    stroke-width:2;\r\n    stroke: rgba(21, 127, 240, 1.0);\r\n    fill: transparent;\r\n    pointer-events: none; \r\n}\r\n\r\n.polylineSelector .polylineStyle {\r\n    fill: transparent;\r\n    stroke-width: 2px;\r\n    stroke:  rgba(21, 127, 240, 0.5);\r\n    pointer-events: none;\r\n}\r\n\r\n.polylineSelector .polylinePointStyle {\r\n    fill:  rgba(21, 127, 240, 1.0);\r\n    stroke-width: 0;\r\n    pointer-events: none;\r\n}\r\n\r\n.polylineSelector .nextSegmentStyle {\r\n    stroke-width:2;\r\n    stroke-dasharray: 3 3;\r\n    stroke: rgba(21, 127, 240, 1.0);\r\n    pointer-events: none;\r\n}\r\n.polylineSelector .nextPointStyle {\r\n    stroke-width:2;\r\n    r: 6px;\r\n    stroke: rgba(21, 127, 240, 1.0);\r\n    fill: transparent;\r\n    pointer-events: none;\r\n}\r\n\r\n.polygonSelector .polygonStyle {\r\n    fill: rgba(255,255,255, 0.2);\r\n    stroke-width: 2px;\r\n    stroke:  rgba(21, 127, 240, 0.5);\r\n    pointer-events: none;\r\n}\r\n\r\n.polygonSelector .polygonPointStyle {\r\n    fill:  rgba(21, 127, 240, 1.0);\r\n    stroke-width: 0;\r\n    pointer-events: none;\r\n}\r\n\r\n.polygonSelector .nextSegmentStyle {\r\n    stroke-width:2;\r\n    stroke-dasharray: 3 3;\r\n    stroke: rgba(21, 127, 240, 1.0);\r\n    pointer-events: none;\r\n}\r\n.polygonSelector .nextPointStyle {\r\n    stroke-width:2;\r\n    r: 6px;\r\n    stroke: rgba(21, 127, 240, 1.0);\r\n    fill: transparent;\r\n    pointer-events: none;\r\n}\r\n\r\n/* Toolbar \r\n\r\n.toolbarLayer\r\n--\x3e .toolbarBGStyle\r\n--\x3e .iconsLayerStyle\r\n    --\x3e .iconStyle\r\n        --\x3e .iconBGRectStyle\r\n            .iconImageStyle\r\n*/\r\n.toolbarBGStyle {\r\n    fill: #000;\r\n}\r\n\r\n.iconStyle {\r\n    pointer-events: all;\r\n}\r\n\r\n.iconStyle.selector .iconBGRectStyle{\r\n    fill: transparent;\r\n}\r\n\r\n.iconStyle.selector:hover .iconBGRectStyle {\r\n    fill: #157ff0;\r\n}\r\n\r\n.iconStyle.selector.selected .iconBGRectStyle {\r\n    fill: #157ff0;\r\n}\r\n\r\n.iconStyle .iconImageStyle * {\r\n    stroke: #fff;\r\n}\r\n\r\n\r\n.iconStyle.switch .iconBGRectStyle{\r\n    fill: transparent;\r\n}\r\n\r\n.iconStyle.switch:hover .iconBGRectStyle{\r\n    fill: #157ff0;\r\n}\r\n\r\n.iconStyle.switch .iconImageStyle * {\r\n    stroke: #fff;\r\n}\r\n\r\n.iconStyle.switch.selected .iconImageStyle * {\r\n    stroke: rgb(14, 186, 253);\r\n    stroke-width: 1.5;\r\n}\r\n\r\n.iconStyle .iconImageStyle .accent-f {\r\n    fill: rgba(21, 127, 240, 1.0);\r\n}\r\n\r\n.iconStyle .iconImageStyle .accent-s {\r\n    stroke: rgba(21, 127, 240, 1.0);\r\n}\r\n\r\n.iconStyle.separator line {\r\n    stroke: #fff;\r\n    stroke-width: 0.5px;\r\n}\r\n\r\n/* Announcer */\r\n#regionAnnouncer {\r\n    position: absolute !important;\r\n    height: 0px; \r\n    width: 0px;\r\n    overflow: hidden;\r\n    clip: rect(0px, 0px, 0px, 0px);\r\n    clip-path: polygon(0px 0px, 0px 0px, 0px 0px);\r\n    -webkit-clip-path: polygon(0px 0px, 0px 0px, 0px 0px);\r\n    white-space: nowrap;\r\n}",""])},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",n=t[3];if(!n)return i;if(e&&"function"==typeof btoa){var r=(o=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),s=n.sources.map((function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"}));return[i].concat(s).concat([r]).join("\n")}var o;return[i].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+i+"}":i})).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},r=0;r<this.length;r++){var s=this[r][0];"number"==typeof s&&(n[s]=!0)}for(r=0;r<t.length;r++){var o=t[r];"number"==typeof o[0]&&n[o[0]]||(i&&!o[2]?o[2]=i:i&&(o[2]="("+o[2]+") and ("+i+")"),e.push(o))}},e}},function(t,e,i){var n,r,s={},o=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===r&&(r=n.apply(this,arguments)),r}),a=function(t,e){return e?e.querySelector(t):document.querySelector(t)},h=function(t){var e={};return function(t,i){if("function"==typeof t)return t();if(void 0===e[t]){var n=a.call(this,t,i);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),l=null,c=0,d=[],g=i(80);function u(t,e){for(var i=0;i<t.length;i++){var n=t[i],r=s[n.id];if(r){r.refs++;for(var o=0;o<r.parts.length;o++)r.parts[o](n.parts[o]);for(;o<n.parts.length;o++)r.parts.push(b(n.parts[o],e))}else{var a=[];for(o=0;o<n.parts.length;o++)a.push(b(n.parts[o],e));s[n.id]={id:n.id,refs:1,parts:a}}}}function p(t,e){for(var i=[],n={},r=0;r<t.length;r++){var s=t[r],o=e.base?s[0]+e.base:s[0],a={css:s[1],media:s[2],sourceMap:s[3]};n[o]?n[o].parts.push(a):i.push(n[o]={id:o,parts:[a]})}return i}function f(t,e){var i=h(t.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=d[d.length-1];if("top"===t.insertAt)n?n.nextSibling?i.insertBefore(e,n.nextSibling):i.appendChild(e):i.insertBefore(e,i.firstChild),d.push(e);else if("bottom"===t.insertAt)i.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var r=h(t.insertAt.before,i);i.insertBefore(e,r)}}function y(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=d.indexOf(t);e>=0&&d.splice(e,1)}function m(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var n=function(){0;return i.nc}();n&&(t.attrs.nonce=n)}return v(e,t.attrs),f(t,e),e}function v(t,e){Object.keys(e).forEach((function(i){t.setAttribute(i,e[i])}))}function b(t,e){var i,n,r,s;if(e.transform&&t.css){if(!(s="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=s}if(e.singleton){var o=c++;i=l||(l=m(e)),n=w.bind(null,i,o,!1),r=w.bind(null,i,o,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",v(e,t.attrs),f(t,e),e}(e),n=A.bind(null,i,e),r=function(){y(i),i.href&&URL.revokeObjectURL(i.href)}):(i=m(e),n=C.bind(null,i),r=function(){y(i)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else r()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=o()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var i=p(t,e);return u(i,e),function(t){for(var n=[],r=0;r<i.length;r++){var o=i[r];(a=s[o.id]).refs--,n.push(a)}t&&u(p(t,e),e);for(r=0;r<n.length;r++){var a;if(0===(a=n[r]).refs){for(var h=0;h<a.parts.length;h++)a.parts[h]();delete s[a.id]}}}};var S,x=(S=[],function(t,e){return S[t]=e,S.filter(Boolean).join("\n")});function w(t,e,i,n){var r=i?"":n.css;if(t.styleSheet)t.styleSheet.cssText=x(e,r);else{var s=document.createTextNode(r),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(s,o[e]):t.appendChild(s)}}function C(t,e){var i=e.css,n=e.media;if(n&&t.setAttribute("media",n),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}function A(t,e,i){var n=i.css,r=i.sourceMap,s=void 0===e.convertToAbsoluteUrls&&r;(e.convertToAbsoluteUrls||s)&&(n=g(n)),r&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var o=new Blob([n],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(o),a&&URL.revokeObjectURL(a)}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var i=e.protocol+"//"+e.host,n=i+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,e){var r,s=e.trim().replace(/^"(.*)"$/,(function(t,e){return e})).replace(/^'(.*)'$/,(function(t,e){return e}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(s)?t:(r=0===s.indexOf("//")?s:0===s.indexOf("/")?i+s:n+s.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")}))}},function(t,e,i){"use strict";i.r(e);var n=i(0);class r{constructor(t=[1,0,0,1,0,0]){this.dirty=!1,this.m=t&&t.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new r(this.m)}copyInto(t){t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5]}point(t){var e=this.m;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}}translate(t,e){return this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e,this}scale(t,e){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e,this}rotate(t){var e=Math.cos(t),i=Math.sin(t),n=this.m[0]*e+this.m[2]*i,r=this.m[1]*e+this.m[3]*i,s=this.m[0]*-i+this.m[2]*e,o=this.m[1]*-i+this.m[3]*e;return this.m[0]=n,this.m[1]=r,this.m[2]=s,this.m[3]=o,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(t,e){var i=this.m[0]+this.m[2]*e,n=this.m[1]+this.m[3]*e,r=this.m[2]+this.m[0]*t,s=this.m[3]+this.m[1]*t;return this.m[0]=i,this.m[1]=n,this.m[2]=r,this.m[3]=s,this}multiply(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],i=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],r=this.m[1]*t.m[2]+this.m[3]*t.m[3],s=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],o=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=r,this.m[4]=s,this.m[5]=o,this}invert(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,i=-this.m[1]*t,n=-this.m[2]*t,r=this.m[0]*t,s=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),o=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=r,this.m[4]=s,this.m[5]=o,this}getMatrix(){return this.m}decompose(){var t=this.m[0],e=this.m[1],i=this.m[2],n=this.m[3],r=t*n-e*i;let s={x:this.m[4],y:this.m[5],rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(0!=t||0!=e){var o=Math.sqrt(t*t+e*e);s.rotation=e>0?Math.acos(t/o):-Math.acos(t/o),s.scaleX=o,s.scaleY=r/o,s.skewX=(t*i+e*n)/r,s.skewY=0}else if(0!=i||0!=n){var a=Math.sqrt(i*i+n*n);s.rotation=Math.PI/2-(n>0?Math.acos(-i/a):-Math.acos(i/a)),s.scaleX=r/a,s.scaleY=a,s.skewX=0,s.skewY=(t*i+e*n)/r}return s.rotation=d._getRotation(s.rotation),s}}var s=Math.PI/180,o=180/Math.PI,a={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},h=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,l=[];const c="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||function(t){setTimeout(t,60)},d={_isElement:t=>!(!t||1!=t.nodeType),_isFunction:t=>!!(t&&t.constructor&&t.call&&t.apply),_isPlainObject:t=>!!t&&t.constructor===Object,_isArray:t=>"[object Array]"===Object.prototype.toString.call(t),_isNumber:t=>"[object Number]"===Object.prototype.toString.call(t)&&!isNaN(t)&&isFinite(t),_isString:t=>"[object String]"===Object.prototype.toString.call(t),_isBoolean:t=>"[object Boolean]"===Object.prototype.toString.call(t),isObject:t=>t instanceof Object,isValidSelector(t){if("string"!=typeof t)return!1;var e=t[0];return"#"===e||"."===e||e===e.toUpperCase()},_sign:t=>0===t||t>0?1:-1,requestAnimFrame(t){l.push(t),1===l.length&&c((function(){const t=l;l=[],t.forEach((function(t){t()}))}))},createCanvasElement(){var t=document.createElement("canvas");try{t.style=t.style||{}}catch(t){}return t},createImageElement:()=>document.createElement("img"),_isInDocument(t){for(;t=t.parentNode;)if(t==document)return!0;return!1},_urlToImage(t,e){var i=d.createImageElement();i.onload=function(){e(i)},i.src=t},_rgbToHex:(t,e,i)=>((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1),_hexToRgb(t){t=t.replace("#","");var e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e}},getRandomColor(){for(var t=(16777215*Math.random()<<0).toString(16);t.length<6;)t="0"+t;return"#"+t},getRGB(t){var e;return t in a?{r:(e=a[t])[0],g:e[1],b:e[2]}:"#"===t[0]?this._hexToRgb(t.substring(1)):"rgb("===t.substr(0,4)?(e=h.exec(t.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},colorToRGBA:t=>(t=t||"black",d._namedColorToRBA(t)||d._hex3ColorToRGBA(t)||d._hex4ColorToRGBA(t)||d._hex6ColorToRGBA(t)||d._hex8ColorToRGBA(t)||d._rgbColorToRGBA(t)||d._rgbaColorToRGBA(t)||d._hslColorToRGBA(t)),_namedColorToRBA(t){var e=a[t.toLowerCase()];return e?{r:e[0],g:e[1],b:e[2],a:1}:null},_rgbColorToRGBA(t){if(0===t.indexOf("rgb(")){var e=(t=t.match(/rgb\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:1}}},_rgbaColorToRGBA(t){if(0===t.indexOf("rgba(")){var e=(t=t.match(/rgba\(([^)]+)\)/)[1]).split(/ *, */).map((t,e)=>"%"===t.slice(-1)?3===e?parseInt(t)/100:parseInt(t)/100*255:Number(t));return{r:e[0],g:e[1],b:e[2],a:e[3]}}},_hex8ColorToRGBA(t){if("#"===t[0]&&9===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:parseInt(t.slice(7,9),16)/255}},_hex6ColorToRGBA(t){if("#"===t[0]&&7===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:1}},_hex4ColorToRGBA(t){if("#"===t[0]&&5===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:parseInt(t[4]+t[4],16)/255}},_hex3ColorToRGBA(t){if("#"===t[0]&&4===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1}},_hslColorToRGBA(t){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(t)){const[e,...i]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t),n=Number(i[0])/360,r=Number(i[1])/100,s=Number(i[2])/100;let o,a,h;if(0===r)return h=255*s,{r:Math.round(h),g:Math.round(h),b:Math.round(h),a:1};o=s<.5?s*(1+r):s+r-s*r;const l=2*s-o,c=[0,0,0];for(let t=0;t<3;t++)a=n+1/3*-(t-1),a<0&&a++,a>1&&a--,h=6*a<1?l+6*(o-l)*a:2*a<1?o:3*a<2?l+(o-l)*(2/3-a)*6:l,c[t]=255*h;return{r:Math.round(c[0]),g:Math.round(c[1]),b:Math.round(c[2]),a:1}}},haveIntersection:(t,e)=>!(e.x>t.x+t.width||e.x+e.width<t.x||e.y>t.y+t.height||e.y+e.height<t.y),cloneObject(t){var e={};for(var i in t)this._isPlainObject(t[i])?e[i]=this.cloneObject(t[i]):this._isArray(t[i])?e[i]=this.cloneArray(t[i]):e[i]=t[i];return e},cloneArray:t=>t.slice(0),degToRad:t=>t*s,radToDeg:t=>t*o,_degToRad:t=>(d.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),d.degToRad(t)),_radToDeg:t=>(d.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),d.radToDeg(t)),_getRotation:t=>n.a.angleDeg?d.radToDeg(t):t,_capitalize:t=>t.charAt(0).toUpperCase()+t.slice(1),throw(t){throw new Error("Konva error: "+t)},error(t){console.error("Konva error: "+t)},warn(t){n.a.showWarnings&&console.warn("Konva warning: "+t)},each(t,e){for(var i in t)e(i,t[i])},_inRange:(t,e,i)=>e<=t&&t<i,_getProjectionToSegment(t,e,i,n,r,s){var o,a,h,l=(t-i)*(t-i)+(e-n)*(e-n);if(0==l)o=t,a=e,h=(r-i)*(r-i)+(s-n)*(s-n);else{var c=((r-t)*(i-t)+(s-e)*(n-e))/l;c<0?(o=t,a=e,h=(t-r)*(t-r)+(e-s)*(e-s)):c>1?(o=i,a=n,h=(i-r)*(i-r)+(n-s)*(n-s)):h=((o=t+c*(i-t))-r)*(o-r)+((a=e+c*(n-e))-s)*(a-s)}return[o,a,h]},_getProjectionToLine(t,e,i){var n=d.cloneObject(t),r=Number.MAX_VALUE;return e.forEach((function(s,o){if(i||o!==e.length-1){var a=e[(o+1)%e.length],h=d._getProjectionToSegment(s.x,s.y,a.x,a.y,t.x,t.y),l=h[0],c=h[1],g=h[2];g<r&&(n.x=l,n.y=c,r=g)}})),n},_prepareArrayForTween(t,e,i){var n,r=[],s=[];if(t.length>e.length){var o=e;e=t,t=o}for(n=0;n<t.length;n+=2)r.push({x:t[n],y:t[n+1]});for(n=0;n<e.length;n+=2)s.push({x:e[n],y:e[n+1]});var a=[];return s.forEach((function(t){var e=d._getProjectionToLine(t,r,i);a.push(e.x),a.push(e.y)})),a},_prepareToStringify(t){var e;for(var i in t.visitedByCircularReferenceRemoval=!0,t)if(t.hasOwnProperty(i)&&t[i]&&"object"==typeof t[i])if(e=Object.getOwnPropertyDescriptor(t,i),t[i].visitedByCircularReferenceRemoval||d._isElement(t[i])){if(!e.configurable)return null;delete t[i]}else if(null===d._prepareToStringify(t[i])){if(!e.configurable)return null;delete t[i]}return delete t.visitedByCircularReferenceRemoval,t},_assign(t,e){for(var i in e)t[i]=e[i];return t},_getFirstPointerId:t=>t.touches?t.changedTouches[0].identifier:t.pointerId||999,releaseCanvas(...t){n.a.releaseCanvasOnDestroy&&t.forEach(t=>{t.width=0,t.height=0})},drawRoundedRectPath(t,e,i,n){let r=0,s=0,o=0,a=0;"number"==typeof n?r=s=o=a=Math.min(n,e/2,i/2):(r=Math.min(n[0]||0,e/2,i/2),s=Math.min(n[1]||0,e/2,i/2),a=Math.min(n[2]||0,e/2,i/2),o=Math.min(n[3]||0,e/2,i/2)),t.moveTo(r,0),t.lineTo(e-s,0),t.arc(e-s,s,s,3*Math.PI/2,0,!1),t.lineTo(e,i-a),t.arc(e-a,i-a,a,0,Math.PI/2,!1),t.lineTo(o,i),t.arc(o,i-o,o,Math.PI/2,Math.PI,!1),t.lineTo(0,r),t.arc(r,r,r,Math.PI,3*Math.PI/2,!1)}};function g(t){return d._isString(t)?'"'+t+'"':"[object Number]"===Object.prototype.toString.call(t)||d._isBoolean(t)?t:Object.prototype.toString.call(t)}function u(t){return t>255?255:t<0?0:Math.round(t)}function p(){if(n.a.isUnminified)return function(t,e){return d._isNumber(t)||d.warn(g(t)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),t}}function f(t){if(n.a.isUnminified)return function(e,i){let n=d._isNumber(e),r=d._isArray(e)&&e.length==t;return n||r||d.warn(g(e)+' is a not valid value for "'+i+'" attribute. The value should be a number or Array<number>('+t+")"),e}}function y(){if(n.a.isUnminified)return function(t,e){return d._isNumber(t)||"auto"===t||d.warn(g(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),t}}function m(){if(n.a.isUnminified)return function(t,e){return d._isString(t)||d.warn(g(t)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),t}}function v(){if(n.a.isUnminified)return function(t,e){const i=d._isString(t),n="[object CanvasGradient]"===Object.prototype.toString.call(t)||t&&t.addColorStop;return i||n||d.warn(g(t)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),t}}function b(){if(n.a.isUnminified)return function(t,e){return!0===t||!1===t||d.warn(g(t)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),t}}const S={addGetterSetter(t,e,i,n,r){S.addGetter(t,e,i),S.addSetter(t,e,n,r),S.addOverloadedGetterSetter(t,e)},addGetter(t,e,i){var n="get"+d._capitalize(e);t.prototype[n]=t.prototype[n]||function(){var t=this.attrs[e];return void 0===t?i:t}},addSetter(t,e,i,n){var r="set"+d._capitalize(e);t.prototype[r]||S.overWriteSetter(t,e,i,n)},overWriteSetter(t,e,i,n){var r="set"+d._capitalize(e);t.prototype[r]=function(t){return i&&null!=t&&(t=i.call(this,t,e)),this._setAttr(e,t),n&&n.call(this),this}},addComponentsGetterSetter(t,e,i,r,s){var o,a,h=i.length,l=d._capitalize,c="get"+l(e),u="set"+l(e);t.prototype[c]=function(){var t={};for(o=0;o<h;o++)t[a=i[o]]=this.getAttr(e+l(a));return t};var p=function(t){if(n.a.isUnminified)return function(e,i){return null==e||d.isObject(e)||d.warn(g(e)+' is a not valid value for "'+i+'" attribute. The value should be an object with properties '+t),e}}(i);t.prototype[u]=function(t){var n,o=this.attrs[e];for(n in r&&(t=r.call(this,t)),p&&p.call(this,t,e),t)t.hasOwnProperty(n)&&this._setAttr(e+l(n),t[n]);return t||i.forEach(t=>{this._setAttr(e+l(t),void 0)}),this._fireChangeEvent(e,o,t),s&&s.call(this),this},S.addOverloadedGetterSetter(t,e)},addOverloadedGetterSetter(t,e){var i=d._capitalize(e),n="set"+i,r="get"+i;t.prototype[e]=function(){return arguments.length?(this[n](arguments[0]),this):this[r]()}},addDeprecatedGetterSetter(t,e,i,n){d.error("Adding deprecated "+e);var r="get"+d._capitalize(e),s=e+" property is deprecated and will be removed soon. Look at Konva change log for more information.";t.prototype[r]=function(){d.error(s);var t=this.attrs[e];return void 0===t?i:t},S.addSetter(t,e,n,(function(){d.error(s)})),S.addOverloadedGetterSetter(t,e)},backCompat(t,e){d.each(e,(function(e,i){var n=t.prototype[i],r="get"+d._capitalize(e),s="set"+d._capitalize(e);function o(){n.apply(this,arguments),d.error('"'+e+'" method is deprecated and will be removed soon. Use ""'+i+'" instead.')}t.prototype[e]=o,t.prototype[r]=o,t.prototype[s]=o}))},afterSetFilter(){this._filterUpToDate=!1}};function x(t){var e,i,n=[],r=t.length,s=d;for(e=0;e<r;e++)i=t[e],s._isNumber(i)?i=Math.round(1e3*i)/1e3:s._isString(i)||(i+=""),n.push(i);return n}var w=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];class C{constructor(t){this.canvas=t,n.a.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(t){t.fillEnabled()&&this._fill(t)}_fill(t){}strokeShape(t){t.hasStroke()&&this._stroke(t)}_stroke(t){}fillStrokeShape(t){t.attrs.fillAfterStrokeEnabled?(this.strokeShape(t),this.fillShape(t)):(this.fillShape(t),this.strokeShape(t))}getTrace(t,e){var i,n,r,s,o=this.traceArr,a=o.length,h="";for(i=0;i<a;i++)(r=(n=o[i]).method)?(s=n.args,h+=r,t?h+="()":d._isArray(s[0])?h+="(["+s.join(",")+"])":(e&&(s=s.map(t=>"number"==typeof t?Math.floor(t):t)),h+="("+s.join(",")+")")):(h+=n.property,t||(h+="="+n.val)),h+=";";return h}clearTrace(){this.traceArr=[]}_trace(t){var e=this.traceArr;e.push(t),e.length>=100&&e.shift()}reset(){var t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)}getCanvas(){return this.canvas}clear(t){var e=this.getCanvas();t?this.clearRect(t.x||0,t.y||0,t.width||0,t.height||0):this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)}_applyLineCap(t){var e=t.getLineCap();e&&this.setAttr("lineCap",e)}_applyOpacity(t){var e=t.getAbsoluteOpacity();1!==e&&this.setAttr("globalAlpha",e)}_applyLineJoin(t){var e=t.attrs.lineJoin;e&&this.setAttr("lineJoin",e)}setAttr(t,e){this._context[t]=e}arc(t,e,i,n,r,s){this._context.arc(t,e,i,n,r,s)}arcTo(t,e,i,n,r){this._context.arcTo(t,e,i,n,r)}beginPath(){this._context.beginPath()}bezierCurveTo(t,e,i,n,r,s){this._context.bezierCurveTo(t,e,i,n,r,s)}clearRect(t,e,i,n){this._context.clearRect(t,e,i,n)}clip(){this._context.clip()}closePath(){this._context.closePath()}createImageData(t,e){var i=arguments;return 2===i.length?this._context.createImageData(t,e):1===i.length?this._context.createImageData(t):void 0}createLinearGradient(t,e,i,n){return this._context.createLinearGradient(t,e,i,n)}createPattern(t,e){return this._context.createPattern(t,e)}createRadialGradient(t,e,i,n,r,s){return this._context.createRadialGradient(t,e,i,n,r,s)}drawImage(t,e,i,n,r,s,o,a,h){var l=arguments,c=this._context;3===l.length?c.drawImage(t,e,i):5===l.length?c.drawImage(t,e,i,n,r):9===l.length&&c.drawImage(t,e,i,n,r,s,o,a,h)}ellipse(t,e,i,n,r,s,o,a){this._context.ellipse(t,e,i,n,r,s,o,a)}isPointInPath(t,e,i,n){return i?this._context.isPointInPath(i,t,e,n):this._context.isPointInPath(t,e,n)}fill(t){t?this._context.fill(t):this._context.fill()}fillRect(t,e,i,n){this._context.fillRect(t,e,i,n)}strokeRect(t,e,i,n){this._context.strokeRect(t,e,i,n)}fillText(t,e,i,n){n?this._context.fillText(t,e,i,n):this._context.fillText(t,e,i)}measureText(t){return this._context.measureText(t)}getImageData(t,e,i,n){return this._context.getImageData(t,e,i,n)}lineTo(t,e){this._context.lineTo(t,e)}moveTo(t,e){this._context.moveTo(t,e)}rect(t,e,i,n){this._context.rect(t,e,i,n)}putImageData(t,e,i){this._context.putImageData(t,e,i)}quadraticCurveTo(t,e,i,n){this._context.quadraticCurveTo(t,e,i,n)}restore(){this._context.restore()}rotate(t){this._context.rotate(t)}save(){this._context.save()}scale(t,e){this._context.scale(t,e)}setLineDash(t){this._context.setLineDash?this._context.setLineDash(t):"mozDash"in this._context?this._context.mozDash=t:"webkitLineDash"in this._context&&(this._context.webkitLineDash=t)}getLineDash(){return this._context.getLineDash()}setTransform(t,e,i,n,r,s){this._context.setTransform(t,e,i,n,r,s)}stroke(t){t?this._context.stroke(t):this._context.stroke()}strokeText(t,e,i,n){this._context.strokeText(t,e,i,n)}transform(t,e,i,n,r,s){this._context.transform(t,e,i,n,r,s)}translate(t,e){this._context.translate(t,e)}_enableTrace(){var t,e,i=this,n=w.length,r=this.setAttr,s=function(t){var n,r=i[t];i[t]=function(){return e=x(Array.prototype.slice.call(arguments,0)),n=r.apply(i,arguments),i._trace({method:t,args:e}),n}};for(t=0;t<n;t++)s(w[t]);i.setAttr=function(){r.apply(i,arguments);var t=arguments[0],e=arguments[1];"shadowOffsetX"!==t&&"shadowOffsetY"!==t&&"shadowBlur"!==t||(e/=this.canvas.getPixelRatio()),i._trace({property:t,val:e})}}_applyGlobalCompositeOperation(t){const e=t.attrs.globalCompositeOperation;!e||"source-over"===e||this.setAttr("globalCompositeOperation",e)}}["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"].forEach((function(t){Object.defineProperty(C.prototype,t,{get(){return this._context[t]},set(e){this._context[t]=e}})}));class A extends C{constructor(t){super(t),this._context=t._canvas.getContext("2d")}_fillColor(t){var e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)}_fillPattern(t){this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)}_fillLinearGradient(t){var e=t._getLinearGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fillRadialGradient(t){var e=t._getRadialGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fill(t){var e=t.fill(),i=t.getFillPriority();if(e&&"color"===i)this._fillColor(t);else{var n=t.getFillPatternImage();if(n&&"pattern"===i)this._fillPattern(t);else{var r=t.getFillLinearGradientColorStops();if(r&&"linear-gradient"===i)this._fillLinearGradient(t);else{var s=t.getFillRadialGradientColorStops();s&&"radial-gradient"===i?this._fillRadialGradient(t):e?this._fillColor(t):n?this._fillPattern(t):r?this._fillLinearGradient(t):s&&this._fillRadialGradient(t)}}}}_strokeLinearGradient(t){var e=t.getStrokeLinearGradientStartPoint(),i=t.getStrokeLinearGradientEndPoint(),n=t.getStrokeLinearGradientColorStops(),r=this.createLinearGradient(e.x,e.y,i.x,i.y);if(n){for(var s=0;s<n.length;s+=2)r.addColorStop(n[s],n[s+1]);this.setAttr("strokeStyle",r)}}_stroke(t){var e=t.dash(),i=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!i){this.save();var n=this.getCanvas().getPixelRatio();this.setTransform(n,0,0,n,0,0)}this._applyLineCap(t),e&&t.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),t.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),i||this.restore()}}_applyShadow(t){var e,i,n,r=null!==(e=t.getShadowRGBA())&&void 0!==e?e:"black",s=null!==(i=t.getShadowBlur())&&void 0!==i?i:5,o=null!==(n=t.getShadowOffset())&&void 0!==n?n:{x:0,y:0},a=t.getAbsoluteScale(),h=this.canvas.getPixelRatio(),l=a.x*h,c=a.y*h;this.setAttr("shadowColor",r),this.setAttr("shadowBlur",s*Math.min(Math.abs(l),Math.abs(c))),this.setAttr("shadowOffsetX",o.x*l),this.setAttr("shadowOffsetY",o.y*c)}}class T extends C{constructor(t){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:!0})}_fill(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()}strokeShape(t){t.hasHitStroke()&&this._stroke(t)}_stroke(t){if(t.hasHitStroke()){var e=t.getStrokeScaleEnabled();if(!e){this.save();var i=this.getCanvas().getPixelRatio();this.setTransform(i,0,0,i,0,0)}this._applyLineCap(t);var n=t.hitStrokeWidth(),r="auto"===n?t.strokeWidth():n;this.setAttr("lineWidth",r),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),e||this.restore()}}}var _;class R{constructor(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var e=(t||{}).pixelRatio||n.a.pixelRatio||function(){if(_)return _;var t=d.createCanvasElement(),e=t.getContext("2d");return _=(n.a._global.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1),d.releaseCanvas(t),_}();this.pixelRatio=e,this._canvas=d.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(t){var e=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/e,this.getHeight()/e)}setWidth(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";var e=this.pixelRatio;this.getContext()._context.scale(e,e)}setHeight(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";var e=this.pixelRatio;this.getContext()._context.scale(e,e)}getWidth(){return this.width}getHeight(){return this.height}setSize(t,e){this.setWidth(t||0),this.setHeight(e||0)}toDataURL(t,e){try{return this._canvas.toDataURL(t,e)}catch(t){try{return this._canvas.toDataURL()}catch(t){return d.error("Unable to get data URL. "+t.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}S.addGetterSetter(R,"pixelRatio",void 0,p());class P extends R{constructor(t={width:0,height:0}){super(t),this.context=new A(this),this.setSize(t.width,t.height)}}class E extends R{constructor(t={width:0,height:0}){super(t),this.hitCanvas=!0,this.context=new T(this),this.setSize(t.width,t.height)}}const k={get isDragging(){var t=!1;return k._dragElements.forEach(e=>{"dragging"===e.dragStatus&&(t=!0)}),t},justDragged:!1,get node(){var t;return k._dragElements.forEach(e=>{t=e.node}),t},_dragElements:new Map,_drag(t){const e=[];k._dragElements.forEach((i,n)=>{const{node:r}=i,s=r.getStage();s.setPointersPositions(t),void 0===i.pointerId&&(i.pointerId=d._getFirstPointerId(t));const o=s._changedPointerPositions.find(t=>t.id===i.pointerId);if(o){if("dragging"!==i.dragStatus){var a=r.dragDistance();if(Math.max(Math.abs(o.x-i.startPointerPos.x),Math.abs(o.y-i.startPointerPos.y))<a)return;if(r.startDrag({evt:t}),!r.isDragging())return}r._setDragPosition(t,i),e.push(r)}}),e.forEach(e=>{e.fire("dragmove",{type:"dragmove",target:e,evt:t},!0)})},_endDragBefore(t){const e=[];k._dragElements.forEach(i=>{const{node:r}=i,s=r.getStage();t&&s.setPointersPositions(t);if(!s._changedPointerPositions.find(t=>t.id===i.pointerId))return;"dragging"!==i.dragStatus&&"stopped"!==i.dragStatus||(k.justDragged=!0,n.a._mouseListenClick=!1,n.a._touchListenClick=!1,n.a._pointerListenClick=!1,i.dragStatus="stopped");const o=i.node.getLayer()||i.node instanceof n.a.Stage&&i.node;o&&-1===e.indexOf(o)&&e.push(o)}),e.forEach(t=>{t.draw()})},_endDragAfter(t){k._dragElements.forEach((e,i)=>{"stopped"===e.dragStatus&&e.node.fire("dragend",{type:"dragend",target:e.node,evt:t},!0),"dragging"!==e.dragStatus&&k._dragElements.delete(i)})}};n.a.isBrowser&&(window.addEventListener("mouseup",k._endDragBefore,!0),window.addEventListener("touchend",k._endDragBefore,!0),window.addEventListener("mousemove",k._drag),window.addEventListener("touchmove",k._drag),window.addEventListener("mouseup",k._endDragAfter,!1),window.addEventListener("touchend",k._endDragAfter,!1));var M=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(" ");let D=1;class I{constructor(t){this._id=D++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(t),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(t){"transform"!==t&&"absoluteTransform"!==t||!this._cache.get(t)?t?this._cache.delete(t):this._cache.clear():this._cache.get(t).dirty=!0}_getCache(t,e){var i=this._cache.get(t);return(void 0===i||("transform"===t||"absoluteTransform"===t)&&!0===i.dirty)&&(i=e.call(this),this._cache.set(t,i)),i}_calculate(t,e,i){if(!this._attachedDepsListeners.get(t)){const i=e.map(t=>t+"Change.konva").join(" ");this.on(i,()=>{this._clearCache(t)}),this._attachedDepsListeners.set(t,!0)}return this._getCache(t,i)}_getCanvasCache(){return this._cache.get("canvas")}_clearSelfAndDescendantCache(t){this._clearCache(t),"absoluteTransform"===t&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has("canvas")){const{scene:t,filter:e,hit:i}=this._cache.get("canvas");d.releaseCanvas(t,e,i),this._cache.delete("canvas")}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(t){var e=t||{},i={};void 0!==e.x&&void 0!==e.y&&void 0!==e.width&&void 0!==e.height||(i=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()}));var n=Math.ceil(e.width||i.width),r=Math.ceil(e.height||i.height),s=e.pixelRatio,o=void 0===e.x?Math.floor(i.x):e.x,a=void 0===e.y?Math.floor(i.y):e.y,h=e.offset||0,l=e.drawBorder||!1,c=e.hitCanvasPixelRatio||1;if(n&&r){o-=h,a-=h;var g=new P({pixelRatio:s,width:n+=2*h+1,height:r+=2*h+1}),u=new P({pixelRatio:s,width:0,height:0}),p=new E({pixelRatio:c,width:n,height:r}),f=g.getContext(),y=p.getContext();return p.isCache=!0,g.isCache=!0,this._cache.delete("canvas"),this._filterUpToDate=!1,!1===e.imageSmoothingEnabled&&(g.getContext()._context.imageSmoothingEnabled=!1,u.getContext()._context.imageSmoothingEnabled=!1),f.save(),y.save(),f.translate(-o,-a),y.translate(-o,-a),this._isUnderCache=!0,this._clearSelfAndDescendantCache("absoluteOpacity"),this._clearSelfAndDescendantCache("absoluteScale"),this.drawScene(g,this),this.drawHit(p,this),this._isUnderCache=!1,f.restore(),y.restore(),l&&(f.save(),f.beginPath(),f.rect(0,0,n,r),f.closePath(),f.setAttr("strokeStyle","red"),f.setAttr("lineWidth",5),f.stroke(),f.restore()),this._cache.set("canvas",{scene:g,filter:u,hit:p,x:o,y:a}),this._requestDraw(),this}d.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.")}isCached(){return this._cache.has("canvas")}getClientRect(t){throw new Error('abstract "getClientRect" method call')}_transformedRect(t,e){var i,n,r,s,o=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}],a=this.getAbsoluteTransform(e);return o.forEach((function(t){var e=a.point(t);void 0===i&&(i=r=e.x,n=s=e.y),i=Math.min(i,e.x),n=Math.min(n,e.y),r=Math.max(r,e.x),s=Math.max(s,e.y)})),{x:i,y:n,width:r-i,height:s-n}}_drawCachedSceneCanvas(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this);const e=this._getCanvasCache();t.translate(e.x,e.y);var i=this._getCachedSceneCanvas(),n=i.pixelRatio;t.drawImage(i._canvas,0,0,i.width/n,i.height/n),t.restore()}_drawCachedHitCanvas(t){var e=this._getCanvasCache(),i=e.hit;t.save(),t.translate(e.x,e.y),t.drawImage(i._canvas,0,0,i.width/i.pixelRatio,i.height/i.pixelRatio),t.restore()}_getCachedSceneCanvas(){var t,e,i,n,r=this.filters(),s=this._getCanvasCache(),o=s.scene,a=s.filter,h=a.getContext();if(r){if(!this._filterUpToDate){var l=o.pixelRatio;a.setSize(o.width/o.pixelRatio,o.height/o.pixelRatio);try{for(t=r.length,h.clear(),h.drawImage(o._canvas,0,0,o.getWidth()/l,o.getHeight()/l),e=h.getImageData(0,0,a.getWidth(),a.getHeight()),i=0;i<t;i++)"function"==typeof(n=r[i])?(n.call(this,e),h.putImageData(e,0,0)):d.error("Filter should be type of function, but got "+typeof n+" instead. Please check correct filters")}catch(t){d.error("Unable to apply filter. "+t.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return a}return o}on(t,e){if(this._cache&&this._cache.delete("allEventListeners"),3===arguments.length)return this._delegate.apply(this,arguments);var i,n,r,s,o=t.split(" "),a=o.length;for(i=0;i<a;i++)r=(n=o[i].split("."))[0],s=n[1]||"",this.eventListeners[r]||(this.eventListeners[r]=[]),this.eventListeners[r].push({name:s,handler:e});return this}off(t,e){var i,n,r,s,o,a=(t||"").split(" "),h=a.length;if(this._cache&&this._cache.delete("allEventListeners"),!t)for(n in this.eventListeners)this._off(n);for(i=0;i<h;i++)if(s=(r=a[i].split("."))[0],o=r[1],s)this.eventListeners[s]&&this._off(s,o,e);else for(n in this.eventListeners)this._off(n,o,e);return this}dispatchEvent(t){var e={target:this,type:t.type,evt:t};return this.fire(t.type,e),this}addEventListener(t,e){return this.on(t,(function(t){e.call(this,t.evt)})),this}removeEventListener(t){return this.off(t),this}_delegate(t,e,i){var n=this;this.on(t,(function(t){for(var r=t.target.findAncestors(e,!0,n),s=0;s<r.length;s++)(t=d.cloneObject(t)).currentTarget=r[s],i.call(r[s],t)}))}remove(){return this.isDragging()&&this.stopDrag(),k._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache("absoluteTransform"),this._clearSelfAndDescendantCache("absoluteOpacity"),this._clearSelfAndDescendantCache("absoluteScale"),this._clearSelfAndDescendantCache("stage"),this._clearSelfAndDescendantCache("visible"),this._clearSelfAndDescendantCache("listening")}_remove(){this._clearCaches();var t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(t){var e="get"+d._capitalize(t);return d._isFunction(this[e])?this[e]():this.attrs[t]}getAncestors(){for(var t=this.getParent(),e=[];t;)e.push(t),t=t.getParent();return e}getAttrs(){return this.attrs||{}}setAttrs(t){return this._batchTransformChanges(()=>{var e,i;if(!t)return this;for(e in t)"children"!==e&&(i="set"+d._capitalize(e),d._isFunction(this[i])?this[i](t[e]):this._setAttr(e,t[e]))}),this}isListening(){return this._getCache("listening",this._isListening)}_isListening(t){if(!this.listening())return!1;const e=this.getParent();return!e||e===t||this===t||e._isListening(t)}isVisible(){return this._getCache("visible",this._isVisible)}_isVisible(t){if(!this.visible())return!1;const e=this.getParent();return!e||e===t||this===t||e._isVisible(t)}shouldDrawHit(t,e=!1){if(t)return this._isVisible(t)&&this._isListening(t);var i=this.getLayer(),r=!1;k._dragElements.forEach(t=>{"dragging"===t.dragStatus&&("Stage"===t.node.nodeType||t.node.getLayer()===i)&&(r=!0)});var s=!e&&!n.a.hitOnDragEnabled&&r;return this.isListening()&&this.isVisible()&&!s}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){var t,e,i,n,r=this.getDepth(),s=this,o=0;return"Stage"!==s.nodeType&&function a(h){for(t=[],e=h.length,i=0;i<e;i++)n=h[i],o++,"Shape"!==n.nodeType&&(t=t.concat(n.getChildren().slice())),n._id===s._id&&(i=e);t.length>0&&t[0].getDepth()<=r&&a(t)}(s.getStage().getChildren()),o}getDepth(){for(var t=0,e=this.parent;e;)t++,e=e.parent;return t}_batchTransformChanges(t){this._batchingTransformChange=!0,t(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")),this._needClearTransformCache=!1}setPosition(t){return this._batchTransformChanges(()=>{this.x(t.x),this.y(t.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){if(!this.getStage())return null;var t=this.getStage().getPointerPosition();if(!t)return null;var e=this.getAbsoluteTransform().copy();return e.invert(),e.point(t)}getAbsolutePosition(t){let e=!1,i=this.parent;for(;i;){if(i.isCached()){e=!0;break}i=i.parent}e&&!t&&(t=!0);var n=this.getAbsoluteTransform(t).getMatrix(),s=new r,o=this.offset();return s.m=n.slice(),s.translate(o.x,o.y),s.getTranslation()}setAbsolutePosition(t){var e=this._clearTransform();this.attrs.x=e.x,this.attrs.y=e.y,delete e.x,delete e.y,this._clearCache("transform");var i=this._getAbsoluteTransform().copy();return i.invert(),i.translate(t.x,t.y),t={x:this.attrs.x+i.getTranslation().x,y:this.attrs.y+i.getTranslation().y},this._setTransform(e),this.setPosition({x:t.x,y:t.y}),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform"),this}_setTransform(t){var e;for(e in t)this.attrs[e]=t[e]}_clearTransform(){var t={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,t}move(t){var e=t.x,i=t.y,n=this.x(),r=this.y();return void 0!==e&&(n+=e),void 0!==i&&(r+=i),this.setPosition({x:n,y:r}),this}_eachAncestorReverse(t,e){var i,n,r=[],s=this.getParent();if(!e||e._id!==this._id){for(r.unshift(this);s&&(!e||s._id!==e._id);)r.unshift(s),s=s.parent;for(i=r.length,n=0;n<i;n++)t(r[n])}}rotate(t){return this.rotation(this.rotation()+t),this}moveToTop(){if(!this.parent)return d.warn("Node has no parent. moveToTop function is ignored."),!1;var t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0)}moveUp(){if(!this.parent)return d.warn("Node has no parent. moveUp function is ignored."),!1;var t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0)}moveDown(){if(!this.parent)return d.warn("Node has no parent. moveDown function is ignored."),!1;var t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0)}moveToBottom(){if(!this.parent)return d.warn("Node has no parent. moveToBottom function is ignored."),!1;var t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)}setZIndex(t){if(!this.parent)return d.warn("Node has no parent. zIndex parameter is ignored."),this;(t<0||t>=this.parent.children.length)&&d.warn("Unexpected value "+t+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache("absoluteOpacity",this._getAbsoluteOpacity)}_getAbsoluteOpacity(){var t=this.opacity(),e=this.getParent();return e&&!e._isUnderCache&&(t*=e.getAbsoluteOpacity()),t}moveTo(t){return this.getParent()!==t&&(this._remove(),t.add(this)),this}toObject(){var t,e,i,n,r={},s=this.getAttrs();for(t in r.attrs={},s)e=s[t],d.isObject(e)&&!d._isPlainObject(e)&&!d._isArray(e)||(i="function"==typeof this[t]&&this[t],delete s[t],n=i?i.call(this):null,s[t]=e,n!==e&&(r.attrs[t]=e));return r.className=this.getClassName(),d._prepareToStringify(r)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(t,e,i){var n=[];e&&this._isMatch(t)&&n.push(this);for(var r=this.parent;r;){if(r===i)return n;r._isMatch(t)&&n.push(r),r=r.parent}return n}isAncestorOf(t){return!1}findAncestor(t,e,i){return this.findAncestors(t,e,i)[0]}_isMatch(t){if(!t)return!1;if("function"==typeof t)return t(this);var e,i,n=t.replace(/ /g,"").split(","),r=n.length;for(e=0;e<r;e++)if(i=n[e],d.isValidSelector(i)||(d.warn('Selector "'+i+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),d.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),d.warn("Konva is awesome, right?")),"#"===i.charAt(0)){if(this.id()===i.slice(1))return!0}else if("."===i.charAt(0)){if(this.hasName(i.slice(1)))return!0}else if(this.className===i||this.nodeType===i)return!0;return!1}getLayer(){var t=this.getParent();return t?t.getLayer():null}getStage(){return this._getCache("stage",this._getStage)}_getStage(){var t=this.getParent();return t?t.getStage():void 0}fire(t,e={},i){return e.target=e.target||this,i?this._fireAndBubble(t,e):this._fire(t,e),this}getAbsoluteTransform(t){return t?this._getAbsoluteTransform(t):this._getCache("absoluteTransform",this._getAbsoluteTransform)}_getAbsoluteTransform(t){var e;if(t)return e=new r,this._eachAncestorReverse((function(t){var i=t.transformsEnabled();"all"===i?e.multiply(t.getTransform()):"position"===i&&e.translate(t.x()-t.offsetX(),t.y()-t.offsetY())}),t),e;e=this._cache.get("absoluteTransform")||new r,this.parent?this.parent.getAbsoluteTransform().copyInto(e):e.reset();var i=this.transformsEnabled();if("all"===i)e.multiply(this.getTransform());else if("position"===i){const t=this.attrs.x||0,i=this.attrs.y||0,n=this.attrs.offsetX||0,r=this.attrs.offsetY||0;e.translate(t-n,i-r)}return e.dirty=!1,e}getAbsoluteScale(t){for(var e=this;e;)e._isUnderCache&&(t=e),e=e.getParent();const i=this.getAbsoluteTransform(t).decompose();return{x:i.scaleX,y:i.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache("transform",this._getTransform)}_getTransform(){var t,e,i=this._cache.get("transform")||new r;i.reset();var s=this.x(),o=this.y(),a=n.a.getAngle(this.rotation()),h=null!==(t=this.attrs.scaleX)&&void 0!==t?t:1,l=null!==(e=this.attrs.scaleY)&&void 0!==e?e:1,c=this.attrs.skewX||0,d=this.attrs.skewY||0,g=this.attrs.offsetX||0,u=this.attrs.offsetY||0;return 0===s&&0===o||i.translate(s,o),0!==a&&i.rotate(a),0===c&&0===d||i.skew(c,d),1===h&&1===l||i.scale(h,l),0===g&&0===u||i.translate(-1*g,-1*u),i.dirty=!1,i}clone(t){var e,i,n,r,s,o=d.cloneObject(this.attrs);for(e in t)o[e]=t[e];var a=new this.constructor(o);for(e in this.eventListeners)for(n=(i=this.eventListeners[e]).length,r=0;r<n;r++)(s=i[r]).name.indexOf("konva")<0&&(a.eventListeners[e]||(a.eventListeners[e]=[]),a.eventListeners[e].push(s));return a}_toKonvaCanvas(t){t=t||{};var e=this.getClientRect(),i=this.getStage(),n=void 0!==t.x?t.x:Math.floor(e.x),r=void 0!==t.y?t.y:Math.floor(e.y),s=t.pixelRatio||1,o=new P({width:t.width||Math.ceil(e.width)||(i?i.width():0),height:t.height||Math.ceil(e.height)||(i?i.height():0),pixelRatio:s}),a=o.getContext();return!1===t.imageSmoothingEnabled&&(a._context.imageSmoothingEnabled=!1),a.save(),(n||r)&&a.translate(-1*n,-1*r),this.drawScene(o),a.restore(),o}toCanvas(t){return this._toKonvaCanvas(t)._canvas}toDataURL(t){var e=(t=t||{}).mimeType||null,i=t.quality||null,n=this._toKonvaCanvas(t).toDataURL(e,i);return t.callback&&t.callback(n),n}toImage(t){return new Promise((e,i)=>{try{const i=null==t?void 0:t.callback;i&&delete t.callback,d._urlToImage(this.toDataURL(t),(function(t){e(t),null==i||i(t)}))}catch(t){i(t)}})}toBlob(t){return new Promise((e,i)=>{try{const i=null==t?void 0:t.callback;i&&delete t.callback,this.toCanvas(t).toBlob(t=>{e(t),null==i||i(t)})}catch(t){i(t)}})}setSize(t){return this.width(t.width),this.height(t.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():n.a.dragDistance}_off(t,e,i){var n,r,s,o=this.eventListeners[t];for(n=0;n<o.length;n++)if(r=o[n].name,s=o[n].handler,!("konva"===r&&"konva"!==e||e&&r!==e||i&&i!==s)){if(o.splice(n,1),0===o.length){delete this.eventListeners[t];break}n--}}_fireChangeEvent(t,e,i){this._fire(t+"Change",{oldVal:e,newVal:i})}addName(t){if(!this.hasName(t)){var e=this.name(),i=e?e+" "+t:t;this.name(i)}return this}hasName(t){if(!t)return!1;const e=this.name();return!!e&&-1!==(e||"").split(/\s/g).indexOf(t)}removeName(t){var e=(this.name()||"").split(/\s/g),i=e.indexOf(t);return-1!==i&&(e.splice(i,1),this.name(e.join(" "))),this}setAttr(t,e){var i=this["set"+d._capitalize(t)];return d._isFunction(i)?i.call(this,e):this._setAttr(t,e),this}_requestDraw(){if(n.a.autoDrawEnabled){const t=this.getLayer()||this.getStage();null==t||t.batchDraw()}}_setAttr(t,e){var i=this.attrs[t];(i!==e||d.isObject(e))&&(null==e?delete this.attrs[t]:this.attrs[t]=e,this._shouldFireChangeEvents&&this._fireChangeEvent(t,i,e),this._requestDraw())}_setComponentAttr(t,e,i){var n;void 0!==i&&((n=this.attrs[t])||(this.attrs[t]=this.getAttr(t)),this.attrs[t][e]=i,this._fireChangeEvent(t,n,i))}_fireAndBubble(t,e,i){if(e&&"Shape"===this.nodeType&&(e.target=this),!(("mouseenter"===t||"mouseleave"===t)&&(i&&(this===i||this.isAncestorOf&&this.isAncestorOf(i))||"Stage"===this.nodeType&&!i))){this._fire(t,e);var n=("mouseenter"===t||"mouseleave"===t)&&i&&i.isAncestorOf&&i.isAncestorOf(this)&&!i.isAncestorOf(this.parent);(e&&!e.cancelBubble||!e)&&this.parent&&this.parent.isListening()&&!n&&(i&&i.parent?this._fireAndBubble.call(this.parent,t,e,i):this._fireAndBubble.call(this.parent,t,e))}}_getProtoListeners(t){let e=this._cache.get("allEventListeners");if(!e){e={};let t=Object.getPrototypeOf(this);for(;t;)if(t.eventListeners){for(var i in t.eventListeners){const n=t.eventListeners[i],r=e[i]||[];e[i]=n.concat(r)}t=Object.getPrototypeOf(t)}else t=Object.getPrototypeOf(t);this._cache.set("allEventListeners",e)}return e[t]}_fire(t,e){(e=e||{}).currentTarget=this,e.type=t;const i=this._getProtoListeners(t);if(i)for(var n=0;n<i.length;n++)i[n].handler.call(this,e);const r=this.eventListeners[t];if(r)for(n=0;n<r.length;n++)r[n].handler.call(this,e)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(t){var e=t?t.pointerId:void 0,i=this.getStage(),n=this.getAbsolutePosition(),r=i._getPointerById(e)||i._changedPointerPositions[0]||n;k._dragElements.set(this._id,{node:this,startPointerPos:r,offset:{x:r.x-n.x,y:r.y-n.y},dragStatus:"ready",pointerId:e})}startDrag(t,e=!0){k._dragElements.has(this._id)||this._createDragElement(t);k._dragElements.get(this._id).dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:t&&t.evt},e)}_setDragPosition(t,e){const i=this.getStage()._getPointerById(e.pointerId);if(i){var n={x:i.x-e.offset.x,y:i.y-e.offset.y},r=this.dragBoundFunc();if(void 0!==r){const e=r.call(this,n,t);e?n=e:d.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}this._lastPos&&this._lastPos.x===n.x&&this._lastPos.y===n.y||(this.setAbsolutePosition(n),this._requestDraw()),this._lastPos=n}}stopDrag(t){const e=k._dragElements.get(this._id);e&&(e.dragStatus="stopped"),k._endDragBefore(t),k._endDragAfter(t)}setDraggable(t){this._setAttr("draggable",t),this._dragChange()}isDragging(){const t=k._dragElements.get(this._id);return!!t&&"dragging"===t.dragStatus}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",(function(t){if((!(void 0!==t.evt.button)||n.a.dragButtons.indexOf(t.evt.button)>=0)&&!this.isDragging()){var e=!1;k._dragElements.forEach(t=>{this.isAncestorOf(t.node)&&(e=!0)}),e||this._createDragElement(t)}}))}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const t=k._dragElements.get(this._id),e=t&&"dragging"===t.dragStatus,i=t&&"ready"===t.dragStatus;e?this.stopDrag():i&&k._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(t={x:0,y:0}){const e=this.getStage();if(!e)return!1;const i={x:-t.x,y:-t.y,width:e.width()+2*t.x,height:e.height()+2*t.y};return d.haveIntersection(i,this.getClientRect())}static create(t,e){return d._isString(t)&&(t=JSON.parse(t)),this._createNode(t,e)}static _createNode(t,e){var i,r,s,o=I.prototype.getClassName.call(t),a=t.children;e&&(t.attrs.container=e),n.a[o]||(d.warn('Can not find a node with class name "'+o+'". Fallback to "Shape".'),o="Shape");if(i=new(0,n.a[o])(t.attrs),a)for(r=a.length,s=0;s<r;s++)i.add(I._createNode(a[s]));return i}}I.prototype.nodeType="Node",I.prototype._attrsAffectingSize=[],I.prototype.eventListeners={},I.prototype.on.call(I.prototype,M,(function(){this._batchingTransformChange?this._needClearTransformCache=!0:(this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform"))})),I.prototype.on.call(I.prototype,"visibleChange.konva",(function(){this._clearSelfAndDescendantCache("visible")})),I.prototype.on.call(I.prototype,"listeningChange.konva",(function(){this._clearSelfAndDescendantCache("listening")})),I.prototype.on.call(I.prototype,"opacityChange.konva",(function(){this._clearSelfAndDescendantCache("absoluteOpacity")}));const B=S.addGetterSetter;B(I,"zIndex"),B(I,"absolutePosition"),B(I,"position"),B(I,"x",0,p()),B(I,"y",0,p()),B(I,"globalCompositeOperation","source-over",m()),B(I,"opacity",1,p()),B(I,"name","",m()),B(I,"id","",m()),B(I,"rotation",0,p()),S.addComponentsGetterSetter(I,"scale",["x","y"]),B(I,"scaleX",1,p()),B(I,"scaleY",1,p()),S.addComponentsGetterSetter(I,"skew",["x","y"]),B(I,"skewX",0,p()),B(I,"skewY",0,p()),S.addComponentsGetterSetter(I,"offset",["x","y"]),B(I,"offsetX",0,p()),B(I,"offsetY",0,p()),B(I,"dragDistance",null,p()),B(I,"width",0,p()),B(I,"height",0,p()),B(I,"listening",!0,b()),B(I,"preventDefault",!0,b()),B(I,"filters",null,(function(t){return this._filterUpToDate=!1,t})),B(I,"visible",!0,b()),B(I,"transformsEnabled","all",m()),B(I,"size"),B(I,"dragBoundFunc"),B(I,"draggable",!1,b()),S.backCompat(I,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});class O extends I{constructor(){super(...arguments),this.children=[]}getChildren(t){if(!t)return this.children||[];const e=this.children||[];var i=[];return e.forEach((function(e){t(e)&&i.push(e)})),i}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.destroy()}),this.children=[],this._requestDraw(),this}add(...t){if(0===t.length)return this;if(t.length>1){for(var e=0;e<t.length;e++)this.add(t[e]);return this}const i=t[0];return i.getParent()?(i.moveTo(this),this):(this._validateAdd(i),i.index=this.getChildren().length,i.parent=this,i._clearCaches(),this.getChildren().push(i),this._fire("add",{child:i}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(t){return this._generalFind(t,!1)}findOne(t){var e=this._generalFind(t,!0);return e.length>0?e[0]:void 0}_generalFind(t,e){var i=[];return this._descendants(n=>{const r=n._isMatch(t);return r&&i.push(n),!(!r||!e)}),i}_descendants(t){let e=!1;const i=this.getChildren();for(const n of i){if(e=t(n),e)return!0;if(n.hasChildren()&&(e=n._descendants(t),e))return!0}return!1}toObject(){var t=I.prototype.toObject.call(this);return t.children=[],this.getChildren().forEach(e=>{t.children.push(e.toObject())}),t}isAncestorOf(t){for(var e=t.getParent();e;){if(e._id===this._id)return!0;e=e.getParent()}return!1}clone(t){var e=I.prototype.clone.call(this,t);return this.getChildren().forEach((function(t){e.add(t.clone())})),e}getAllIntersections(t){var e=[];return this.find("Shape").forEach((function(i){i.isVisible()&&i.intersects(t)&&e.push(i)})),e}_clearSelfAndDescendantCache(t){var e;super._clearSelfAndDescendantCache(t),this.isCached()||null===(e=this.children)||void 0===e||e.forEach((function(e){e._clearSelfAndDescendantCache(t)}))}_setChildrenIndices(){var t;null===(t=this.children)||void 0===t||t.forEach((function(t,e){t.index=e})),this._requestDraw()}drawScene(t,e){var i=this.getLayer(),n=t||i&&i.getCanvas(),r=n&&n.getContext(),s=this._getCanvasCache(),o=s&&s.scene,a=n&&n.isCache;if(!this.isVisible()&&!a)return this;if(o){r.save();var h=this.getAbsoluteTransform(e).getMatrix();r.transform(h[0],h[1],h[2],h[3],h[4],h[5]),this._drawCachedSceneCanvas(r),r.restore()}else this._drawChildren("drawScene",n,e);return this}drawHit(t,e){if(!this.shouldDrawHit(e))return this;var i=this.getLayer(),n=t||i&&i.hitCanvas,r=n&&n.getContext(),s=this._getCanvasCache();if(s&&s.hit){r.save();var o=this.getAbsoluteTransform(e).getMatrix();r.transform(o[0],o[1],o[2],o[3],o[4],o[5]),this._drawCachedHitCanvas(r),r.restore()}else this._drawChildren("drawHit",n,e);return this}_drawChildren(t,e,i){var n,r=e&&e.getContext(),s=this.clipWidth(),o=this.clipHeight(),a=this.clipFunc(),h=s&&o||a;const l=i===this;if(h){r.save();var c=this.getAbsoluteTransform(i),d=c.getMatrix();if(r.transform(d[0],d[1],d[2],d[3],d[4],d[5]),r.beginPath(),a)a.call(this,r,this);else{var g=this.clipX(),u=this.clipY();r.rect(g,u,s,o)}r.clip(),d=c.copy().invert().getMatrix(),r.transform(d[0],d[1],d[2],d[3],d[4],d[5])}var p=!l&&"source-over"!==this.globalCompositeOperation()&&"drawScene"===t;p&&(r.save(),r._applyGlobalCompositeOperation(this)),null===(n=this.children)||void 0===n||n.forEach((function(n){n[t](e,i)})),p&&r.restore(),h&&r.restore()}getClientRect(t){var e,i,n,r,s,o=(t=t||{}).skipTransform,a=t.relativeTo,h={x:1/0,y:1/0,width:0,height:0},l=this;null===(e=this.children)||void 0===e||e.forEach((function(e){if(e.visible()){var o=e.getClientRect({relativeTo:l,skipShadow:t.skipShadow,skipStroke:t.skipStroke});0===o.width&&0===o.height||(void 0===i?(i=o.x,n=o.y,r=o.x+o.width,s=o.y+o.height):(i=Math.min(i,o.x),n=Math.min(n,o.y),r=Math.max(r,o.x+o.width),s=Math.max(s,o.y+o.height)))}}));for(var c=this.find("Shape"),d=!1,g=0;g<c.length;g++){if(c[g]._isVisible(this)){d=!0;break}}return h=d&&void 0!==i?{x:i,y:n,width:r-i,height:s-n}:{x:0,y:0,width:0,height:0},o?h:this._transformedRect(h,a)}}S.addComponentsGetterSetter(O,"clip",["x","y","width","height"]),S.addGetterSetter(O,"clipX",void 0,p()),S.addGetterSetter(O,"clipY",void 0,p()),S.addGetterSetter(O,"clipWidth",void 0,p()),S.addGetterSetter(O,"clipHeight",void 0,p()),S.addGetterSetter(O,"clipFunc");const L=new Map,F=void 0!==n.a._global.PointerEvent;function G(t){return L.get(t)}function N(t){return{evt:t,pointerId:t.pointerId}}function z(t,e){return L.get(t)===e}function U(t,e){H(t);e.getStage()&&(L.set(t,e),F&&e._fire("gotpointercapture",N(new PointerEvent("gotpointercapture"))))}function H(t,e){const i=L.get(t);if(!i)return;const n=i.getStage();n&&n.content,L.delete(t),F&&i._fire("lostpointercapture",N(new PointerEvent("lostpointercapture")))}var j=[["mouseenter","_pointerenter"],["mousedown","_pointerdown"],["mousemove","_pointermove"],["mouseup","_pointerup"],["mouseleave","_pointerleave"],["touchstart","_pointerdown"],["touchmove","_pointermove"],["touchend","_pointerup"],["touchcancel","_pointercancel"],["mouseover","_pointerover"],["wheel","_wheel"],["contextmenu","_contextmenu"],["pointerdown","_pointerdown"],["pointermove","_pointermove"],["pointerup","_pointerup"],["pointercancel","_pointercancel"],["lostpointercapture","_lostpointercapture"]];const $={mouse:{pointerout:"mouseout",pointerleave:"mouseleave",pointerover:"mouseover",pointerenter:"mouseenter",pointermove:"mousemove",pointerdown:"mousedown",pointerup:"mouseup",pointercancel:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{pointerout:"touchout",pointerleave:"touchleave",pointerover:"touchover",pointerenter:"touchenter",pointermove:"touchmove",pointerdown:"touchstart",pointerup:"touchend",pointercancel:"touchcancel",pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{pointerout:"pointerout",pointerleave:"pointerleave",pointerover:"pointerover",pointerenter:"pointerenter",pointermove:"pointermove",pointerdown:"pointerdown",pointerup:"pointerup",pointercancel:"pointercancel",pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},q=t=>t.indexOf("pointer")>=0?"pointer":t.indexOf("touch")>=0?"touch":"mouse",Y=t=>{const e=q(t);return"pointer"===e?n.a.pointerEventsEnabled&&$.pointer:"touch"===e?$.touch:"mouse"===e?$.mouse:void 0};function V(t={}){return(t.clipFunc||t.clipWidth||t.clipHeight)&&d.warn("Stage does not support clipping. Please use clip for Layers or Groups."),t}const W=[];class Z extends O{constructor(t){super(V(t)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),W.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{V(this.attrs)}),this._checkVisibility()}_validateAdd(t){const e="Layer"===t.getType(),i="FastLayer"===t.getType();e||i||d.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const t=this.visible()?"":"none";this.content.style.display=t}setContainer(t){if("string"==typeof t){if("."===t.charAt(0)){var e=t.slice(1);t=document.getElementsByClassName(e)[0]}else{var i;i="#"!==t.charAt(0)?t:t.slice(1),t=document.getElementById(i)}if(!t)throw"Can not find container in document with id "+i}return this._setAttr("container",t),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),t.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){var t,e=this.children,i=e.length;for(t=0;t<i;t++)e[t].clear();return this}clone(t){return t||(t={}),t.container="undefined"!=typeof document&&document.createElement("div"),O.prototype.clone.call(this,t)}destroy(){super.destroy();var t=this.content;t&&d._isInDocument(t)&&this.container().removeChild(t);var e=W.indexOf(this);return e>-1&&W.splice(e,1),d.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const t=this._pointerPositions[0]||this._changedPointerPositions[0];return t?{x:t.x,y:t.y}:(d.warn("Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);"),null)}_getPointerById(t){return this._pointerPositions.find(e=>e.id===t)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(t){(t=t||{}).x=t.x||0,t.y=t.y||0,t.width=t.width||this.width(),t.height=t.height||this.height();var e=new P({width:t.width,height:t.height,pixelRatio:t.pixelRatio||1}),i=e.getContext()._context,n=this.children;return(t.x||t.y)&&i.translate(-1*t.x,-1*t.y),n.forEach((function(e){if(e.isVisible()){var n=e._toKonvaCanvas(t);i.drawImage(n._canvas,t.x,t.y,n.getWidth()/n.getPixelRatio(),n.getHeight()/n.getPixelRatio())}})),e}getIntersection(t){if(!t)return null;var e,i=this.children;for(e=i.length-1;e>=0;e--){const n=i[e].getIntersection(t);if(n)return n}return null}_resizeDOM(){var t=this.width(),e=this.height();this.content&&(this.content.style.width=t+"px",this.content.style.height=e+"px"),this.bufferCanvas.setSize(t,e),this.bufferHitCanvas.setSize(t,e),this.children.forEach(i=>{i.setSize({width:t,height:e}),i.draw()})}add(t,...e){if(arguments.length>1){for(var i=0;i<arguments.length;i++)this.add(arguments[i]);return this}super.add(t);var r=this.children.length;return r>5&&d.warn("The stage has "+r+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),t.setSize({width:this.width(),height:this.height()}),t.draw(),n.a.isBrowser&&this.content.appendChild(t.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(t){return z(t,this)}setPointerCapture(t){U(t,this)}releaseCapture(t){H(t)}getLayers(){return this.children}_bindContentEvents(){n.a.isBrowser&&j.forEach(([t,e])=>{this.content.addEventListener(t,t=>{this[e](t)},{passive:!1})})}_pointerenter(t){this.setPointersPositions(t);const e=Y(t.type);this._fire(e.pointerenter,{evt:t,target:this,currentTarget:this})}_pointerover(t){this.setPointersPositions(t);const e=Y(t.type);this._fire(e.pointerover,{evt:t,target:this,currentTarget:this})}_getTargetShape(t){let e=this[t+"targetShape"];return e&&!e.getStage()&&(e=null),e}_pointerleave(t){const e=Y(t.type),i=q(t.type);if(e){this.setPointersPositions(t);var r=this._getTargetShape(i),s=!k.isDragging||n.a.hitOnDragEnabled;r&&s?(r._fireAndBubble(e.pointerout,{evt:t}),r._fireAndBubble(e.pointerleave,{evt:t}),this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this[i+"targetShape"]=null):s&&(this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this._fire(e.pointerout,{evt:t,target:this,currentTarget:this})),this.pointerPos=void 0,this._pointerPositions=[]}}_pointerdown(t){const e=Y(t.type),i=q(t.type);if(e){this.setPointersPositions(t);var r=!1;this._changedPointerPositions.forEach(s=>{var o=this.getIntersection(s);k.justDragged=!1,n.a["_"+i+"ListenClick"]=!0;if(!(o&&o.isListening()))return;n.a.capturePointerEventsEnabled&&o.setPointerCapture(s.id),this[i+"ClickStartShape"]=o,o._fireAndBubble(e.pointerdown,{evt:t,pointerId:s.id}),r=!0;const a=t.type.indexOf("touch")>=0;o.preventDefault()&&t.cancelable&&a&&t.preventDefault()}),r||this._fire(e.pointerdown,{evt:t,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}}_pointermove(t){const e=Y(t.type),i=q(t.type);if(!e)return;if(k.isDragging&&k.node.preventDefault()&&t.cancelable&&t.preventDefault(),this.setPointersPositions(t),!(!k.isDragging||n.a.hitOnDragEnabled))return;var r={};let s=!1;var o=this._getTargetShape(i);this._changedPointerPositions.forEach(n=>{const a=G(n.id)||this.getIntersection(n),h=n.id,l={evt:t,pointerId:h};var c=o!==a;if(c&&o&&(o._fireAndBubble(e.pointerout,Object.assign({},l),a),o._fireAndBubble(e.pointerleave,Object.assign({},l),a)),a){if(r[a._id])return;r[a._id]=!0}a&&a.isListening()?(s=!0,c&&(a._fireAndBubble(e.pointerover,Object.assign({},l),o),a._fireAndBubble(e.pointerenter,Object.assign({},l),o),this[i+"targetShape"]=a),a._fireAndBubble(e.pointermove,Object.assign({},l))):o&&(this._fire(e.pointerover,{evt:t,target:this,currentTarget:this,pointerId:h}),this[i+"targetShape"]=null)}),s||this._fire(e.pointermove,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(t){const e=Y(t.type),i=q(t.type);if(!e)return;this.setPointersPositions(t);const r=this[i+"ClickStartShape"],s=this[i+"ClickEndShape"];var o={};let a=!1;this._changedPointerPositions.forEach(h=>{const l=G(h.id)||this.getIntersection(h);if(l){if(l.releaseCapture(h.id),o[l._id])return;o[l._id]=!0}const c=h.id,d={evt:t,pointerId:c};let g=!1;n.a["_"+i+"InDblClickWindow"]?(g=!0,clearTimeout(this[i+"DblTimeout"])):k.justDragged||(n.a["_"+i+"InDblClickWindow"]=!0,clearTimeout(this[i+"DblTimeout"])),this[i+"DblTimeout"]=setTimeout((function(){n.a["_"+i+"InDblClickWindow"]=!1}),n.a.dblClickWindow),l&&l.isListening()?(a=!0,this[i+"ClickEndShape"]=l,l._fireAndBubble(e.pointerup,Object.assign({},d)),n.a["_"+i+"ListenClick"]&&r&&r===l&&(l._fireAndBubble(e.pointerclick,Object.assign({},d)),g&&s&&s===l&&l._fireAndBubble(e.pointerdblclick,Object.assign({},d)))):(this[i+"ClickEndShape"]=null,n.a["_"+i+"ListenClick"]&&this._fire(e.pointerclick,{evt:t,target:this,currentTarget:this,pointerId:c}),g&&this._fire(e.pointerdblclick,{evt:t,target:this,currentTarget:this,pointerId:c}))}),a||this._fire(e.pointerup,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),n.a["_"+i+"ListenClick"]=!1,t.cancelable&&"touch"!==i&&t.preventDefault()}_contextmenu(t){this.setPointersPositions(t);var e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble("contextmenu",{evt:t}):this._fire("contextmenu",{evt:t,target:this,currentTarget:this})}_wheel(t){this.setPointersPositions(t);var e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble("wheel",{evt:t}):this._fire("wheel",{evt:t,target:this,currentTarget:this})}_pointercancel(t){this.setPointersPositions(t);const e=G(t.pointerId)||this.getIntersection(this.getPointerPosition());e&&e._fireAndBubble("pointerup",N(t)),H(t.pointerId)}_lostpointercapture(t){H(t.pointerId)}setPointersPositions(t){var e=this._getContentPosition(),i=null,n=null;void 0!==(t=t||window.event).touches?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(t.touches,t=>{this._pointerPositions.push({id:t.identifier,x:(t.clientX-e.left)/e.scaleX,y:(t.clientY-e.top)/e.scaleY})}),Array.prototype.forEach.call(t.changedTouches||t.touches,t=>{this._changedPointerPositions.push({id:t.identifier,x:(t.clientX-e.left)/e.scaleX,y:(t.clientY-e.top)/e.scaleY})})):(i=(t.clientX-e.left)/e.scaleX,n=(t.clientY-e.top)/e.scaleY,this.pointerPos={x:i,y:n},this._pointerPositions=[{x:i,y:n,id:d._getFirstPointerId(t)}],this._changedPointerPositions=[{x:i,y:n,id:d._getFirstPointerId(t)}])}_setPointerPosition(t){d.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(t)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var t=this.content.getBoundingClientRect();return{top:t.top,left:t.left,scaleX:t.width/this.content.clientWidth||1,scaleY:t.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new P({width:this.width(),height:this.height()}),this.bufferHitCanvas=new E({pixelRatio:1,width:this.width(),height:this.height()}),n.a.isBrowser){var t=this.container();if(!t)throw"Stage has no container. A container is required.";t.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),t.appendChild(this.content),this._resizeDOM()}}cache(){return d.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach((function(t){t.batchDraw()})),this}}Z.prototype.nodeType="Stage",Object(n.b)(Z),S.addGetterSetter(Z,"container");let K;function X(){return K||(K=d.createCanvasElement().getContext("2d"),K)}const Q={};class J extends I{constructor(t){let e;for(super(t);e=d.getRandomColor(),!e||e in Q;);this.colorKey=e,Q[e]=this}getContext(){return d.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return d.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache("hasShadow",this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&0!==this.shadowOpacity()&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache("patternImage",this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const t=X().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(t&&t.setTransform){const e=new r;e.translate(this.fillPatternX(),this.fillPatternY()),e.rotate(n.a.getAngle(this.fillPatternRotation())),e.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),e.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const i=e.getMatrix(),s="undefined"==typeof DOMMatrix?{a:i[0],b:i[1],c:i[2],d:i[3],e:i[4],f:i[5]}:new DOMMatrix(i);t.setTransform(s)}return t}}_getLinearGradient(){return this._getCache("linearGradient",this.__getLinearGradient)}__getLinearGradient(){var t=this.fillLinearGradientColorStops();if(t){for(var e=X(),i=this.fillLinearGradientStartPoint(),n=this.fillLinearGradientEndPoint(),r=e.createLinearGradient(i.x,i.y,n.x,n.y),s=0;s<t.length;s+=2)r.addColorStop(t[s],t[s+1]);return r}}_getRadialGradient(){return this._getCache("radialGradient",this.__getRadialGradient)}__getRadialGradient(){var t=this.fillRadialGradientColorStops();if(t){for(var e=X(),i=this.fillRadialGradientStartPoint(),n=this.fillRadialGradientEndPoint(),r=e.createRadialGradient(i.x,i.y,this.fillRadialGradientStartRadius(),n.x,n.y,this.fillRadialGradientEndRadius()),s=0;s<t.length;s+=2)r.addColorStop(t[s],t[s+1]);return r}}getShadowRGBA(){return this._getCache("shadowRGBA",this._getShadowRGBA)}_getShadowRGBA(){if(this.hasShadow()){var t=d.colorToRGBA(this.shadowColor());return t?"rgba("+t.r+","+t.g+","+t.b+","+t.a*(this.shadowOpacity()||1)+")":void 0}}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!(!this.stroke()&&!this.strokeLinearGradientColorStops()))}hasHitStroke(){const t=this.hitStrokeWidth();return"auto"===t?this.hasStroke():this.strokeEnabled()&&!!t}intersects(t){var e=this.getStage().bufferHitCanvas;return e.getContext().clear(),this.drawHit(e,null,!0),e.context.getImageData(Math.round(t.x),Math.round(t.y),1,1).data[3]>0}destroy(){return I.prototype.destroy.call(this),delete Q[this.colorKey],delete this.colorKey,this}_useBufferCanvas(t){var e;if(!this.getStage())return!1;if(!(null===(e=this.attrs.perfectDrawEnabled)||void 0===e||e))return!1;const i=t||this.hasFill(),n=this.hasStroke(),r=1!==this.getAbsoluteOpacity();if(i&&n&&r)return!0;const s=this.hasShadow(),o=this.shadowForStrokeEnabled();return!!(i&&n&&s&&o)}setStrokeHitEnabled(t){d.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),t?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return 0!==this.hitStrokeWidth()}getSelfRect(){var t=this.size();return{x:this._centroid?-t.width/2:0,y:this._centroid?-t.height/2:0,width:t.width,height:t.height}}getClientRect(t={}){const e=t.skipTransform,i=t.relativeTo,n=this.getSelfRect(),r=!t.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,s=n.width+r,o=n.height+r,a=!t.skipShadow&&this.hasShadow(),h=a?this.shadowOffsetX():0,l=a?this.shadowOffsetY():0,c=s+Math.abs(h),d=o+Math.abs(l),g=a&&this.shadowBlur()||0,u={width:c+2*g,height:d+2*g,x:-(r/2+g)+Math.min(h,0)+n.x,y:-(r/2+g)+Math.min(l,0)+n.y};return e?u:this._transformedRect(u,i)}drawScene(t,e){var i,n,r=this.getLayer(),s=t||r.getCanvas(),o=s.getContext(),a=this._getCanvasCache(),h=this.getSceneFunc(),l=this.hasShadow(),c=s.isCache,d=e===this;if(!this.isVisible()&&!d)return this;if(a){o.save();var g=this.getAbsoluteTransform(e).getMatrix();return o.transform(g[0],g[1],g[2],g[3],g[4],g[5]),this._drawCachedSceneCanvas(o),o.restore(),this}if(!h)return this;if(o.save(),this._useBufferCanvas()&&!c){(n=(i=this.getStage().bufferCanvas).getContext()).clear(),n.save(),n._applyLineJoin(this);var u=this.getAbsoluteTransform(e).getMatrix();n.transform(u[0],u[1],u[2],u[3],u[4],u[5]),h.call(this,n,this),n.restore();var p=i.pixelRatio;l&&o._applyShadow(this),o._applyOpacity(this),o._applyGlobalCompositeOperation(this),o.drawImage(i._canvas,0,0,i.width/p,i.height/p)}else{if(o._applyLineJoin(this),!d){u=this.getAbsoluteTransform(e).getMatrix();o.transform(u[0],u[1],u[2],u[3],u[4],u[5]),o._applyOpacity(this),o._applyGlobalCompositeOperation(this)}l&&o._applyShadow(this),h.call(this,o,this)}return o.restore(),this}drawHit(t,e,i=!1){if(!this.shouldDrawHit(e,i))return this;var n=this.getLayer(),r=t||n.hitCanvas,s=r&&r.getContext(),o=this.hitFunc()||this.sceneFunc(),a=this._getCanvasCache(),h=a&&a.hit;if(this.colorKey||d.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),h){s.save();var l=this.getAbsoluteTransform(e).getMatrix();return s.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._drawCachedHitCanvas(s),s.restore(),this}if(!o)return this;s.save(),s._applyLineJoin(this);if(!(this===e)){var c=this.getAbsoluteTransform(e).getMatrix();s.transform(c[0],c[1],c[2],c[3],c[4],c[5])}return o.call(this,s,this),s.restore(),this}drawHitFromCache(t=0){var e,i,n,r,s,o=this._getCanvasCache(),a=this._getCachedSceneCanvas(),h=o.hit,l=h.getContext(),c=h.getWidth(),g=h.getHeight();l.clear(),l.drawImage(a._canvas,0,0,c,g);try{for(n=(i=(e=l.getImageData(0,0,c,g)).data).length,r=d._hexToRgb(this.colorKey),s=0;s<n;s+=4)i[s+3]>t?(i[s]=r.r,i[s+1]=r.g,i[s+2]=r.b,i[s+3]=255):i[s+3]=0;l.putImageData(e,0,0)}catch(t){d.error("Unable to draw hit graph from cached scene canvas. "+t.message)}return this}hasPointerCapture(t){return z(t,this)}setPointerCapture(t){U(t,this)}releaseCapture(t){H(t)}}J.prototype._fillFunc=function(t){t.fill()},J.prototype._strokeFunc=function(t){t.stroke()},J.prototype._fillFuncHit=function(t){t.fill()},J.prototype._strokeFuncHit=function(t){t.stroke()},J.prototype._centroid=!1,J.prototype.nodeType="Shape",Object(n.b)(J),J.prototype.eventListeners={},J.prototype.on.call(J.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",(function(){this._clearCache("hasShadow")})),J.prototype.on.call(J.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",(function(){this._clearCache("shadowRGBA")})),J.prototype.on.call(J.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",(function(){this._clearCache("patternImage")})),J.prototype.on.call(J.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",(function(){this._clearCache("linearGradient")})),J.prototype.on.call(J.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",(function(){this._clearCache("radialGradient")})),S.addGetterSetter(J,"stroke",void 0,v()),S.addGetterSetter(J,"strokeWidth",2,p()),S.addGetterSetter(J,"fillAfterStrokeEnabled",!1),S.addGetterSetter(J,"hitStrokeWidth","auto",y()),S.addGetterSetter(J,"strokeHitEnabled",!0,b()),S.addGetterSetter(J,"perfectDrawEnabled",!0,b()),S.addGetterSetter(J,"shadowForStrokeEnabled",!0,b()),S.addGetterSetter(J,"lineJoin"),S.addGetterSetter(J,"lineCap"),S.addGetterSetter(J,"sceneFunc"),S.addGetterSetter(J,"hitFunc"),S.addGetterSetter(J,"dash"),S.addGetterSetter(J,"dashOffset",0,p()),S.addGetterSetter(J,"shadowColor",void 0,m()),S.addGetterSetter(J,"shadowBlur",0,p()),S.addGetterSetter(J,"shadowOpacity",1,p()),S.addComponentsGetterSetter(J,"shadowOffset",["x","y"]),S.addGetterSetter(J,"shadowOffsetX",0,p()),S.addGetterSetter(J,"shadowOffsetY",0,p()),S.addGetterSetter(J,"fillPatternImage"),S.addGetterSetter(J,"fill",void 0,v()),S.addGetterSetter(J,"fillPatternX",0,p()),S.addGetterSetter(J,"fillPatternY",0,p()),S.addGetterSetter(J,"fillLinearGradientColorStops"),S.addGetterSetter(J,"strokeLinearGradientColorStops"),S.addGetterSetter(J,"fillRadialGradientStartRadius",0),S.addGetterSetter(J,"fillRadialGradientEndRadius",0),S.addGetterSetter(J,"fillRadialGradientColorStops"),S.addGetterSetter(J,"fillPatternRepeat","repeat"),S.addGetterSetter(J,"fillEnabled",!0),S.addGetterSetter(J,"strokeEnabled",!0),S.addGetterSetter(J,"shadowEnabled",!0),S.addGetterSetter(J,"dashEnabled",!0),S.addGetterSetter(J,"strokeScaleEnabled",!0),S.addGetterSetter(J,"fillPriority","color"),S.addComponentsGetterSetter(J,"fillPatternOffset",["x","y"]),S.addGetterSetter(J,"fillPatternOffsetX",0,p()),S.addGetterSetter(J,"fillPatternOffsetY",0,p()),S.addComponentsGetterSetter(J,"fillPatternScale",["x","y"]),S.addGetterSetter(J,"fillPatternScaleX",1,p()),S.addGetterSetter(J,"fillPatternScaleY",1,p()),S.addComponentsGetterSetter(J,"fillLinearGradientStartPoint",["x","y"]),S.addComponentsGetterSetter(J,"strokeLinearGradientStartPoint",["x","y"]),S.addGetterSetter(J,"fillLinearGradientStartPointX",0),S.addGetterSetter(J,"strokeLinearGradientStartPointX",0),S.addGetterSetter(J,"fillLinearGradientStartPointY",0),S.addGetterSetter(J,"strokeLinearGradientStartPointY",0),S.addComponentsGetterSetter(J,"fillLinearGradientEndPoint",["x","y"]),S.addComponentsGetterSetter(J,"strokeLinearGradientEndPoint",["x","y"]),S.addGetterSetter(J,"fillLinearGradientEndPointX",0),S.addGetterSetter(J,"strokeLinearGradientEndPointX",0),S.addGetterSetter(J,"fillLinearGradientEndPointY",0),S.addGetterSetter(J,"strokeLinearGradientEndPointY",0),S.addComponentsGetterSetter(J,"fillRadialGradientStartPoint",["x","y"]),S.addGetterSetter(J,"fillRadialGradientStartPointX",0),S.addGetterSetter(J,"fillRadialGradientStartPointY",0),S.addComponentsGetterSetter(J,"fillRadialGradientEndPoint",["x","y"]),S.addGetterSetter(J,"fillRadialGradientEndPointX",0),S.addGetterSetter(J,"fillRadialGradientEndPointY",0),S.addGetterSetter(J,"fillPatternRotation",0),S.backCompat(J,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});var tt=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],et=tt.length;class it extends O{constructor(t){super(t),this.canvas=new P,this.hitCanvas=new E({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(t){return this.getContext().clear(t),this.getHitCanvas().getContext().clear(t),this}setZIndex(t){super.setZIndex(t);var e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),t<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[t+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){I.prototype.moveToTop.call(this);var t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!I.prototype.moveUp.call(this))return!1;var t=this.getStage();return!(!t||!t.content)&&(t.content.removeChild(this.getNativeCanvasElement()),this.index<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[this.index+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(I.prototype.moveDown.call(this)){var t=this.getStage();if(t){var e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(I.prototype.moveToBottom.call(this)){var t=this.getStage();if(t){var e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){var t=this.getNativeCanvasElement();return I.prototype.remove.call(this),t&&t.parentNode&&d._isInDocument(t)&&t.parentNode.removeChild(t),this}getStage(){return this.parent}setSize({width:t,height:e}){return this.canvas.setSize(t,e),this.hitCanvas.setSize(t,e),this._setSmoothEnabled(),this}_validateAdd(t){var e=t.getType();"Group"!==e&&"Shape"!==e&&d.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(t){return(t=t||{}).width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=void 0!==t.x?t.x:this.x(),t.y=void 0!==t.y?t.y:this.y(),I.prototype._toKonvaCanvas.call(this,t)}_checkVisibility(){const t=this.visible();this.canvas._canvas.style.display=t?"block":"none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){d.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){d.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,d.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(t){if(!this.isListening()||!this.isVisible())return null;for(var e=1,i=!1;;){for(let n=0;n<et;n++){const r=tt[n],s=this._getIntersection({x:t.x+r.x*e,y:t.y+r.y*e}),o=s.shape;if(o)return o;if(i=!!s.antialiased,!s.antialiased)break}if(!i)return null;e+=1}}_getIntersection(t){const e=this.hitCanvas.pixelRatio,i=this.hitCanvas.context.getImageData(Math.round(t.x*e),Math.round(t.y*e),1,1).data,n=i[3];if(255===n){const t=d._rgbToHex(i[0],i[1],i[2]),e=Q["#"+t];return e?{shape:e}:{antialiased:!0}}return n>0?{antialiased:!0}:{}}drawScene(t,e){var i=this.getLayer(),n=t||i&&i.getCanvas();return this._fire("beforeDraw",{node:this}),this.clearBeforeDraw()&&n.getContext().clear(),O.prototype.drawScene.call(this,n,e),this._fire("draw",{node:this}),this}drawHit(t,e){var i=this.getLayer(),n=t||i&&i.hitCanvas;return i&&i.clearBeforeDraw()&&i.getHitCanvas().getContext().clear(),O.prototype.drawHit.call(this,n,e),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(t){d.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(t)}getHitGraphEnabled(t){return d.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(this.parent&&this.parent.content){var t=this.parent;!!this.hitCanvas._canvas.parentNode?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}}destroy(){return d.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}it.prototype.nodeType="Layer",Object(n.b)(it),S.addGetterSetter(it,"imageSmoothingEnabled",!0),S.addGetterSetter(it,"clearBeforeDraw",!0),S.addGetterSetter(it,"hitGraphEnabled",!0,b());class nt extends it{constructor(t){super(t),this.listening(!1),d.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}nt.prototype.nodeType="FastLayer",Object(n.b)(nt);class rt extends O{_validateAdd(t){var e=t.getType();"Group"!==e&&"Shape"!==e&&d.throw("You may only add groups and shapes to groups.")}}rt.prototype.nodeType="Group",Object(n.b)(rt);var st=n.c.performance&&n.c.performance.now?function(){return n.c.performance.now()}:function(){return(new Date).getTime()};class ot{constructor(t,e){this.id=ot.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:st(),frameRate:0},this.func=t,this.setLayers(e)}setLayers(t){var e=[];return e=t?t.length>0?t:[t]:[],this.layers=e,this}getLayers(){return this.layers}addLayer(t){var e,i=this.layers,n=i.length;for(e=0;e<n;e++)if(i[e]._id===t._id)return!1;return this.layers.push(t),!0}isRunning(){var t,e=ot.animations,i=e.length;for(t=0;t<i;t++)if(e[t].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=st(),ot._addAnimation(this),this}stop(){return ot._removeAnimation(this),this}_updateFrameObject(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(t){this.animations.push(t),this._handleAnimation()}static _removeAnimation(t){var e,i=t.id,n=this.animations,r=n.length;for(e=0;e<r;e++)if(n[e].id===i){this.animations.splice(e,1);break}}static _runFrames(){var t,e,i,n,r,s,o,a,h={},l=this.animations;for(n=0;n<l.length;n++)if(e=(t=l[n]).layers,i=t.func,t._updateFrameObject(st()),s=e.length,!i||!1!==i.call(t,t.frame))for(r=0;r<s;r++)void 0!==(o=e[r])._id&&(h[o._id]=o);for(a in h)h.hasOwnProperty(a)&&h[a].batchDraw()}static _animationLoop(){var t=ot;t.animations.length?(t._runFrames(),d.requestAnimFrame(t._animationLoop)):t.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,d.requestAnimFrame(this._animationLoop))}}ot.animations=[],ot.animIdCounter=0,ot.animRunning=!1;var at={node:1,duration:1,easing:1,onFinish:1,yoyo:1},ht=0,lt=["fill","stroke","shadowColor"];class ct{constructor(t,e,i,n,r,s,o){this.prop=t,this.propFunc=e,this.begin=n,this._pos=n,this.duration=s,this._change=0,this.prevPos=0,this.yoyo=o,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=i,this._change=r-this.begin,this.pause()}fire(t){var e=this[t];e&&e()}setTime(t){t>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():t<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=t,this.update())}getTime(){return this._time}setPosition(t){this.prevPos=this._pos,this.propFunc(t),this._pos=t}getPosition(t){return void 0===t&&(t=this._time),this.func(t,this.begin,this._change,this.duration)}play(){this.state=2,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=3,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(t){this.pause(),this._time=t,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){var t=this.getTimer()-this._startTime;2===this.state?this.setTime(t):3===this.state&&this.setTime(this.duration-t)}pause(){this.state=1,this.fire("onPause")}getTimer(){return(new Date).getTime()}}class dt{constructor(t){var e,i,r=this,s=t.node,o=s._id,a=t.easing||gt.Linear,h=!!t.yoyo;e=void 0===t.duration?.3:0===t.duration?.001:t.duration,this.node=s,this._id=ht++;var l=s.getLayer()||(s instanceof n.a.Stage?s.getLayers():null);for(i in l||d.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new ot((function(){r.tween.onEnterFrame()}),l),this.tween=new ct(i,(function(t){r._tweenFunc(t)}),a,0,1,1e3*e,h),this._addListeners(),dt.attrs[o]||(dt.attrs[o]={}),dt.attrs[o][this._id]||(dt.attrs[o][this._id]={}),dt.tweens[o]||(dt.tweens[o]={}),t)void 0===at[i]&&this._addAttr(i,t[i]);this.reset(),this.onFinish=t.onFinish,this.onReset=t.onReset,this.onUpdate=t.onUpdate}_addAttr(t,e){var i,n,r,s,o,a,h,l,c=this.node,g=c._id;if((r=dt.tweens[g][t])&&delete dt.attrs[g][r][t],i=c.getAttr(t),d._isArray(e))if(n=[],o=Math.max(e.length,i.length),"points"===t&&e.length!==i.length&&(e.length>i.length?(h=i,i=d._prepareArrayForTween(i,e,c.closed())):(a=e,e=d._prepareArrayForTween(e,i,c.closed()))),0===t.indexOf("fill"))for(s=0;s<o;s++)if(s%2==0)n.push(e[s]-i[s]);else{var u=d.colorToRGBA(i[s]);l=d.colorToRGBA(e[s]),i[s]=u,n.push({r:l.r-u.r,g:l.g-u.g,b:l.b-u.b,a:l.a-u.a})}else for(s=0;s<o;s++)n.push(e[s]-i[s]);else-1!==lt.indexOf(t)?(i=d.colorToRGBA(i),n={r:(l=d.colorToRGBA(e)).r-i.r,g:l.g-i.g,b:l.b-i.b,a:l.a-i.a}):n=e-i;dt.attrs[g][this._id][t]={start:i,diff:n,end:e,trueEnd:a,trueStart:h},dt.tweens[g][t]=this._id}_tweenFunc(t){var e,i,n,r,s,o,a,h,l=this.node,c=dt.attrs[l._id][this._id];for(e in c){if(n=(i=c[e]).start,r=i.diff,h=i.end,d._isArray(n))if(s=[],a=Math.max(n.length,h.length),0===e.indexOf("fill"))for(o=0;o<a;o++)o%2==0?s.push((n[o]||0)+r[o]*t):s.push("rgba("+Math.round(n[o].r+r[o].r*t)+","+Math.round(n[o].g+r[o].g*t)+","+Math.round(n[o].b+r[o].b*t)+","+(n[o].a+r[o].a*t)+")");else for(o=0;o<a;o++)s.push((n[o]||0)+r[o]*t);else s=-1!==lt.indexOf(e)?"rgba("+Math.round(n.r+r.r*t)+","+Math.round(n.g+r.g*t)+","+Math.round(n.b+r.b*t)+","+(n.a+r.a*t)+")":n+r*t;l.setAttr(e,s)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{var t=this.node,e=dt.attrs[t._id][this._id];e.points&&e.points.trueEnd&&t.setAttr("points",e.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{var t=this.node,e=dt.attrs[t._id][this._id];e.points&&e.points.trueStart&&t.points(e.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(t){return this.tween.seek(1e3*t),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){var t,e=this.node._id,i=this._id,n=dt.tweens[e];for(t in this.pause(),n)delete dt.tweens[e][t];delete dt.attrs[e][i]}}dt.attrs={},dt.tweens={},I.prototype.to=function(t){var e=t.onFinish;t.node=this,t.onFinish=function(){this.destroy(),e&&e()},new dt(t).play()};const gt={BackEaseIn(t,e,i,n){var r=1.70158;return i*(t/=n)*t*((r+1)*t-r)+e},BackEaseOut(t,e,i,n){var r=1.70158;return i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},BackEaseInOut(t,e,i,n){var r=1.70158;return(t/=n/2)<1?i/2*(t*t*((1+(r*=1.525))*t-r))+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},ElasticEaseIn(t,e,i,n,r,s){var o=0;return 0===t?e:1==(t/=n)?e+i:(s||(s=.3*n),!r||r<Math.abs(i)?(r=i,o=s/4):o=s/(2*Math.PI)*Math.asin(i/r),-r*Math.pow(2,10*(t-=1))*Math.sin((t*n-o)*(2*Math.PI)/s)+e)},ElasticEaseOut(t,e,i,n,r,s){var o=0;return 0===t?e:1==(t/=n)?e+i:(s||(s=.3*n),!r||r<Math.abs(i)?(r=i,o=s/4):o=s/(2*Math.PI)*Math.asin(i/r),r*Math.pow(2,-10*t)*Math.sin((t*n-o)*(2*Math.PI)/s)+i+e)},ElasticEaseInOut(t,e,i,n,r,s){var o=0;return 0===t?e:2==(t/=n/2)?e+i:(s||(s=n*(.3*1.5)),!r||r<Math.abs(i)?(r=i,o=s/4):o=s/(2*Math.PI)*Math.asin(i/r),t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*n-o)*(2*Math.PI)/s)*-.5+e:r*Math.pow(2,-10*(t-=1))*Math.sin((t*n-o)*(2*Math.PI)/s)*.5+i+e)},BounceEaseOut:(t,e,i,n)=>(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e,BounceEaseIn:(t,e,i,n)=>i-gt.BounceEaseOut(n-t,0,i,n)+e,BounceEaseInOut:(t,e,i,n)=>t<n/2?.5*gt.BounceEaseIn(2*t,0,i,n)+e:.5*gt.BounceEaseOut(2*t-n,0,i,n)+.5*i+e,EaseIn:(t,e,i,n)=>i*(t/=n)*t+e,EaseOut:(t,e,i,n)=>-i*(t/=n)*(t-2)+e,EaseInOut:(t,e,i,n)=>(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e,StrongEaseIn:(t,e,i,n)=>i*(t/=n)*t*t*t*t+e,StrongEaseOut:(t,e,i,n)=>i*((t=t/n-1)*t*t*t*t+1)+e,StrongEaseInOut:(t,e,i,n)=>(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e,Linear:(t,e,i,n)=>i*t/n+e},ut=d._assign(n.a,{Util:d,Transform:r,Node:I,Container:O,Stage:Z,stages:W,Layer:it,FastLayer:nt,Group:rt,DD:k,Shape:J,shapes:Q,Animation:ot,Tween:dt,Easings:gt,Context:C,Canvas:R});class pt extends J{_sceneFunc(t){var e=n.a.getAngle(this.angle()),i=this.clockwise();t.beginPath(),t.arc(0,0,this.outerRadius(),0,e,i),t.arc(0,0,this.innerRadius(),e,0,!i),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}getSelfRect(){const t=this.innerRadius(),e=this.outerRadius(),i=this.clockwise(),r=n.a.getAngle(i?360-this.angle():this.angle()),s=Math.cos(Math.min(r,Math.PI)),o=Math.sin(Math.min(Math.max(Math.PI,r),3*Math.PI/2)),a=Math.sin(Math.min(r,Math.PI/2)),h=s*(s>0?t:e),l=o*(o>0?t:e),c=a*(a>0?e:t);return{x:h,y:i?-1*c:l,width:1*e-h,height:c-l}}}function ft(t,e,i,n,r,s,o){var a=Math.sqrt(Math.pow(i-t,2)+Math.pow(n-e,2)),h=Math.sqrt(Math.pow(r-i,2)+Math.pow(s-n,2)),l=o*a/(a+h),c=o*h/(a+h);return[i-l*(r-t),n-l*(s-e),i+c*(r-t),n+c*(s-e)]}function yt(t,e){var i,n,r=t.length,s=[];for(i=2;i<r-2;i+=2)n=ft(t[i-2],t[i-1],t[i],t[i+1],t[i+2],t[i+3],e),isNaN(n[0])||(s.push(n[0]),s.push(n[1]),s.push(t[i]),s.push(t[i+1]),s.push(n[2]),s.push(n[3]));return s}pt.prototype._centroid=!0,pt.prototype.className="Arc",pt.prototype._attrsAffectingSize=["innerRadius","outerRadius"],Object(n.b)(pt),S.addGetterSetter(pt,"innerRadius",0,p()),S.addGetterSetter(pt,"outerRadius",0,p()),S.addGetterSetter(pt,"angle",0,p()),S.addGetterSetter(pt,"clockwise",!1,b());class mt extends J{constructor(t){super(t),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",(function(){this._clearCache("tensionPoints")}))}_sceneFunc(t){var e,i,n,r=this.points(),s=r.length,o=this.tension(),a=this.closed(),h=this.bezier();if(s){if(t.beginPath(),t.moveTo(r[0],r[1]),0!==o&&s>4){for(i=(e=this.getTensionPoints()).length,n=a?0:4,a||t.quadraticCurveTo(e[0],e[1],e[2],e[3]);n<i-2;)t.bezierCurveTo(e[n++],e[n++],e[n++],e[n++],e[n++],e[n++]);a||t.quadraticCurveTo(e[i-2],e[i-1],r[s-2],r[s-1])}else if(h)for(n=2;n<s;)t.bezierCurveTo(r[n++],r[n++],r[n++],r[n++],r[n++],r[n++]);else for(n=2;n<s;n+=2)t.lineTo(r[n],r[n+1]);a?(t.closePath(),t.fillStrokeShape(this)):t.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():yt(this.points(),this.tension())}_getTensionPointsClosed(){var t=this.points(),e=t.length,i=this.tension(),n=ft(t[e-2],t[e-1],t[0],t[1],t[2],t[3],i),r=ft(t[e-4],t[e-3],t[e-2],t[e-1],t[0],t[1],i),s=yt(t,i);return[n[2],n[3]].concat(s).concat([r[0],r[1],t[e-2],t[e-1],r[2],r[3],n[0],n[1],t[0],t[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){var t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};for(var e,i,n=(t=0!==this.tension()?[t[0],t[1],...this._getTensionPoints(),t[t.length-2],t[t.length-1]]:this.points())[0],r=t[0],s=t[1],o=t[1],a=0;a<t.length/2;a++)e=t[2*a],i=t[2*a+1],n=Math.min(n,e),r=Math.max(r,e),s=Math.min(s,i),o=Math.max(o,i);return{x:n,y:s,width:r-n,height:o-s}}}mt.prototype.className="Line",mt.prototype._attrsAffectingSize=["points","bezier","tension"],Object(n.b)(mt),S.addGetterSetter(mt,"closed",!1),S.addGetterSetter(mt,"bezier",!1),S.addGetterSetter(mt,"tension",0,p()),S.addGetterSetter(mt,"points",[],function(){if(n.a.isUnminified)return function(t,e){const i=Int8Array?Object.getPrototypeOf(Int8Array):null;return i&&t instanceof i||(d._isArray(t)?t.forEach((function(t){d._isNumber(t)||d.warn('"'+e+'" attribute has non numeric element '+t+". Make sure that all elements are numbers.")})):d.warn(g(t)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.')),t}}());class vt extends J{constructor(t){super(t),this.dataArray=[],this.pathLength=0,this.dataArray=vt.parsePathData(this.data()),this.pathLength=0;for(var e=0;e<this.dataArray.length;++e)this.pathLength+=this.dataArray[e].pathLength;this.on("dataChange.konva",(function(){this.dataArray=vt.parsePathData(this.data()),this.pathLength=0;for(var t=0;t<this.dataArray.length;++t)this.pathLength+=this.dataArray[t].pathLength}))}_sceneFunc(t){var e=this.dataArray;t.beginPath();for(var i=!1,n=0;n<e.length;n++){var r=e[n].command,s=e[n].points;switch(r){case"L":t.lineTo(s[0],s[1]);break;case"M":t.moveTo(s[0],s[1]);break;case"C":t.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case"Q":t.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case"A":var o=s[0],a=s[1],h=s[2],l=s[3],c=s[4],d=s[5],g=s[6],u=s[7],p=h>l?h:l,f=h>l?1:h/l,y=h>l?l/h:1;t.translate(o,a),t.rotate(g),t.scale(f,y),t.arc(0,0,p,c,c+d,1-u),t.scale(1/f,1/y),t.rotate(-g),t.translate(-o,-a);break;case"z":i=!0,t.closePath()}}i||this.hasFill()?t.fillStrokeShape(this):t.strokeShape(this)}getSelfRect(){var t=[];this.dataArray.forEach((function(e){if("A"===e.command){var i=e.points[4],n=e.points[5],r=e.points[4]+n,s=Math.PI/180;if(Math.abs(i-r)<s&&(s=Math.abs(i-r)),n<0)for(let n=i-s;n>r;n-=s){const i=vt.getPointOnEllipticalArc(e.points[0],e.points[1],e.points[2],e.points[3],n,0);t.push(i.x,i.y)}else for(let n=i+s;n<r;n+=s){const i=vt.getPointOnEllipticalArc(e.points[0],e.points[1],e.points[2],e.points[3],n,0);t.push(i.x,i.y)}}else if("C"===e.command)for(let i=0;i<=1;i+=.01){const n=vt.getPointOnCubicBezier(i,e.start.x,e.start.y,e.points[0],e.points[1],e.points[2],e.points[3],e.points[4],e.points[5]);t.push(n.x,n.y)}else t=t.concat(e.points)}));for(var e,i,n=t[0],r=t[0],s=t[1],o=t[1],a=0;a<t.length/2;a++)e=t[2*a],i=t[2*a+1],isNaN(e)||(n=Math.min(n,e),r=Math.max(r,e)),isNaN(i)||(s=Math.min(s,i),o=Math.max(o,i));return{x:n,y:s,width:r-n,height:o-s}}getLength(){return this.pathLength}getPointAtLength(t){var e,i=0,n=this.dataArray.length;if(!n)return null;for(;i<n&&t>this.dataArray[i].pathLength;)t-=this.dataArray[i].pathLength,++i;if(i===n)return{x:(e=this.dataArray[i-1].points.slice(-2))[0],y:e[1]};if(t<.01)return{x:(e=this.dataArray[i].points.slice(0,2))[0],y:e[1]};var r=this.dataArray[i],s=r.points;switch(r.command){case"L":return vt.getPointOnLine(t,r.start.x,r.start.y,s[0],s[1]);case"C":return vt.getPointOnCubicBezier(t/r.pathLength,r.start.x,r.start.y,s[0],s[1],s[2],s[3],s[4],s[5]);case"Q":return vt.getPointOnQuadraticBezier(t/r.pathLength,r.start.x,r.start.y,s[0],s[1],s[2],s[3]);case"A":var o=s[0],a=s[1],h=s[2],l=s[3],c=s[4],d=s[5],g=s[6];return c+=d*t/r.pathLength,vt.getPointOnEllipticalArc(o,a,h,l,c,g)}return null}static getLineLength(t,e,i,n){return Math.sqrt((i-t)*(i-t)+(n-e)*(n-e))}static getPointOnLine(t,e,i,n,r,s,o){void 0===s&&(s=e),void 0===o&&(o=i);var a=(r-i)/(n-e+1e-8),h=Math.sqrt(t*t/(1+a*a));n<e&&(h*=-1);var l,c=a*h;if(n===e)l={x:s,y:o+c};else if((o-i)/(s-e+1e-8)===a)l={x:s+h,y:o+c};else{var d,g,u=this.getLineLength(e,i,n,r),p=(s-e)*(n-e)+(o-i)*(r-i);d=e+(p/=u*u)*(n-e),g=i+p*(r-i);var f=this.getLineLength(s,o,d,g),y=Math.sqrt(t*t-f*f);h=Math.sqrt(y*y/(1+a*a)),n<e&&(h*=-1),l={x:d+h,y:g+(c=a*h)}}return l}static getPointOnCubicBezier(t,e,i,n,r,s,o,a,h){function l(t){return t*t*t}function c(t){return 3*t*t*(1-t)}function d(t){return 3*t*(1-t)*(1-t)}function g(t){return(1-t)*(1-t)*(1-t)}return{x:a*l(t)+s*c(t)+n*d(t)+e*g(t),y:h*l(t)+o*c(t)+r*d(t)+i*g(t)}}static getPointOnQuadraticBezier(t,e,i,n,r,s,o){function a(t){return t*t}function h(t){return 2*t*(1-t)}function l(t){return(1-t)*(1-t)}return{x:s*a(t)+n*h(t)+e*l(t),y:o*a(t)+r*h(t)+i*l(t)}}static getPointOnEllipticalArc(t,e,i,n,r,s){var o=Math.cos(s),a=Math.sin(s),h=i*Math.cos(r),l=n*Math.sin(r);return{x:t+(h*o-l*a),y:e+(h*a+l*o)}}static parsePathData(t){if(!t)return[];var e=t,i=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];e=e.replace(new RegExp(" ","g"),",");for(var n=0;n<i.length;n++)e=e.replace(new RegExp(i[n],"g"),"|"+i[n]);var r,s=e.split("|"),o=[],a=[],h=0,l=0,c=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;for(n=1;n<s.length;n++){var d=s[n],g=d.charAt(0);for(d=d.slice(1),a.length=0;r=c.exec(d);)a.push(r[0]);for(var u=[],p=0,f=a.length;p<f;p++)if("00"!==a[p]){var y=parseFloat(a[p]);isNaN(y)?u.push(0):u.push(y)}else u.push(0,0);for(;u.length>0&&!isNaN(u[0]);){var m,v,b,S,x,w,C,A,T,_,R=null,P=[],E=h,k=l;switch(g){case"l":h+=u.shift(),l+=u.shift(),R="L",P.push(h,l);break;case"L":h=u.shift(),l=u.shift(),P.push(h,l);break;case"m":var M=u.shift(),D=u.shift();if(h+=M,l+=D,R="M",o.length>2&&"z"===o[o.length-1].command)for(var I=o.length-2;I>=0;I--)if("M"===o[I].command){h=o[I].points[0]+M,l=o[I].points[1]+D;break}P.push(h,l),g="l";break;case"M":h=u.shift(),l=u.shift(),R="M",P.push(h,l),g="L";break;case"h":h+=u.shift(),R="L",P.push(h,l);break;case"H":h=u.shift(),R="L",P.push(h,l);break;case"v":l+=u.shift(),R="L",P.push(h,l);break;case"V":l=u.shift(),R="L",P.push(h,l);break;case"C":P.push(u.shift(),u.shift(),u.shift(),u.shift()),h=u.shift(),l=u.shift(),P.push(h,l);break;case"c":P.push(h+u.shift(),l+u.shift(),h+u.shift(),l+u.shift()),h+=u.shift(),l+=u.shift(),R="C",P.push(h,l);break;case"S":v=h,b=l,"C"===(m=o[o.length-1]).command&&(v=h+(h-m.points[2]),b=l+(l-m.points[3])),P.push(v,b,u.shift(),u.shift()),h=u.shift(),l=u.shift(),R="C",P.push(h,l);break;case"s":v=h,b=l,"C"===(m=o[o.length-1]).command&&(v=h+(h-m.points[2]),b=l+(l-m.points[3])),P.push(v,b,h+u.shift(),l+u.shift()),h+=u.shift(),l+=u.shift(),R="C",P.push(h,l);break;case"Q":P.push(u.shift(),u.shift()),h=u.shift(),l=u.shift(),P.push(h,l);break;case"q":P.push(h+u.shift(),l+u.shift()),h+=u.shift(),l+=u.shift(),R="Q",P.push(h,l);break;case"T":v=h,b=l,"Q"===(m=o[o.length-1]).command&&(v=h+(h-m.points[0]),b=l+(l-m.points[1])),h=u.shift(),l=u.shift(),R="Q",P.push(v,b,h,l);break;case"t":v=h,b=l,"Q"===(m=o[o.length-1]).command&&(v=h+(h-m.points[0]),b=l+(l-m.points[1])),h+=u.shift(),l+=u.shift(),R="Q",P.push(v,b,h,l);break;case"A":S=u.shift(),x=u.shift(),w=u.shift(),C=u.shift(),A=u.shift(),T=h,_=l,h=u.shift(),l=u.shift(),R="A",P=this.convertEndpointToCenterParameterization(T,_,h,l,C,A,S,x,w);break;case"a":S=u.shift(),x=u.shift(),w=u.shift(),C=u.shift(),A=u.shift(),T=h,_=l,h+=u.shift(),l+=u.shift(),R="A",P=this.convertEndpointToCenterParameterization(T,_,h,l,C,A,S,x,w)}o.push({command:R||g,points:P,start:{x:E,y:k},pathLength:this.calcLength(E,k,R||g,P)})}"z"!==g&&"Z"!==g||o.push({command:"z",points:[],start:void 0,pathLength:0})}return o}static calcLength(t,e,i,n){var r,s,o,a,h=vt;switch(i){case"L":return h.getLineLength(t,e,n[0],n[1]);case"C":for(r=0,s=h.getPointOnCubicBezier(0,t,e,n[0],n[1],n[2],n[3],n[4],n[5]),a=.01;a<=1;a+=.01)o=h.getPointOnCubicBezier(a,t,e,n[0],n[1],n[2],n[3],n[4],n[5]),r+=h.getLineLength(s.x,s.y,o.x,o.y),s=o;return r;case"Q":for(r=0,s=h.getPointOnQuadraticBezier(0,t,e,n[0],n[1],n[2],n[3]),a=.01;a<=1;a+=.01)o=h.getPointOnQuadraticBezier(a,t,e,n[0],n[1],n[2],n[3]),r+=h.getLineLength(s.x,s.y,o.x,o.y),s=o;return r;case"A":r=0;var l=n[4],c=n[5],d=n[4]+c,g=Math.PI/180;if(Math.abs(l-d)<g&&(g=Math.abs(l-d)),s=h.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],l,0),c<0)for(a=l-g;a>d;a-=g)o=h.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],a,0),r+=h.getLineLength(s.x,s.y,o.x,o.y),s=o;else for(a=l+g;a<d;a+=g)o=h.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],a,0),r+=h.getLineLength(s.x,s.y,o.x,o.y),s=o;return o=h.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],d,0),r+=h.getLineLength(s.x,s.y,o.x,o.y)}return 0}static convertEndpointToCenterParameterization(t,e,i,n,r,s,o,a,h){var l=h*(Math.PI/180),c=Math.cos(l)*(t-i)/2+Math.sin(l)*(e-n)/2,d=-1*Math.sin(l)*(t-i)/2+Math.cos(l)*(e-n)/2,g=c*c/(o*o)+d*d/(a*a);g>1&&(o*=Math.sqrt(g),a*=Math.sqrt(g));var u=Math.sqrt((o*o*(a*a)-o*o*(d*d)-a*a*(c*c))/(o*o*(d*d)+a*a*(c*c)));r===s&&(u*=-1),isNaN(u)&&(u=0);var p=u*o*d/a,f=u*-a*c/o,y=(t+i)/2+Math.cos(l)*p-Math.sin(l)*f,m=(e+n)/2+Math.sin(l)*p+Math.cos(l)*f,v=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},b=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(v(t)*v(e))},S=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(b(t,e))},x=S([1,0],[(c-p)/o,(d-f)/a]),w=[(c-p)/o,(d-f)/a],C=[(-1*c-p)/o,(-1*d-f)/a],A=S(w,C);return b(w,C)<=-1&&(A=Math.PI),b(w,C)>=1&&(A=0),0===s&&A>0&&(A-=2*Math.PI),1===s&&A<0&&(A+=2*Math.PI),[y,m,o,a,x,A,l,s]}}vt.prototype.className="Path",vt.prototype._attrsAffectingSize=["data"],Object(n.b)(vt),S.addGetterSetter(vt,"data");class bt extends mt{_sceneFunc(t){super._sceneFunc(t);var e=2*Math.PI,i=this.points(),n=i,r=0!==this.tension()&&i.length>4;r&&(n=this.getTensionPoints());var s,o,a=this.pointerLength(),h=i.length;if(r){const t=[n[n.length-4],n[n.length-3],n[n.length-2],n[n.length-1],i[h-2],i[h-1]],e=vt.calcLength(n[n.length-4],n[n.length-3],"C",t),r=vt.getPointOnQuadraticBezier(Math.min(1,1-a/e),t[0],t[1],t[2],t[3],t[4],t[5]);s=i[h-2]-r.x,o=i[h-1]-r.y}else s=i[h-2]-i[h-4],o=i[h-1]-i[h-3];var l=(Math.atan2(o,s)+e)%e,c=this.pointerWidth();this.pointerAtEnding()&&(t.save(),t.beginPath(),t.translate(i[h-2],i[h-1]),t.rotate(l),t.moveTo(0,0),t.lineTo(-a,c/2),t.lineTo(-a,-c/2),t.closePath(),t.restore(),this.__fillStroke(t)),this.pointerAtBeginning()&&(t.save(),t.beginPath(),t.translate(i[0],i[1]),r?(s=(n[0]+n[2])/2-i[0],o=(n[1]+n[3])/2-i[1]):(s=i[2]-i[0],o=i[3]-i[1]),t.rotate((Math.atan2(-o,-s)+e)%e),t.moveTo(0,0),t.lineTo(-a,c/2),t.lineTo(-a,-c/2),t.closePath(),t.restore(),this.__fillStroke(t))}__fillStroke(t){var e=this.dashEnabled();e&&(this.attrs.dashEnabled=!1,t.setLineDash([])),t.fillStrokeShape(this),e&&(this.attrs.dashEnabled=!0)}getSelfRect(){const t=super.getSelfRect(),e=this.pointerWidth()/2;return{x:t.x-e,y:t.y-e,width:t.width+2*e,height:t.height+2*e}}}bt.prototype.className="Arrow",Object(n.b)(bt),S.addGetterSetter(bt,"pointerLength",10,p()),S.addGetterSetter(bt,"pointerWidth",10,p()),S.addGetterSetter(bt,"pointerAtBeginning",!1),S.addGetterSetter(bt,"pointerAtEnding",!0);class St extends J{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.attrs.radius||0,0,2*Math.PI,!1),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(t){this.radius()!==t/2&&this.radius(t/2)}setHeight(t){this.radius()!==t/2&&this.radius(t/2)}}St.prototype._centroid=!0,St.prototype.className="Circle",St.prototype._attrsAffectingSize=["radius"],Object(n.b)(St),S.addGetterSetter(St,"radius",0,p());class xt extends J{_sceneFunc(t){var e=this.radiusX(),i=this.radiusY();t.beginPath(),t.save(),e!==i&&t.scale(1,i/e),t.arc(0,0,e,0,2*Math.PI,!1),t.restore(),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.radiusX()}getHeight(){return 2*this.radiusY()}setWidth(t){this.radiusX(t/2)}setHeight(t){this.radiusY(t/2)}}xt.prototype.className="Ellipse",xt.prototype._centroid=!0,xt.prototype._attrsAffectingSize=["radiusX","radiusY"],Object(n.b)(xt),S.addComponentsGetterSetter(xt,"radius",["x","y"]),S.addGetterSetter(xt,"radiusX",0,p()),S.addGetterSetter(xt,"radiusY",0,p());class wt extends J{constructor(t){super(t),this.on("imageChange.konva",()=>{this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const t=this.image();t&&t.complete||t&&4===t.readyState||t&&t.addEventListener&&t.addEventListener("load",()=>{this._requestDraw()})}_useBufferCanvas(){return super._useBufferCanvas(!0)}_sceneFunc(t){const e=this.getWidth(),i=this.getHeight(),n=this.cornerRadius(),r=this.attrs.image;let s;if(r){const t=this.attrs.cropWidth,n=this.attrs.cropHeight;s=t&&n?[r,this.cropX(),this.cropY(),t,n,0,0,e,i]:[r,0,0,e,i]}(this.hasFill()||this.hasStroke()||n)&&(t.beginPath(),n?d.drawRoundedRectPath(t,e,i,n):t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)),r&&(n&&t.clip(),t.drawImage.apply(t,s))}_hitFunc(t){var e=this.width(),i=this.height(),n=this.cornerRadius();t.beginPath(),n?d.drawRoundedRectPath(t,e,i,n):t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)}getWidth(){var t,e;return null!==(t=this.attrs.width)&&void 0!==t?t:null===(e=this.image())||void 0===e?void 0:e.width}getHeight(){var t,e;return null!==(t=this.attrs.height)&&void 0!==t?t:null===(e=this.image())||void 0===e?void 0:e.height}static fromURL(t,e,i=null){var n=d.createImageElement();n.onload=function(){var t=new wt({image:n});e(t)},n.onerror=i,n.crossOrigin="Anonymous",n.src=t}}wt.prototype.className="Image",Object(n.b)(wt),S.addGetterSetter(wt,"cornerRadius",0,f(4)),S.addGetterSetter(wt,"image"),S.addComponentsGetterSetter(wt,"crop",["x","y","width","height"]),S.addGetterSetter(wt,"cropX",0,p()),S.addGetterSetter(wt,"cropY",0,p()),S.addGetterSetter(wt,"cropWidth",0,p()),S.addGetterSetter(wt,"cropHeight",0,p());var Ct=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],At=Ct.length;class Tt extends rt{constructor(t){super(t),this.on("add.konva",(function(t){this._addListeners(t.child),this._sync()}))}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(t){var e,i=this,n=function(){i._sync()};for(e=0;e<At;e++)t.on(Ct[e]+"Change.konva",n)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){var t,e,i,n,r,s,o,a=this.getText(),h=this.getTag();if(a&&h){switch(t=a.width(),e=a.height(),i=h.pointerDirection(),n=h.pointerWidth(),o=h.pointerHeight(),r=0,s=0,i){case"up":r=t/2,s=-1*o;break;case"right":r=t+n,s=e/2;break;case"down":r=t/2,s=e+o;break;case"left":r=-1*n,s=e/2}h.setAttrs({x:-1*r,y:-1*s,width:t,height:e}),a.setAttrs({x:-1*r,y:-1*s})}}}Tt.prototype.className="Label",Object(n.b)(Tt);class _t extends J{_sceneFunc(t){var e=this.width(),i=this.height(),n=this.pointerDirection(),r=this.pointerWidth(),s=this.pointerHeight(),o=this.cornerRadius();let a=0,h=0,l=0,c=0;"number"==typeof o?a=h=l=c=Math.min(o,e/2,i/2):(a=Math.min(o[0]||0,e/2,i/2),h=Math.min(o[1]||0,e/2,i/2),c=Math.min(o[2]||0,e/2,i/2),l=Math.min(o[3]||0,e/2,i/2)),t.beginPath(),t.moveTo(a,0),"up"===n&&(t.lineTo((e-r)/2,0),t.lineTo(e/2,-1*s),t.lineTo((e+r)/2,0)),t.lineTo(e-h,0),t.arc(e-h,h,h,3*Math.PI/2,0,!1),"right"===n&&(t.lineTo(e,(i-s)/2),t.lineTo(e+r,i/2),t.lineTo(e,(i+s)/2)),t.lineTo(e,i-c),t.arc(e-c,i-c,c,0,Math.PI/2,!1),"down"===n&&(t.lineTo((e+r)/2,i),t.lineTo(e/2,i+s),t.lineTo((e-r)/2,i)),t.lineTo(l,i),t.arc(l,i-l,l,Math.PI/2,Math.PI,!1),"left"===n&&(t.lineTo(0,(i+s)/2),t.lineTo(-1*r,i/2),t.lineTo(0,(i-s)/2)),t.lineTo(0,a),t.arc(a,a,a,Math.PI,3*Math.PI/2,!1),t.closePath(),t.fillStrokeShape(this)}getSelfRect(){var t=0,e=0,i=this.pointerWidth(),n=this.pointerHeight(),r=this.pointerDirection(),s=this.width(),o=this.height();return"up"===r?(e-=n,o+=n):"down"===r?o+=n:"left"===r?(t-=1.5*i,s+=i):"right"===r&&(s+=1.5*i),{x:t,y:e,width:s,height:o}}}_t.prototype.className="Tag",Object(n.b)(_t),S.addGetterSetter(_t,"pointerDirection","none"),S.addGetterSetter(_t,"pointerWidth",0,p()),S.addGetterSetter(_t,"pointerHeight",0,p()),S.addGetterSetter(_t,"cornerRadius",0,f(4));class Rt extends J{_sceneFunc(t){var e=this.cornerRadius(),i=this.width(),n=this.height();t.beginPath(),e?d.drawRoundedRectPath(t,i,n,e):t.rect(0,0,i,n),t.closePath(),t.fillStrokeShape(this)}}Rt.prototype.className="Rect",Object(n.b)(Rt),S.addGetterSetter(Rt,"cornerRadius",0,f(4));class Pt extends J{_sceneFunc(t){const e=this._getPoints();t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y);t.closePath(),t.fillStrokeShape(this)}_getPoints(){const t=this.attrs.sides,e=this.attrs.radius||0,i=[];for(var n=0;n<t;n++)i.push({x:e*Math.sin(2*n*Math.PI/t),y:-1*e*Math.cos(2*n*Math.PI/t)});return i}getSelfRect(){const t=this._getPoints();var e=t[0].x,i=t[0].y,n=t[0].x,r=t[0].y;return t.forEach(t=>{e=Math.min(e,t.x),i=Math.max(i,t.x),n=Math.min(n,t.y),r=Math.max(r,t.y)}),{x:e,y:n,width:i-e,height:r-n}}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(t){this.radius(t/2)}setHeight(t){this.radius(t/2)}}Pt.prototype.className="RegularPolygon",Pt.prototype._centroid=!0,Pt.prototype._attrsAffectingSize=["radius"],Object(n.b)(Pt),S.addGetterSetter(Pt,"radius",0,p()),S.addGetterSetter(Pt,"sides",0,p());var Et=2*Math.PI;class kt extends J{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.innerRadius(),0,Et,!1),t.moveTo(this.outerRadius(),0),t.arc(0,0,this.outerRadius(),Et,0,!0),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}}kt.prototype.className="Ring",kt.prototype._centroid=!0,kt.prototype._attrsAffectingSize=["innerRadius","outerRadius"],Object(n.b)(kt),S.addGetterSetter(kt,"innerRadius",0,p()),S.addGetterSetter(kt,"outerRadius",0,p());class Mt extends J{constructor(t){super(t),this._updated=!0,this.anim=new ot(()=>{var t=this._updated;return this._updated=!1,t}),this.on("animationChange.konva",(function(){this.frameIndex(0)})),this.on("frameIndexChange.konva",(function(){this._updated=!0})),this.on("frameRateChange.konva",(function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())}))}_sceneFunc(t){var e=this.animation(),i=this.frameIndex(),n=4*i,r=this.animations()[e],s=this.frameOffsets(),o=r[n+0],a=r[n+1],h=r[n+2],l=r[n+3],c=this.image();if((this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,h,l),t.closePath(),t.fillStrokeShape(this)),c)if(s){var d=s[e],g=2*i;t.drawImage(c,o,a,h,l,d[g+0],d[g+1],h,l)}else t.drawImage(c,o,a,h,l,0,0,h,l)}_hitFunc(t){var e=this.animation(),i=this.frameIndex(),n=4*i,r=this.animations()[e],s=this.frameOffsets(),o=r[n+2],a=r[n+3];if(t.beginPath(),s){var h=s[e],l=2*i;t.rect(h[l+0],h[l+1],o,a)}else t.rect(0,0,o,a);t.closePath(),t.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){var t=this;this.interval=setInterval((function(){t._updateIndex()}),1e3/this.frameRate())}start(){if(!this.isRunning()){var t=this.getLayer();this.anim.setLayers(t),this._setInterval(),this.anim.start()}}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){var t=this.frameIndex(),e=this.animation();t<this.animations()[e].length/4-1?this.frameIndex(t+1):this.frameIndex(0)}}Mt.prototype.className="Sprite",Object(n.b)(Mt),S.addGetterSetter(Mt,"animation"),S.addGetterSetter(Mt,"animations"),S.addGetterSetter(Mt,"frameOffsets"),S.addGetterSetter(Mt,"image"),S.addGetterSetter(Mt,"frameIndex",0,p()),S.addGetterSetter(Mt,"frameRate",17,p()),S.backCompat(Mt,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});class Dt extends J{_sceneFunc(t){var e=this.innerRadius(),i=this.outerRadius(),n=this.numPoints();t.beginPath(),t.moveTo(0,0-i);for(var r=1;r<2*n;r++){var s=r%2==0?i:e,o=s*Math.sin(r*Math.PI/n),a=-1*s*Math.cos(r*Math.PI/n);t.lineTo(o,a)}t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}}function It(t){return Array.from(t)}Dt.prototype.className="Star",Dt.prototype._centroid=!0,Dt.prototype._attrsAffectingSize=["innerRadius","outerRadius"],Object(n.b)(Dt),S.addGetterSetter(Dt,"numPoints",5,p()),S.addGetterSetter(Dt,"innerRadius",0,p()),S.addGetterSetter(Dt,"outerRadius",0,p());var Bt,Ot=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],Lt=Ot.length;function Ft(){return Bt||(Bt=d.createCanvasElement().getContext("2d"))}class Gt extends J{constructor(t){super(function(t){return(t=t||{}).fillLinearGradientColorStops||t.fillRadialGradientColorStops||t.fillPatternImage||(t.fill=t.fill||"black"),t}(t)),this._partialTextX=0,this._partialTextY=0;for(var e=0;e<Lt;e++)this.on(Ot[e]+"Change.konva",this._setTextData);this._setTextData()}_sceneFunc(t){var e=this.textArr,i=e.length;if(this.text()){var n,r=this.padding(),s=this.fontSize(),o=this.lineHeight()*s,a=this.verticalAlign(),h=0,l=this.align(),c=this.getWidth(),d=this.letterSpacing(),g=this.fill(),u=this.textDecoration(),p=-1!==u.indexOf("underline"),f=-1!==u.indexOf("line-through"),y=0,m=(y=o/2,0),v=0;for(t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline","middle"),t.setAttr("textAlign","left"),"middle"===a?h=(this.getHeight()-i*o-2*r)/2:"bottom"===a&&(h=this.getHeight()-i*o-2*r),t.translate(r,h+r),n=0;n<i;n++){m=0,v=0;var b,S,x,w=e[n],C=w.text,A=w.width,T=w.lastInParagraph;if(t.save(),"right"===l?m+=c-A-2*r:"center"===l&&(m+=(c-A-2*r)/2),p){t.save(),t.beginPath(),t.moveTo(m,y+v+Math.round(s/2)),S=0===(b=C.split(" ").length-1),x="justify"!==l||T?A:c-2*r,t.lineTo(m+Math.round(x),y+v+Math.round(s/2)),t.lineWidth=s/15;const e=this._getLinearGradient();t.strokeStyle=e||g,t.stroke(),t.restore()}if(f){t.save(),t.beginPath(),t.moveTo(m,y+v),S=0===(b=C.split(" ").length-1),x="justify"===l&&T&&!S?c-2*r:A,t.lineTo(m+Math.round(x),y+v),t.lineWidth=s/15;const e=this._getLinearGradient();t.strokeStyle=e||g,t.stroke(),t.restore()}if(0!==d||"justify"===l){b=C.split(" ").length-1;for(var _=It(C),R=0;R<_.length;R++){var P=_[R];" "!==P||T||"justify"!==l||(m+=(c-2*r-A)/b),this._partialTextX=m,this._partialTextY=y+v,this._partialText=P,t.fillStrokeShape(this),m+=this.measureSize(P).width+d}}else this._partialTextX=m,this._partialTextY=y+v,this._partialText=C,t.fillStrokeShape(this);t.restore(),i>1&&(y+=o)}}}_hitFunc(t){var e=this.getWidth(),i=this.getHeight();t.beginPath(),t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)}setText(t){var e=d._isString(t)?t:null==t?"":t+"";return this._setAttr("text",e),this}getWidth(){return"auto"===this.attrs.width||void 0===this.attrs.width?this.getTextWidth()+2*this.padding():this.attrs.width}getHeight(){return"auto"===this.attrs.height||void 0===this.attrs.height?this.fontSize()*this.textArr.length*this.lineHeight()+2*this.padding():this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return d.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(t){var e,i=Ft(),n=this.fontSize();return i.save(),i.font=this._getContextFont(),e=i.measureText(t),i.restore(),{width:e.width,height:n}}_getContextFont(){return this.fontStyle()+" "+this.fontVariant()+" "+this.fontSize()+"px "+this.fontFamily().split(",").map(t=>{const e=(t=t.trim()).indexOf(" ")>=0,i=t.indexOf('"')>=0||t.indexOf("'")>=0;return e&&!i&&(t=`"${t}"`),t}).join(", ")}_addTextLine(t){"justify"===this.align()&&(t=t.trim());var e=this._getTextWidth(t);return this.textArr.push({text:t,width:e,lastInParagraph:!1})}_getTextWidth(t){var e=this.letterSpacing(),i=t.length;return Ft().measureText(t).width+(i?e*(i-1):0)}_setTextData(){var t=this.text().split("\n"),e=+this.fontSize(),i=0,n=this.lineHeight()*e,r=this.attrs.width,s=this.attrs.height,o="auto"!==r&&void 0!==r,a="auto"!==s&&void 0!==s,h=this.padding(),l=r-2*h,c=s-2*h,d=0,g=this.wrap(),u="char"!==g&&"none"!==g,p=this.ellipsis();this.textArr=[],Ft().font=this._getContextFont();for(var f=p?this._getTextWidth(""):0,y=0,m=t.length;y<m;++y){var v=t[y],b=this._getTextWidth(v);if(o&&b>l)for(;v.length>0;){for(var S=0,x=v.length,w="",C=0;S<x;){var A=S+x>>>1,T=v.slice(0,A+1),_=this._getTextWidth(T)+f;_<=l?(S=A+1,w=T,C=_):x=A}if(!w)break;if(u){var R,P=v[w.length];(R=(" "===P||"-"===P)&&C<=l?w.length:Math.max(w.lastIndexOf(" "),w.lastIndexOf("-"))+1)>0&&(S=R,w=w.slice(0,S),C=this._getTextWidth(w))}if(w=w.trimRight(),this._addTextLine(w),i=Math.max(i,C),d+=n,this._shouldHandleEllipsis(d)){this._tryToAddEllipsisToLastLine();break}if((v=(v=v.slice(S)).trimLeft()).length>0&&(b=this._getTextWidth(v))<=l){this._addTextLine(v),d+=n,i=Math.max(i,b);break}}else this._addTextLine(v),d+=n,i=Math.max(i,b),this._shouldHandleEllipsis(d)&&y<m-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),a&&d+n>c)break}this.textHeight=e,this.textWidth=i}_shouldHandleEllipsis(t){var e=+this.fontSize(),i=this.lineHeight()*e,n=this.attrs.height,r="auto"!==n&&void 0!==n,s=n-2*this.padding();return!("none"!==this.wrap())||r&&t+i>s}_tryToAddEllipsisToLastLine(){var t=this.attrs.width,e="auto"!==t&&void 0!==t,i=t-2*this.padding(),n=this.ellipsis(),r=this.textArr[this.textArr.length-1];if(r&&n){if(e)this._getTextWidth(r.text+"")<i||(r.text=r.text.slice(0,r.text.length-3));this.textArr.splice(this.textArr.length-1,1),this._addTextLine(r.text+"")}}getStrokeScaleEnabled(){return!0}}Gt.prototype._fillFunc=function(t){t.fillText(this._partialText,this._partialTextX,this._partialTextY)},Gt.prototype._strokeFunc=function(t){t.strokeText(this._partialText,this._partialTextX,this._partialTextY)},Gt.prototype.className="Text",Gt.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],Object(n.b)(Gt),S.overWriteSetter(Gt,"width",y()),S.overWriteSetter(Gt,"height",y()),S.addGetterSetter(Gt,"fontFamily","Arial"),S.addGetterSetter(Gt,"fontSize",12,p()),S.addGetterSetter(Gt,"fontStyle","normal"),S.addGetterSetter(Gt,"fontVariant","normal"),S.addGetterSetter(Gt,"padding",0,p()),S.addGetterSetter(Gt,"align","left"),S.addGetterSetter(Gt,"verticalAlign","top"),S.addGetterSetter(Gt,"lineHeight",1,p()),S.addGetterSetter(Gt,"wrap","word"),S.addGetterSetter(Gt,"ellipsis",!1,b()),S.addGetterSetter(Gt,"letterSpacing",0,p()),S.addGetterSetter(Gt,"text","",m()),S.addGetterSetter(Gt,"textDecoration","");function Nt(t){t.fillText(this.partialText,0,0)}function zt(t){t.strokeText(this.partialText,0,0)}class Ut extends J{constructor(t){super(t),this.dummyCanvas=d.createCanvasElement(),this.dataArray=[],this.dataArray=vt.parsePathData(this.attrs.data),this.on("dataChange.konva",(function(){this.dataArray=vt.parsePathData(this.attrs.data),this._setTextData()})),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_sceneFunc(t){t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",this.textBaseline()),t.setAttr("textAlign","left"),t.save();var e=this.textDecoration(),i=this.fill(),n=this.fontSize(),r=this.glyphInfo;"underline"===e&&t.beginPath();for(var s=0;s<r.length;s++){t.save();var o=r[s].p0;t.translate(o.x,o.y),t.rotate(r[s].rotation),this.partialText=r[s].text,t.fillStrokeShape(this),"underline"===e&&(0===s&&t.moveTo(0,n/2+1),t.lineTo(n,n/2+1)),t.restore()}"underline"===e&&(t.strokeStyle=i,t.lineWidth=n/20,t.stroke()),t.restore()}_hitFunc(t){t.beginPath();var e=this.glyphInfo;if(e.length>=1){var i=e[0].p0;t.moveTo(i.x,i.y)}for(var n=0;n<e.length;n++){var r=e[n].p1;t.lineTo(r.x,r.y)}t.setAttr("lineWidth",this.fontSize()),t.setAttr("strokeStyle",this.colorKey),t.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return d.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(t){return Gt.prototype.setText.call(this,t)}_getContextFont(){return Gt.prototype._getContextFont.call(this)}_getTextSize(t){var e=this.dummyCanvas.getContext("2d");e.save(),e.font=this._getContextFont();var i=e.measureText(t);return e.restore(),{width:i.width,height:parseInt(this.attrs.fontSize,10)}}_setTextData(){var t=this,e=this._getTextSize(this.attrs.text),i=this.letterSpacing(),n=this.align(),r=this.kerningFunc();this.textWidth=e.width,this.textHeight=e.height;var s=Math.max(this.textWidth+((this.attrs.text||"").length-1)*i,0);this.glyphInfo=[];for(var o=0,a=0;a<t.dataArray.length;a++)t.dataArray[a].pathLength>0&&(o+=t.dataArray[a].pathLength);var h=0;"center"===n&&(h=Math.max(0,o/2-s/2)),"right"===n&&(h=Math.max(0,o-s));for(var l,c,d,g=It(this.text()),u=this.text().split(" ").length-1,p=-1,f=0,y=function(){f=0;for(var e=t.dataArray,i=p+1;i<e.length;i++){if(e[i].pathLength>0)return p=i,e[i];"M"===e[i].command&&(l={x:e[i].points[0],y:e[i].points[1]})}return{}},m=function(e){var r=t._getTextSize(e).width+i;" "===e&&"justify"===n&&(r+=(o-s)/u);var a=0,h=0;for(c=void 0;Math.abs(r-a)/r>.01&&h<20;){h++;for(var g=a;void 0===d;)(d=y())&&g+d.pathLength<r&&(g+=d.pathLength,d=void 0);if(0===Object.keys(d).length||void 0===l)return;var p=!1;switch(d.command){case"L":vt.getLineLength(l.x,l.y,d.points[0],d.points[1])>r?c=vt.getPointOnLine(r,l.x,l.y,d.points[0],d.points[1],l.x,l.y):d=void 0;break;case"A":var m=d.points[4],v=d.points[5],b=d.points[4]+v;0===f?f=m+1e-8:r>a?f+=Math.PI/180*v/Math.abs(v):f-=Math.PI/360*v/Math.abs(v),(v<0&&f<b||v>=0&&f>b)&&(f=b,p=!0),c=vt.getPointOnEllipticalArc(d.points[0],d.points[1],d.points[2],d.points[3],f,d.points[6]);break;case"C":0===f?f=r>d.pathLength?1e-8:r/d.pathLength:r>a?f+=(r-a)/d.pathLength/2:f=Math.max(f-(a-r)/d.pathLength/2,0),f>1&&(f=1,p=!0),c=vt.getPointOnCubicBezier(f,d.start.x,d.start.y,d.points[0],d.points[1],d.points[2],d.points[3],d.points[4],d.points[5]);break;case"Q":0===f?f=r/d.pathLength:r>a?f+=(r-a)/d.pathLength:f-=(a-r)/d.pathLength,f>1&&(f=1,p=!0),c=vt.getPointOnQuadraticBezier(f,d.start.x,d.start.y,d.points[0],d.points[1],d.points[2],d.points[3])}void 0!==c&&(a=vt.getLineLength(l.x,l.y,c.x,c.y)),p&&(p=!1,d=void 0)}},v=h/(t._getTextSize("C").width+i)-1,b=0;b<v&&(m("C"),void 0!==l&&void 0!==c);b++)l=c;for(var S=0;S<g.length&&(m(g[S]),void 0!==l&&void 0!==c);S++){var x=vt.getLineLength(l.x,l.y,c.x,c.y),w=0;if(r)try{w=r(g[S-1],g[S])*this.fontSize()}catch(t){w=0}l.x+=w,c.x+=w,this.textWidth+=w;var C=vt.getPointOnLine(w+x/2,l.x,l.y,c.x,c.y),A=Math.atan2(c.y-l.y,c.x-l.x);this.glyphInfo.push({transposeX:C.x,transposeY:C.y,text:g[S],rotation:A,p0:l,p1:c}),l=c}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};var t=[];this.glyphInfo.forEach((function(e){t.push(e.p0.x),t.push(e.p0.y),t.push(e.p1.x),t.push(e.p1.y)}));for(var e,i,n=t[0]||0,r=t[0]||0,s=t[1]||0,o=t[1]||0,a=0;a<t.length/2;a++)e=t[2*a],i=t[2*a+1],n=Math.min(n,e),r=Math.max(r,e),s=Math.min(s,i),o=Math.max(o,i);var h=this.fontSize();return{x:n-h/2,y:s-h/2,width:r-n+h,height:o-s+h}}destroy(){return d.releaseCanvas(this.dummyCanvas),super.destroy()}}Ut.prototype._fillFunc=Nt,Ut.prototype._strokeFunc=zt,Ut.prototype._fillFuncHit=Nt,Ut.prototype._strokeFuncHit=zt,Ut.prototype.className="TextPath",Ut.prototype._attrsAffectingSize=["text","fontSize","data"],Object(n.b)(Ut),S.addGetterSetter(Ut,"data"),S.addGetterSetter(Ut,"fontFamily","Arial"),S.addGetterSetter(Ut,"fontSize",12,p()),S.addGetterSetter(Ut,"fontStyle","normal"),S.addGetterSetter(Ut,"align","left"),S.addGetterSetter(Ut,"letterSpacing",0,p()),S.addGetterSetter(Ut,"textBaseline","middle"),S.addGetterSetter(Ut,"fontVariant","normal"),S.addGetterSetter(Ut,"text",""),S.addGetterSetter(Ut,"textDecoration",null),S.addGetterSetter(Ut,"kerningFunc",null);var Ht=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange"].map(t=>t+".tr-konva").join(" "),jt=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],$t={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135};const qt="ontouchstart"in n.a._global;var Yt=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function Vt(t,e,i){const n=i.x+(t.x-i.x)*Math.cos(e)-(t.y-i.y)*Math.sin(e),r=i.y+(t.x-i.x)*Math.sin(e)+(t.y-i.y)*Math.cos(e);return Object.assign(Object.assign({},t),{rotation:t.rotation+e,x:n,y:r})}function Wt(t,e){return Vt(t,e,function(t){return{x:t.x+t.width/2*Math.cos(t.rotation)+t.height/2*Math.sin(-t.rotation),y:t.y+t.height/2*Math.cos(t.rotation)+t.width/2*Math.sin(t.rotation)}}(t))}class Zt extends rt{constructor(t){super(t),this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(Ht,this.update),this.getNode()&&this.update()}attachTo(t){return this.setNode(t),this}setNode(t){return d.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([t])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return"tr-konva"+this._id}setNodes(t=[]){return this._nodes&&this._nodes.length&&this.detach(),this._nodes=t,1===t.length&&this.useSingleNodeRotation()?this.rotation(t[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(t=>{const e=()=>{1===this.nodes().length&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),this._transforming||this.isDragging()||this.update()},i=t._attrsAffectingSize.map(t=>t+"Change."+this._getEventNamespace()).join(" ");t.on(i,e),t.on(jt.map(t=>t+"."+this._getEventNamespace()).join(" "),e),t.on("absoluteTransformChange."+this._getEventNamespace(),e),this._proxyDrag(t)}),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(t){let e;t.on("dragstart."+this._getEventNamespace(),i=>{e=t.getAbsolutePosition(),this.isDragging()||t===this.findOne(".back")||this.startDrag(i,!1)}),t.on("dragmove."+this._getEventNamespace(),i=>{if(!e)return;const n=t.getAbsolutePosition(),r=n.x-e.x,s=n.y-e.y;this.nodes().forEach(e=>{if(e===t)return;if(e.isDragging())return;const n=e.getAbsolutePosition();e.setAbsolutePosition({x:n.x+r,y:n.y+s}),e.startDrag(i)}),e=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(t=>{t.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache("nodesRect"),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache("nodesRect",this.__getNodeRect)}__getNodeShape(t,e=this.rotation(),i){var r=t.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),s=t.getAbsoluteScale(i),o=t.getAbsolutePosition(i),a=r.x*s.x-t.offsetX()*s.x,h=r.y*s.y-t.offsetY()*s.y;const l=(n.a.getAngle(t.getAbsoluteRotation())+2*Math.PI)%(2*Math.PI);return Vt({x:o.x+a*Math.cos(l)+h*Math.sin(-l),y:o.y+h*Math.cos(l)+a*Math.sin(l),width:r.width*s.x,height:r.height*s.y,rotation:l},-n.a.getAngle(e),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const t=[];this.nodes().map(e=>{const i=e.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()});var n=[{x:i.x,y:i.y},{x:i.x+i.width,y:i.y},{x:i.x+i.width,y:i.y+i.height},{x:i.x,y:i.y+i.height}],r=e.getAbsoluteTransform();n.forEach((function(e){var i=r.point(e);t.push(i)}))});const e=new r;var i,s,o,a;e.rotate(-n.a.getAngle(this.rotation())),t.forEach((function(t){var n=e.point(t);void 0===i&&(i=o=n.x,s=a=n.y),i=Math.min(i,n.x),s=Math.min(s,n.y),o=Math.max(o,n.x),a=Math.max(a,n.y)})),e.invert();const h=e.point({x:i,y:s});return{x:h.x,y:h.y,width:o-i,height:a-s,rotation:n.a.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),Yt.forEach(function(t){this._createAnchor(t)}.bind(this)),this._createAnchor("rotater")}_createAnchor(t){var e=new Rt({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:t+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:qt?10:"auto"}),i=this;e.on("mousedown touchstart",(function(t){i._handleMouseDown(t)})),e.on("dragstart",t=>{e.stopDrag(),t.cancelBubble=!0}),e.on("dragend",t=>{t.cancelBubble=!0}),e.on("mouseenter",()=>{var i=n.a.getAngle(this.rotation()),r=function(t,e){if("rotater"===t)return"crosshair";e+=d.degToRad($t[t]||0);var i=(d.radToDeg(e)%360+360)%360;return d._inRange(i,337.5,360)||d._inRange(i,0,22.5)?"ns-resize":d._inRange(i,22.5,67.5)?"nesw-resize":d._inRange(i,67.5,112.5)?"ew-resize":d._inRange(i,112.5,157.5)?"nwse-resize":d._inRange(i,157.5,202.5)?"ns-resize":d._inRange(i,202.5,247.5)?"nesw-resize":d._inRange(i,247.5,292.5)?"ew-resize":d._inRange(i,292.5,337.5)?"nwse-resize":(d.error("Transformer has unknown angle for cursor detection: "+i),"pointer")}(t,i);e.getStage().content&&(e.getStage().content.style.cursor=r),this._cursorChange=!0}),e.on("mouseout",()=>{e.getStage().content&&(e.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(e)}_createBack(){var t=new J({name:"back",width:0,height:0,draggable:!0,sceneFunc(t){var e=this.getParent(),i=e.padding();t.beginPath(),t.rect(-i,-i,this.width()+2*i,this.height()+2*i),t.moveTo(this.width()/2,-i),e.rotateEnabled()&&t.lineTo(this.width()/2,-e.rotateAnchorOffset()*d._sign(this.height())-i),t.fillStrokeShape(this)},hitFunc:(t,e)=>{if(this.shouldOverdrawWholeArea()){var i=this.padding();t.beginPath(),t.rect(-i,-i,e.width()+2*i,e.height()+2*i),t.fillStrokeShape(e)}}});this.add(t),this._proxyDrag(t),t.on("dragstart",t=>{t.cancelBubble=!0}),t.on("dragmove",t=>{t.cancelBubble=!0}),t.on("dragend",t=>{t.cancelBubble=!0}),this.on("dragmove",t=>{this.update()})}_handleMouseDown(t){this._movingAnchorName=t.target.name().split(" ")[0];var e=this._getNodeRect(),i=e.width,n=e.height,r=Math.sqrt(Math.pow(i,2)+Math.pow(n,2));this.sin=Math.abs(n/r),this.cos=Math.abs(i/r),"undefined"!=typeof window&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;var s=t.target.getAbsolutePosition(),o=t.target.getStage().getPointerPosition();this._anchorDragOffset={x:o.x-s.x,y:o.y-s.y},this._fire("transformstart",{evt:t.evt,target:this.getNode()}),this._nodes.forEach(e=>{e._fire("transformstart",{evt:t.evt,target:e})})}_handleMouseMove(t){var e,i,r,s=this.findOne("."+this._movingAnchorName),o=s.getStage();o.setPointersPositions(t);const a=o.getPointerPosition();let h={x:a.x-this._anchorDragOffset.x,y:a.y-this._anchorDragOffset.y};const l=s.getAbsolutePosition();this.anchorDragBoundFunc()&&(h=this.anchorDragBoundFunc()(l,h,t)),s.setAbsolutePosition(h);const c=s.getAbsolutePosition();if(l.x!==c.x||l.y!==c.y)if("rotater"!==this._movingAnchorName){var d=this.keepRatio()||t.shiftKey,g=this.centeredScaling()||t.altKey;if("top-left"===this._movingAnchorName){if(d){var u=g?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};r=Math.sqrt(Math.pow(u.x-s.x(),2)+Math.pow(u.y-s.y(),2));var p=this.findOne(".top-left").x()>u.x?-1:1,f=this.findOne(".top-left").y()>u.y?-1:1;e=r*this.cos*p,i=r*this.sin*f,this.findOne(".top-left").x(u.x-e),this.findOne(".top-left").y(u.y-i)}}else if("top-center"===this._movingAnchorName)this.findOne(".top-left").y(s.y());else if("top-right"===this._movingAnchorName){if(d){u=g?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};r=Math.sqrt(Math.pow(s.x()-u.x,2)+Math.pow(u.y-s.y(),2));p=this.findOne(".top-right").x()<u.x?-1:1,f=this.findOne(".top-right").y()>u.y?-1:1;e=r*this.cos*p,i=r*this.sin*f,this.findOne(".top-right").x(u.x+e),this.findOne(".top-right").y(u.y-i)}var y=s.position();this.findOne(".top-left").y(y.y),this.findOne(".bottom-right").x(y.x)}else if("middle-left"===this._movingAnchorName)this.findOne(".top-left").x(s.x());else if("middle-right"===this._movingAnchorName)this.findOne(".bottom-right").x(s.x());else if("bottom-left"===this._movingAnchorName){if(d){u=g?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};r=Math.sqrt(Math.pow(u.x-s.x(),2)+Math.pow(s.y()-u.y,2));p=u.x<s.x()?-1:1,f=s.y()<u.y?-1:1;e=r*this.cos*p,i=r*this.sin*f,s.x(u.x-e),s.y(u.y+i)}y=s.position(),this.findOne(".top-left").x(y.x),this.findOne(".bottom-right").y(y.y)}else if("bottom-center"===this._movingAnchorName)this.findOne(".bottom-right").y(s.y());else if("bottom-right"===this._movingAnchorName){if(d){u=g?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};r=Math.sqrt(Math.pow(s.x()-u.x,2)+Math.pow(s.y()-u.y,2));p=this.findOne(".bottom-right").x()<u.x?-1:1,f=this.findOne(".bottom-right").y()<u.y?-1:1;e=r*this.cos*p,i=r*this.sin*f,this.findOne(".bottom-right").x(u.x+e),this.findOne(".bottom-right").y(u.y+i)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));if(g=this.centeredScaling()||t.altKey){var m=this.findOne(".top-left"),v=this.findOne(".bottom-right"),b=m.x(),S=m.y(),x=this.getWidth()-v.x(),w=this.getHeight()-v.y();v.move({x:-b,y:-S}),m.move({x:x,y:w})}var C=this.findOne(".top-left").getAbsolutePosition();e=C.x,i=C.y;var A=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),T=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:e,y:i,width:A,height:T,rotation:n.a.getAngle(this.rotation())},t)}else{var _=this._getNodeRect();e=s.x()-_.width/2,i=-s.y()+_.height/2;let r=Math.atan2(-i,e)+Math.PI/2;_.height<0&&(r-=Math.PI);const o=n.a.getAngle(this.rotation())+r,a=n.a.getAngle(this.rotationSnapTolerance()),h=Wt(_,function(t,e,i){let r=e;for(let s=0;s<t.length;s++){const o=n.a.getAngle(t[s]),a=Math.abs(o-e)%(2*Math.PI);Math.min(a,2*Math.PI-a)<i&&(r=o)}return r}(this.rotationSnaps(),o,a)-_.rotation);this._fitNodesInto(h,t)}}_handleMouseUp(t){this._removeEvents(t)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(t){if(this._transforming){this._transforming=!1,"undefined"!=typeof window&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));var e=this.getNode();this._fire("transformend",{evt:t,target:e}),e&&this._nodes.forEach(e=>{e._fire("transformend",{evt:t,target:e})}),this._movingAnchorName=null}}_fitNodesInto(t,e){var i=this._getNodeRect();if(d._inRange(t.width,2*-this.padding()-1,1))return void this.update();if(d._inRange(t.height,2*-this.padding()-1,1))return void this.update();const s=this.flipEnabled();var o=new r;if(o.rotate(n.a.getAngle(this.rotation())),this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("left")>=0){const e=o.point({x:2*-this.padding(),y:0});if(t.x+=e.x,t.y+=e.y,t.width+=2*this.padding(),this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,!s)return void this.update()}else if(this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("right")>=0){const e=o.point({x:2*this.padding(),y:0});if(this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,t.width+=2*this.padding(),!s)return void this.update()}if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("top")>=0){const e=o.point({x:0,y:2*-this.padding()});if(t.x+=e.x,t.y+=e.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,t.height+=2*this.padding(),!s)return void this.update()}else if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const e=o.point({x:0,y:2*this.padding()});if(this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,t.height+=2*this.padding(),!s)return void this.update()}if(this.boundBoxFunc()){const e=this.boundBoxFunc()(i,t);e?t=e:d.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const a=new r;a.translate(i.x,i.y),a.rotate(i.rotation),a.scale(i.width/1e7,i.height/1e7);const h=new r;h.translate(t.x,t.y),h.rotate(t.rotation),h.scale(t.width/1e7,t.height/1e7);const l=h.multiply(a.invert());this._nodes.forEach(t=>{var i;const n=t.getParent().getAbsoluteTransform(),s=t.getTransform().copy();s.translate(t.offsetX(),t.offsetY());const o=new r;o.multiply(n.copy().invert()).multiply(l).multiply(n).multiply(s);const a=o.decompose();t.setAttrs(a),this._fire("transform",{evt:e,target:t}),t._fire("transform",{evt:e,target:t}),null===(i=t.getLayer())||void 0===i||i.batchDraw()}),this.rotation(d._getRotation(t.rotation)),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(t,e){this.findOne(t).setAttrs(e)}update(){var t,e=this._getNodeRect();this.rotation(d._getRotation(e.rotation));var i=e.width,n=e.height,r=this.enabledAnchors(),s=this.resizeEnabled(),o=this.padding(),a=this.anchorSize();this.find("._anchor").forEach(t=>{t.setAttrs({width:a,height:a,offsetX:a/2,offsetY:a/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:a/2+o,offsetY:a/2+o,visible:s&&r.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:i/2,y:0,offsetY:a/2+o,visible:s&&r.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:i,y:0,offsetX:a/2-o,offsetY:a/2+o,visible:s&&r.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:n/2,offsetX:a/2+o,visible:s&&r.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:i,y:n/2,offsetX:a/2-o,visible:s&&r.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:n,offsetX:a/2+o,offsetY:a/2-o,visible:s&&r.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:i/2,y:n,offsetY:a/2-o,visible:s&&r.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:i,y:n,offsetX:a/2-o,offsetY:a/2-o,visible:s&&r.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:i/2,y:-this.rotateAnchorOffset()*d._sign(n)-o,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:i,height:n,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0}),null===(t=this.getLayer())||void 0===t||t.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();var t=this.findOne("."+this._movingAnchorName);t&&t.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),rt.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return I.prototype.toObject.call(this)}clone(t){return I.prototype.clone.call(this,t)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}Zt.prototype.className="Transformer",Object(n.b)(Zt),S.addGetterSetter(Zt,"enabledAnchors",Yt,(function(t){return t instanceof Array||d.warn("enabledAnchors value should be an array"),t instanceof Array&&t.forEach((function(t){-1===Yt.indexOf(t)&&d.warn("Unknown anchor name: "+t+". Available names are: "+Yt.join(", "))})),t||[]})),S.addGetterSetter(Zt,"flipEnabled",!0,b()),S.addGetterSetter(Zt,"resizeEnabled",!0),S.addGetterSetter(Zt,"anchorSize",10,p()),S.addGetterSetter(Zt,"rotateEnabled",!0),S.addGetterSetter(Zt,"rotationSnaps",[]),S.addGetterSetter(Zt,"rotateAnchorOffset",50,p()),S.addGetterSetter(Zt,"rotationSnapTolerance",5,p()),S.addGetterSetter(Zt,"borderEnabled",!0),S.addGetterSetter(Zt,"anchorStroke","rgb(0, 161, 255)"),S.addGetterSetter(Zt,"anchorStrokeWidth",1,p()),S.addGetterSetter(Zt,"anchorFill","white"),S.addGetterSetter(Zt,"anchorCornerRadius",0,p()),S.addGetterSetter(Zt,"borderStroke","rgb(0, 161, 255)"),S.addGetterSetter(Zt,"borderStrokeWidth",1,p()),S.addGetterSetter(Zt,"borderDash"),S.addGetterSetter(Zt,"keepRatio",!0),S.addGetterSetter(Zt,"centeredScaling",!1),S.addGetterSetter(Zt,"ignoreStroke",!1),S.addGetterSetter(Zt,"padding",0,p()),S.addGetterSetter(Zt,"node"),S.addGetterSetter(Zt,"nodes"),S.addGetterSetter(Zt,"boundBoxFunc"),S.addGetterSetter(Zt,"anchorDragBoundFunc"),S.addGetterSetter(Zt,"shouldOverdrawWholeArea",!1),S.addGetterSetter(Zt,"useSingleNodeRotation",!0),S.backCompat(Zt,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});class Kt extends J{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.radius(),0,n.a.getAngle(this.angle()),this.clockwise()),t.lineTo(0,0),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(t){this.radius(t/2)}setHeight(t){this.radius(t/2)}}function Xt(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}Kt.prototype.className="Wedge",Kt.prototype._centroid=!0,Kt.prototype._attrsAffectingSize=["radius"],Object(n.b)(Kt),S.addGetterSetter(Kt,"radius",0,p()),S.addGetterSetter(Kt,"angle",0,p()),S.addGetterSetter(Kt,"clockwise",!1),S.backCompat(Kt,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});var Qt=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],Jt=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];S.addGetterSetter(I,"blurRadius",0,p(),S.afterSetFilter);S.addGetterSetter(I,"brightness",0,p(),S.afterSetFilter);S.addGetterSetter(I,"contrast",0,p(),S.afterSetFilter);function te(t,e,i,n,r){var s=i-e,o=r-n;return 0===s?n+o/2:0===o?n:o*((t-e)/s)+n}S.addGetterSetter(I,"embossStrength",.5,p(),S.afterSetFilter),S.addGetterSetter(I,"embossWhiteLevel",.5,p(),S.afterSetFilter),S.addGetterSetter(I,"embossDirection","top-left",null,S.afterSetFilter),S.addGetterSetter(I,"embossBlend",!1,null,S.afterSetFilter);S.addGetterSetter(I,"enhance",0,p(),S.afterSetFilter);S.addGetterSetter(I,"hue",0,p(),S.afterSetFilter),S.addGetterSetter(I,"saturation",0,p(),S.afterSetFilter),S.addGetterSetter(I,"luminance",0,p(),S.afterSetFilter);S.addGetterSetter(I,"hue",0,p(),S.afterSetFilter),S.addGetterSetter(I,"saturation",0,p(),S.afterSetFilter),S.addGetterSetter(I,"value",0,p(),S.afterSetFilter);function ee(t,e,i){var n=4*(i*t.width+e),r=[];return r.push(t.data[n++],t.data[n++],t.data[n++],t.data[n++]),r}function ie(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}S.addGetterSetter(I,"kaleidoscopePower",2,p(),S.afterSetFilter),S.addGetterSetter(I,"kaleidoscopeAngle",0,p(),S.afterSetFilter);S.addGetterSetter(I,"threshold",0,p(),S.afterSetFilter);S.addGetterSetter(I,"noise",.2,p(),S.afterSetFilter);S.addGetterSetter(I,"pixelSize",8,p(),S.afterSetFilter);S.addGetterSetter(I,"levels",.5,p(),S.afterSetFilter);S.addGetterSetter(I,"red",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),S.addGetterSetter(I,"green",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),S.addGetterSetter(I,"blue",0,u,S.afterSetFilter);S.addGetterSetter(I,"red",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),S.addGetterSetter(I,"green",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),S.addGetterSetter(I,"blue",0,u,S.afterSetFilter),S.addGetterSetter(I,"alpha",1,(function(t){return this._filterUpToDate=!1,t>1?1:t<0?0:t}));S.addGetterSetter(I,"threshold",.5,p(),S.afterSetFilter);const ne=ut.Util._assign(ut,{Arc:pt,Arrow:bt,Circle:St,Ellipse:xt,Image:wt,Label:Tt,Tag:_t,Line:mt,Path:vt,Rect:Rt,RegularPolygon:Pt,Ring:kt,Sprite:Mt,Star:Dt,Text:Gt,TextPath:Ut,Transformer:Zt,Wedge:Kt,Filters:{Blur:function(t){var e=Math.round(this.blurRadius());e>0&&function(t,e){var i,n,r,s,o,a,h,l,c,d,g,u,p,f,y,m,v,b,S,x,w,C,A,T,_=t.data,R=t.width,P=t.height,E=e+e+1,k=R-1,M=P-1,D=e+1,I=D*(D+1)/2,B=new Xt,O=null,L=B,F=null,G=null,N=Qt[e],z=Jt[e];for(r=1;r<E;r++)L=L.next=new Xt,r===D&&(O=L);for(L.next=B,h=a=0,n=0;n<P;n++){for(m=v=b=S=l=c=d=g=0,u=D*(x=_[a]),p=D*(w=_[a+1]),f=D*(C=_[a+2]),y=D*(A=_[a+3]),l+=I*x,c+=I*w,d+=I*C,g+=I*A,L=B,r=0;r<D;r++)L.r=x,L.g=w,L.b=C,L.a=A,L=L.next;for(r=1;r<D;r++)s=a+((k<r?k:r)<<2),l+=(L.r=x=_[s])*(T=D-r),c+=(L.g=w=_[s+1])*T,d+=(L.b=C=_[s+2])*T,g+=(L.a=A=_[s+3])*T,m+=x,v+=w,b+=C,S+=A,L=L.next;for(F=B,G=O,i=0;i<R;i++)_[a+3]=A=g*N>>z,0!==A?(A=255/A,_[a]=(l*N>>z)*A,_[a+1]=(c*N>>z)*A,_[a+2]=(d*N>>z)*A):_[a]=_[a+1]=_[a+2]=0,l-=u,c-=p,d-=f,g-=y,u-=F.r,p-=F.g,f-=F.b,y-=F.a,s=h+((s=i+e+1)<k?s:k)<<2,l+=m+=F.r=_[s],c+=v+=F.g=_[s+1],d+=b+=F.b=_[s+2],g+=S+=F.a=_[s+3],F=F.next,u+=x=G.r,p+=w=G.g,f+=C=G.b,y+=A=G.a,m-=x,v-=w,b-=C,S-=A,G=G.next,a+=4;h+=R}for(i=0;i<R;i++){for(v=b=S=m=c=d=g=l=0,u=D*(x=_[a=i<<2]),p=D*(w=_[a+1]),f=D*(C=_[a+2]),y=D*(A=_[a+3]),l+=I*x,c+=I*w,d+=I*C,g+=I*A,L=B,r=0;r<D;r++)L.r=x,L.g=w,L.b=C,L.a=A,L=L.next;for(o=R,r=1;r<=e;r++)a=o+i<<2,l+=(L.r=x=_[a])*(T=D-r),c+=(L.g=w=_[a+1])*T,d+=(L.b=C=_[a+2])*T,g+=(L.a=A=_[a+3])*T,m+=x,v+=w,b+=C,S+=A,L=L.next,r<M&&(o+=R);for(a=i,F=B,G=O,n=0;n<P;n++)_[(s=a<<2)+3]=A=g*N>>z,A>0?(A=255/A,_[s]=(l*N>>z)*A,_[s+1]=(c*N>>z)*A,_[s+2]=(d*N>>z)*A):_[s]=_[s+1]=_[s+2]=0,l-=u,c-=p,d-=f,g-=y,u-=F.r,p-=F.g,f-=F.b,y-=F.a,s=i+((s=n+D)<M?s:M)*R<<2,l+=m+=F.r=_[s],c+=v+=F.g=_[s+1],d+=b+=F.b=_[s+2],g+=S+=F.a=_[s+3],F=F.next,u+=x=G.r,p+=w=G.g,f+=C=G.b,y+=A=G.a,m-=x,v-=w,b-=C,S-=A,G=G.next,a+=R}}(t,e)},Brighten:function(t){var e,i=255*this.brightness(),n=t.data,r=n.length;for(e=0;e<r;e+=4)n[e]+=i,n[e+1]+=i,n[e+2]+=i},Contrast:function(t){var e,i=Math.pow((this.contrast()+100)/100,2),n=t.data,r=n.length,s=150,o=150,a=150;for(e=0;e<r;e+=4)s=n[e],o=n[e+1],a=n[e+2],s/=255,s-=.5,s*=i,s+=.5,o/=255,o-=.5,o*=i,o+=.5,a/=255,a-=.5,a*=i,a+=.5,s=(s*=255)<0?0:s>255?255:s,o=(o*=255)<0?0:o>255?255:o,a=(a*=255)<0?0:a>255?255:a,n[e]=s,n[e+1]=o,n[e+2]=a},Emboss:function(t){var e=10*this.embossStrength(),i=255*this.embossWhiteLevel(),n=this.embossDirection(),r=this.embossBlend(),s=0,o=0,a=t.data,h=t.width,l=t.height,c=4*h,g=l;switch(n){case"top-left":s=-1,o=-1;break;case"top":s=-1,o=0;break;case"top-right":s=-1,o=1;break;case"right":s=0,o=1;break;case"bottom-right":s=1,o=1;break;case"bottom":s=1,o=0;break;case"bottom-left":s=1,o=-1;break;case"left":s=0,o=-1;break;default:d.error("Unknown emboss direction: "+n)}do{var u=(g-1)*c,p=s;g+p<1&&(p=0),g+p>l&&(p=0);var f=(g-1+p)*h*4,y=h;do{var m=u+4*(y-1),v=o;y+v<1&&(v=0),y+v>h&&(v=0);var b=f+4*(y-1+v),S=a[m]-a[b],x=a[m+1]-a[b+1],w=a[m+2]-a[b+2],C=S,A=C>0?C:-C;if((x>0?x:-x)>A&&(C=x),(w>0?w:-w)>A&&(C=w),C*=e,r){var T=a[m]+C,_=a[m+1]+C,R=a[m+2]+C;a[m]=T>255?255:T<0?0:T,a[m+1]=_>255?255:_<0?0:_,a[m+2]=R>255?255:R<0?0:R}else{var P=i-C;P<0?P=0:P>255&&(P=255),a[m]=a[m+1]=a[m+2]=P}}while(--y)}while(--g)},Enhance:function(t){var e,i,n,r,s=t.data,o=s.length,a=s[0],h=a,l=s[1],c=l,d=s[2],g=d,u=this.enhance();if(0!==u){for(r=0;r<o;r+=4)(e=s[r+0])<a?a=e:e>h&&(h=e),(i=s[r+1])<l?l=i:i>c&&(c=i),(n=s[r+2])<d?d=n:n>g&&(g=n);var p,f,y,m,v,b,S,x,w;for(h===a&&(h=255,a=0),c===l&&(c=255,l=0),g===d&&(g=255,d=0),u>0?(f=h+u*(255-h),y=a-u*(a-0),v=c+u*(255-c),b=l-u*(l-0),x=g+u*(255-g),w=d-u*(d-0)):(f=h+u*(h-(p=.5*(h+a))),y=a+u*(a-p),v=c+u*(c-(m=.5*(c+l))),b=l+u*(l-m),x=g+u*(g-(S=.5*(g+d))),w=d+u*(d-S)),r=0;r<o;r+=4)s[r+0]=te(s[r+0],a,h,y,f),s[r+1]=te(s[r+1],l,c,b,v),s[r+2]=te(s[r+2],d,g,w,x)}},Grayscale:function(t){var e,i,n=t.data,r=n.length;for(e=0;e<r;e+=4)i=.34*n[e]+.5*n[e+1]+.16*n[e+2],n[e]=i,n[e+1]=i,n[e+2]=i},HSL:function(t){var e,i,n,r,s,o=t.data,a=o.length,h=Math.pow(2,this.saturation()),l=Math.abs(this.hue()+360)%360,c=127*this.luminance(),d=1*h*Math.cos(l*Math.PI/180),g=1*h*Math.sin(l*Math.PI/180),u=.299+.701*d+.167*g,p=.587-.587*d+.33*g,f=.114-.114*d-.497*g,y=.299-.299*d-.328*g,m=.587+.413*d+.035*g,v=.114-.114*d+.293*g,b=.299-.3*d+1.25*g,S=.587-.586*d-1.05*g,x=.114+.886*d-.2*g;for(e=0;e<a;e+=4)i=o[e+0],n=o[e+1],r=o[e+2],s=o[e+3],o[e+0]=u*i+p*n+f*r+c,o[e+1]=y*i+m*n+v*r+c,o[e+2]=b*i+S*n+x*r+c,o[e+3]=s},HSV:function(t){var e,i,n,r,s,o=t.data,a=o.length,h=Math.pow(2,this.value()),l=Math.pow(2,this.saturation()),c=Math.abs(this.hue()+360)%360,d=h*l*Math.cos(c*Math.PI/180),g=h*l*Math.sin(c*Math.PI/180),u=.299*h+.701*d+.167*g,p=.587*h-.587*d+.33*g,f=.114*h-.114*d-.497*g,y=.299*h-.299*d-.328*g,m=.587*h+.413*d+.035*g,v=.114*h-.114*d+.293*g,b=.299*h-.3*d+1.25*g,S=.587*h-.586*d-1.05*g,x=.114*h+.886*d-.2*g;for(e=0;e<a;e+=4)i=o[e+0],n=o[e+1],r=o[e+2],s=o[e+3],o[e+0]=u*i+p*n+f*r,o[e+1]=y*i+m*n+v*r,o[e+2]=b*i+S*n+x*r,o[e+3]=s},Invert:function(t){var e,i=t.data,n=i.length;for(e=0;e<n;e+=4)i[e]=255-i[e],i[e+1]=255-i[e+1],i[e+2]=255-i[e+2]},Kaleidoscope:function(t){var e,i,n,r,s,o,a,h,l,c=t.width,g=t.height,u=Math.round(this.kaleidoscopePower()),p=Math.round(this.kaleidoscopeAngle()),f=Math.floor(c*(p%360)/360);if(!(u<1)){var y=d.createCanvasElement();y.width=c,y.height=g;var m=y.getContext("2d").getImageData(0,0,c,g);d.releaseCanvas(y),function(t,e,i){var n,r,s,o,a=t.data,h=e.data,l=t.width,c=t.height,d=i.polarCenterX||l/2,g=i.polarCenterY||c/2,u=0,p=0,f=0,y=0,m=Math.sqrt(d*d+g*g);r=l-d,s=c-g,m=(o=Math.sqrt(r*r+s*s))>m?o:m;var v,b,S,x,w=c,C=l,A=360/C*Math.PI/180;for(b=0;b<C;b+=1)for(S=Math.sin(b*A),x=Math.cos(b*A),v=0;v<w;v+=1)r=Math.floor(d+m*v/w*x),u=a[(n=4*((s=Math.floor(g+m*v/w*S))*l+r))+0],p=a[n+1],f=a[n+2],y=a[n+3],h[(n=4*(b+v*l))+0]=u,h[n+1]=p,h[n+2]=f,h[n+3]=y}(t,m,{polarCenterX:c/2,polarCenterY:g/2});for(var v=c/Math.pow(2,u);v<=8;)v*=2,u-=1;var b=v=Math.ceil(v),S=0,x=b,w=1;for(f+v>c&&(S=b,x=0,w=-1),i=0;i<g;i+=1)for(e=S;e!==x;e+=w)h=4*(c*i+Math.round(e+f)%c),r=m.data[h+0],s=m.data[h+1],o=m.data[h+2],a=m.data[h+3],l=4*(c*i+e),m.data[l+0]=r,m.data[l+1]=s,m.data[l+2]=o,m.data[l+3]=a;for(i=0;i<g;i+=1)for(b=Math.floor(v),n=0;n<u;n+=1){for(e=0;e<b+1;e+=1)h=4*(c*i+e),r=m.data[h+0],s=m.data[h+1],o=m.data[h+2],a=m.data[h+3],l=4*(c*i+2*b-e-1),m.data[l+0]=r,m.data[l+1]=s,m.data[l+2]=o,m.data[l+3]=a;b*=2}!function(t,e,i){var n,r,s,o,a,h,l=t.data,c=e.data,d=t.width,g=t.height,u=i.polarCenterX||d/2,p=i.polarCenterY||g/2,f=0,y=0,m=0,v=0,b=Math.sqrt(u*u+p*p);r=d-u,s=g-p,b=(h=Math.sqrt(r*r+s*s))>b?h:b;var S,x,w,C=g,A=d,T=i.polarRotation||0;for(r=0;r<d;r+=1)for(s=0;s<g;s+=1)o=r-u,a=s-p,S=Math.sqrt(o*o+a*a)*C/b,x=(x=(180*Math.atan2(a,o)/Math.PI+360+T)%360)*A/360,w=Math.floor(x),f=l[(n=4*(Math.floor(S)*d+w))+0],y=l[n+1],m=l[n+2],v=l[n+3],c[(n=4*(s*d+r))+0]=f,c[n+1]=y,c[n+2]=m,c[n+3]=v}(m,t,{polarRotation:0})}},Mask:function(t){var e=function(t,e){var i=ee(t,0,0),n=ee(t,t.width-1,0),r=ee(t,0,t.height-1),s=ee(t,t.width-1,t.height-1),o=e||10;if(ie(i,n)<o&&ie(n,s)<o&&ie(s,r)<o&&ie(r,i)<o){for(var a=function(t){for(var e=[0,0,0],i=0;i<t.length;i++)e[0]+=t[i][0],e[1]+=t[i][1],e[2]+=t[i][2];return e[0]/=t.length,e[1]/=t.length,e[2]/=t.length,e}([n,i,s,r]),h=[],l=0;l<t.width*t.height;l++){var c=ie(a,[t.data[4*l],t.data[4*l+1],t.data[4*l+2]]);h[l]=c<o?0:255}return h}}(t,this.threshold());return e&&function(t,e){for(var i=0;i<t.width*t.height;i++)t.data[4*i+3]=e[i]}(t,e=function(t,e,i){for(var n=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],r=Math.round(Math.sqrt(n.length)),s=Math.floor(r/2),o=[],a=0;a<i;a++)for(var h=0;h<e;h++){for(var l=a*e+h,c=0,d=0;d<r;d++)for(var g=0;g<r;g++){var u=a+d-s,p=h+g-s;if(u>=0&&u<i&&p>=0&&p<e){var f=n[d*r+g];c+=t[u*e+p]*f}}o[l]=c}return o}(e=function(t,e,i){for(var n=[1,1,1,1,1,1,1,1,1],r=Math.round(Math.sqrt(n.length)),s=Math.floor(r/2),o=[],a=0;a<i;a++)for(var h=0;h<e;h++){for(var l=a*e+h,c=0,d=0;d<r;d++)for(var g=0;g<r;g++){var u=a+d-s,p=h+g-s;if(u>=0&&u<i&&p>=0&&p<e){var f=n[d*r+g];c+=t[u*e+p]*f}}o[l]=c>=1020?255:0}return o}(e=function(t,e,i){for(var n=[1,1,1,1,0,1,1,1,1],r=Math.round(Math.sqrt(n.length)),s=Math.floor(r/2),o=[],a=0;a<i;a++)for(var h=0;h<e;h++){for(var l=a*e+h,c=0,d=0;d<r;d++)for(var g=0;g<r;g++){var u=a+d-s,p=h+g-s;if(u>=0&&u<i&&p>=0&&p<e){var f=n[d*r+g];c+=t[u*e+p]*f}}o[l]=2040===c?255:0}return o}(e,t.width,t.height),t.width,t.height),t.width,t.height)),t},Noise:function(t){var e,i=255*this.noise(),n=t.data,r=n.length,s=i/2;for(e=0;e<r;e+=4)n[e+0]+=s-2*s*Math.random(),n[e+1]+=s-2*s*Math.random(),n[e+2]+=s-2*s*Math.random()},Pixelate:function(t){var e,i,n,r,s,o,a,h,l,c,g,u,p,f,y=Math.ceil(this.pixelSize()),m=t.width,v=t.height,b=Math.ceil(m/y),S=Math.ceil(v/y),x=t.data;if(y<=0)d.error("pixelSize value can not be <= 0");else for(u=0;u<b;u+=1)for(p=0;p<S;p+=1){for(r=0,s=0,o=0,a=0,l=(h=u*y)+y,g=(c=p*y)+y,f=0,e=h;e<l;e+=1)if(!(e>=m))for(i=c;i<g;i+=1)i>=v||(r+=x[(n=4*(m*i+e))+0],s+=x[n+1],o+=x[n+2],a+=x[n+3],f+=1);for(r/=f,s/=f,o/=f,a/=f,e=h;e<l;e+=1)if(!(e>=m))for(i=c;i<g;i+=1)i>=v||(x[(n=4*(m*i+e))+0]=r,x[n+1]=s,x[n+2]=o,x[n+3]=a)}},Posterize:function(t){var e,i=Math.round(254*this.levels())+1,n=t.data,r=n.length,s=255/i;for(e=0;e<r;e+=1)n[e]=Math.floor(n[e]/s)*s},RGB:function(t){var e,i,n=t.data,r=n.length,s=this.red(),o=this.green(),a=this.blue();for(e=0;e<r;e+=4)i=(.34*n[e]+.5*n[e+1]+.16*n[e+2])/255,n[e]=i*s,n[e+1]=i*o,n[e+2]=i*a,n[e+3]=n[e+3]},RGBA:function(t){var e,i,n=t.data,r=n.length,s=this.red(),o=this.green(),a=this.blue(),h=this.alpha();for(e=0;e<r;e+=4)i=1-h,n[e]=s*h+n[e]*i,n[e+1]=o*h+n[e+1]*i,n[e+2]=a*h+n[e+2]*i},Sepia:function(t){var e,i,n,r,s=t.data,o=s.length;for(e=0;e<o;e+=4)i=s[e+0],n=s[e+1],r=s[e+2],s[e+0]=Math.min(255,.393*i+.769*n+.189*r),s[e+1]=Math.min(255,.349*i+.686*n+.168*r),s[e+2]=Math.min(255,.272*i+.534*n+.131*r)},Solarize:function(t){var e=t.data,i=t.width,n=4*i,r=t.height;do{var s=(r-1)*n,o=i;do{var a=s+4*(o-1),h=e[a],l=e[a+1],c=e[a+2];h>127&&(h=255-h),l>127&&(l=255-l),c>127&&(c=255-c),e[a]=h,e[a+1]=l,e[a+2]=c}while(--o)}while(--r)},Threshold:function(t){var e,i=255*this.threshold(),n=t.data,r=n.length;for(e=0;e<r;e+=1)n[e]=n[e]<i?0:255}}});e.default=ne}])}));
//# sourceMappingURL=ct.min.js.map